"use strict";(self.webpackChunkenergy_and_water_dashboard=self.webpackChunkenergy_and_water_dashboard||[]).push([[3337],{93337:function(e,t,r){r.r(t),r.d(t,{default:function(){return Q}});var n=r(4942),i=r(15861),a=r(15671),o=r(43144),s=r(60136),u=r(6215),c=r(61120),l=r(87757),p=r.n(l),h=r(83195),f=r(75571),y=r(37566),d=r(89636),v=(r(43079),r(33682),r(64003),r(30732)),m=r(74023),g=r(57047),b=r(17396),w=r(74649),x=r(11752),O=(r(97182),r(4761));function Z(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.Z)(e);if(t){var i=(0,c.Z)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,u.Z)(this,r)}}var P=function(e){(0,s.Z)(r,e);var t=Z(r);function r(){return(0,a.Z)(this,r),t.apply(this,arguments)}return(0,o.Z)(r,[{key:"renderChildren",value:function(e){if(e.drawPhase===O.jx.HIGHLIGHT&&(this.attributeView.bindTextures(e.context),this.children.some((function(e){return e.hasData})))){(0,x.Z)((0,c.Z)(r.prototype),"renderChildren",this).call(this,e);var t=e.painter.effects.highlight;t.bind(e),e.context.setColorMask(!0,!0,!0,!0),e.context.clear(16384),this._renderChildren(e,t.defines.concat(["highlightAll"])),t.draw(e),t.unbind()}}}]),r}(r(13505).Z),k=P=(0,h._)([(0,v.j)("esri.views.2d.layers.support.HighlightGraphicContainer")],P),_=r(99092),C=r(43798),j=r(93433),R=r(33300),I=r(10173),E=r(44946),D=r(53121),S=r(47417),q=r(18767),G=r(1815),U=r(57649);function V(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function A(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?V(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):V(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function M(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.Z)(e);if(t){var i=(0,c.Z)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,u.Z)(this,r)}}var F=r(51785),B=r(4641);function H(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function L(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.Z)(e);if(t){var i=(0,c.Z)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,u.Z)(this,r)}}var T=f.Z.getLogger("esri.views.2d.layers.MapImageLayerView2D"),N=function(e){(0,s.Z)(u,e);var t,r=L(u);function u(){var e;return(0,a.Z)(this,u),(e=r.apply(this,arguments))._highlightGraphics=new m.J,e}return(0,o.Z)(u,[{key:"update",value:function(e){this.strategy.update(e).catch((function(e){(0,y.D_)(e)||T.error(e)}))}},{key:"attach",value:function(){var e=this,t=this.layer,r=t.imageMaxWidth,n=t.imageMaxHeight,i=t.version,a=i>=10.3,o=i>=10;this._bitmapContainer=new g.c,this.container.addChild(this._bitmapContainer);var s=new w.Z({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:function(){return e.requestUpdate()},container:new k(this.view.featuresTilingScheme)});this.container.addChild(s.container),this.strategy=new _.Z({container:this._bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:r,imageMaxHeight:n,imageRotationSupported:a,imageNormalizationSupported:o,hidpi:!0}),this.handles.add(this.watch("exportImageVersion",(function(){return e.requestUpdate()})),"exportImageVersion"),this.handles.add(this.watch("view.floors",(function(){return e.requestUpdate()})),"view.floors"),this.requestUpdate()}},{key:"detach",value:function(){this.handles.remove("exportImageVersion"),this.handles.remove("view.floors"),this.strategy.destroy(),this.container.removeAllChildren(),this._bitmapContainer.removeAllChildren()}},{key:"moveStart",value:function(){}},{key:"viewChange",value:function(){}},{key:"moveEnd",value:function(){this.requestUpdate()}},{key:"highlight",value:function(e,t){var r=this;return this._highlightGraphics.add(e),{remove:function(){r._highlightGraphics.remove(e)}}}},{key:"createFetchPopupFeaturesQueryGeometry",value:function(e,t){return(0,B.K)(e,t,this.view)}},{key:"doRefresh",value:(t=(0,i.Z)(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.requestUpdate();case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"isUpdating",value:function(){return this.strategy.updating||this.updateRequested}},{key:"fetchImage",value:function(e,t,r,i){return this.layer.fetchImage(e,t,r,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?H(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({timeExtent:this.timeExtent,floors:this.view.floors},i))}}]),u}(function(e){var t=function(e){(0,s.Z)(n,e);var t,r=M(n);function n(){return(0,a.Z)(this,n),r.apply(this,arguments)}return(0,o.Z)(n,[{key:"initialize",value:function(){this.exportImageParameters=new D.R({layer:this.layer})}},{key:"destroy",value:function(){this.exportImageParameters.destroy(),this.exportImageParameters=null}},{key:"exportImageVersion",get:function(){var e;return null==(e=this.exportImageParameters)||e.commitProperty("version"),this.commitProperty("timeExtent"),(this._get("exportImageVersion")||0)+1}},{key:"fetchPopupFeatures",value:(t=(0,i.Z)(p().mark((function e(t,r){var n,a,o,s,u,c,l=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.layer,t){e.next=3;break}return e.abrupt("return",Promise.reject(new R.Z("mapimagelayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:n})));case 3:return a=this.get("view.scale"),o=[],s=function(){var e=(0,i.Z)(p().mark((function e(t){var n,i,u;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0===t.minScale||a<=t.minScale,i=0===t.maxScale||a>=t.maxScale,t.visible&&n&&i&&(t.sublayers?t.sublayers.forEach(s):t.popupEnabled&&(u=(0,G.V)(t,A(A({},r),{},{defaultPopupTemplateEnabled:!1})),(0,I.pC)(u)&&o.unshift({sublayer:t,popupTemplate:u})));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),u=n.sublayers.toArray().reverse().map(s),e.next=6,Promise.all(u);case 6:return c=o.map(function(){var e=(0,i.Z)(p().mark((function e(n){var i,a,o,s,u,c,h,f,y,d,v;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.sublayer,a=n.popupTemplate,e.next=3,i.load().catch((function(){}));case 3:return o=i.createQuery(),s=(0,I.pC)(r)?r.event:null,u=(0,S.k)({renderer:i.renderer,event:s}),c=l.createFetchPopupFeaturesQueryGeometry(t,u),o.geometry=c,e.next=7,(0,G.e)(i,a);case 7:if(o.outFields=e.sent,"map-image"!==l.layer.type||!("floors"in l.view)){e.next=11;break}y=null==(h=l.view)||null==(f=h.floors)?void 0:f.clone(),d=(0,U.ff)(y,i),(0,I.pC)(d)&&(o.where=o.where?"(".concat(o.where,") AND (").concat(d,")"):d);case 11:return e.next=13,l._loadArcadeModules(a);case 13:return(v=e.sent)&&v.arcadeUtils.hasGeometryOperations(a)||(o.maxAllowableOffset=c.width/u),e.next=17,i.queryFeatures(o);case 17:return e.abrupt("return",e.sent.features);case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=9,(0,y.as)(c);case 9:return e.abrupt("return",e.sent.reduce((function(e,t){return t.value?[].concat((0,j.Z)(e),(0,j.Z)(t.value)):e}),[]).filter((function(e){return null!=e})));case 10:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})},{key:"canResume",value:function(){var e;return!(!(0,x.Z)((0,c.Z)(n.prototype),"canResume",this).call(this)||null!=(e=this.timeExtent)&&e.isEmpty)}},{key:"_loadArcadeModules",value:function(e){if(e.get("expressionInfos.length")||Array.isArray(e.content)&&e.content.some((function(e){return"expression"===e.type})))return(0,q.LC)()}}]),n}(e);return(0,h._)([(0,d.Cb)()],t.prototype,"exportImageParameters",void 0),(0,h._)([(0,d.Cb)({readOnly:!0})],t.prototype,"exportImageVersion",null),(0,h._)([(0,d.Cb)()],t.prototype,"layer",void 0),(0,h._)([(0,d.Cb)()],t.prototype,"suspended",void 0),(0,h._)([(0,d.Cb)(E.qG)],t.prototype,"timeExtent",void 0),t=(0,h._)([(0,v.j)("esri.views.layers.MapImageLayerView")],t)}((0,F.y)((0,b.y)(C.Z))));(0,h._)([(0,d.Cb)()],N.prototype,"strategy",void 0),(0,h._)([(0,d.Cb)()],N.prototype,"updating",void 0);var Q=N=(0,h._)([(0,v.j)("esri.views.2d.layers.MapImageLayerView2D")],N)}}]);
//# sourceMappingURL=3337-dd67121e8ffdb447cac9.js.map