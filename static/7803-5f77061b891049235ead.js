"use strict";(self.webpackChunkenergy_and_water_dashboard=self.webpackChunkenergy_and_water_dashboard||[]).push([[7803],{17803:function(e,t,r){r.r(t),r.d(t,{default:function(){return E}});var n=r(4942),i=r(15861),a=r(15671),o=r(43144),s=r(60136),u=r(6215),c=r(61120),p=r(87757),h=r.n(p),l=r(83195),f=r(33300),y=r(75571),d=r(37566),m=r(89636),v=(r(43079),r(33682),r(64003),r(30732)),g=r(59007),w=r(57047),b=r(17396),x=r(99092),P=r(43798),Z=r(51785),_=r(44946),k=r(36055);function O(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.Z)(e);if(t){var i=(0,c.Z)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,u.Z)(this,r)}}function C(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function R(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.Z)(e);if(t){var i=(0,c.Z)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,u.Z)(this,r)}}var j,I,S=y.Z.getLogger("esri.views.2d.layers.WMSLayerView2D"),M=function(e){(0,s.Z)(u,e);var t,r=R(u);function u(){return(0,a.Z)(this,u),r.apply(this,arguments)}return(0,o.Z)(u,[{key:"initialize",value:function(){var e=this.layer,t=this.view;e.supportsSpatialReference(t.spatialReference)||this.addResolvingPromise(Promise.reject(new f.Z("layerview:spatial-reference-incompatible","The spatial references supported by this WMS layer are incompatible with the spatial reference of the view",{layer:e})))}},{key:"update",value:function(e){this.strategy.update(e).catch((function(e){(0,d.D_)(e)||S.error(e)}))}},{key:"attach",value:function(){var e=this,t=this.layer,r=t.imageMaxHeight,n=t.imageMaxWidth;this._bitmapContainer=new w.c,this.container.addChild(this._bitmapContainer),this.strategy=new x.Z({container:this._bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxHeight:r,imageMaxWidth:n,imageRotationSupported:!1,imageNormalizationSupported:!1,hidpi:!1}),this.handles.add(this.watch("exportImageVersion",(function(){return e.requestUpdate()})),"exportImageVersion")}},{key:"detach",value:function(){this.handles.remove("exportImageVersion"),this.strategy.destroy(),this.container.removeChild(this._bitmapContainer),this._bitmapContainer.removeAllChildren()}},{key:"moveStart",value:function(){}},{key:"viewChange",value:function(){}},{key:"moveEnd",value:function(){this.requestUpdate()}},{key:"createFetchPopupFeaturesQuery",value:function(e){var t=this.view,r=this._bitmapContainer,n=e.x,i=e.y,a=t.spatialReference,o=null,s=0,u=0;if(r.children.some((function(e){var t=e.width,r=e.height,c=e.resolution,p=e.x,h=e.y,l=p+c*t,f=h-c*r;return n>=p&&n<=l&&i<=h&&i>=f&&(o=new g.Z({xmin:p,ymin:f,xmax:l,ymax:h,spatialReference:a}),s=t,u=r,!0)})),!o)return null;var c=o.width/s,p=Math.round((n-o.xmin)/c),h=Math.round((o.ymax-i)/c);return{extent:o,width:s,height:u,x:p,y:h}}},{key:"doRefresh",value:(t=(0,i.Z)(h().mark((function e(){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.requestUpdate();case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"isUpdating",value:function(){return this.strategy.updating||this.updateRequested}},{key:"fetchImage",value:function(e,t,r,i){return this.layer.fetchImage(e,t,r,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?C(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({timeExtent:this.timeExtent},i))}}]),u}((j=(0,Z.y)((0,b.y)(P.Z)),I=function(e){(0,s.Z)(r,e);var t=O(r);function r(){return(0,a.Z)(this,r),t.apply(this,arguments)}return(0,o.Z)(r,[{key:"initialize",value:function(){this.exportImageParameters=new k.j({layer:this.layer})}},{key:"destroy",value:function(){this.exportImageParameters.destroy(),this.exportImageParameters=null}},{key:"exportImageVersion",get:function(){var e;return null==(e=this.exportImageParameters)||e.commitProperty("version"),this.commitProperty("timeExtent"),(this._get("exportImageVersion")||0)+1}},{key:"fetchPopupFeatures",value:function(e){var t=this.layer;if(!e)return Promise.reject(new f.Z("wmslayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:t}));var r=t.popupEnabled;if(!r)return Promise.reject(new f.Z("wmslayerview:fetchPopupFeatures","popupEnabled should be true",{popupEnabled:r}));var n=this.createFetchPopupFeaturesQuery(e);if(!n)return Promise.resolve([]);var i=n.extent,a=n.width,o=n.height,s=n.x,u=n.y;if(!(i&&a&&o))throw new f.Z("wmslayerview:fetchPopupFeatures","WMSLayer does not support fetching features.",{extent:i,width:a,height:o});var c=t.fetchFeatureInfo(i,a,o,s,u);return Promise.resolve(c?[c]:[])}}]),r}(j),(0,l._)([(0,m.Cb)()],I.prototype,"exportImageParameters",void 0),(0,l._)([(0,m.Cb)({readOnly:!0})],I.prototype,"exportImageVersion",null),(0,l._)([(0,m.Cb)()],I.prototype,"layer",void 0),(0,l._)([(0,m.Cb)(_.qG)],I.prototype,"timeExtent",void 0),I=(0,l._)([(0,v.j)("esri.layers.mixins.WMSLayerView")],I)));(0,l._)([(0,m.Cb)()],M.prototype,"strategy",void 0),(0,l._)([(0,m.Cb)()],M.prototype,"updating",void 0);var E=M=(0,l._)([(0,v.j)("esri.views.2d.layers.WMSLayerView2D")],M)}}]);
//# sourceMappingURL=7803-5f77061b891049235ead.js.map