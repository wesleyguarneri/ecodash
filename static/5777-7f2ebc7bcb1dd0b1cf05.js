"use strict";(self.webpackChunkenergy_and_water_dashboard=self.webpackChunkenergy_and_water_dashboard||[]).push([[5777],{25777:function(e,t,r){r.r(t),r.d(t,{default:function(){return It}});var i=r(93433),n=r(29439),a=r(15861),s=r(15671),o=r(43144),l=r(11752),u=r(60136),c=r(6215),h=r(61120),f=r(87757),y=r.n(f),d=r(83195),p=r(9340),v=r(33300),_=r(82703),g=r(75571),m=r(10173),b=r(37566),w=r(83241),x=r(89636),S=(r(64003),r(30732)),k=r(86724),C=r(22983),I=r(4942),T=r(51916),R=r(33682),Z=r(98840),P=r(16602),O=r(199),A=(r(64994),r(60183),r(42572),r(56947),r(3776)),D=r(48604),M=r(90415),B=function(){function e(t,r){(0,s.Z)(this,e),this._width=0,this._height=0,this._free=[],this._width=t,this._height=r,this._free.push(new M.Z(0,0,t,r))}return(0,o.Z)(e,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"allocate",value:function(e,t){if(e>this._width||t>this._height)return new M.Z;for(var r=null,i=-1,n=0;n<this._free.length;++n){var a=this._free[n];e<=a.width&&t<=a.height&&(null===r||a.y<=r.y&&a.x<=r.x)&&(r=a,i=n)}return null===r?new M.Z:(this._free.splice(i,1),r.width<r.height?(r.width>e&&this._free.push(new M.Z(r.x+e,r.y,r.width-e,t)),r.height>t&&this._free.push(new M.Z(r.x,r.y+t,r.width,r.height-t))):(r.width>e&&this._free.push(new M.Z(r.x+e,r.y,r.width-e,r.height)),r.height>t&&this._free.push(new M.Z(r.x,r.y+t,e,r.height-t))),new M.Z(r.x,r.y,e,t))}},{key:"release",value:function(e){for(var t=0;t<this._free.length;++t){var r=this._free[t];if(r.y===e.y&&r.height===e.height&&r.x+r.width===e.x)r.width+=e.width;else if(r.x===e.x&&r.width===e.width&&r.y+r.height===e.y)r.height+=e.height;else if(e.y===r.y&&e.height===r.height&&e.x+e.width===r.x)r.x=e.x,r.width+=e.width;else{if(e.x!==r.x||e.width!==r.width||e.y+e.height!==r.y)continue;r.y=e.y,r.height+=e.height}this._free.splice(t,1),this.release(e)}this._free.push(e)}}]),e}();function U(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return L(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return L(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}function L(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}var V=function(){function e(t,r,i){(0,s.Z)(this,e),this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphIndex={},this._textures=[],this._rangePromises=new Map,this.width=t,this.height=r,this._glyphSource=i,this._binPack=new B(t-4,r-4),this._glyphData.push(new Uint8Array(t*r)),this._dirties.push(!0),this._textures.push(void 0)}return(0,o.Z)(e,[{key:"getGlyphItems",value:function(e,t){var r,i=this,n=[],a=this._glyphSource,s=new Set,o=U(t);try{for(o.s();!(r=o.n()).done;){var l=r.value,u=Math.floor(.00390625*l);s.add(u)}}catch(h){o.e(h)}finally{o.f()}var c=[];return s.forEach((function(t){if(t<=256){var r=e+t;if(i._rangePromises.has(r))c.push(i._rangePromises.get(r));else{var n=a.getRange(e,t).then((function(){i._rangePromises.delete(r)}),(function(){i._rangePromises.delete(r)}));i._rangePromises.set(r,n),c.push(n)}}})),Promise.all(c).then((function(){var r=i._glyphIndex[e];r||(r={},i._glyphIndex[e]=r);var s,o=U(t);try{for(o.s();!(s=o.n()).done;){var l=s.value,u=r[l];if(u)n[l]={sdf:!0,rect:u.rect,metrics:u.metrics,page:u.page,code:l};else{var c=a.getGlyph(e,l);if(c&&c.metrics){var f=c.metrics,y=void 0;if(0===f.width)y=new M.Z(0,0,0,0);else{var d=f.width+6,p=f.height+6,v=d%4?4-d%4:4,_=p%4?4-p%4:4;1===v&&(v=5),1===_&&(_=5),(y=i._binPack.allocate(d+v,p+_)).isEmpty&&(i._dirties[i._currentPage]||(i._glyphData[i._currentPage]=null),i._currentPage=i._glyphData.length,i._glyphData.push(new Uint8Array(i.width*i.height)),i._dirties.push(!0),i._textures.push(void 0),i._binPack=new B(i.width-4,i.height-4),y=i._binPack.allocate(d+v,p+_));var g=i._glyphData[i._currentPage],m=c.bitmap,b=void 0,w=void 0;if(m)for(var x=0;x<p;x++){b=d*x,w=i.width*(y.y+x+1)+y.x;for(var S=0;S<d;S++)g[w+S+1]=m[b+S]}}r[l]={rect:y,metrics:f,tileIDs:null,page:i._currentPage},n[l]={sdf:!0,rect:y,metrics:f,page:i._currentPage,code:l},i._dirties[i._currentPage]=!0}}}}catch(h){o.e(h)}finally{o.f()}return n}))}},{key:"removeGlyphs",value:function(e){for(var t in this._glyphIndex){var r=this._glyphIndex[t];if(r){var i=void 0;for(var n in r)if((i=r[n]).tileIDs.delete(e),0===i.tileIDs.size){for(var a=this._glyphData[i.page],s=i.rect,o=void 0,l=void 0,u=0;u<s.height;u++)for(o=this.width*(s.y+u)+s.x,l=0;l<s.width;l++)a[o+l]=0;delete r[n],this._dirties[i.page]=!0}}}}},{key:"bind",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._textures[r]||(this._textures[r]=new A.Z(e,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));var n=this._textures[r];n.setSamplingMode(t),this._dirties[r]&&n.setData(this._glyphData[r]),e.bindTexture(n,i),this._dirties[r]=!1}},{key:"dispose",value:function(){this._binPack=null;var e,t=U(this._textures);try{for(t.s();!(e=t.n()).done;){var r=e.value;r&&r.dispose()}}catch(i){t.e(i)}finally{t.f()}this._textures.length=0}}]),e}(),j=r(87980),z=function(){function e(t){if((0,s.Z)(this,e),this._metrics=[],this._bitmaps=[],t)for(;t.next();)if(1===t.tag()){for(var r=t.getMessage();r.next();)if(3===r.tag()){for(var i=r.getMessage(),n=void 0,a=void 0,o=void 0,l=void 0,u=void 0,c=void 0,h=void 0;i.next();)switch(i.tag()){case 1:n=i.getUInt32();break;case 2:a=i.getBytes();break;case 3:o=i.getUInt32();break;case 4:l=i.getUInt32();break;case 5:u=i.getSInt32();break;case 6:c=i.getSInt32();break;case 7:h=i.getUInt32();break;default:i.skip()}i.release(),n&&(this._metrics[n]={width:o,height:l,left:u,top:c,advance:h},this._bitmaps[n]=a)}else r.skip();r.release()}else t.skip()}return(0,o.Z)(e,[{key:"getMetrics",value:function(e){return this._metrics[e]}},{key:"getBitmap",value:function(e){return this._bitmaps[e]}}]),e}(),q=function(){function e(){(0,s.Z)(this,e),this._ranges=[]}return(0,o.Z)(e,[{key:"getRange",value:function(e){return this._ranges[e]}},{key:"addRange",value:function(e,t){this._ranges[e]=t}}]),e}(),F=function(){function e(t){(0,s.Z)(this,e),this._glyphInfo={},this._baseURL=t}return(0,o.Z)(e,[{key:"getRange",value:function(e,t){var r=this._getFontStack(e);if(r.getRange(t))return Promise.resolve();var i=256*t,n=i+255,a=this._baseURL.replace("{fontstack}",e).replace("{range}",i+"-"+n);return(0,T.default)(a,{responseType:"array-buffer"}).then((function(e){r.addRange(t,new z(new j.Z(new Uint8Array(e.data),new DataView(e.data))))})).catch((function(){r.addRange(t,new z)}))}},{key:"getGlyph",value:function(e,t){var r=this._getFontStack(e);if(r){var i=Math.floor(t/256);if(!(i>256)){var n=r.getRange(i);return n?{metrics:n.getMetrics(t),bitmap:n.getBitmap(t)}:void 0}}}},{key:"_getFontStack",value:function(e){var t=this._glyphInfo[e];return t||(t=this._glyphInfo[e]=new q),t}}]),e}(),H=r(5321);function E(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Q(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Q(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}function Q(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}var W="dasharray-",J=function(){function e(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,s.Z)(this,e),this._size=[],this._mosaicsData=[],this._textures=[],this._dirties=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects={},this.pixelRatio=1,(t<=0||r<=0)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=t,this._pageHeight=r,i>0&&(this._maxItemSize=i),this._binPack=new B(t-4,r-4)}return(0,o.Z)(e,[{key:"dispose",value:function(){this._binPack=null,this._mosaicRects={};var e,t=E(this._textures);try{for(t.s();!(e=t.n()).done;){var r=e.value;r&&r.dispose()}}catch(i){t.e(i)}finally{t.f()}this._textures.length=0}},{key:"getWidth",value:function(e){return e>=this._size.length?-1:this._size[e][0]}},{key:"getHeight",value:function(e){return e>=this._size.length?-1:this._size[e][1]}},{key:"getPageSize",value:function(e){return e>=this._size.length?null:this._size[e]}},{key:"setSpriteSource",value:function(e){if(this.dispose(),this.pixelRatio=e.devicePixelRatio,0===this._mosaicsData.length){this._binPack=new B(this._pageWidth-4,this._pageHeight-4);var t=Math.floor(this._pageWidth),r=Math.floor(this._pageHeight),i=new Uint32Array(t*r);this._mosaicsData[0]=i,this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0)}this._sprites=e}},{key:"getSpriteItem",value:function(e){var t,r,i,a,s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=this._mosaicRects[e];if(o)return o;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;if(e&&e.startsWith(W)?(t=this._rasterizeDash(e),i=(r=(0,n.Z)(t,2))[0],a=r[1],s=!0):i=this._sprites.getSpriteInfo(e),!i||!i.width||!i.height||i.width<0||i.height<0)return null;var l=i.width,u=i.height,c=this._allocateImage(l,u),h=(0,n.Z)(c,3),f=h[0],y=h[1],d=h[2];return f.width<=0?null:(this._copy(f,i,y,d,s,a),o={rect:f,width:l,height:u,sdf:i.sdf,simplePattern:!1,pixelRatio:i.pixelRatio,page:y},this._mosaicRects[e]=o,o)}},{key:"getSpriteItems",value:function(e){var t,r={},i=E(e);try{for(i.s();!(t=i.n()).done;){var n=t.value;r[n.name]=this.getSpriteItem(n.name,n.repeat)}}catch(a){i.e(a)}finally{i.f()}return r}},{key:"getMosaicItemPosition",value:function(e,t){var r=this.getSpriteItem(e,t),i=r&&r.rect;if(!i)return null;i.width=r.width,i.height=r.height;var n=r.width,a=r.height;return{tl:[i.x+2,i.y+2],br:[i.x+2+n,i.y+2+a],page:r.page}}},{key:"bind",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._textures[r]||(this._textures[r]=new A.Z(e,{pixelFormat:6408,dataType:5121,wrapMode:33071,width:this._size[r][0],height:this._size[r][1]},new Uint8Array(this._mosaicsData[r].buffer)));var n=this._textures[r];n.setSamplingMode(t),this._dirties[r]&&n.setData(new Uint8Array(this._mosaicsData[r].buffer)),e.bindTexture(n,i),this._dirties[r]=!1}},{key:"_copy",value:function(t,r,i,n,a,s){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(i>=this._mosaicsData.length)){var o=new Uint32Array(s?s.buffer:this._sprites.image.buffer),l=this._mosaicsData[i];l&&o||console.error("Source or target images are uninitialized!");var u=s?r.width:this._sprites.width;e._copyBits(o,u,r.x,r.y,l,n[0],t.x+2,t.y+2,r.width,r.height,a),this._dirties[i]=!0}}},{key:"_allocateImage",value:function(e,t){e+=2,t+=2;var r=Math.max(e,t);if(this._maxItemSize&&this._maxItemSize<r){var i=new M.Z(0,0,e,t);return this._mosaicsData.push(new Uint32Array(e*t)),this._dirties.push(!0),this._size.push([e,t]),this._textures.push(void 0),[i,this._mosaicsData.length-1,[e,t]]}var n=e%4?4-e%4:4,a=t%4?4-t%4:4;1===n&&(n=5),1===a&&(a=5);var s=this._binPack.allocate(e+n,t+a);return s.width<=0?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new B(this._pageWidth-4,this._pageHeight-4),this._allocateImage(e,t)):[s,this._currentPage,[this._pageWidth,this._pageHeight]]}},{key:"_rasterizeDash",value:function(e){var t=e.match(/\[(.*?)\]/);if(!t)return null;var r=t[1].split(",").map(Number),i=e.slice(e.lastIndexOf("-")+1),a=H.fN.rasterizeDash(r,i),s=(0,n.Z)(a,3),o=s[0];return[{x:0,y:0,width:s[1],height:s[2],sdf:!0,pixelRatio:1},new Uint8Array(o.buffer)]}}],[{key:"_copyBits",value:function(e,t,r,i,n,a,s,o,l,u,c){var h=i*t+r,f=o*a+s;if(c){f-=a;for(var y=-1;y<=u;h=((++y+u)%u+i)*t+r,f+=a)for(var d=-1;d<=l;d++)n[f+d]=e[h+(d+l)%l]}else for(var p=0;p<u;p++){for(var v=0;v<l;v++)n[f+v]=e[h+v];h+=t,f+=a}}}]),e}();function N(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return G(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return G(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}function G(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function $(e,t,r,i,n,a){e.fillStyle=t,e.fillRect(r,i,n,a)}function K(e,t,r,i,n,a){e.strokeStyle=t,e.strokeRect(r,i,n,a)}function Y(e,t){for(var r=window.COLLISION_XRAY,i=0;i<t.length;++i){var n=!t[i].unique.show;if(r||!n){var a,s=N(t[i].colliders);try{for(s.s();!(a=s.n()).done;){var o=a.value;if(o.enabled){var l=!t[i].unique.parts[o.partIndex].show;if(r||!l){var u=o.xScreen,c=o.yScreen,h=o.dxScreen,f=o.dyScreen;e.globalAlpha=n||l?.2:1,$(e,"green",u-1,c-1,3,3),K(e,"red",u+h,c+f,o.width,o.height),$(e,"blue",u+h-1,c+f-1,3,3),e.globalAlpha=1}}}}catch(y){s.e(y)}finally{s.f()}}}}var X=r(90832);function ee(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function te(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(r),!0).forEach((function(t){(0,I.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ee(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var re=function(){function e(t,r,i){(0,s.Z)(this,e),this._layer=t,this._styleRepository=r,this.devicePixelRatio=i,this._spriteMosaic=null,this._glyphMosaic=null,this._connection=null}var t,r,i,n,l;return(0,o.Z)(e,[{key:"destroy",value:function(){this._connection&&(this._connection.close(),this._connection=null),this._styleRepository=null,this._layer=null,this._spriteMosaic&&(this._spriteMosaic=null),this._glyphMosaic&&(this._glyphMosaic=null)}},{key:"spriteMosaic",get:function(){var e=this;return this._spriteSourcePromise.then((function(){return e._spriteMosaic}))}},{key:"glyphMosaic",get:function(){return this._glyphMosaic}},{key:"start",value:(l=(0,a.Z)(y().mark((function e(t){var r,i=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._spriteSourcePromise=this._layer.loadSpriteSource(this.devicePixelRatio,t),this._spriteSourcePromise.then((function(e){i._spriteMosaic=new J(1024,1024,250),i._spriteMosaic.setSpriteSource(e)})),r=new F(this._layer.currentStyleInfo.glyphsUrl?(0,Z.fl)(this._layer.currentStyleInfo.glyphsUrl,te(te({},this._layer.customParameters),{},{token:this._layer.apiKey})):null),this._glyphMosaic=new V(1024,1024,r),this._broadcastPromise=(0,P.bA)("WorkerTileHandler",{client:this,schedule:t.schedule,signal:t.signal}).then((function(e){return i._connection=e,Promise.all(i._connection.broadcast("setStyle",{style:i._layer.currentStyleInfo.style,vectorTileLayerMaxBuffers:(0,R.Z)("vectortilelayer-max-buffers")},t))}));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"updateStyle",value:(n=(0,a.Z)(y().mark((function e(t){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._broadcastPromise;case 2:return this._broadcastPromise=Promise.all(this._connection.broadcast("updateStyle",t)),e.abrupt("return",this._broadcastPromise);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"setStyle",value:(i=(0,a.Z)(y().mark((function e(t,r){var i,n=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._broadcastPromise;case 2:return this._styleRepository=t,this._spriteSourcePromise=this._layer.loadSpriteSource(this.devicePixelRatio,null),this._spriteSourcePromise.then((function(e){n._spriteMosaic=new J(1024,1024,250),n._spriteMosaic.setSpriteSource(e)})),i=new F(this._layer.currentStyleInfo.glyphsUrl?(0,Z.fl)(this._layer.currentStyleInfo.glyphsUrl,te(te({},this._layer.customParameters),{},{token:this._layer.apiKey})):null),e.abrupt("return",(this._glyphMosaic=new V(1024,1024,i),this._broadcastPromise=Promise.all(this._connection.broadcast("setStyle",{style:r,vectorTileLayerMaxBuffers:(0,R.Z)("vectortilelayer-max-buffers")})),this._broadcastPromise));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"fetchTileData",value:function(e,t){var r=this;return this._getRefKeys(e,t).then((function(e){var i=r._layer.sourceNameToSource,n=[];for(var a in i)n.push(a);return r._getSourcesData(n,e,t)}))}},{key:"parseTileData",value:function(e,t){var r=this,i=e&&e.data;if(!i)return Promise.resolve(null);var n=i.sourceName2DataAndRefKey,a=i.transferList;return 0===Object.keys(n).length?Promise.resolve(null):this._broadcastPromise.then((function(){return r._connection.getAvailableClient().then((function(r){return r.invoke("createTileAndParse",{key:e.key.id,sourceName2DataAndRefKey:n,styleLayerUIDs:e.styleLayerUIDs},te(te({},t),{},{transferList:a}))}))}))}},{key:"getSprites",value:(r=(0,a.Z)(y().mark((function e(t){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._spriteSourcePromise;case 2:return e.abrupt("return",this._spriteMosaic.getSpriteItems(t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"getGlyphs",value:function(e){return this._glyphMosaic.getGlyphItems(e.font,e.codePoints)}},{key:"perfReport",value:function(e){!function(e,t,r){if(window.PERFORMANCE_RECORDING_STORAGE){var i=window.PERFORMANCE_RECORDING_STORAGE;i.perf=i.perf||{};var n=i.perf;n[e]=n[e]||{start:null,time:0,min:void 0,max:void 0,samples:[],unit:r},n[e].time+=t,n[e].samples.push(t),(null==n[e].min||t<n[e].min)&&(n[e].min=t),(null==n[e].max||t>n[e].max)&&(n[e].max=t)}}(e.key,e.milliseconds,"ms")}},{key:"_getTilePayload",value:(t=(0,a.Z)(y().mark((function e(t,r,i){var n,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=X.Z.pool.acquire(t.id),a=this._layer.sourceNameToSource[r].getSourceTileUrl(n.level,n.row,n.col),X.Z.pool.release(n),e.prev=2,e.next=5,this.request(a,i);case 5:return e.t0=e.sent,e.t1=r,e.abrupt("return",{protobuff:e.t0,sourceName:e.t1});case 10:if(e.prev=10,e.t2=e.catch(2),!(0,b.D_)(e.t2)){e.next=14;break}throw e.t2;case 14:return e.abrupt("return",{protobuff:null,sourceName:r});case 15:case"end":return e.stop()}}),e,this,[[2,10]])}))),function(e,r,i){return t.apply(this,arguments)})},{key:"request",value:function(e,t){return(0,T.default)(e,te({responseType:"array-buffer"},t)).then((function(e){return e.data}))}},{key:"_getRefKeys",value:function(e,t){var r=this._layer.sourceNameToSource,i=new Array;for(var n in r){var a=r[n].getRefKey(e,t);i.push(a)}return(0,b.as)(i)}},{key:"_getSourcesData",value:function(e,t,r){for(var i=[],n=0;n<t.length;n++)if(null==t[n].value||null==e[n])i.push(null);else{var a=this._getTilePayload(t[n].value,e[n],r);i.push(a)}return(0,b.as)(i).then((function(e){for(var r={},i=[],n=0;n<e.length;n++)if(e[n].value&&e[n].value&&e[n].value.protobuff&&e[n].value.protobuff.byteLength>0){var a=t[n].value.id;r[e[n].value.sourceName]={refKey:a,protobuff:e[n].value.protobuff},i.push(e[n].value.protobuff)}return{sourceName2DataAndRefKey:r,transferList:i}}))}}]),e}(),ie=r(77398),ne=r(51952);function ae(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return se(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return se(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}function se(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}var oe=function(e,t){return e+1/(1<<2*t)},le=function(){function e(t,r){(0,s.Z)(this,e),this._tiles=new Map,this._tileCache=new ie.Z(40,(function(e){return e.dispose()})),this._viewSize=[0,0],this._visibleTiles=new Map,this.acquireTile=t.acquireTile,this.releaseTile=t.releaseTile,this.tileInfoView=t.tileInfoView,this._container=r}return(0,o.Z)(e,[{key:"destroy",value:function(){var e,t=ae(this._tiles);try{for(t.s();!(e=t.n()).done;){var r=(0,n.Z)(e.value,2);r[0];r[1].dispose()}}catch(i){t.e(i)}finally{t.f()}this._tiles=null,this._tileCache.clear(),this._tileCache=null}},{key:"update",value:function(e){this._updateCacheSize(e);var t,r=this.tileInfoView,i=r.getTileCoverage(e.state,0,"smallest"),a=i.spans,s=i.lodInfo,o=s.level,l=this._tiles,u=new Set,c=new Set,h=ae(a);try{for(h.s();!(t=h.n()).done;)for(var f=t.value,y=f.row,d=f.colFrom,p=f.colTo,v=d;v<=p;v++){var _=X.Z.getId(o,y,s.normalizeCol(v),s.getWorldForColumn(v)),g=this._getOrAcquireTile(_);u.add(_),g.processed()?this._addToContainer(g):c.add(new X.Z(_))}}catch(U){h.e(U)}finally{h.f()}var m,b=ae(l);try{for(b.s();!(m=b.n()).done;){var w=(0,n.Z)(m.value,2),x=w[0];w[1].isCoverage=u.has(x)}}catch(U){b.e(U)}finally{b.f()}var S,k=ae(c);try{for(k.s();!(S=k.n()).done;){var C=S.value;this._findPlaceholdersForMissingTiles(C,u)}}catch(U){k.e(U)}finally{k.f()}var I,T=!1,R=ae(l);try{for(R.s();!(I=R.n()).done;){var Z=(0,n.Z)(I.value,2),P=Z[0],O=Z[1];O.neededForCoverage=u.has(P),O.neededForCoverage||O.isHoldingForFade&&r.intersects(i,O.key)&&u.add(P),O.isFading&&(T=!0)}}catch(U){R.e(U)}finally{R.f()}var A,D=ae(this._tiles);try{for(D.s();!(A=D.n()).done;){var M=(0,n.Z)(A.value,2),B=M[0];M[1];u.has(B)||this._releaseTile(B)}}catch(U){D.e(U)}finally{D.f()}return ne.Z.pool.release(i),!T}},{key:"clear",value:function(){this._tiles.clear(),this._tileCache.clear(),this._visibleTiles.clear()}},{key:"clearCache",value:function(){this._tileCache.clear()}},{key:"_findPlaceholdersForMissingTiles",value:function(e,t){var r,i=[],a=ae(this._tiles);try{for(a.s();!(r=a.n()).done;){var s=(0,n.Z)(r.value,2),o=(s[0],s[1]);this._addPlaceholderChild(i,o,e,t)}}catch(u){a.e(u)}finally{a.f()}var l=i.reduce(oe,0);Math.abs(1-l)<1e-6||this._addPlaceholderParent(e.id,t)}},{key:"_addPlaceholderChild",value:function(e,t,r,i){t.key.level<=r.level||!t.hasData()||function(e,t){var r=t.level-e.level;return e.row===t.row>>r&&e.col===t.col>>r&&e.world===t.world}(r,t.key)&&(this._addToContainer(t),i.add(t.id),e.push(t.key.level-r.level))}},{key:"_addPlaceholderParent",value:function(e,t){for(var r=this._tiles,i=e;;){if(!(i=ue(i))||t.has(i))return;var n=r.get(i);if(n&&n.hasData())return this._addToContainer(n),void t.add(n.id)}}},{key:"_getOrAcquireTile",value:function(e){var t=this._tiles.get(e);return t||((t=this._tileCache.pop(e))||(t=this.acquireTile(new X.Z(e))),this._tiles.set(e,t),t)}},{key:"_releaseTile",value:function(e){var t=this._tiles.get(e);this.releaseTile(t),this._removeFromContainer(t),this._tiles.delete(e),t.hasData()?this._tileCache.put(e,t,1):t.dispose()}},{key:"_addToContainer",value:function(e){var t,r=[],i=this._container;if(!i.contains(e)){var a,s=this._visibleTiles,o=ae(s);try{for(o.s();!(a=o.n()).done;){var l=(0,n.Z)(a.value,2),u=(l[0],l[1]);this._canConnectDirectly(e,u)&&r.push(u),(0,m.Wi)(t)&&this._canConnectDirectly(u,e)&&(t=u)}}catch(v){o.e(v)}finally{o.f()}if((0,m.pC)(t)){var c,h=ae(r);try{for(h.s();!(c=h.n()).done;){var f=c.value;t.childrenTiles.delete(f),e.childrenTiles.add(f),f.parentTile=e}}catch(v){h.e(v)}finally{h.f()}t.childrenTiles.add(e),e.parentTile=t}else{var y,d=ae(r);try{for(d.s();!(y=d.n()).done;){var p=y.value;e.childrenTiles.add(p),p.parentTile=e}}catch(v){d.e(v)}finally{d.f()}}s.set(e.id,e),i.addChild(e)}}},{key:"_removeFromContainer",value:function(e){if(this._visibleTiles.delete(e.id),this._container.removeChild(e),(0,m.pC)(e.parentTile)){e.parentTile.childrenTiles.delete(e);var t,r=ae(e.childrenTiles);try{for(r.s();!(t=r.n()).done;){var i=t.value;(0,m.pC)(e.parentTile)&&e.parentTile.childrenTiles.add(i)}}catch(s){r.e(s)}finally{r.f()}}var n,a=ae(e.childrenTiles);try{for(a.s();!(n=a.n()).done;){n.value.parentTile=e.parentTile}}catch(s){a.e(s)}finally{a.f()}e.parentTile=null,e.childrenTiles.clear()}},{key:"_canConnectDirectly",value:function(e,t){for(var r=e.key,i=t.key,n=i.level,a=i.row,s=i.col,o=i.world,l=this._visibleTiles;n>0;){if(n--,a>>=1,s>>=1,r.level===n&&r.row===a&&r.col===s&&r.world===o)return!0;if(l.has("".concat(n,"/").concat(a,"/").concat(s,"/").concat(o)))return!1}return!1}},{key:"_updateCacheSize",value:function(e){var t=e.state.size;if(t[0]!==this._viewSize[0]||t[1]!==this._viewSize[1]){var r=Math.ceil(t[0]/512)+1,i=Math.ceil(t[1]/512)+1;this._viewSize[0]=t[0],this._viewSize[1]=t[1],this._tileCache.maxSize=5*r*i}}}]),e}();function ue(e){var t=e.split("/"),r=(0,n.Z)(t,4),i=r[0],a=r[1],s=r[2],o=r[3],l=parseInt(i,10);return 0===l?null:"".concat(l-1,"/").concat(parseInt(a,10)>>1,"/").concat(parseInt(s,10)>>1,"/").concat(parseInt(o,10))}var ce=r(2834),he=r(75428),fe=(0,o.Z)((function e(t){(0,s.Z)(this,e),this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=t})),ye=(0,o.Z)((function e(){(0,s.Z)(this,e),this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}));function de(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return pe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return pe(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}function pe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function ve(e,t,r,i,n,a){var s=r-n;if(s>=0)return(t>>s)+(i-(a<<s))*(e>>s);var o=-s;return t-(a-(i<<o))*(e>>o)<<o}var _e=function(){function e(t,r,i){(0,s.Z)(this,e),this._rows=Math.ceil(r/i),this._columns=Math.ceil(t/i),this._cellSize=i,this.cells=new Array(this._rows);for(var n=0;n<this._rows;n++){this.cells[n]=new Array(this._columns);for(var a=0;a<this._columns;a++)this.cells[n][a]=[]}}return(0,o.Z)(e,[{key:"getCell",value:function(e,t){var r=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._rows-1),i=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][i]||null}},{key:"getCellSpan",value:function(e,t,r,i){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(t/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.rows-1)]}},{key:"cellSize",get:function(){return this._cellSize}},{key:"columns",get:function(){return this._columns}},{key:"rows",get:function(){return this._rows}}]),e}();function ge(e,t,r,i,a){var s=e.layerData.get(a);if(3===s.type){var o,l=de(i);try{for(l.s();!(o=l.n()).done;){var u=o.value,c=u.unique,h=void 0;if(u.selectedForRendering){var f=c.parts[0],y=f.startOpacity,d=f.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===d;var p=r?Math.floor(127*y)|d<<7:d?255:0;h=p<<24|p<<16|p<<8|p}else h=0;var v,_=de(u.iconVertexRanges);try{for(_.s();!(v=_.n()).done;)for(var g=(0,n.Z)(v.value,2),m=g[0],b=g[1],w=m;w<m+b;w+=4)s.iconOpacity[w/4]=h}catch(A){_.e(A)}finally{_.f()}if(u.selectedForRendering){var x=c.parts[1],S=x.startOpacity,k=x.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===k;var C=r?Math.floor(127*S)|k<<7:k?255:0;h=C<<24|C<<16|C<<8|C}else h=0;var I,T=de(u.textVertexRanges);try{for(T.s();!(I=T.n()).done;)for(var R=(0,n.Z)(I.value,2),Z=R[0],P=R[1],O=Z;O<Z+P;O+=4)s.textOpacity[O/4]=h}catch(A){T.e(A)}finally{T.f()}}}catch(A){l.e(A)}finally{l.f()}s.lastOpacityUpdate=t,s.opacityChanged=!0}}function me(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return be(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return be(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}function be(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function we(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(B){return!1}}();return function(){var r,i=(0,h.Z)(e);if(t){var n=(0,h.Z)(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return(0,c.Z)(this,r)}}var xe=function(){function e(t,r){(0,s.Z)(this,e),this.layerUIDs=[],this.isDestroyed=!1,this.data=t,this.memoryUsed=t.byteLength;var i=1,n=new Uint32Array(t);this.layerUIDs=[];for(var a=n[i++],o=0;o<a;o++)this.layerUIDs[o]=n[i++];this.bufferDataOffset=i,r&&(this.layer=r.getStyleLayerByUID(this.layerUIDs[0]))}return(0,o.Z)(e,[{key:"isPreparedForRendering",get:function(){return(0,m.Wi)(this.data)}},{key:"offset",get:function(){return this.bufferDataOffset}},{key:"destroy",value:function(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}},{key:"prepareForRendering",value:function(e){(0,m.Wi)(this.data)||(this.doPrepareForRendering(e,this.data,this.bufferDataOffset),this.data=null)}}]),e}(),Se=function(e){(0,u.Z)(r,e);var t=we(r);function r(e,i){var n;(0,s.Z)(this,r),(n=t.call(this,e,i)).type=2,n.lineIndexStart=0,n.lineIndexCount=0;var a=new Uint32Array(e),o=n.bufferDataOffset;n.lineIndexStart=a[o++],n.lineIndexCount=a[o++];var l=a[o++];if(l>0){for(var u=new Map,c=0;c<l;c++){var h=a[o++],f=a[o++],y=a[o++];u.set(h,[f,y])}n.patternMap=u}return n.bufferDataOffset=o,n}return(0,o.Z)(r,[{key:"hasData",value:function(){return this.lineIndexCount>0}},{key:"triangleCount",value:function(){return this.lineIndexCount/3}},{key:"doDestroy",value:function(){(0,m.pC)(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose(),(0,m.pC)(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose(),(0,m.pC)(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose(),this.lineVertexArrayObject=null,this.lineVertexBuffer=null,this.lineIndexBuffer=null,this.memoryUsed=0}},{key:"doPrepareForRendering",value:function(e,t,r){var i=new Uint32Array(t),n=new Int32Array(i.buffer),a=i[r++];this.lineVertexBuffer=O.Z.createVertex(e,35044,new Int32Array(n.buffer,4*r,a)),r+=a;var s=i[r++];this.lineIndexBuffer=O.Z.createIndex(e,35044,new Uint32Array(i.buffer,4*r,s)),r+=s;var o=this.layer.lineMaterial;this.lineVertexArrayObject=new D.Z(e,o.getAttributeLocations(),o.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)}}]),r}(xe),ke=function(e){(0,u.Z)(r,e);var t=we(r);function r(e,i){var n;(0,s.Z)(this,r),(n=t.call(this,e,i)).type=1,n.fillIndexStart=0,n.fillIndexCount=0,n.outlineIndexStart=0,n.outlineIndexCount=0;var a=new Uint32Array(e),o=n.bufferDataOffset;n.fillIndexStart=a[o++],n.fillIndexCount=a[o++],n.outlineIndexStart=a[o++],n.outlineIndexCount=a[o++];var l=a[o++];if(l>0){for(var u=new Map,c=0;c<l;c++){var h=a[o++],f=a[o++],y=a[o++];u.set(h,[f,y])}n.patternMap=u}return n.bufferDataOffset=o,n}return(0,o.Z)(r,[{key:"hasData",value:function(){return this.fillIndexCount>0||this.outlineIndexCount>0}},{key:"triangleCount",value:function(){return(this.fillIndexCount+this.outlineIndexCount)/3}},{key:"doDestroy",value:function(){(0,m.pC)(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose(),(0,m.pC)(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose(),(0,m.pC)(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose(),this.fillVertexArrayObject=null,this.fillVertexBuffer=null,this.fillIndexBuffer=null,(0,m.pC)(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose(),(0,m.pC)(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose(),(0,m.pC)(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose(),this.outlineVertexArrayObject=null,this.outlineVertexBuffer=null,this.outlineIndexBuffer=null,this.memoryUsed=0}},{key:"doPrepareForRendering",value:function(e,t,r){var i=new Uint32Array(t),n=new Int32Array(i.buffer),a=i[r++];this.fillVertexBuffer=O.Z.createVertex(e,35044,new Int32Array(n.buffer,4*r,a)),r+=a;var s=i[r++];this.fillIndexBuffer=O.Z.createIndex(e,35044,new Uint32Array(i.buffer,4*r,s)),r+=s;var o=i[r++];this.outlineVertexBuffer=O.Z.createVertex(e,35044,new Int32Array(n.buffer,4*r,o)),r+=o;var l=i[r++];this.outlineIndexBuffer=O.Z.createIndex(e,35044,new Uint32Array(i.buffer,4*r,l)),r+=l;var u=this.layer,c=u.fillMaterial,h=u.outlineMaterial;this.fillVertexArrayObject=new D.Z(e,c.getAttributeLocations(),c.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer),this.outlineVertexArrayObject=new D.Z(e,h.getAttributeLocations(),h.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)}}]),r}(xe),Ce=function(e){(0,u.Z)(r,e);var t=we(r);function r(e,i,n){var a;(0,s.Z)(this,r),(a=t.call(this,e,i)).type=3,a.iconPerPageElementsMap=new Map,a.glyphPerPageElementsMap=new Map,a.symbolInstances=[],a.isIconSDF=!1,a.opacityChanged=!1,a.lastOpacityUpdate=0,a.symbols=[];var o=new Uint32Array(e),l=new Int32Array(e),u=new Float32Array(e),c=a.bufferDataOffset;a.isIconSDF=!!o[c++];for(var h=o[c++],f=0;f<h;f++){var y=o[c++],d=o[c++],p=o[c++];a.iconPerPageElementsMap.set(y,[d,p])}for(var v=o[c++],_=0;_<v;_++){var g=o[c++],m=o[c++],b=o[c++];a.glyphPerPageElementsMap.set(g,[m,b])}var w=o[c++],x=o[c++];return a.iconOpacity=new Int32Array(w),a.textOpacity=new Int32Array(x),c=function(e,t,r,i,n,a){for(var s=t[i++],o=0;o<s;o++){var l=new fe(a);l.xTile=t[i++],l.yTile=t[i++],l.hash=t[i++],l.priority=t[i++];for(var u=t[i++],c=0;c<u;c++){var h=t[i++],f=t[i++],y=t[i++],d=t[i++],p=!!t[i++],v=t[i++],_=r[i++],g=r[i++],m=t[i++],b=t[i++];l.colliders.push({xTile:h,yTile:f,dxPixels:y,dyPixels:d,hard:p,partIndex:v,width:m,height:b,minLod:_,maxLod:g})}for(var w=e[i++],x=0;x<w;x++)l.textVertexRanges.push([e[i++],e[i++]]);for(var S=e[i++],k=0;k<S;k++)l.iconVertexRanges.push([e[i++],e[i++]]);n.push(l)}return i}(o,l,u,c,a.symbols,n),a.bufferDataOffset=c,a}return(0,o.Z)(r,[{key:"hasData",value:function(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}},{key:"triangleCount",value:function(){var e,t=0,r=me(this.iconPerPageElementsMap);try{for(r.s();!(e=r.n()).done;){var i=(0,n.Z)(e.value,2);i[0];t+=i[1][1]}}catch(l){r.e(l)}finally{r.f()}var a,s=me(this.glyphPerPageElementsMap);try{for(s.s();!(a=s.n()).done;){var o=(0,n.Z)(a.value,2);o[0];t+=o[1][1]}}catch(l){s.e(l)}finally{s.f()}return t/3}},{key:"doDestroy",value:function(){(0,m.pC)(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose(),(0,m.pC)(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose(),(0,m.pC)(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose(),(0,m.pC)(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose(),this.iconVertexArrayObject=null,this.iconVertexBuffer=null,this.iconOpacityBuffer=null,this.iconIndexBuffer=null,(0,m.pC)(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose(),(0,m.pC)(this.textVertexBuffer)&&this.textVertexBuffer.dispose(),(0,m.pC)(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose(),(0,m.pC)(this.textIndexBuffer)&&this.textIndexBuffer.dispose(),this.textVertexArrayObject=null,this.textVertexBuffer=null,this.textOpacityBuffer=null,this.textIndexBuffer=null,this.memoryUsed=0}},{key:"updateOpacityInfo",value:function(){if(this.opacityChanged){this.opacityChanged=!1;var e=(0,m.Wg)(this.iconOpacity),t=(0,m.Wg)(this.iconOpacityBuffer);e.length>0&&e.byteLength===t.size&&t.setSubData(e);var r=(0,m.Wg)(this.textOpacity),i=(0,m.Wg)(this.textOpacityBuffer);r.length>0&&r.byteLength===i.size&&i.setSubData(r)}}},{key:"doPrepareForRendering",value:function(e,t,r){var i=new Uint32Array(t),n=new Int32Array(i.buffer),a=i[r++];this.iconVertexBuffer=O.Z.createVertex(e,35044,new Int32Array(n.buffer,4*r,a)),r+=a;var s=i[r++];this.iconIndexBuffer=O.Z.createIndex(e,35044,new Uint32Array(i.buffer,4*r,s)),r+=s;var o=i[r++];this.textVertexBuffer=O.Z.createVertex(e,35044,new Int32Array(n.buffer,4*r,o)),r+=o;var l=i[r++];this.textIndexBuffer=O.Z.createIndex(e,35044,new Uint32Array(i.buffer,4*r,l)),r+=l,this.iconOpacityBuffer=O.Z.createVertex(e,35044,(0,m.Wg)(this.iconOpacity).buffer),this.textOpacityBuffer=O.Z.createVertex(e,35044,(0,m.Wg)(this.textOpacity).buffer);var u=this.layer,c=u.iconMaterial,h=u.textMaterial;this.iconVertexArrayObject=new D.Z(e,c.getAttributeLocations(),c.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer),this.textVertexArrayObject=new D.Z(e,h.getAttributeLocations(),h.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)}}]),r}(xe),Ie=function(e){(0,u.Z)(r,e);var t=we(r);function r(e,i){var n;(0,s.Z)(this,r),(n=t.call(this,e,i)).type=4,n.circleIndexStart=0,n.circleIndexCount=0;var a=new Uint32Array(e),o=n.bufferDataOffset;return n.circleIndexStart=a[o++],n.circleIndexCount=a[o++],n.bufferDataOffset=o,n}return(0,o.Z)(r,[{key:"hasData",value:function(){return this.circleIndexCount>0}},{key:"triangleCount",value:function(){return this.circleIndexCount/3}},{key:"doDestroy",value:function(){(0,m.pC)(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose(),(0,m.pC)(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose(),(0,m.pC)(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose(),this.circleVertexArrayObject=null,this.circleVertexBuffer=null,this.circleIndexBuffer=null,this.memoryUsed=0}},{key:"doPrepareForRendering",value:function(e,t,r){var i=new Uint32Array(t),n=new Int32Array(i.buffer),a=i[r++];this.circleVertexBuffer=O.Z.createVertex(e,35044,new Int32Array(n.buffer,4*r,a)),r+=a;var s=i[r++];this.circleIndexBuffer=O.Z.createIndex(e,35044,new Uint32Array(i.buffer,4*r,s)),r+=s;var o=this.layer.circleMaterial;this.circleVertexArrayObject=new D.Z(e,o.getAttributeLocations(),o.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)}}]),r}(xe),Te=r(64312),Re=r(85147);function Ze(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Pe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Pe(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}function Pe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function Oe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(B){return!1}}();return function(){var r,i=(0,h.Z)(e);if(t){var n=(0,h.Z)(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return(0,c.Z)(this,r)}}var Ae=function(e){(0,u.Z)(r,e);var t=Oe(r);function r(e,i,n,a,o,l){var u,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;return(0,s.Z)(this,r),(u=t.call(this,e,i,n,a,o,4096,4096))._memCache=c,u.type="vector-tile",u._referenced=0,u._hasSymbolBuckets=!1,u._memoryUsedByLayerData=0,u.layerData=new Map,u.layerCount=0,u.status="loading",u.allSymbolsFadingOut=!1,u.lastOpacityUpdate=0,u.symbols=new Map,u.isCoverage=!1,u.neededForCoverage=!1,u.decluttered=!1,u.invalidating=!1,u.parentTile=null,u.childrenTiles=new Set,u._processed=!1,u._referenced=1,u.styleRepository=l,u.id=e.id,u}return(0,o.Z)(r,[{key:"hasSymbolBuckets",get:function(){return this._hasSymbolBuckets}},{key:"isFading",get:function(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<Te.nN}},{key:"isHoldingForFade",get:function(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<Te.nN)}},{key:"wasRequested",get:function(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}},{key:"setData",value:function(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}},{key:"deleteLayerData",value:function(e){var t,r=!1,i=Ze(e);try{for(i.s();!(t=i.n()).done;){var n=t.value;if(this.layerData.has(n)){var a=this.layerData.get(n);this._memoryUsedByLayerData-=a.memoryUsed,3===a.type&&this.symbols.has(n)&&(this.symbols.delete(n),r=!0),a.destroy(),this.layerData.delete(n),this.layerCount--}}}catch(s){i.e(s)}finally{i.f()}(0,m.pC)(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData),r&&this.emit("symbols-changed"),this.requestRender()}},{key:"processed",value:function(){return this._processed}},{key:"hasData",value:function(){return this.layerCount>0}},{key:"dispose",value:function(){"unloaded"!==this.status&&(De.delete(this),r._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}},{key:"release",value:function(){return 0==--this._referenced&&(this.dispose(),this.stage=null,!0)}},{key:"retain",value:function(){++this._referenced}},{key:"referenced",get:function(){return this._referenced}},{key:"memoryUsage",get:function(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}},{key:"changeDataImpl",value:function(e){var t=!1;if(e){var r,i=Ze(this._createRenderBuckets(e));try{for(i.s();!(r=i.n()).done;){var a=(0,n.Z)(r.value,2),s=a[0],o=a[1];if(this.layerData.has(s)){var l=this.layerData.get(s);this._memoryUsedByLayerData-=o.memoryUsed,l.destroy(),this.layerData.delete(s),this.layerCount--}3===o.type&&(this.symbols.set(s,o.symbols),t=!0),this._memoryUsedByLayerData+=o.memoryUsed,this.layerData.set(s,o),this.layerCount++}}catch(f){i.e(f)}finally{i.f()}(0,m.pC)(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;var u,c=Ze(this.layerData);try{for(c.s();!(u=c.n()).done;){var h=(0,n.Z)(u.value,2);h[0];3===h[1].type&&(this._hasSymbolBuckets=!0)}}catch(f){c.e(f)}finally{c.f()}t&&this.emit("symbols-changed")}},{key:"attachWithContext",value:function(e){this.stage={context:e,trashDisplayObject:function(e){e.processDetach()},untrashDisplayObject:function(){return!1}}}},{key:"setTransform",value:function(e,t){(0,l.Z)((0,h.Z)(r.prototype),"setTransform",this).call(this,e,t);var i=t/(e.resolution*e.pixelRatio),n=this.width/this.rangeX*i,a=this.height/this.rangeY*i,s=[0,0];e.toScreen(s,[this.x,this.y]);var o=this.transforms.tileUnitsToPixels;(0,ce.b)(o),(0,ce.c)(o,o,s),(0,ce.r)(o,o,Math.PI*e.rotation/180),(0,ce.d)(o,o,[n,a,1])}},{key:"_createTransforms",value:function(){return{dvs:(0,he.c)(),tileMat3:(0,he.c)(),tileUnitsToPixels:(0,he.c)()}}},{key:"_createRenderBuckets",value:function(e){var t,r=new Map,i=new Map,n=Ze(e);try{for(n.s();!(t=n.n()).done;){var a,s=t.value,o=this._deserializeBucket(s,i),l=Ze(o.layerUIDs);try{for(l.s();!(a=l.n()).done;){var u=a.value;r.set(u,o)}}catch(c){l.e(c)}finally{l.f()}}}catch(c){n.e(c)}finally{n.f()}return r}},{key:"_deserializeBucket",value:function(e,t){var r=t.get(e);if(r)return r;switch(new Uint32Array(e)[0]){case 1:r=new ke(e,this.styleRepository);break;case 2:r=new Se(e,this.styleRepository);break;case 3:r=new Ce(e,this.styleRepository,this);break;case 4:r=new Ie(e,this.styleRepository)}return t.set(e,r),r}}],[{key:"_destroyRenderBuckets",value:function(e){if(e){var t=new Set;e.forEach((function(e){t.has(e)||(e.destroy(),t.add(e))})),e.clear()}}}]),r}(Re.I),De=new Map;var Me=r(92332);function Be(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Ue(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ue(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}function Ue(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function Le(e,t,r,i,a,s){var o,l=i.iconRotationAlignment,u=i.textRotationAlignment,c=i.iconTranslate,h=i.iconTranslateAnchor,f=i.textTranslate,y=i.textTranslateAnchor,d=0,p=Be(e.colliders);try{for(p.s();!(o=p.n()).done;){var v=o.value,_=0===v.partIndex?c:f,g=(0,n.Z)(_,2),m=g[0],b=g[1],w=0===v.partIndex?h:y,x=v.minLod<=s&&s<=v.maxLod;d+=x?0:1,v.enabled=x,v.xScreen=v.xTile*a[0]+v.yTile*a[3]+a[6],v.yScreen=v.xTile*a[1]+v.yTile*a[4]+a[7],0===w?(v.xScreen+=r*m-t*b,v.yScreen+=t*m+r*b):(v.xScreen+=m,v.yScreen+=b),1===(0===v.partIndex?l:u)?(v.dxScreen=v.dxPixels,v.dyScreen=v.dyPixels):(v.dxScreen=r*(v.dxPixels+v.width/2)-t*(v.dyPixels+v.height/2)-v.width/2,v.dyScreen=t*(v.dxPixels+v.width/2)+r*(v.dyPixels+v.height/2)-v.height/2)}}catch(S){p.e(S)}finally{p.f()}e.colliders.length>0&&d===e.colliders.length&&(e.unique.show=!1)}var Ve=function(){function e(t,r,i,n,a,o){(0,s.Z)(this,e),this._symbols=t,this._styleRepository=n,this._zoom=a,this._currentLayerCursor=0,this._currentSymbolCursor=0,this._styleProps=new Map,this._allNeededMatrices=new Map,this._gridIndex=new _e(r,i,Te.PF),this._si=Math.sin(Math.PI*o/180),this._co=Math.cos(Math.PI*o/180);var l,u=Be(t);try{for(u.s();!(l=u.n()).done;){var c,h=Be(l.value.symbols);try{for(h.s();!(c=h.n()).done;){var f=c.value;this._allNeededMatrices.has(f.tile)||this._allNeededMatrices.set(f.tile,(0,he.a)(f.tile.transforms.tileUnitsToPixels))}}catch(y){h.e(y)}finally{h.f()}}}catch(y){u.e(y)}finally{u.f()}}return(0,o.Z)(e,[{key:"work",value:function(e){var t=this._gridIndex;function r(e){for(var r=e.xScreen+e.dxScreen,i=e.yScreen+e.dyScreen,a=r+e.width,s=i+e.height,o=t.getCellSpan(r,i,a,s),l=(0,n.Z)(o,4),u=l[0],c=l[1],h=l[2],f=l[3],y=c;y<=f;y++)for(var d=u;d<=h;d++){var p,v=Be(t.cells[y][d]);try{for(v.s();!(p=v.n()).done;){var _=p.value,g=_.xScreen+_.dxScreen,m=_.yScreen+_.dyScreen,b=g+_.width,w=m+_.height;if(!(a<g||r>b||s<m||i>w))return!0}}catch(x){v.e(x)}finally{v.f()}}return!1}for(var i=performance.now();this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0)for(var a=this._symbols[this._currentLayerCursor],s=this._getProperties(a.styleLayerUID);this._currentSymbolCursor<a.symbols.length;this._currentSymbolCursor++){if(this._currentSymbolCursor%100==99&&performance.now()-i>e)return!1;var o=a.symbols[this._currentSymbolCursor];if(o.unique.show){Le(o,this._si,this._co,s,this._allNeededMatrices.get(o.tile),this._zoom);var l=o.unique;if(l.show){var u,c=s.iconAllowOverlap,h=s.iconIgnorePlacement,f=s.textAllowOverlap,y=s.textIgnorePlacement,d=Be(o.colliders);try{for(d.s();!(u=d.n()).done;){var p=u.value;if(p.enabled){var v=l.parts[p.partIndex];v.show&&!(p.partIndex?f:c)&&r(p)&&(p.hard?l.show=!1:v.show=!1)}}}catch(A){d.e(A)}finally{d.f()}if(l.show){var _,g=Be(o.colliders);try{for(g.s();!(_=g.n()).done;){var m=_.value;if(m.enabled&&(!(m.partIndex?y:h)&&l.parts[m.partIndex].show))for(var b=m.xScreen+m.dxScreen,w=m.yScreen+m.dyScreen,x=b+m.width,S=w+m.height,k=this._gridIndex.getCellSpan(b,w,x,S),C=(0,n.Z)(k,4),I=C[0],T=C[1],R=C[2],Z=C[3],P=T;P<=Z;P++)for(var O=I;O<=R;O++)this._gridIndex.cells[P][O].push(m)}}catch(A){g.e(A)}finally{g.f()}}}}}return!0}},{key:"_getProperties",value:function(e){var t=this._styleProps.get(e);if(t)return t;var r=this._zoom,i=this._styleRepository.getStyleLayerByUID(e),n=0!==i.getLayoutValue("symbol-placement",r),a=i.getLayoutValue("icon-rotation-alignment",r);2===a&&(a=n?0:1);var s=i.getLayoutValue("text-rotation-alignment",r);2===s&&(s=n?0:1);var o=i.getPaintValue("icon-translate",r),l=i.getPaintValue("icon-translate-anchor",r),u=i.getPaintValue("text-translate",r),c=i.getPaintValue("text-translate-anchor",r),h={iconAllowOverlap:i.getLayoutValue("icon-allow-overlap",r),iconIgnorePlacement:i.getLayoutValue("icon-ignore-placement",r),textAllowOverlap:i.getLayoutValue("text-allow-overlap",r),textIgnorePlacement:i.getLayoutValue("text-ignore-placement",r),iconRotationAlignment:a,textRotationAlignment:s,iconTranslateAnchor:l,iconTranslate:o,textTranslateAnchor:c,textTranslate:u};return this._styleProps.set(e,h),h}}]),e}();function je(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return ze(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ze(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}function ze(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function qe(e,t){if(e.priority-t.priority)return e.priority-t.priority;var r=e.tile.key,i=t.tile.key;return r.world-i.world?r.world-i.world:r.level-i.level?r.level-i.level:r.row-i.row?r.row-i.row:r.col-i.col?r.col-i.col:e.xTile-t.xTile?e.xTile-t.xTile:e.yTile-t.yTile}var Fe=function(){function e(t,r,i,n,a,o){(0,s.Z)(this,e),this._visibleTiles=t,this._symbolRepository=r,this._createCollisionJob=i,this._assignTileSymbolsOpacity=n,this._symbolLayerSorter=a,this._isLayerVisible=o,this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}return(0,o.Z)(e,[{key:"running",get:function(){return this._running}},{key:"setScreenSize",value:function(e,t){this._screenWidth===e&&this._screenHeight===t||this.restart(),this._screenWidth=e,this._screenHeight=t}},{key:"restart",value:function(){this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}},{key:"continue",value:function(e){if(this._selectionJob||(this._selectionJob=this._createSelectionJob()),!this._selectionJobCompleted){var t=performance.now();if(!this._selectionJob.work(e))return!1;if(this._selectionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}if(this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight)),!this._collisionJobCompleted){var r=performance.now();if(!this._collisionJob.work(e))return!1;if(this._collisionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-r))))return!1}if(this._opacityJob||(this._opacityJob=this._createOpacityJob()),!this._opacityJobCompleted){var i=performance.now();if(!this._opacityJob.work(e))return!1;if(this._opacityJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-i))))return!1}return this._running=!1,!0}},{key:"_createSelectionJob",value:function(){for(var e=this._symbolRepository.uniqueSymbols,t=0;t<e.length;t++)for(var r=e[t],i=0;i<r.uniqueSymbols.length;i++){var n,a=je(r.uniqueSymbols[i].tileSymbols);try{for(a.s();!(n=a.n()).done;){n.value.selectedForRendering=!1}}catch(h){a.e(h)}finally{a.f()}}var s=[],o=0,l=0,u=this._isLayerVisible;var c=this._symbolLayerSorter;return{work:function(t){for(var r,i=performance.now();l<e.length;l++,o=0){var n=e[l],a=n.styleLayerUID;if(u(a)){s[l]=s[l]||{styleLayerUID:a,symbols:[]};for(var c=s[l];o<n.uniqueSymbols.length;o++){if(r=n.uniqueSymbols[o],o%100==99&&performance.now()-i>t)return!1;var f,y=null,d=!1,p=!1,v=je(r.tileSymbols);try{for(v.s();!(f=v.n()).done;){var _=f.value;if(!p||!d){var g=_.tile;(!y||g.isCoverage||g.neededForCoverage&&!d)&&(y=_,(g.neededForCoverage||g.isCoverage)&&(p=!0),g.isCoverage&&(d=!0))}}}catch(h){v.e(h)}finally{v.f()}if(y.selectedForRendering=!0,p){c.symbols.push(y),r.show=!0;var m,b=je(r.parts);try{for(b.s();!(m=b.n()).done;){m.value.show=!0}}catch(h){b.e(h)}finally{b.f()}}else r.show=!1}}else s[l]||(s[l]={styleLayerUID:a,symbols:[]})}var w,x=je(s);try{for(x.s();!(w=x.n()).done;){w.value.symbols.sort(qe)}}catch(h){x.e(h)}finally{x.f()}return!0},get sortedSymbols(){return s.sort(c)}}}},{key:"_createOpacityJob",value:function(){var e=this._assignTileSymbolsOpacity,t=this._visibleTiles,r=0;function i(t,r){var a,s=je(t.symbols);try{for(s.s();!(a=s.n()).done;){var o=(0,n.Z)(a.value,2);o[0];He(o[1],r)}}catch(c){s.e(c)}finally{s.f()}e(t,r);var l,u=je(t.childrenTiles);try{for(u.s();!(l=u.n()).done;){i(l.value,r)}}catch(c){u.e(c)}finally{u.f()}}return{work:function(e){for(var n=performance.now();r<t.length;r++){if(performance.now()-n>e)return!1;var a=t[r];(0,m.pC)(a.parentTile)||i(a,performance.now())}return!0}}}}]),e}();function He(e,t){var r,i=je(e);try{for(i.s();!(r=i.n()).done;){var n,a=r.value.unique,s=je(a.parts);try{for(s.s();!(n=s.n()).done;){var o=n.value,l=o.targetOpacity>.5?1:-1;o.startOpacity+=l*((t-o.startTime)/Te.nN),o.startOpacity=Math.min(Math.max(o.startOpacity,0),1),o.startTime=t,o.targetOpacity=a.show&&o.show?1:0}}catch(u){s.e(u)}finally{s.f()}}}catch(u){i.e(u)}finally{i.f()}}r(84944),r(33792);function Ee(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Qe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Qe(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}function Qe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}var We=function(){function e(t,r,i){(0,s.Z)(this,e),this.tileCoordRange=t,this._visibleTiles=r,this._createUnique=i,this._tiles=new Map,this._uniqueSymbolsReferences=new Map}return(0,o.Z)(e,[{key:"uniqueSymbols",get:function(){return(0,m.Wi)(this._uniqueSymbolLayerArray)&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray()),this._uniqueSymbolLayerArray}},{key:"add",value:function(e,t){this._uniqueSymbolLayerArray=null;var r=this._tiles.get(e.id);r||(r={symbols:new Map},this._tiles.set(e.id,r));var i=new Map;if(t){var a,s=Ee(t);try{for(s.s();!(a=s.n()).done;){var o=a.value;r.symbols.has(o)&&(i.set(o,r.symbols.get(o)),r.symbols.delete(o))}}catch(C){s.e(C)}finally{s.f()}}else{var l,u=Ee(e.layerData);try{for(u.s();!(l=u.n()).done;){var c=(0,n.Z)(l.value,2),h=c[0];c[1];r.symbols.has(h)&&(i.set(h,r.symbols.get(h)),r.symbols.delete(h))}}catch(C){u.e(C)}finally{u.f()}}this._removeSymbols(i);var f,y=e.symbols,d=new Map,p=Ee(y);try{for(p.s();!(f=p.n()).done;){var v=(0,n.Z)(f.value,2),_=v[0],g=v[1],m=g.length;if(m>=32){var b=this.tileCoordRange;do{b/=2,m/=4}while(m>8&&b>64);var w=new _e(this.tileCoordRange,this.tileCoordRange,b);d.set(_,{flat:g,index:w}),r.symbols.set(_,{flat:g,index:w});var x,S=Ee(g);try{for(S.s();!(x=S.n()).done;){var k=x.value;w.getCell(k.xTile,k.yTile).push(k)}}catch(C){S.e(C)}finally{S.f()}}else d.set(_,{flat:g}),r.symbols.set(_,{flat:g})}}catch(C){p.e(C)}finally{p.f()}this._addSymbols(e.key,y)}},{key:"deleteStyleLayers",value:function(e){this._uniqueSymbolLayerArray=null;var t,r=Ee(this._tiles);try{for(r.s();!(t=r.n()).done;){var i,a=(0,n.Z)(t.value,2),s=a[0],o=a[1],l=new Map,u=Ee(e);try{for(u.s();!(i=u.n()).done;){var c=i.value;o.symbols.has(c)&&(l.set(c,o.symbols.get(c)),o.symbols.delete(c))}}catch(h){u.e(h)}finally{u.f()}this._removeSymbols(l),0===o.symbols.size&&this._tiles.delete(s)}}catch(h){r.e(h)}finally{r.f()}}},{key:"removeTile",value:function(e){this._uniqueSymbolLayerArray=null;var t=this._tiles.get(e.id);if(t){var r,i=new Map,a=Ee(e.symbols);try{for(a.s();!(r=a.n()).done;){var s=(0,n.Z)(r.value,2),o=s[0];s[1];t.symbols.has(o)&&(i.set(o,t.symbols.get(o)),t.symbols.delete(o))}}catch(l){a.e(l)}finally{a.f()}this._removeSymbols(i),0===t.symbols.size&&this._tiles.delete(e.id)}}},{key:"_removeSymbols",value:function(e){var t,r=Ee(e);try{for(r.s();!(t=r.n()).done;){var i,a=(0,n.Z)(t.value,2),s=a[0],o=Ee(a[1].flat);try{for(o.s();!(i=o.n()).done;){for(var l=i.value,u=l.unique,c=u.tileSymbols,h=c.length-1,f=0;f<h;f++)if(c[f]===l){c[f]=c[h];break}if(c.length=h,0===h){var y=this._uniqueSymbolsReferences.get(s);y.delete(u),0===y.size&&this._uniqueSymbolsReferences.delete(s)}l.unique=null}}catch(d){o.e(d)}finally{o.f()}}}catch(d){r.e(d)}finally{r.f()}}},{key:"_addSymbols",value:function(e,t){if(0!==t.size){var r,i=Ee(this._visibleTiles);try{for(i.s();!(r=i.n()).done;){var a=r.value;a.parentTile||a.key.world!==e.world||a.key.level===e.level&&!a.key.equals(e)||this._matchSymbols(a,e,t)}}catch(p){i.e(p)}finally{i.f()}var s,o=Ee(t);try{for(o.s();!(s=o.n()).done;){var l,u=(0,n.Z)(s.value,2),c=u[0],h=Ee(u[1]);try{for(h.s();!(l=h.n()).done;){var f=l.value;if((0,m.Wi)(f.unique)){var y=this._createUnique();f.unique=y,y.tileSymbols.push(f);var d=this._uniqueSymbolsReferences.get(c);d||(d=new Set,this._uniqueSymbolsReferences.set(c,d)),d.add(y)}}}catch(p){h.e(p)}finally{h.f()}}}catch(p){o.e(p)}finally{o.f()}}}},{key:"_matchSymbols",value:function(e,t,r){if(e.key.level>t.level){var i=e.key.level-t.level;if(e.key.row>>i!==t.row||e.key.col>>i!==t.col)return}if(t.level>e.key.level){var a=t.level-e.key.level;if(t.row>>a!==e.key.row||t.col>>a!==e.key.col)return}if(t.equals(e.key)){var s,o=Ee(e.childrenTiles);try{for(o.s();!(s=o.n()).done;){var l=s.value;this._matchSymbols(l,t,r)}}catch(F){o.e(F)}finally{o.f()}}else{var u,c=new Map,h=Ee(r);try{for(h.s();!(u=h.n()).done;){var f,y=(0,n.Z)(u.value,2),d=y[0],p=y[1],v=[],_=Ee(p);try{for(_.s();!(f=_.n()).done;){var g=f.value,b=ve(this.tileCoordRange,g.xTile,t.level,t.col,e.key.level,e.key.col),w=ve(this.tileCoordRange,g.yTile,t.level,t.row,e.key.level,e.key.row);b>=0&&b<this.tileCoordRange&&w>=0&&w<this.tileCoordRange&&v.push({symbol:g,xTransformed:b,yTransformed:w})}}catch(F){_.e(F)}finally{_.f()}var x=[],S=e.key.level<t.level?1:1<<e.key.level-t.level,k=this._tiles.get(e.id).symbols.get(d);if(k){var C,I=k.flat,T=Ee(v);try{for(T.s();!(C=T.n()).done;){var R,Z=C.value,P=!1,O=Z.xTransformed,A=Z.yTransformed;R=(0,m.pC)(k.index)?k.index.getCell(O,A):I;var D,M=Z.symbol,B=M.hash,U=Ee(R);try{for(U.s();!(D=U.n()).done;){var L=D.value;if(B===L.hash&&Math.abs(O-L.xTile)<=S&&Math.abs(A-L.yTile)<=S){var V=L.unique;M.unique=V,V.tileSymbols.push(M),P=!0;break}}}catch(F){U.e(F)}finally{U.f()}P||x.push(M)}}catch(F){T.e(F)}finally{T.f()}}x.length>0&&c.set(d,x)}}catch(F){h.e(F)}finally{h.f()}var j,z=Ee(e.childrenTiles);try{for(z.s();!(j=z.n()).done;){var q=j.value;this._matchSymbols(q,t,c)}}catch(F){z.e(F)}finally{z.f()}}}},{key:"_createUniqueSymbolLayerArray",value:function(){var e,t,r=this._uniqueSymbolsReferences,i=new Array(r.size),a=0,s=Ee(r);try{for(s.s();!(t=s.n()).done;){var o=(0,n.Z)(t.value,2),l=o[0],u=o[1],c=new Array(u.size);e=0;var h,f=Ee(u);try{for(f.s();!(h=f.n()).done;){var y=h.value;c[e++]=y}}catch(d){f.e(d)}finally{f.f()}i[a]={styleLayerUID:l,uniqueSymbols:c},a++}}catch(d){s.e(d)}finally{s.f()}return i}}]),e}();function Je(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(B){return!1}}();return function(){var r,i=(0,h.Z)(e);if(t){var n=(0,h.Z)(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return(0,c.Z)(this,r)}}var Ne=1e-6,Ge=function(e){(0,u.Z)(r,e);var t=Je(r);function r(e,i){var a;return(0,s.Z)(this,r),(a=t.call(this)).styleRepository=e,a._tileToHandle=new Map,a._viewState={scale:0,rotation:0,center:[0,0],size:[0,0]},a._declutterViewState={scale:0,rotation:0,center:[0,0],size:[0,0]},a._completed=!1,a._symbolRepository=new We(4096,i,(function(){return new ye})),a._symbolDeclutterer=new Fe(i,a._symbolRepository,(function(e,t,r){return new Ve(e,t,r,a.styleRepository,a._zoom,a._viewState.rotation)}),(function(e,t){e.allSymbolsFadingOut=!0,e.lastOpacityUpdate=t,function(e,t,r){var i,a=de(e.symbols);try{for(a.s();!(i=a.n()).done;){var s=(0,n.Z)(i.value,2),o=s[0];ge(e,t,r,s[1],o)}}catch(l){a.e(l)}finally{a.f()}}(e,t,!0),e.decluttered=!0,e.requestRender()}),(function(e,t){return a.styleRepository.getStyleLayerByUID(e.styleLayerUID).z-a.styleRepository.getStyleLayerByUID(t.styleLayerUID).z}),(function(e){var t=a.styleRepository.getStyleLayerByUID(e);if(a._zoom+Ne<t.minzoom||a._zoom-Ne>=t.maxzoom)return!1;var r=t.getLayoutProperty("visibility");return!r||1!==r.getValue()})),a}return(0,o.Z)(r,[{key:"addTile",value:function(e){var t=this;e.decluttered=!1,this._tileToHandle.set(e,e.on("symbols-changed",(function(){t._symbolRepository.add(e),t.restartDeclutter()}))),this._symbolRepository.add(e),this.restartDeclutter()}},{key:"removeTile",value:function(e){var t=this._tileToHandle.get(e);t&&(this._symbolRepository.removeTile(e),this.restartDeclutter(),t.remove(),this._tileToHandle.delete(e))}},{key:"update",value:function(e,t){return this._zoom=e,this._viewState={scale:t.scale,rotation:t.rotation,center:[t.center[0],t.center[1]],size:[t.size[0],t.size[1]]},this._continueDeclutter(),this._completed}},{key:"restartDeclutter",value:function(){this._completed=!1,this._symbolDeclutterer.restart(),this._notifyUnstable()}},{key:"clear",value:function(){this._completed=!1,this._symbolRepository=null,this._symbolDeclutterer.restart(),this._tileToHandle.forEach((function(e){return e.remove()})),this._tileToHandle.clear()}},{key:"stale",get:function(){return this._zoom!==this._declutterZoom||this._viewState.size[0]!==this._declutterViewState.size[0]||this._viewState.size[1]!==this._declutterViewState.size[1]||this._viewState.scale!==this._declutterViewState.scale||this._viewState.rotation!==this._declutterViewState.rotation}},{key:"deleteStyleLayers",value:function(e){this._symbolRepository.deleteStyleLayers(e)}},{key:"_continueDeclutter",value:function(){this._completed&&!this.stale||(this._symbolDeclutterer.running||(this._declutterZoom=this._zoom,this._declutterViewState.center[0]=this._viewState.center[0],this._declutterViewState.center[1]=this._viewState.center[1],this._declutterViewState.rotation=this._viewState.rotation,this._declutterViewState.scale=this._viewState.scale,this._declutterViewState.size[0]=this._viewState.size[0],this._declutterViewState.size[1]=this._viewState.size[1],this._symbolDeclutterer.restart()),this._symbolDeclutterer.setScreenSize(this._viewState.size[0],this._viewState.size[1]),this._completed=this._symbolDeclutterer.continue(Te.Ts),this._completed&&this._scheduleNotifyStable())}},{key:"_scheduleNotifyStable",value:function(){var e=this;(0,m.pC)(this._stableNotificationHandle)&&clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=setTimeout((function(){e._stableNotificationHandle=null,e.emit("fade-complete")}),1.5*Te.nN)}},{key:"_notifyUnstable",value:function(){(0,m.pC)(this._stableNotificationHandle)&&(clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=null),this.emit("fade-start")}}]),r}(Me.Z),$e=r(4761);function Ke(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(B){return!1}}();return function(){var r,i=(0,h.Z)(e);if(t){var n=(0,h.Z)(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return(0,c.Z)(this,r)}}var Ye=function(e){(0,u.Z)(r,e);var t=Ke(r);function r(){return(0,s.Z)(this,r),t.apply(this,arguments)}return(0,o.Z)(r,[{key:"_createTransforms",value:function(){return{dvs:(0,he.c)(),tileMat3:(0,he.c)()}}}]),r}(Re.I),Xe=r(62345);function et(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function tt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?et(Object(r),!0).forEach((function(t){(0,I.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):et(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function rt(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return it(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return it(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}function it(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function nt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(B){return!1}}();return function(){var r,i=(0,h.Z)(e);if(t){var n=(0,h.Z)(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return(0,c.Z)(this,r)}}var at=1e-6;function st(e,t){if(e){var r=e.getLayoutProperty("visibility");if(!r||1!==r.getValue()&&(void 0===e.minzoom||e.minzoom<t+at)&&(void 0===e.maxzoom||e.maxzoom>=t-at))return!0}return!1}var ot=function(e){(0,u.Z)(i,e);var t,r=nt(i);function i(e){var t;return(0,s.Z)(this,i),(t=r.call(this,e))._backgroundTiles=[],t._pointToCallbacks=new Map,t}return(0,o.Z)(i,[{key:"destroy",value:function(){this.removeAllChildren(),this._spriteMosaic&&(this._spriteMosaic.dispose(),this._spriteMosaic=null),this._glyphMosaic&&(this._glyphMosaic.dispose(),this._glyphMosaic=null),(0,m.pC)(this._symbolFader)&&(this._symbolFader.clear(),this._symbolFader=null),this._styleRepository=null,this._backgroundTiles=[],this._pointToCallbacks.clear()}},{key:"setStyleResources",value:function(e,t,r){var i=this;if(this._spriteMosaic=e,this._glyphMosaic=t,this._styleRepository=r,(0,m.Wi)(this._symbolFader)){var n=new Ge(this._styleRepository,this.children);n.on("fade-start",(function(){i.emit("fade-start"),i.requestRender()})),n.on("fade-complete",(function(){i.emit("fade-complete"),i.requestRender()})),this._symbolFader=n}(0,m.Wg)(this._symbolFader).styleRepository=r}},{key:"deleteStyleLayers",value:function(e){(0,m.pC)(this._symbolFader)&&this._symbolFader.deleteStyleLayers(e)}},{key:"hitTest",value:(t=(0,a.Z)(y().mark((function e(t){var r;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,b.hh)(),e.abrupt("return",(this._pointToCallbacks.set(t,r),this.requestRender(),r.promise));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"enterTileInvalidation",value:function(){var e,t=rt(this.children);try{for(t.s();!(e=t.n()).done;){e.value.invalidating=!0}}catch(r){t.e(r)}finally{t.f()}}},{key:"createRenderParams",value:function(e){return tt(tt({},(0,l.Z)((0,h.Z)(i.prototype),"createRenderParams",this).call(this,e)),{},{renderPass:null,styleLayer:null,styleLayerUID:-1,glyphMosaic:this._glyphMosaic,spriteMosaic:this._spriteMosaic,hasClipping:!!this._clippingInfos})}},{key:"doRender",value:function(e){!this.visible||e.drawPhase!==$e.jx.MAP&&e.drawPhase!==$e.jx.DEBUG||void 0===this._spriteMosaic||(0,l.Z)((0,h.Z)(i.prototype),"doRender",this).call(this,e)}},{key:"addChild",value:function(e){return(0,l.Z)((0,h.Z)(i.prototype),"addChild",this).call(this,e),(0,m.pC)(this._symbolFader)?this._symbolFader.addTile(e):e.decluttered=!0,this.requestRender(),e}},{key:"removeChild",value:function(e){return(0,m.pC)(this._symbolFader)&&this._symbolFader.removeTile(e),this.requestRender(),(0,l.Z)((0,h.Z)(i.prototype),"removeChild",this).call(this,e)}},{key:"renderChildren",value:function(e){var t=e.drawPhase;if(t!==$e.jx.DEBUG){if(this._doRender(e),this._pointToCallbacks.size>0){e.drawPhase=$e.jx.HITTEST;var r=e.painter.effects.hittest;r.bind(e),this._doRender(e),r.draw(e,this._pointToCallbacks),r.unbind(e),e.drawPhase=t}}else(0,l.Z)((0,h.Z)(i.prototype),"renderChildren",this).call(this,e)}},{key:"removeAllChildren",value:function(){for(var e=0;e<this.children.length;e++){var t=this.children[e];(0,m.pC)(this._symbolFader)&&this._symbolFader.removeTile(t),t.dispose()}(0,l.Z)((0,h.Z)(i.prototype),"removeAllChildren",this).call(this)}},{key:"getStencilTarget",value:function(){return this.children.filter((function(e){return e.neededForCoverage&&e.hasData()}))}},{key:"restartDeclutter",value:function(){(0,m.pC)(this._symbolFader)&&this._symbolFader.restartDeclutter()}},{key:"_doRender",value:function(e){var t=e.context,r=this._styleRepository;if(r){var n=r.layers,a=!0;e.drawPhase===$e.jx.HITTEST&&(a=!1),r.backgroundBucketIds.length>0&&(e.renderPass="background",this._renderBackgroundLayers(e,r.backgroundBucketIds)),(0,l.Z)((0,h.Z)(i.prototype),"renderChildren",this).call(this,e),e.drawPhase===$e.jx.MAP&&this._fade(e.displayLevel,e.state);var s=this.children.filter((function(e){return e.visible&&e.hasData()}));if(!s||0===s.length)return t.bindVAO(),t.setStencilTestEnabled(!0),void t.setBlendingEnabled(!0);var o,u=rt(s);try{for(u.s();!(o=u.n()).done;){o.value.triangleCount=0}}catch(d){u.e(d)}finally{u.f()}t.setStencilWriteMask(0),t.setColorMask(!0,!0,!0,!0),t.setStencilOp(7680,7680,7681),t.setStencilTestEnabled(!0),t.setBlendingEnabled(!1),t.setDepthTestEnabled(!0),t.setDepthWriteEnabled(!0),t.setDepthFunction(515),t.setClearDepth(1),t.clear(t.gl.DEPTH_BUFFER_BIT),e.renderPass="opaque";for(var c=n.length-1;c>=0;c--)this._renderStyleLayer(n[c],e,s);t.setDepthWriteEnabled(!1),t.setBlendingEnabled(a),t.setBlendFunctionSeparate(1,771,1,771),e.renderPass="translucent";for(var f=0;f<n.length;f++)this._renderStyleLayer(n[f],e,s);t.setDepthTestEnabled(!1),e.renderPass="symbol";for(var y=0;y<n.length;y++)this._renderStyleLayer(n[y],e,s);t.bindVAO(),t.setStencilTestEnabled(!0),t.setBlendingEnabled(!0)}}},{key:"_fade",value:function(e,t){(0,m.pC)(this._symbolFader)&&(this._symbolFader.update(e,t)||this.requestRender())}},{key:"_renderStyleLayer",value:function(e,t,r){var i=t.painter,n=t.renderPass;if(void 0!==e){var a=e.getLayoutProperty("visibility");if(!a||1!==a.getValue()){var s;switch(e.type){case 0:return;case 1:if("opaque"!==n&&"translucent"!==t.renderPass)return;s="vtlFill";break;case 2:if("translucent"!==n)return;s="vtlLine";break;case 4:if("symbol"!==n)return;s="vtlCircle";break;case 3:if("symbol"!==n)return;s="vtlSymbol"}if(r=3===e.type?r.filter((function(e){return e.decluttered})):r.filter((function(e){return e.neededForCoverage})),"vtlSymbol"!==s){var o=t.displayLevel;if(0===r.length||void 0!==e.minzoom&&e.minzoom>=o+at||void 0!==e.maxzoom&&e.maxzoom<o-at)return}var l=e.uid;t.styleLayerUID=l,t.styleLayer=e;var u,c=rt(r);try{for(c.s();!(u=c.n()).done;){if(u.value.layerData.has(l)){i.renderObjects(t,r,s);break}}}catch(h){c.e(h)}finally{c.f()}}}}},{key:"_renderBackgroundLayers",value:function(e,t){var r,i=e.context,n=e.displayLevel,a=e.painter,s=e.state,o=this._styleRepository,l=!1,u=rt(t);try{for(u.s();!(r=u.n()).done;){var c=r.value;if(0===o.getLayerById(c).type&&st(o.getLayerById(c),n)){l=!0;break}}}catch(L){u.e(L)}finally{u.f()}if(l){var h=this._tileInfoView.getTileCoverage(e.state,0,"smallest"),f=h.spans,y=h.lodInfo,d=y.level,p=(0,C.Ue)(),v=[];if(this._renderPasses){var _=this._renderPasses[0];(0,m.pC)(this._clippingInfos)&&(_.brushes[0].prepareState(e,this._clippingInfos[0]),_.brushes[0].drawMany(e,this._clippingInfos))}var g,b,w=this._backgroundTiles,x=0,S=rt(f);try{for(S.s();!(b=S.n()).done;)for(var k=b.value,I=k.row,T=k.colFrom,R=k.colTo,Z=T;Z<=R;Z++){if(x<w.length)(g=w[x]).key.set(d,I,y.normalizeCol(Z),y.getWorldForColumn(Z)),this._tileInfoView.getTileBounds(p,g.key,!1),g.x=p[0],g.y=p[3];else{var P=new X.Z(d,I,y.normalizeCol(Z),y.getWorldForColumn(Z)),O=this._tileInfoView.getTileBounds((0,C.Ue)(),P);g=new Ye(P,O[0],O[3],512,512,4096,4096),w.push(g)}g.setTransform(s,this._tileInfoView.getTileResolution(g.key)),v.push(g),x++}}catch(L){S.e(L)}finally{S.f()}i.setStencilWriteMask(0),i.setColorMask(!0,!0,!0,!0),i.setStencilOp(7680,7680,7681),i.setStencilFunction(514,0,255);var A=!0;e.drawPhase===$e.jx.HITTEST&&(A=!1),i.setStencilTestEnabled(A);var D,M=rt(t);try{for(M.s();!(D=M.n()).done;){var B=D.value,U=o.getLayerById(B);0===U.type&&st(U,n)&&(e.styleLayerUID=U.uid,e.styleLayer=U,a.renderObjects(e,v,"vtlBackground"))}}catch(L){M.e(L)}finally{M.f()}ne.Z.pool.release(h)}}}]),i}(Xe.Z),lt=r(90909),ut=r(17396),ct=r(97326),ht=r(46645);function ft(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function yt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ft(Object(r),!0).forEach((function(t){(0,I.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ft(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function dt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(B){return!1}}();return function(){var r,i=(0,h.Z)(e);if(t){var n=(0,h.Z)(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return(0,c.Z)(this,r)}}var pt=function(e){(0,u.Z)(r,e);var t=dt(r);function r(e){var i;return(0,s.Z)(this,r),(i=t.call(this)).requestRender=i.requestRender.bind((0,ct.Z)(i)),i._layerView=e,i._canvas=document.createElement("canvas"),i._context=i._canvas.getContext("2d"),i._bitmap=new ht.eY(null,"standard",!1),i.addChild(i._bitmap),i}return(0,o.Z)(r,[{key:"doRender",value:function(e){var t=e.state,i=this._createCustomRenderParams(e),n=this._canvas,a=this._bitmap,s=window.devicePixelRatio;n.width=t.size[0]*s,n.height=t.size[1]*s,a.resolution=t.resolution;var o=t.clone();o.pixelRatio=s,a.pixelRatio=s,i.state=o,a.x=t.viewpoint.targetGeometry.x-Math.abs(t.extent.xmax-t.extent.xmin)/2,a.y=t.viewpoint.targetGeometry.y+Math.abs(t.extent.ymax-t.extent.ymin)/2,this._layerView.render(i),a.source=n,a.rotation=t.rotation,(0,l.Z)((0,h.Z)(r.prototype),"doRender",this).call(this,yt(yt({},e),{},{state:o}))}},{key:"_createCustomRenderParams",value:function(e){return{globalOpacity:e.globalOpacity,state:e.state,stationary:e.stationary,pixelRatio:window.devicePixelRatio,context:this._context}}}]),r}(r(57047).c),vt=r(22176);function _t(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(B){return!1}}();return function(){var r,i=(0,h.Z)(e);if(t){var n=(0,h.Z)(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return(0,c.Z)(this,r)}}var gt=function(e){(0,u.Z)(r,e);var t=_t(r);function r(){var e;return(0,s.Z)(this,r),(e=t.apply(this,arguments))._fullCacheLodInfos=null,e._levelByScale={},e}return(0,o.Z)(r,[{key:"getTileParentId",value:function(e){var t=X.Z.pool.acquire(e),r=0===t.level?null:X.Z.getId(t.level-1,t.row>>1,t.col>>1,t.world);return X.Z.pool.release(t),r}},{key:"getTileCoverage",value:function(e,t,i){var n=(0,l.Z)((0,h.Z)(r.prototype),"getTileCoverage",this).call(this,e,t,i);if(!n)return n;var a=1<<n.lodInfo.level;return n.spans=n.spans.filter((function(e){return e.row>=0&&e.row<a})),n}},{key:"scaleToLevel",value:function(e){if(this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos),this._levelByScale[e])return this._levelByScale[e];var t,r,i=this._fullCacheLodInfos;if(e>i[0].scale)return i[0].level;for(var n=0;n<i.length-1;n++)if(e>(r=i[n+1]).scale)return(t=i[n]).level+(t.scale-e)/(t.scale-r.scale);return i[i.length-1].level}},{key:"_initializeFullCacheLODs",value:function(e){var t;if(0===e[0].level)t=e.map((function(e){return{level:e.level,resolution:e.resolution,scale:e.scale}}));else{var r=this.tileInfo.size[0],i=this.tileInfo.spatialReference;t=vt.Z.create({size:r,spatialReference:i}).lods.map((function(e){return{level:e.level,resolution:e.resolution,scale:e.scale}}))}for(var n=0;n<t.length;n++)this._levelByScale[t[n].scale]=t[n].level;this._fullCacheLodInfos=t}}]),r}(r(99675).Z),mt=r(75998),bt=r(43798);function wt(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return xt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return xt(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}function xt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function St(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(B){return!1}}();return function(){var r,i=(0,h.Z)(e);if(t){var n=(0,h.Z)(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return(0,c.Z)(this,r)}}var kt=g.Z.getLogger("esri.views.2d.layers.VectorTileLayerView2D"),Ct=function(e){(0,u.Z)(x,e);var t,r,c,f,d,g=St(x);function x(){var e;return(0,s.Z)(this,x),(e=g.apply(this,arguments))._styleChanges=[],e._fetchQueue=null,e._parseQueue=null,e._isTileHandlerReady=!1,e.fading=!1,e}return(0,o.Z)(x,[{key:"initialize",value:function(){var e=this,t=this.layer.tileInfo;if((t&&t.spatialReference).equals(this.view.spatialReference)){var r=this.layer.currentStyleInfo.style;this._styleRepository=new lt.Z(r),this._tileInfoView=new gt(this.layer.tileInfo,this.layer.fullExtent),this._vectorTileContainer=new ot(this._tileInfoView),this._tileHandler=new re(this.layer,this._styleRepository,window.devicePixelRatio||1),this.container.addChild(this._vectorTileContainer),this.handles.add([this._vectorTileContainer.on("fade-start",(function(){e.fading=!0,e.notifyChange("updating"),e.requestUpdate()})),this._vectorTileContainer.on("fade-complete",(function(){e._collisionBoxesDisplay&&e._collisionBoxesDisplay.requestRender(),e.fading=!1,e.notifyChange("updating"),e.requestUpdate()})),(0,w.S1)(this.layer,"symbolCollisionBoxesVisible",(function(t){t?(e._collisionBoxesDisplay=new pt({render:function(t){return e._renderCollisionBoxes(t.context)}}),e.container.addChild(e._collisionBoxesDisplay)):(e.container.removeChild(e._collisionBoxesDisplay),e._collisionBoxesDisplay=null)}))])}else this.addResolvingPromise(Promise.reject(new v.Z("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer})))}},{key:"destroy",value:function(){var e;this._stop(),this.container.removeAllChildren(),this._vectorTileContainer&&(this._vectorTileContainer.destroy(),this._vectorTileContainer=null),null==(e=this._tileHandler)||e.destroy(),this._tileHandler=null}},{key:"hitTest",value:(d=(0,a.Z)(y().mark((function e(t,r){var i,n,a,s,o,l;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._tileHandlerPromise){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,this._tileHandlerPromise;case 4:return e.next=6,this._vectorTileContainer.hitTest(r);case 6:if((i=e.sent)&&0!==i.length){e.next=9;break}return e.abrupt("return",null);case 9:if(n=i[0]-1,a=this._styleRepository,s=a.getStyleLayerByUID(n)){e.next=12;break}return e.abrupt("return",null);case 12:return o=a.getStyleLayerIndex(s.id),l=new p.Z({attributes:{layerId:o,layerName:s.id,layerUID:n}}),e.abrupt("return",(l.layer=this.layer,l.sourceLayer=this.layer,[l]));case 14:case"end":return e.stop()}}),e,this)}))),function(e,t){return d.apply(this,arguments)})},{key:"update",value:function(e){if(this._tileHandlerPromise&&this._isTileHandlerReady)return e.pixelRatio!==this._tileHandler.devicePixelRatio?(this._start(),void(this._tileHandler.devicePixelRatio=e.pixelRatio)):void(this._styleChanges.length>0?this._tileHandlerPromise=this._applyStyleChanges():(this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.state=e.state,this._parseQueue.state=e.state,this._tileManager.update(e)||this.requestUpdate(),this._parseQueue.resume(),this._fetchQueue.resume()))}},{key:"attach",value:function(){var e=this;this._start(),this.handles.add([this.layer.on("paint-change",(function(t){if(t.isDataDriven)e._styleChanges.push({type:0,data:t}),e.notifyChange("updating"),e.requestUpdate();else{var r=e._styleRepository,i=r.getLayerById(t.layer);if(!i)return;var n=3===i.type;r.setPaintProperties(t.layer,t.paint),n&&e._vectorTileContainer.restartDeclutter(),e._vectorTileContainer.requestRender()}})),this.layer.on("layout-change",(function(t){var r=e._styleRepository,i=r.getLayerById(t.layer);if(i){var n=(0,k.Hg)(i.layout,t.layout);if(!(0,m.Wi)(n)){if((0,k.uD)(n,"visibility")&&1===function(e){if((0,m.Wi)(e))return 0;switch(e.type){case"partial":return Object.keys(e.diff).length;case"complete":return Math.max(Object.keys(e.oldValue).length,Object.keys(e.newValue).length);case"collection":return Object.keys(e.added).length+Object.keys(e.changed).length+Object.keys(e.removed).length}}(n))return r.setLayoutProperties(t.layer,t.layout),3===i.type&&e._vectorTileContainer.restartDeclutter(),void e._vectorTileContainer.requestRender();e._styleChanges.push({type:1,data:t}),e.notifyChange("updating"),e.requestUpdate()}}})),this.layer.on("style-layer-visibility-change",(function(t){var r=e._styleRepository,i=r.getLayerById(t.layer);i&&(r.setStyleLayerVisibility(t.layer,t.visibility),3===i.type&&e._vectorTileContainer.restartDeclutter(),e._vectorTileContainer.requestRender())})),this.layer.on("style-layer-change",(function(t){e._styleChanges.push({type:2,data:t}),e.notifyChange("updating"),e.requestUpdate()})),this.layer.on("delete-style-layer",(function(t){e._styleChanges.push({type:3,data:t}),e.notifyChange("updating"),e.requestUpdate()})),this.layer.on("load-style",(function(){return e._loadStyle()}))],this.declaredClass)}},{key:"detach",value:function(){this._stop(),this.handles.remove(this.declaredClass)}},{key:"moveStart",value:function(){this.requestUpdate()}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"moveEnd",value:function(){this._collisionBoxesDisplay&&this._vectorTileContainer.restartDeclutter(),this.requestUpdate()}},{key:"canResume",value:function(){var e=(0,l.Z)((0,h.Z)(x.prototype),"canResume",this).call(this),t=this.layer;if(e&&t.currentStyleInfo){var r=this.view.scale,i=t.currentStyleInfo;if(i&&i.layerDefinition){var n=i.layerDefinition;n.minScale&&n.minScale<r&&(e=!1),n.maxScale&&n.maxScale>r&&(e=!1)}}return e}},{key:"isUpdating",value:function(){var e=this._vectorTileContainer.children;return!this._isTileHandlerReady||!this._fetchQueue||!this._parseQueue||this._fetchQueue.updating||this._parseQueue.updating||e.length>0&&e.filter((function(e){return e.invalidating})).length>0||this.fading}},{key:"acquireTile",value:function(e){var t=this,r=this._createVectorTile(e);return this._tileHandlerPromise.then((function(){t._fetchQueue.push(r.key).then((function(e){return t._parseQueue.push({key:r.key,data:e})})).then((function(e){r.once("attach",(function(){return t.requestUpdate()})),r.setData(e),t.requestUpdate(),t.notifyChange("updating")})).catch((function(e){t.notifyChange("updating"),(0,b.D_)(e)||kt.error(e)}))})),r}},{key:"releaseTile",value:function(e){var t=e.key.id;this._fetchQueue.abort(t),this._parseQueue.abort(t),this.requestUpdate()}},{key:"_start",value:function(){var e=this;if(this._stop(),this._tileManager=new le({acquireTile:function(t){return e.acquireTile(t)},releaseTile:function(t){return e.releaseTile(t)},tileInfoView:this._tileInfoView},this._vectorTileContainer),this.layer.currentStyleInfo){var t=new AbortController,r=this._tileHandler.start({signal:t.signal}).then((function(){e._fetchQueue=new mt.Z({tileInfoView:e._tileInfoView,process:function(t,r){return e._getTileData(t,r)},concurrency:15}),e._parseQueue=new mt.Z({tileInfoView:e._tileInfoView,process:function(t,r){return e._parseTileData(t,r)},concurrency:8}),e.requestUpdate(),e._isTileHandlerReady=!0}));this._tileHandler.spriteMosaic.then((function(t){e._vectorTileContainer.setStyleResources(t,e._tileHandler.glyphMosaic,e._styleRepository),e.requestUpdate()})),this._tileHandlerAbortController=t,this._tileHandlerPromise=r}}},{key:"_stop",value:function(){if(this._tileHandlerAbortController&&this._vectorTileContainer){var e=this._tileHandlerAbortController;e&&e.abort(),this._tileHandlerPromise=null,this._isTileHandlerReady=!1,this._fetchQueue&&(this._fetchQueue.destroy(),this._fetchQueue=null),this._parseQueue&&(this._parseQueue.destroy(),this._parseQueue=null),this._tileManager&&(this._tileManager.destroy(),this._tileManager=null),this._vectorTileContainer.removeAllChildren()}}},{key:"_getTileData",value:(f=(0,a.Z)(y().mark((function e(t,r){var i;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._tileHandler.fetchTileData(t,r);case 2:return i=e.sent,e.abrupt("return",(this.notifyChange("updating"),i));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return f.apply(this,arguments)})},{key:"_parseTileData",value:(c=(0,a.Z)(y().mark((function e(t,r){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._tileHandler.parseTileData(t,r));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"_applyStyleChanges",value:(r=(0,a.Z)(y().mark((function e(){var t,r,i,n,a,s,o,l,u,c,h,f,d=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._isTileHandlerReady=!1,this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.clear(),this._parseQueue.clear(),this._tileManager.clearCache(),t=this._styleChanges,e.prev=2,e.next=5,this._tileHandler.updateStyle(t);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),kt.error("error applying vector-tiles style update",e.t0.message),this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=!0;case 10:if(r=this._styleRepository,i=[],t.forEach((function(e){if(3===e.type){var t=e.data,n=r.getLayerById(t.layer);n&&i.push(n.uid)}})),n=[],t.forEach((function(e){var t=e.type,i=e.data;switch(t){case 0:r.setPaintProperties(i.layer,i.paint),a=i.layer;break;case 1:r.setLayoutProperties(i.layer,i.layout),a=i.layer;break;case 3:return void r.deleteStyleLayer(i.layer);case 2:r.setStyleLayer(i.layer,i.index),a=i.layer.id}var s=r.getLayerById(a);s&&n.push(s.uid)})),s=this._vectorTileContainer.children,i.length>0){this._vectorTileContainer.deleteStyleLayers(i),o=wt(s);try{for(o.s();!(l=o.n()).done;)l.value.deleteLayerData(i)}catch(y){o.e(y)}finally{o.f()}}if(this._fetchQueue.resume(),this._parseQueue.resume(),!(n.length>0)){e.next=22;break}u=[],c=wt(s);try{for(f=function(){var e=h.value,t=d._fetchQueue.push(e.key).then((function(t){return d._parseQueue.push({key:e.key,data:t,styleLayerUIDs:n})})).then((function(t){return e.setData(t)}));u.push(t)},c.s();!(h=c.n()).done;)f()}catch(y){c.e(y)}finally{c.f()}return e.next=22,Promise.all(u);case 22:this._styleChanges=[],this._isTileHandlerReady=!0,this.notifyChange("updating"),this.requestUpdate();case 23:case"end":return e.stop()}}),e,this,[[2,7]])}))),function(){return r.apply(this,arguments)})},{key:"_loadStyle",value:(t=(0,a.Z)(y().mark((function e(){var t,r,i,n;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.currentStyleInfo.style,r=(0,_.d9)(t),this._isTileHandlerReady=!1,this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.clear(),this._parseQueue.clear(),this.notifyChange("updating"),this._styleRepository=new lt.Z(r),this._vectorTileContainer.destroy(),this._tileManager.clear(),this._tileHandlerAbortController.abort(),this._tileHandlerAbortController=new AbortController,i=this._tileHandlerAbortController.signal,e.prev=3,this._tileHandlerPromise=this._tileHandler.setStyle(this._styleRepository,r),e.next=7,this._tileHandlerPromise;case 7:e.next=13;break;case 9:if(e.prev=9,e.t0=e.catch(3),(0,b.D_)(e.t0)){e.next=13;break}throw e.t0;case 13:if(!i.aborted){e.next=15;break}return e.abrupt("return",(this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=!0,this.notifyChange("updating"),void this.requestUpdate()));case 15:return e.next=17,this._tileHandler.spriteMosaic;case 17:n=e.sent,this._vectorTileContainer.setStyleResources(n,this._tileHandler.glyphMosaic,this._styleRepository),this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=!0,this.notifyChange("updating"),this.requestUpdate();case 19:case"end":return e.stop()}}),e,this,[[3,9]])}))),function(){return t.apply(this,arguments)})},{key:"_createVectorTile",value:function(e){var t=this._tileInfoView.getTileBounds((0,C.Ue)(),e);return new Ae(e,t[0],t[3],512,512,this._styleRepository)}},{key:"_renderCollisionBoxes",value:function(e){var t,r=wt(this._vectorTileContainer.children);try{for(r.s();!(t=r.n()).done;){var a=t.value;if(a.symbols){var s,o=[],l=wt(a.symbols);try{for(l.s();!(s=l.n()).done;){var u=(0,n.Z)(s.value,2),c=(u[0],u[1]);o.push.apply(o,(0,i.Z)(c))}}catch(h){l.e(h)}finally{l.f()}Y(e,o)}}}catch(h){r.e(h)}finally{r.f()}}}]),x}((0,ut.y)(bt.Z));(0,d._)([(0,x.Cb)()],Ct.prototype,"_fetchQueue",void 0),(0,d._)([(0,x.Cb)()],Ct.prototype,"_parseQueue",void 0),(0,d._)([(0,x.Cb)()],Ct.prototype,"_isTileHandlerReady",void 0),(0,d._)([(0,x.Cb)()],Ct.prototype,"fading",void 0);var It=Ct=(0,d._)([(0,S.j)("esri.views.2d.layers.VectorTileLayerView2D")],Ct)}}]);
//# sourceMappingURL=5777-7f2ebc7bcb1dd0b1cf05.js.map