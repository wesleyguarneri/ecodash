"use strict";(self.webpackChunkenergy_and_water_dashboard=self.webpackChunkenergy_and_water_dashboard||[]).push([[9320],{9320:function(e,t,r){r.r(t),r.d(t,{default:function(){return bt}});var n=r(15861),i=r(4942),a=r(15671),s=r(43144),o=r(11752),l=r(60136),u=r(6215),c=r(61120),f=r(87757),h=r.n(f),p=r(83195),d=r(60125),m=r(34174),y=r(33300),v=r(10173),x=r(80347),g=r(37566),b=r(89636),w=(r(43079),r(33682),r(64003)),I=r(17418),k=r(9634),R=r(30732),C=r(65673),S=r(83350),_=r(39987),T=r(29439),O=(r(58168),r(51916)),Z=r(75571),P=r(18965),M=r(50810),F=r(90697),D=r(44946),B=r(52724),E=r(62513),H=r(22176),A=r(18521),z=r(51490),N=r(89579),L=r(65268),j=r(59007),J=r(39356);function W(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function q(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?W(Object(r),!0).forEach((function(t){(0,i.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):W(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function U(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.Z)(e);if(t){var i=(0,c.Z)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,u.Z)(this,r)}}var G=Z.Z.getLogger("esri.layers.mixins.ImageryTileMixin"),V=r(74915),Y=r(3781),X=r(15665),K=r(29780),Q=r(38313),$=r(35166),ee=r(36578),te=r(78120),re=r(24373),ne=r(25294),ie=r(93433),ae=r(54279),se=r(85001),oe=r(25907),le=r(97690),ue=r(7665),ce=r(24748),fe=r(5224);function he(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function pe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?he(Object(r),!0).forEach((function(t){(0,i.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):he(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function de(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.Z)(e);if(t){var i=(0,c.Z)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,u.Z)(this,r)}}var me=function(e){(0,l.Z)(x,e);var t,r,i,o,u,c,f,p,d,m=de(x);function x(){var e;return(0,a.Z)(this,x),(e=m.apply(this,arguments)).rasterJobHandler=null,e.datasetName=null,e.datasetFormat=null,e.rasterInfo=null,e.ioConfig={sampling:"closest"},e}return(0,s.Z)(x,[{key:"init",value:(d=(0,n.Z)(h().mark((function e(){var t;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,ce.zD)(),this.addResolvingPromise(t),e.next=4,this.when();case 4:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"normalizeCtorArgs",value:function(e){return e&&e.ioConfig&&(e=pe(pe({},e),{},{ioConfig:pe({resolution:null,bandIds:null,sampling:"closest",tileInfo:H.Z.create()},e.ioConfig)})),e}},{key:"url",set:function(e){this._set("url",(0,F.Nm)(e,Z.Z.getLogger(this.declaredClass)))}},{key:"open",value:(p=(0,n.Z)(h().mark((function e(t){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new y.Z("BaseRaster:open-not-implemented","open() is not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return p.apply(this,arguments)})},{key:"fetchTile",value:(f=(0,n.Z)(h().mark((function e(t,r,n){var i,a,s,o=arguments;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=o.length>3&&void 0!==o[3]?o[3]:{},a=i.tileInfo||this.rasterInfo.storageInfo.tileInfo,s=this.getTileExtentFromTileInfo(t,r,n,a),e.abrupt("return",this.fetchPixels(s,a.size[0],a.size[1],i));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return f.apply(this,arguments)})},{key:"identify",value:(c=(0,n.Z)(h().mark((function e(t){var r,n,i,a,s,o,l,u,c,f,p,d,m,y,x,g,b,w,I,k,R=arguments;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=R.length>1&&void 0!==R[1]?R[1]:{},r=this._getRequestOptionsWithSliceId(r),n=this.rasterInfo,i=n.spatialReference,a=n.extent,s=r.datumTransformation,o=(0,ce.nF)(t,i,s),a.intersects(o)){e.next=6;break}return e.abrupt("return",{location:o,value:null});case 6:if(!(0,v.pC)(this.rasterInfo.transform)){e.next=11;break}if(l=this.rasterInfo.transform.inverseTransform(o),this.rasterInfo.nativeExtent.intersects(l)){e.next=10;break}return e.abrupt("return",{location:l,value:null});case 10:o=l;case 11:if(u=0,!r.srcResolution){e.next=16;break}u=(0,ce.kr)(r.srcResolution,this.rasterInfo,this.ioConfig.sampling).pyramidLevel,e.next=21;break;case 16:return e.next=18,this.computeBestPyramidLevelForLocation(t,r);case 18:if(null!=(u=e.sent)){e.next=21;break}return e.abrupt("return",{location:o,value:null});case 21:if(null!==(c=this.identifyPixelLocation(o,u,null))){e.next=24;break}return e.abrupt("return",{location:o,value:null});case 24:return f=c.row,p=c.col,d=c.rowOffset,m=c.colOffset,y=(0,oe.Rq)(this.url,r.sliceId),x="".concat(u,"/").concat(f,"/").concat(p),g=(0,oe.Qg)(y,null,x),(0,v.Wi)(g)&&(g=this.fetchRawTile(u,f,p,r),(0,oe.gX)(y,null,x,g)),e.next=29,g;case 29:if(b=e.sent,!(0,v.Wi)(b)&&b.pixels&&0!==b.pixels.length){e.next=32;break}return e.abrupt("return",{location:o,value:null});case 32:if(w=d*this.rasterInfo.storageInfo.blockHeight+m,I=!b.mask||b.mask[w]?b.pixels.map((function(e){return e[w]})):null,"vector-magdir"!==(k=this.rasterInfo.dataType)&&"vector-uv"!==k||!((null==I?void 0:I.length)>1)){e.next=35;break}return e.abrupt("return",{location:o,value:I,magdirValue:"vector-magdir"===k?[I[0],I[1]]:(0,A.Tg)([I[0],I[1]]),pyramidLevel:u});case 35:return e.abrupt("return",{location:o,value:I,pyramidLevel:u});case 36:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"fetchPixels",value:(u=(0,n.Z)(h().mark((function e(t,r,n){var i,a,s,o,l,u,c,f,p,d,m,y,x,g,b,w,I,k,R,C,S=arguments;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=S.length>3&&void 0!==S[3]?S[3]:{},t=(0,ce.kZ)(t),a=(0,ce.ut)(t.spatialReference),s=(0,ce.Hq)(t),o=(0,ce.ut)(this.rasterInfo.spatialReference),l=(0,v.pC)(o)&&this.rasterInfo.extent.width>=o/2,i=this._getRequestOptionsWithSliceId(i),!((0,v.Wi)(a)||0===s||1===s&&l)){e.next=5;break}return e.abrupt("return",this._fetchPixels(t,r,n,i));case 5:if(!(s>=3)){e.next=7;break}return e.abrupt("return",{extent:t,pixelBlock:null});case 7:for(u=[],f=(c=t).xmin,p=c.xmax,d=Math.round(a/(p-f)*r),m=d-Math.round((a/2-f)/(p-f)*r),y=0,x=[],g=0;g<=s;g++)b=new j.Z({xmin:0===g?f:-a/2,xmax:g===s?p-a*g:a/2,ymin:t.ymin,ymax:t.ymax,spatialReference:t.spatialReference}),y+=w=0===g?d-m:g===s?r-y:d,x.push(w),I=this._fetchPixels(b,w,n,i),u.push(I);return e.next=13,Promise.all(u);case 13:if(k=e.sent.map((function(e){return null==e?void 0:e.pixelBlock})),R=null,C={width:r,height:n},!this.rasterJobHandler){e.next=22;break}return e.next=19,this.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:k,srcMosaicSize:C,destDimension:null,coefs:null,sampleSpacing:null,interpolation:"nearest",alignmentInfo:null,blockWidths:x},i);case 19:e.t0=e.sent,e.next=23;break;case 22:e.t0=(0,ue.us)(k,C,{blockWidths:x});case 23:return R=e.t0,e.abrupt("return",{extent:t,srcExtent:(0,ce.tB)(t,this.rasterInfo.spatialReference,i.datumTransformation),pixelBlock:R});case 25:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return u.apply(this,arguments)})},{key:"fetchRawPixels",value:(o=(0,n.Z)(h().mark((function e(t,r,n,i){var a,s,o,l,u,c,f,p,d,m,y,x,g,b,w,I,k,R,C,S,_,T,O,Z,P,M,F,D,B,E,H,A,z,N=this;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.rasterInfo.storageInfo,s=a.origin,o=a.blockBoundary,l=this.getBlockWidthHeight(t),u=l.blockWidth,c=l.blockHeight,f=r.x,p=r.y,d=n.width,m=n.height,y=n.wrapCount,x=(0,v.Wg)(this._getRasterTileAlignmentInfo(t,0)),i.buffer&&(f-=i.buffer.cols,p-=i.buffer.rows,d+=2*i.buffer.cols,m+=2*i.buffer.rows),g=Math.floor(f/u),b=Math.floor(p/c),w=Math.floor((f+d-1)/u),I=Math.floor((p+m-1)/c),k=o[t]){e.next=7;break}return e.abrupt("return",null);case 7:if(R=k.minRow,C=k.minCol,S=k.maxCol,_=k.maxRow,0!==y||!(I<R||w<C||b>_||g>S)){e.next=10;break}return e.abrupt("return",null);case 10:for(T=new Array,O=!1,Z=null==this.ioConfig.allowPartialFill?i.allowPartialFill:this.ioConfig.allowPartialFill,P=b;P<=I;P++)for(M=g;M<=w;M++)F=0===y||null==x||M<x.worldColumnCountFromOrigin?M:M%x.worldColumnCountFromOrigin-x.originColumnOffset,P>=R&&F>=C&&_>=P&&S>=F?function(){var e=N._fetchRawTile(t,P,F,i);Z?T.push(new Promise((function(t){e.then((function(e){return t(e)})).catch((function(){O=!0,t(null)}))}))):T.push(e)}():T.push(null);if(0!==T.length){e.next=16;break}return e.abrupt("return",null);case 16:return e.next=18,Promise.all(T);case 18:return D=e.sent,B={height:(I-b+1)*c,width:(w-g+1)*u},E=this.rasterInfo.spatialReference,H=this.getPyramidPixelSize(t),A=H.x,z=H.y,e.abrupt("return",{extent:new j.Z({xmin:s.x+g*u*A,xmax:s.x+(w+1)*u*A,ymin:s.y-(I+1)*c*z,ymax:s.y-b*c*z,spatialReference:E}),pixelBlocks:D,mosaicSize:B,isPartiallyFilled:O});case 25:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n){return o.apply(this,arguments)})},{key:"fetchRawTile",value:function(e,t,r,n){throw new y.Z("BaseRaster:read-not-implemented","fetchRawTile() is not implemented")}},{key:"computeExtent",value:function(e){return(0,ce.tB)(this.rasterInfo.extent,e)}},{key:"decodePixelBlock",value:function(e,t){return!this.rasterJobHandler||t.useCanvas?(0,le.Jx)(e,t):this.rasterJobHandler.decode({data:e,options:t})}},{key:"request",value:(i=(0,n.Z)(h().mark((function e(t,r,n){var i,a,s,o,l,u,c;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=this.ioConfig.customFetchParameters,o=r.range,l=r.query,u=r.headers,n=null!=(i=null!=(a=n)?a:r.retryCount)?i:this.ioConfig.retryCount,c=o?{Range:"bytes=".concat(o.from,"-").concat(o.to)}:null,e.prev=3,e.next=6,(0,O.default)(t,pe(pe({},r),{},{query:pe(pe({},l),s),headers:pe(pe({},u),c)}));case 6:return e.abrupt("return",e.sent);case 9:if(e.prev=9,e.t0=e.catch(3),!(n>0)){e.next=13;break}return e.abrupt("return",(n--,this.request(t,r,n)));case 13:throw e.t0;case 14:case"end":return e.stop()}}),e,this,[[3,9]])}))),function(e,t,r){return i.apply(this,arguments)})},{key:"getSliceIndex",value:function(e){var t=this,r=this.rasterInfo.multidimensionalInfo;if(!(0,v.pC)(r))return null;if(!(0,v.pC)(e)||0===e.length)return null;for(var n=0,i=e[0].variableName,a=function(a){var s=r.variables[a],o=s.dimensions;if(s.name!==i)return n+=o.map((function(e){return t._getDimensionValuesCount(e)})).reduce((function(e,t){return e+t})),"break";for(var l=o.map((function(e){return t._getDimensionValuesCount(e)})),u=o.length,c=function(r){var i=e.filter((function(e){return e.dimensionName===o[r].name}))[0];if(null==i)return{v:{v:null}};var a=Array.isArray(i.values[0])?i.values[0][0]:i.values[0],s=t._getIndexFromDimensions(a,o[r]);if(-1===s)return{v:{v:null}};l.shift(),n+=r===u-1?s:s*l.reduce((function(e,t){return e+t}))},f=0;f<u;f++){var h=c(f);if("object"==typeof h)return h.v}},s=0;s<r.variables.length;s++){var o=a(s);if("break"===o)break;if("object"==typeof o)return o.v}return n}},{key:"getTileExtentFromTileInfo",value:function(e,t,r,n){var i=n.lodAt(e);return this.getTileExtent({x:i.resolution,y:i.resolution},t,r,n.origin,n.spatialReference,n.size)}},{key:"updateTileInfo",value:function(){var e=this.rasterInfo,t=e.storageInfo,r=e.spatialReference,n=e.extent,i=e.pixelSize;if(!t.tileInfo){for(var a=[],s=t.maximumPyramidLevel||0,o=Math.max(i.x,i.y),l=1/.0254*96*o,u=0;u<=s;u++)a.push({level:s-u,resolution:o,scale:l}),o*=2,l*=2;var c=new fe.Z({x:n.xmin,y:n.ymax,spatialReference:r});t.tileInfo=new H.Z({origin:c,size:[t.blockWidth,t.blockHeight],spatialReference:r,lods:a}),t.isVirtualTileInfo=!0}}},{key:"createRemoteDatasetStorageInfo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:512,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:512,n=arguments.length>3?arguments[3]:void 0,i=e.width,a=e.height,s=e.nativeExtent,o=e.pixelSize,l=e.spatialReference,u=new fe.Z({x:s.xmin,y:s.ymax,spatialReference:l});null==n&&(n=Math.max(0,Math.round(Math.log(Math.max(i,a))/Math.LN2-8)));var c=this.computeBlockBoundary(s,512,512,{x:s.xmin,y:s.ymax},[o],n);e.storageInfo=new ne.Z({blockWidth:t,blockHeight:r,pyramidBlockWidth:t,pyramidBlockHeight:r,origin:u,firstPyramidLevel:1,maximumPyramidLevel:n,blockBoundary:c})}},{key:"computeBestPyramidLevelForLocation",value:(r=(0,n.Z)(h().mark((function e(t){var r=arguments;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.length>1&&void 0!==r[1]&&r[1],e.abrupt("return",0);case 2:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"computeBlockBoundary",value:function(e,t,r,n,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2;if(1===i.length&&a>0)for(var o=(i=(0,ie.Z)(i))[0],l=o.x,u=o.y,c=0;c<a;c++)l*=s,u*=s,i.push({x:l,y:u});for(var f=[],h=n.x,p=n.y,d=0;d<i.length;d++){var m=i[d],y=m.x,v=m.y;f.push({minCol:Math.floor((e.xmin-h+.1*y)/t/y),maxCol:Math.floor((e.xmax-h-.1*y)/t/y),minRow:Math.floor((p-e.ymax+.1*v)/r/v),maxRow:Math.floor((p-e.ymin-.1*v)/r/v)})}return f}},{key:"getPyramidPixelSize",value:function(e){var t=this.rasterInfo.nativePixelSize,r=this.rasterInfo.storageInfo,n=r.pyramidResolutions,i=r.pyramidScalingFactor;if(0===e)return t;if((0,v.pC)(n)&&n.length)return n[e-1];var a=Math.pow(i,e);return{x:t.x*a,y:t.y*a}}},{key:"identifyPixelLocation",value:function(e,t,r){var n=this.rasterInfo,i=n.spatialReference,a=n.nativeExtent,s=this.rasterInfo.storageInfo,o=s.blockWidth,l=s.blockHeight,u=s.maximumPyramidLevel,c=s.origin,f=(0,ce.nF)(e,i,r);if(!a.intersects(f))return null;if(t<0||t>u)return null;var h=this.getPyramidPixelSize(t),p=h.x,d=h.y,m=(c.y-f.y)/d/l,y=(f.x-c.x)/p/o,v=Math.min(l-1,Math.floor((m-Math.floor(m))*l)),x=Math.min(o-1,Math.floor((y-Math.floor(y))*o));return{pyramidLevel:t,row:Math.floor(m),col:Math.floor(y),rowOffset:v,colOffset:x,srcLocation:f}}},{key:"getTileExtent",value:function(e,t,r,n,i,a){var s=(0,T.Z)(a,2),o=s[0],l=s[1],u=n.x+r*o*e.x,c=u+o*e.x,f=n.y-t*l*e.y,h=f-l*e.y;return new j.Z({xmin:u,xmax:c,ymin:h,ymax:f,spatialReference:i})}},{key:"getBlockWidthHeight",value:function(e){return{blockWidth:e>0?this.rasterInfo.storageInfo.pyramidBlockWidth:this.rasterInfo.storageInfo.blockWidth,blockHeight:e>0?this.rasterInfo.storageInfo.pyramidBlockHeight:this.rasterInfo.storageInfo.blockHeight}}},{key:"isBlockOutside",value:function(e,t,r){var n=this.rasterInfo.storageInfo.blockBoundary[e];return!n||n.maxRow<t||n.maxCol<r||n.minRow>t||n.minCol>r}},{key:"_fetchPixels",value:(t=(0,n.Z)(h().mark((function e(t,r,n){var i,a,s,o,l,u,c,f,p,d,m,y,x,g,b,w,I,k,R,C,S,_,T,O,Z,P,M,F,D=arguments;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=D.length>3&&void 0!==D[3]?D[3]:{},!((a=(0,ce.Hq)(t))>=2)){e.next=4;break}return e.abrupt("return",{extent:t,pixelBlock:null});case 4:if(s=this._getSourceDataInfo(t,r,n,i),o=s.pyramidLevel,l=s.pyramidResolution,u=s.srcResolution,c=s.srcExtent,f=s.srcWidth,p=s.srcHeight,0!==f&&0!==p){e.next=7;break}return e.abrupt("return",{extent:t,srcExtent:c,pixelBlock:null});case 7:return"gcs-shift"===(null==(d=(0,v.Wg)(this.rasterInfo.transform))?void 0:d.type)&&(a=(0,ce.Hq)(s.srcExtent,!0)),m=this.rasterInfo.storageInfo,y={x:Math.floor((c.xmin-m.origin.x)/l.x+.1),y:Math.floor((m.origin.y-c.ymax)/l.y+.1)},e.next=13,this.fetchRawPixels(o,y,{width:f,height:p,wrapCount:a},i);case 13:if(x=e.sent){e.next=16;break}return e.abrupt("return",{extent:t,srcExtent:c,pixelBlock:null});case 16:if(g=o>0?m.pyramidBlockWidth:m.blockWidth,b=o>0?m.pyramidBlockHeight:m.blockHeight,w=g===f&&b===p&&y.x%g==0&&y.y%b==0,I=new fe.Z({x:(t.xmax-t.xmin)/r,y:(t.ymax-t.ymin)/n,spatialReference:t.spatialReference}),k=!t.spatialReference.equals(this.rasterInfo.spatialReference),R=i.datumTransformation,k||!w||1!==x.pixelBlocks.length||g!==r||b!==n||u.x!==I.x||u.y!==I.y){e.next=19;break}return e.abrupt("return",{extent:t,srcExtent:c,pixelBlock:x.pixelBlocks[0]});case 19:if(!this.rasterJobHandler){e.next=25;break}return e.next=22,this.rasterJobHandler.getProjectionOffsetGrid({projectedExtent:t,srcBufferExtent:x.extent,pixelSize:I.toJSON(),datumTransformation:R,rasterTransform:d,hasWrapAround:a>0,isAdaptive:!1!==this.ioConfig.optimizeProjectionAccuracy},i);case 22:e.t0=e.sent,e.next=26;break;case 25:e.t0=(0,ce.Qp)({projectedExtent:t,srcBufferExtent:x.extent,pixelSize:I,datumTransformation:R,rasterTransform:d,hasWrapAround:a>0,isAdaptive:!1});case 26:if(C=e.t0,_=!i.requestRawData,T={rows:C.spacing[0],cols:C.spacing[1]},O=(0,v.Wg)(this._getRasterTileAlignmentInfo(o,x.extent.xmin)),Z=x.pixelBlocks,P=x.mosaicSize,M=x.isPartiallyFilled,!this.rasterJobHandler){e.next=34;break}return e.next=31,this.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:Z,srcMosaicSize:P,destDimension:_?{width:r,height:n}:null,coefs:_?C.coefficients:null,sampleSpacing:_?T:null,interpolation:i.interpolation,alignmentInfo:O,blockWidths:null},i);case 31:S=e.sent,e.next=36;break;case 34:F=(0,ue.us)(Z,P,{alignmentInfo:O}),S=_?(0,ue.Uk)(F,{width:r,height:n},C.coefficients,T,i.interpolation):F;case 36:return e.abrupt("return",i.requestRawData?{srcExtent:c,pixelBlock:S,transformGrid:C,extent:t,isPartiallyFilled:M}:{srcExtent:c,extent:t,pixelBlock:S});case 37:case"end":return e.stop()}}),e,this)}))),function(e,r,n){return t.apply(this,arguments)})},{key:"_fetchRawTile",value:function(e,t,r,n){var i=this.rasterInfo.storageInfo.blockBoundary[e];if(!i)return Promise.resolve(null);var a=i.minRow,s=i.minCol,o=i.maxCol,l=i.maxRow;if(t<a||r<s||t>l||r>o)return Promise.resolve(null);var u=(0,oe.Rq)(this.url,n.sliceId),c="".concat(e,"/").concat(t,"/").concat(r),f=(0,oe.Qg)(u,n.registryId,c);if((0,v.Wi)(f)){var h=new AbortController;f=this.fetchRawTile(e,t,r,pe(pe({},n),{},{signal:h.signal})),(0,oe.gX)(u,n.registryId,c,f,h),f.catch((function(){return(0,oe.Gc)(u,n.registryId,c)}))}return n.signal&&(0,g.fu)(n,(function(){(0,oe.OE)(u,n.registryId,c)})),f}},{key:"_getIndexFromDimensions",value:function(e,t){var r=t.extent,n=t.interval,i=t.unit,a=t.values;if(null!=a&&a.length)return Array.isArray(a[0])?a.findIndex((function(t){return t[0]<=e&&t[1]>=e})):a.indexOf(e);if(e>r[1])return-1;var s=r[0],o=-1;if("ISO8601"===i){var l;switch((null==(l=t.intervalUnit)?void 0:l.toLowerCase())||"seconds"){case"seconds":o=Math.round((e-s)/1e3/n);break;case"minutes":o=Math.round((e-s)/6e4/n);break;case"hours":o=Math.round((e-s)/36e5/n);break;case"days":o=Math.round((e-s)/864e5/n);break;case"years":o=Math.round((new Date(e).getUTCFullYear()-new Date(s).getUTCFullYear())/n);break;case"decades":o=Math.round((new Date(e).getUTCFullYear()-new Date(s).getUTCFullYear())/10/n)}return o}return Math.round((e-s)/n)}},{key:"_getDimensionValuesCount",value:function(e){var t=e.extent,r=e.interval,n=e.unit,i=e.values,a=(null==i?void 0:i.length)||0;if(a)return a;var s=t[0];if(0===a&&"ISO8601"===n){var o;switch((null==(o=e.intervalUnit)?void 0:o.toLowerCase())||"seconds"){case"seconds":a=Math.round((t[1]-t[0])/1e3/r);break;case"minutes":a=Math.round((t[1]-t[0])/6e4/r);break;case"hours":a=Math.round((t[1]-t[0])/36e5/r);break;case"days":a=Math.round((t[1]-t[0])/864e5/r);break;case"years":a=Math.round((new Date(t[1]).getUTCFullYear()-new Date(s).getUTCFullYear())/r);break;case"decades":a=Math.round((new Date(t[1]).getUTCFullYear()-new Date(s).getUTCFullYear())/10/r)}return a}return Math.round((t[1]-t[0])/r)}},{key:"_getRasterTileAlignmentInfo",value:function(e,t){return null==this._rasterTileAlighmentInfo&&(this._rasterTileAlighmentInfo=(0,ce.P_)(this.rasterInfo)),(0,v.pC)(this._rasterTileAlighmentInfo.pyramidsInfo)?pe({startX:t,halfWorldWidth:this._rasterTileAlighmentInfo.halfWorldWidth,hasGCSSShiftTransform:this._rasterTileAlighmentInfo.hasGCSSShiftTransform},this._rasterTileAlighmentInfo.pyramidsInfo[e]):null}},{key:"_getSourceDataInfo",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i={datumTransformation:n.datumTransformation,pyramidLevel:0,pyramidResolution:null,srcExtent:null,srcHeight:0,srcResolution:null,srcWidth:0};n.srcResolution&&(i.srcResolution=n.srcResolution,this._updateSourceDataInfo(e,i));var a=this.rasterInfo.storageInfo.maximumPyramidLevel||0,s=i.srcWidth,o=i.srcHeight,l=i.pyramidLevel,u=s/t,c=o/r,f=l<a&&u*c>=16;if(f||l===a&&(u>8||c>8)||0===s||0===o){var h=new fe.Z({x:(e.xmax-e.xmin)/t,y:(e.ymax-e.ymin)/r,spatialReference:e.spatialReference}),p=(0,ce.VO)(h,this.rasterInfo.spatialReference,e,i.datumTransformation),d=!p||n.srcResolution&&p.x+p.y<n.srcResolution.x+n.srcResolution.y;if(f&&n.srcResolution&&d){var m=Math.round(Math.log(Math.max(u,c))/Math.LN2)-1;if(a-l+3>=m){var y=Math.pow(2,m);p={x:n.srcResolution.x*y,y:n.srcResolution.y*y}}}p&&(i.srcResolution=p,this._updateSourceDataInfo(e,i))}return(i.srcWidth/t>8||i.srcHeight/r>8)&&(i.srcWidth=0,i.srcHeight=0),i}},{key:"_updateSourceDataInfo",value:function(e,t){t.srcWidth=0,t.srcHeight=0;var r=this.rasterInfo.spatialReference,n=t.srcResolution,i=t.datumTransformation,a=(0,ce.kr)(n,this.rasterInfo,this.ioConfig.sampling),s=a.pyramidLevel,o=a.pyramidResolution;if(!a.excessiveReading){var l=t.srcExtent||(0,ce.tB)(e,r,i);if(null!=l){var u=(0,v.Wg)(this.rasterInfo.transform);u&&(l=u.inverseTransform(l)),t.srcExtent=l;var c=Math.ceil((l.xmax-l.xmin)/o.x-.1),f=Math.ceil((l.ymax-l.ymin)/o.y-.1);t.pyramidLevel=s,t.pyramidResolution=o,t.srcWidth=c,t.srcHeight=f}}}},{key:"_getRequestOptionsWithSliceId",value:function(e){return(0,v.pC)(this.rasterInfo.multidimensionalInfo)&&null==e.sliceId&&(e=pe(pe({},e),{},{sliceId:this.getSliceIndex(e.multidimensionalDefinition)})),e}}]),x}((0,se.v)(ae.wq));(0,p._)([(0,b.Cb)()],me.prototype,"_rasterTileAlighmentInfo",void 0),(0,p._)([(0,b.Cb)(D.HQ)],me.prototype,"url",null),(0,p._)([(0,b.Cb)({type:String,json:{write:!0}})],me.prototype,"datasetName",void 0),(0,p._)([(0,b.Cb)({type:String,json:{write:!0}})],me.prototype,"datasetFormat",void 0),(0,p._)([(0,b.Cb)()],me.prototype,"rasterInfo",void 0),(0,p._)([(0,b.Cb)()],me.prototype,"ioConfig",void 0),(0,p._)([(0,b.Cb)()],me.prototype,"sourceJSON",void 0);var ye=me=(0,p._)([(0,R.j)("esri.layers.support.rasterDatasets.BaseRaster")],me),ve=r(674);function xe(e){var t=e.fields,r=e.records,n=t.some((function(e){return"oid"===e.name.toLowerCase()}))?"OBJECTID":"OID",i=[{name:n,type:"esriFieldTypeOID",alias:"OID"}].concat(t.map((function(e){return{name:e.name,type:"esriFieldType"+e.typeName,alias:e.name}}))),a=i.map((function(e){return e.name})),s=[],o=0,l=0;return r.forEach((function(e){var t={};for(t[n]=o++,l=1;l<a.length;l++)t[a[l]]=e[l-1];s.push({attributes:t})})),{displayFieldName:"",fields:i,features:s}}var ge=function(){function e(){(0,a.Z)(this,e)}return(0,s.Z)(e,null,[{key:"supportedVersions",get:function(){return[5]}},{key:"parse",value:function(e){var t=new DataView(e),r=3&t.getUint8(0);if(3!==r)return{header:{version:r},recordSet:null};var n,i=t.getUint32(4,!0),a=t.getUint16(8,!0),s=t.getUint16(10,!0),o={version:r,recordCount:i,headerByteCount:a,recordByteCount:s},l=32,u=[],c=[];if(3===r){for(;13!==t.getUint8(l);)n=String.fromCharCode(t.getUint8(l+11)).trim(),u.push({name:(0,ve.f)(new Uint8Array(e,l,11)),type:n,typeName:["String","Date","Double","Boolean","String","Integer"][["C","D","F","L","M","N"].indexOf(n)],length:t.getUint8(l+16)}),l+=32;if(l+=1,u.length>0)for(var f=function(){var r=[];32===t.getUint8(l)?(l+=1,u.forEach((function(t){if("C"===t.type)r.push((0,ve.f)(new Uint8Array(e,l,t.length)).trim());else if("N"===t.type)r.push(parseInt(String.fromCharCode.apply(null,new Uint8Array(e,l,t.length)).trim(),10));else if("F"===t.type)r.push(parseFloat(String.fromCharCode.apply(null,new Uint8Array(e,l,t.length)).trim()));else if("D"===t.type){var n=String.fromCharCode.apply(null,new Uint8Array(e,l,t.length)).trim();r.push(new Date(parseInt(n.substring(0,4),10),parseInt(n.substring(4,6),10)-1,parseInt(n.substring(6,8),10)))}l+=t.length})),c.push(r)):l+=s};c.length<i&&e.byteLength-l>s;)f()}return{header:o,fields:u,records:c,recordSet:xe({fields:u,records:c})}}}]),e}(),be=r(50001),we=r(79228);function Ie(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.Z)(e);if(t){var i=(0,c.Z)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,u.Z)(this,r)}}var ke=new Map;ke.set("int16","esriFieldTypeSmallInteger"),ke.set("int32","esriFieldTypeInteger"),ke.set("int64","esriFieldTypeInteger"),ke.set("float32","esriFieldTypeSingle"),ke.set("float64","esriFieldTypeDouble"),ke.set("text","esriFieldTypeString");var Re=function(e){(0,l.Z)(u,e);var t,r,i,o=Ie(u);function u(){var e;return(0,a.Z)(this,u),(e=o.apply(this,arguments)).storageInfo=null,e.datasetFormat="CRF",e}return(0,s.Z)(u,[{key:"open",value:(i=(0,n.Z)(h().mark((function e(t){var r,n,i,a,s,o;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.init();case 2:return e.next=4,this.request(this.url+"/conf.json",{signal:null==t?void 0:t.signal});case 4:if(r=e.sent,n=r.data,this._validateHeader(n)){e.next=8;break}throw new y.Z("cloudraster:open","Invalid or unsupported conf.json.");case 8:if(this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1),i=this._parseHeader(n),a=i.storageInfo,"thematic"!==(s=i.rasterInfo).dataType){e.next=15;break}return e.next=13,this._fetchAuxiliaryInformation();case 13:o=e.sent,s.attributeTable=o;case 15:this._set("storageInfo",a),this._set("rasterInfo",s),this.ioConfig.retryCount=this.ioConfig.retryCount||0;case 16:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"fetchRawTile",value:(r=(0,n.Z)(h().mark((function e(t,r,n){var i,a,s,o,l,u,c,f,p=arguments;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=p.length>3&&void 0!==p[3]?p[3]:{},!((a=this.rasterInfo.storageInfo.maximumPyramidLevel-t)<0)){e.next=4;break}return e.abrupt("return",null);case 4:return s=this._buildCacheFilePath(a,r,n,i.multidimensionalDefinition),o=this._getIndexRecordFromBundle(r,n),e.next=8,this.request(s,{range:{from:0,to:this.storageInfo.headerSize-1},responseType:"array-buffer",signal:i.signal});case 8:if(l=e.sent){e.next=11;break}return e.abrupt("return",null);case 11:if(u=new Uint8Array(l.data),0!==(c=this._getTileEndAndContentType(u,o)).recordSize){e.next=14;break}return e.abrupt("return",null);case 14:return e.next=16,this.request(s,{range:{from:c.position,to:c.position+c.recordSize},responseType:"array-buffer",signal:i.signal});case 16:return f=e.sent,e.abrupt("return",f?this.decodePixelBlock(f.data,{width:this.rasterInfo.storageInfo.tileInfo.size[0],height:this.rasterInfo.storageInfo.tileInfo.size[1],planes:null,pixelType:null}):null);case 18:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"_validateHeader",value:function(e){return e&&"RasterInfo"===e.type&&!["origin","extent","geodataXform","LODInfos","blockWidth","blockHeight","bandCount","pixelType","pixelSizeX","pixelSizeY","format","packetSize"].some((function(t){return!e[t]}))}},{key:"_parseHeader",value:function(e){var t,r,n=["u1","u2","u4","u8","s8","u16","s16","u32","s32","f32","f64"][e.pixelType],i=e.bandCount,a=e.histograms,s=e.colormap,o=e.blockWidth,l=e.blockHeight,u=e.firstPyramidLevel,c=e.maximumPyramidLevel,f=e.statistics&&e.statistics.map((function(e){return{min:e.min,max:e.max,avg:e.mean,stddev:e.standardDeviation,median:e.median,mode:e.mode}})),h=e.extent.spatialReference,p=null==(t=e.geodataXform)?void 0:t.spatialReference,d=new J.Z(null!=h&&h.wkid||null!=h&&h.wkt?h:p),m=new j.Z({xmin:e.extent.xmin,ymin:e.extent.ymin,xmax:e.extent.xmax,ymax:e.extent.ymax,spatialReference:d}),y=new fe.Z({x:e.pixelSizeX,y:e.pixelSizeY,spatialReference:d}),v=Math.round((m.xmax-m.xmin)/y.x),x=Math.round((m.ymax-m.ymin)/y.y),g=this._parseTransform(e.geodataXform),b=g?m:null;g&&(m=g.forwardTransform(m),y.x=(m.xmax-m.xmin)/v,y.y=(m.ymax-m.ymin)/x);var w,I,k,R,C=null!=(r=e.properties)?r:{},S=e.format.toLowerCase().replace("cache/",""),_=new fe.Z(e.origin.x,e.origin.y,d);if(s&&s.colors)for(w=[],I=0;I<s.colors.length;I++)k=s.colors[I],R=s.values?s.values[I]:I,w.push([R,255&k,k<<16>>>24,k<<8>>>24,k>>>24]);var T=e.LODInfos,O=[];for(I=0;I<T.levels.length;I++)O.push({level:T.levels[I],resolution:T.resolutions[I],scale:96/.0254*T.resolutions[I]});var Z=new H.Z({dpi:96,lods:O,format:S,origin:_,size:[o,l],spatialReference:d}),P={recordSize:8,packetSize:e.packetSize,headerSize:e.packetSize*e.packetSize*8+64},M=[{maxCol:Math.ceil(v/o)-1,maxRow:Math.ceil(x/l)-1,minCol:0,minRow:0}],F=2;if(c>0)for(I=0;I<c;I++)M.push({maxCol:Math.ceil(v/F/o)-1,maxRow:Math.ceil(x/F/l)-1,minCol:0,minRow:0}),F*=2;var D=e.mdInfo;return{storageInfo:P,rasterInfo:new re.Z({width:v,height:x,pixelType:n,bandCount:i,extent:m,nativeExtent:b,transform:g,spatialReference:d,pixelSize:y,keyProperties:C,statistics:f,histograms:a,multidimensionalInfo:D,colormap:w,storageInfo:new ne.Z({blockWidth:o,blockHeight:l,pyramidBlockWidth:o,pyramidBlockHeight:l,origin:_,tileInfo:Z,firstPyramidLevel:u,maximumPyramidLevel:c,blockBoundary:M})})}}},{key:"_parseTransform",value:function(e){var t,r;if(!(0,be.j)(e))throw new y.Z("cloudraster:open","the data contains unsupported geodata transform types");var n=(0,be.c)(e);if("identity"===n.type)return null;if("polynomial"!==n.type||null==(t=n.forwardCoefficients)||!t.length||null==(r=n.inverseCoefficients)||!r.length)throw new y.Z("cloudraster:open","the data contains unsupported geodata transforms - both forward and inverse coefficients are required currently");return n}},{key:"_fetchAuxiliaryInformation",value:(t=(0,n.Z)(h().mark((function e(t){var r,n,i,a,s,o,l;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.request(this.url+"/conf.vat.json",{signal:t}).then((function(e){return e.data})).catch((function(){return null})),n=this.request(this.url+"/conf.vat.dbf",{responseType:"array-buffer",signal:t}).then((function(e){return e.data})).catch((function(){return null})),e.next=4,Promise.all([r,n]);case 4:return(i=e.sent)[0]&&(s=i[0].fields,o=i[0].values,s&&o&&(s=s.map((function(e){return{type:"OID"===e.name?"esriFieldTypeOID":ke.get(e.type),name:e.name,alias:e.alias||e.name}})),l=o.map((function(e){return{attributes:e}})),s&&o&&(a={fields:s,features:l}))),!a&&i[1]&&(a=ge.parse(i[1]).recordSet),e.abrupt("return",we.default.fromJSON(a));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_buildCacheFilePath",value:function(e,t,r,n){var i=this.storageInfo.packetSize,a=Math.floor(t/i)*i,s=Math.floor(r/i)*i,o="R"+this._toHexString4(a)+"C"+this._toHexString4(s),l="L";l+=e>=10?e.toString():"0"+e.toString();var u=this.rasterInfo.multidimensionalInfo,c=null==n?void 0:n[0];if(!(0,v.pC)(u)||!c)return"".concat(this.url,"/_alllayers/").concat(l,"/").concat(o,".bundle");for(var f=u.variables.filter((function(e){return e.name===c.variableName}))[0].dimensions[0].values.indexOf(c.values[0]).toString(16),h=4-f.length,p=0;p<h;p++)f="0"+f;return f="S"+f,"".concat(this.url,"/_alllayers/").concat(c.variableName,"/").concat(f,"/").concat(l,"/").concat(o,".bundle")}},{key:"_getIndexRecordFromBundle",value:function(e,t){var r=this.storageInfo.packetSize,n=r*(e%r)+t%r;if(n<0)throw"Invalid level / row / col";return 20+n*this.storageInfo.recordSize+44}},{key:"_getTileEndAndContentType",value:function(e,t){var r,n=e.subarray(t,t+8),i=0;for(r=0;r<5;r++)i|=(255&n[r])<<8*r;var a=0xffffffffff&i;for(i=0,r=5;r<8;r++)i|=(255&n[r])<<8*(r-5);return{position:a,recordSize:0xffffffffff&i}}},{key:"_toHexString4",value:function(e){var t=e.toString(16);if(4!==t.length)for(var r=4-t.length;r-- >0;)t="0"+t;return t}}]),u}(ye);(0,p._)([(0,b.Cb)({readOnly:!0})],Re.prototype,"storageInfo",void 0),(0,p._)([(0,b.Cb)({type:String,json:{write:!0}})],Re.prototype,"datasetFormat",void 0);var Ce=Re=(0,p._)([(0,R.j)("esri.layers.support.rasterDatasets.CloudRaster")],Re);function Se(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.Z)(e);if(t){var i=(0,c.Z)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,u.Z)(this,r)}}var _e=function(e){(0,l.Z)(o,e);var t,r,i=Se(o);function o(){var e;return(0,a.Z)(this,o),(e=i.apply(this,arguments)).datasetFormat="MEMORY",e}return(0,s.Z)(o,[{key:"open",value:(r=(0,n.Z)(h().mark((function e(t){var r,n,i,a,s,o,l,u,c,f,p,d,m,y,v,x;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.init();case 2:return n=this.data,i=n.pixelBlock,a=n.statistics,s=n.histograms,o=n.name,l=n.keyProperties,u=n.nativeExtent,c=n.transform,f=i.width,p=i.height,d=i.pixelType,m=this.data.extent||new j.Z({xmin:-.5,ymin:.5,xmax:f-.5,ymax:p-.5,spatialReference:new J.Z({wkid:3857})}),y=null!=(r=this.data.isPseudoSpatialReference)?r:!this.data.extent,v={x:m.width/f,y:m.height/p},x=new re.Z({width:f,height:p,pixelType:d,extent:m,nativeExtent:u,transform:c,pixelSize:v,spatialReference:m.spatialReference,bandCount:3,keyProperties:l||{},statistics:a,isPseudoSpatialReference:y,histograms:s}),this.createRemoteDatasetStorageInfo(x,512,512),this._set("rasterInfo",x),this.updateTileInfo(),e.next=8,this._buildInMemoryRaster(i,{width:512,height:512},t);case 8:this.datasetName=o,this.url="/InMemory/"+o;case 10:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"fetchRawTile",value:function(e,t,r){var n=this._pixelBlockTiles.get("".concat(e,"/").concat(t,"/").concat(r));return Promise.resolve(n)}},{key:"_buildInMemoryRaster",value:(t=(0,n.Z)(h().mark((function e(t,r,n){var i,a,s,o,l,u,c,f;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.rasterInfo.storageInfo.maximumPyramidLevel,a=this.rasterJobHandler?this.rasterJobHandler.split({pixelBlock:t,tileSize:r,maximumPyramidLevel:i},n):Promise.resolve((0,ue.Vl)(t,r,i)),s=(0,v.pC)(this.rasterInfo.statistics),o=(0,v.pC)(this.rasterInfo.histograms),l=s&&o?Promise.resolve({statistics:null,histograms:null}):this.rasterJobHandler?this.rasterJobHandler.estimateStatisticsHistograms({pixelBlock:t},n):Promise.resolve((0,ue.Hv)(t)),e.next=7,(0,g.as)([a,l]);case 7:if((u=e.sent)[0].value||!u[1].value){e.next=10;break}throw new y.Z("inmemory-raster:open","failed to build in memory raster");case 10:this._pixelBlockTiles=u[0].value,s||(this.rasterInfo.statistics=null==(c=u[1].value)?void 0:c.statistics),o&&(this.rasterInfo.histograms=null==(f=u[1].value)?void 0:f.histograms);case 12:case"end":return e.stop()}}),e,this)}))),function(e,r,n){return t.apply(this,arguments)})}]),o}(ye);(0,p._)([(0,b.Cb)({type:String,json:{write:!0}})],_e.prototype,"datasetFormat",void 0),(0,p._)([(0,b.Cb)()],_e.prototype,"data",void 0);var Te=_e=(0,p._)([(0,R.j)("esri.layers.support.rasterDatasets.InMemoryRaster")],_e);function Oe(e,t){if(!e||!t)return[];var r=t;t.indexOf("/")>-1?(r=t.slice(0,t.indexOf("/")),t=t.slice(t.indexOf("/")+1)):t="";var n=[];if(t){for(var i=Oe(e,r),a=0;a<i.length;a++)Oe(i[a],t).forEach((function(e){return n.push(e)}));return n}var s=e.getElementsByTagNameNS("*",r);if(!s||0===s.length)return[];for(var o=0;o<s.length;o++)n.push(s[o]||s.item[o]);return n}function Ze(e,t){if(!e||!t)return null;var r=t;t.indexOf("/")>-1?(r=t.slice(0,t.indexOf("/")),t=t.slice(t.indexOf("/")+1)):t="";var n=Oe(e,r);return n.length>0?t?Ze(n[0],t):n[0]:null}function Pe(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=r?Ze(e,r):e;return n?(t=n.textContent||n.nodeValue)?t.trim():null:null}function Me(e,t){for(var r,n=Oe(e,t),i=[],a=0;a<n.length;a++)(r=n[a].textContent||n[a].nodeValue)&&(""!==(r=r.trim())&&i.push(r));return i}function Fe(e,t){return Me(e,t).map((function(e){return Number(e)}))}function De(e,t){var r=Pe(e,t);return Number(r)}function Be(e,t){var r,n=null==e||null==(r=e.nodeName)?void 0:r.toLowerCase(),i=t.toLowerCase();return n.slice(n.lastIndexOf(":")+1)===i}var Ee=r(78212);function He(e,t){if(!e||!t)return null;for(var r=[],n=0;n<e.length;n++)r.push(e[n]),r.push(t[n]);return r}function Ae(e){if(!e)return null;var t=Number(e);if(!isNaN(t)&&0!==t)return new J.Z({wkid:t});if((e=String(e)).startsWith("COMPD_CS")){if(!e.includes("VERTCS")||!e.includes("GEOGCS")&&!e.startsWith("PROJCS"))return null;var r=e.indexOf("VERTCS"),n=e.indexOf("PROJCS"),i=n>-1?n:e.indexOf("GEOGCS");if(-1===i)return null;var a=e.slice(i,e.lastIndexOf("]",r)+1).trim(),s=e.slice(r,e.lastIndexOf("]")).trim();t=ze(a);var o=new J.Z(t?{wkid:t}:{wkt:a}),l=ze(s);return l&&(o.vcsWkid=l),o}return e.startsWith("GEOGCS")||e.startsWith("PROJCS")?(t=ze(e),new J.Z(0!==t?{wkid:t}:{wkt:e})):null}function ze(e){var t,r=e.replace(/\]/g,"[").replace(/\"/g,"").split("[").map((function(e){return e.trim()})).filter((function(e){return""!==e})),n=r[r.length-1].split(","),i=null==(t=n[0])?void 0:t.toLowerCase();if(("epsg"===i||"esri"===i)&&e.endsWith('"]]')){var a=Number(n[1]);if(!isNaN(a)&&0!==a)return a}return 0}function Ne(e){var t;if("pamdataset"!==(null==e||null==(t=e.documentElement.tagName)?void 0:t.toLowerCase()))return{};var r={spatialReference:null,transform:null,metadata:{},rasterBands:[],statistics:null,histograms:null};e.documentElement.childNodes.forEach((function(e){if(1===e.nodeType)if(Be(e,"SRS")){if(!r.spatialReference){var t=Pe(e);r.spatialReference=Ae(t)}}else if(Be(e,"Metadata"))if("xml:ESRI"===e.getAttribute("domain")){var n=function(e){var t,r=Ze(e,"GeodataXform"),n=Ae(De(r,"SpatialReference/WKID")||Pe(r,"SpatialReference/WKT"));if("typens:PolynomialXform"!==r.getAttribute("xsi:type"))return{spatialReference:n,transform:null};var i=null!=(t=De(r,"PolynomialOrder"))?t:1,a=Fe(r,"CoeffX/Double"),s=Fe(r,"CoeffY/Double"),o=Fe(r,"InverseCoeffX/Double"),l=Fe(r,"InverseCoeffY/Double"),u=He(a,s),c=He(o,l);return{spatialReference:n,transform:new Ee.Z({spatialReference:n,polynomialOrder:i,forwardCoefficients:u,inverseCoefficients:c})}}(e),i=n.spatialReference,a=n.transform;r.transform=a,r.spatialReference||(r.spatialReference=i)}else Oe(e,"MDI").forEach((function(e){return r.metadata[e.getAttribute("key")]=Pe(e)}));else if(Be(e,"PAMRasterBand")){var s=function(e){var t,r,n,i,a,s=De(e,"NoDataValue"),o=Ze(e,"Histograms/HistItem"),l=De(o,"HistMin"),u=De(o,"HistMax"),c=De(o,"BucketCount"),f=null==(t=Pe(o,"HistCounts"))?void 0:t.split("|").map((function(e){return Number(e)}));Oe(e,"Metadata/MDI").forEach((function(e){var t,s=Number(null!=(t=e.textContent)?t:e.nodeValue);switch(e.getAttribute("key").toUpperCase()){case"STATISTICS_MINIMUM":r=s;break;case"STATISTICS_MAXIMUM":n=s;break;case"STATISTICS_MEAN":i=s;break;case"STATISTICS_STDDEV":a=s}}));var h=De(e,"Metadata/SourceBandIndex");return{noDataValue:s,histogram:null!=f&&f.length&&null!=r&&null!=n?{min:l,max:u,size:c||f.length,counts:f}:null,sourceBandIndex:h,statistics:null!=r&&null!=n?{min:r,max:n,avg:i,stddev:a}:null}}(e);null!=s.sourceBandIndex&&null==r.rasterBands[s.sourceBandIndex]?r.rasterBands[s.sourceBandIndex]=s:r.rasterBands.push(s)}}));var n=r.rasterBands;if(n){var i=!!n[0].statistics;r.statistics=i?n.map((function(e){return e.statistics})):null;var a=!!n[0].histogram;r.histograms=a?n.map((function(e){return e.histogram})):null}return r}function Le(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.Z)(e);if(t){var i=(0,c.Z)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,u.Z)(this,r)}}var je=function(e){(0,l.Z)(u,e);var t,r,i,o=Le(u);function u(){return(0,a.Z)(this,u),o.apply(this,arguments)}return(0,s.Z)(u,[{key:"open",value:(i=(0,n.Z)(h().mark((function e(t){var r,n,i,a,s,o,l,u,c,f,p,d,m;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.init();case 2:return e.next=4,this._fetchData(t);case 4:return r=e.sent,e.next=7,this._fetchAuxiliaryData(t);case 7:return n=e.sent,i=n.spatialReference,a=n.statistics,s=n.histograms,o=n.transform,(l=!i)&&(i=new J.Z({wkid:3857})),null!=s&&s.length&&null==a&&(a=(0,ue.Oh)(s)),u=r.width,c=r.height,f=new j.Z({xmin:-.5,ymin:.5-c,xmax:u-.5,ymax:.5,spatialReference:i}),p=o?o.forwardTransform(f):f,o&&((d=o.forwardCoefficients)&&0===d[1]&&0===d[2]&&(o=null,f=p)),m=new Te({data:{extent:p,nativeExtent:f,transform:o,pixelBlock:r,statistics:a,histograms:s,keyProperties:{DateType:"Processed"},isPseudoSpatialReference:l}}),e.next=22,m.open();case 22:this._set("rasterInfo",m.rasterInfo),this._inMemoryRaster=m;case 24:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"fetchRawTile",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this._inMemoryRaster.fetchRawTile(e,t,r,n)}},{key:"_fetchData",value:(r=(0,n.Z)(h().mark((function e(t){var r,n,i;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.request(this.url,{responseType:"array-buffer",signal:null==t?void 0:t.signal});case 2:if(r=e.sent,n=r.data,"JPG"===(i=(0,le.y6)(n).toUpperCase())||"PNG"===i||"GIF"===i||"BMP"===i){e.next=7;break}throw new y.Z("image-aux-raster:open","the data is not a supported format");case 7:return this._set("datasetFormat",i),e.next=10,this.decodePixelBlock(n,{format:"jpg",width:1,height:1,useCanvas:!0});case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_fetchAuxiliaryData",value:(t=(0,n.Z)(h().mark((function e(t){var r,n,i,a,s,o,l,u,c,f,p;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(0,v.Wg)(null==t?void 0:t.signal),a=null!=(r=this.ioConfig.skipExtensions)?r:[],s=a.indexOf("aux.xml")>-1?null:this.request(this.url+".aux.xml",{responseType:"xml",signal:i}),o=this.datasetFormat,l="JPG"===o?"jgw":"PNG"===o?"pgw":"BMP"===o?"bpw":null,u=a.indexOf(l)>-1?null:this.request(this.url.slice(0,this.url.lastIndexOf("."))+"."+l,{responseType:"text",signal:i}),e.next=8,(0,g.as)([s,u]);case 8:if(c=e.sent,null==i||!i.aborted){e.next=11;break}throw(0,g.zE)();case 11:return(f=Ne(null==(n=c[0].value)?void 0:n.data)).transform||(p=c[1].value?c[1].value.data.split("\n").slice(0,6).map((function(e){return Number(e)})):null,f.transform=6===(null==p?void 0:p.length)?new Ee.Z({forwardCoefficients:[p[4],p[5],p[0],-p[1],p[2],-p[3]]}):null),e.abrupt("return",f);case 14:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),u}(ye);(0,p._)([(0,b.Cb)({type:String,json:{write:!0}})],je.prototype,"datasetFormat",void 0);var Je=je=(0,p._)([(0,R.j)("esri.layers.support.rasterDatasets.ImageAuxRaster")],je),We=r(98840),qe=r(60680),Ue=r(21031),Ge=r(28300);function Ve(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.Z)(e);if(t){var i=(0,c.Z)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,u.Z)(this,r)}}var Ye=function(e){(0,l.Z)(p,e);var t,r,i,o,u,c,f=Ve(p);function p(){var e;return(0,a.Z)(this,p),(e=f.apply(this,arguments))._levelOffset=0,e._slices=null,e._tilemapCache=null,e.datasetFormat="RasterTileServer",e}return(0,s.Z)(p,[{key:"open",value:(c=(0,n.Z)(h().mark((function e(t){var r,n,i,a,s,o,l,u,c,f,p,d,m,x,g,b,w,I,k,R,C,S;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.init();case 2:if(r=t&&t.signal,!this.sourceJSON){e.next=7;break}e.t0={data:this.sourceJSON},e.next=10;break;case 7:return e.next=9,this.request(this.url,{query:{f:"json"},signal:r});case 9:e.t0=e.sent;case 10:if((n=e.t0).ssl&&(this.url=this.url.replace(/^http:/i,"https:")),i=n.data,this.sourceJSON=i,i){e.next=15;break}throw new y.Z("imageserverraster:open","cannot initialize tiled image service, missing service info");case 15:if(i.tileInfo){e.next=17;break}throw new y.Z("imageserverraster:open","use ImageryLayer to open non-tiled image services");case 17:return this._fixScaleInServiceInfo(),a=["jpg","jpeg","png","png8","png24","png32","mixed"],this.tileType=i.cacheType,null==this.tileType&&(a.indexOf(i.tileInfo.format.toLowerCase())>-1?this.tileType="Map":"lerc"===i.tileInfo.format.toLowerCase()?this.tileType="Elevation":this.tileType="Raster"),this.datasetName=i.name.slice(i.name.indexOf("/")+1),e.next=22,this._fetchRasterInfo({signal:r});case 22:if(s=e.sent,(0,v.pC)(s)){e.next=25;break}throw new y.Z("image-server-raster:open","cannot initialize image service");case 25:o="Map"===this.tileType?(0,qe.d)(i.tileInfo,i):H.Z.fromJSON(i.tileInfo),l=s.extent,u=s.pixelSize,c=.5/s.width*u.x,d=o.lodAt(Math.max.apply(null,o.lods.map((function(e){return e.level})))),"Map"!==this.tileType&&0!==i.maxScale&&("Raster"===this.tileType?(f=o.lods.filter((function(e){return e.resolution===u.x}))[0],f||(f=o.lods[o.lods.length-1])):(f=o.lods.filter((function(e){return Math.abs(e.scale-i.maxScale)<c}))[0],f||(f=o.lods.filter((function(e){return e.scale>i.maxScale})).sort((function(e,t){return e.scale>t.scale?1:-1}))[0])),u.x=u.y=f.resolution,s.width=Math.ceil((l.xmax-l.xmin)/u.x-.1),s.height=Math.ceil((l.ymax-l.ymin)/u.y-.1)),f||(f=d),m=o.lodAt(Math.min.apply(null,o.lods.map((function(e){return e.level})))),"Map"===this.tileType?this._levelOffset=o.lods[0].level:0!==i.minScale&&"Elevation"===this.tileType&&(p=o.lods.filter((function(e){return Math.abs(e.scale-i.minScale)<c}))[0],this._levelOffset=p.level-m.level),p||(p=m),x=Math.max(u.x,u.y),(Math.abs(u.x-u.y)>c||!o.lods.some((function(e){return Math.abs(e.resolution-x)<c})))&&(u.x=u.y=f.resolution,s.width=Math.ceil((l.xmax-l.xmin)/u.x-.1),s.height=Math.ceil((l.ymax-l.ymin)/u.y-.1)),g=f.level-p.level,b=(0,T.Z)(o.size,2),w=b[0],I=b[1],k=[],o.lods.forEach((function(e){e.level>=p.level&&e.level<=f.level&&k.push({x:e.resolution,y:e.resolution})})),k.sort((function(e,t){return e.x-t.x})),R=this.computeBlockBoundary(l,w,I,o.origin,k,g),C=k.length>1?k.slice(1):null,s.storageInfo=new ne.Z({blockWidth:o.size[0],blockHeight:o.size[1],pyramidBlockWidth:o.size[0],pyramidBlockHeight:o.size[1],pyramidResolutions:C,compression:o.format,origin:o.origin,firstPyramidLevel:1,maximumPyramidLevel:g,tileInfo:o,blockBoundary:R}),this._fixGCSShift(s),this._set("rasterInfo",s),i.capabilities.toLowerCase().indexOf("tilemap")>-1&&(S={tileInfo:s.storageInfo.tileInfo,parsedUrl:(0,We.mN)(this.url),url:this.url,tileServers:[],type:"tile"},this._tilemapCache=new Ue.y({layer:S}));case 37:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"fetchRawTile",value:(u=(0,n.Z)(h().mark((function e(t,r,n){var i,a,s,o,l,u,c,f,p,d,m,y,v,x,g,b,w,I,k,R,C,S,_,T,O,Z=arguments;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=Z.length>3&&void 0!==Z[3]?Z[3]:{},!this._slices||null!=i.sliceId){e.next=3;break}return e.abrupt("return",null);case 3:return a=this.rasterInfo,s=a.storageInfo,o=a.extent,l=s.maximumPyramidLevel-t+this._levelOffset,u="".concat(this.url,"/tile/").concat(l,"/").concat(r,"/").concat(n),c=this._slices?{sliceId:i.sliceId||0}:null,e.next=11,this.request(u,{query:c,responseType:"array-buffer",signal:i.signal});case 11:if(f=e.sent,p=f.data){e.next=15;break}return e.abrupt("return",null);case 15:return e.next=17,this.decodePixelBlock(p,{width:s.tileInfo.size[0],height:s.tileInfo.size[1],planes:null,pixelType:null,isPoint:"Elevation"===this.tileType});case 17:if(d=e.sent,m=s.blockBoundary[t],!("jpg"!==s.compression||n>m.minCol&&n<m.maxCol&&r>m.minRow&&r<m.maxRow)){e.next=21;break}return e.abrupt("return",d);case 21:return y=s.origin,v=s.blockWidth,x=s.blockHeight,g=this.getPyramidPixelSize(t),b=g.x,w=g.y,I=Math.round((o.xmin-y.x)/b)%v,k=Math.round((o.xmax-y.x)/b)%v,R=Math.round((y.y-o.ymax)/w)%x,C=Math.round((y.y-o.ymin)/w)%x,S=n===m.minCol?I:0,_=r===m.minRow?R:0,T=n===m.maxCol?k:v,O=r===m.maxRow?C:x,e.abrupt("return",((0,ue.pW)(d,{x:S,y:_},{width:T-S,height:O-_}),d));case 23:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return u.apply(this,arguments)})},{key:"getSliceIndex",value:function(e){if(!this._slices||(0,v.Wi)(e)||0===e.length)return null;for(var t=e,r=0;r<this._slices.length;r++){var n=this._slices[r].multidimensionalDefinition;if(n.length===t.length&&!n.some((function(e){var r=t.filter((function(t){return e.variableName===t.variableName&&t.dimensionName===e.dimensionName}))[0];return!r||(Array.isArray(e.values[0])?"".concat(e.values[0][0],"-").concat(e.values[0][1]):e.values[0])!==(Array.isArray(r.values[0])?"".concat(r.values[0][0],"-").concat(r.values[0][1]):r.values[0])})))return r}return null}},{key:"fetchVariableStatisticsHistograms",value:(o=(0,n.Z)(h().mark((function e(t,r){var n,i,a;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.request(this.url+"/statistics",{query:{variable:t,f:"json"},signal:r}).then((function(e){var t;return null==(t=e.data)?void 0:t.statistics})),i=this.request(this.url+"/histograms",{query:{variable:t,f:"json"},signal:r}).then((function(e){var t;return null==(t=e.data)?void 0:t.histograms})),e.next=4,Promise.all([n,i]);case 4:return a=e.sent,e.abrupt("return",(a[0]&&a[0].forEach((function(e){e.avg=e.mean,e.stddev=e.standardDeviation})),{statistics:a[0]||null,histograms:a[1]||null}));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"computeBestPyramidLevelForLocation",value:(i=(0,n.Z)(h().mark((function e(t){var r,n,i,a,s,o,l=arguments;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=l.length>1&&void 0!==l[1]?l[1]:{},this._tilemapCache){e.next=3;break}return e.abrupt("return",0);case 3:if(null!==(n=this.identifyPixelLocation(t,0,(0,v.Wg)(r.datumTransformation)))){e.next=6;break}return e.abrupt("return",null);case 6:i=0,a=this.rasterInfo.storageInfo.maximumPyramidLevel,s=a-i+this._levelOffset,o=n.srcLocation;case 10:if(!(s>=0)){e.next=25;break}return e.prev=11,e.next=14,this._tilemapCache.fetchAvailability(s,n.row,n.col,r);case 14:if(e.t0=e.sent,"available"!==e.t0){e.next=17;break}return e.abrupt("break",25);case 17:e.next=21;break;case 19:e.prev=19,e.t1=e.catch(11);case 21:if(s--,i++,null!==(n=this.identifyPixelLocation(o,i,(0,v.Wg)(r.datumTransformation)))){e.next=23;break}return e.abrupt("return",null);case 23:e.next=10;break;case 25:return e.abrupt("return",-1===s||null==n?null:i);case 26:case"end":return e.stop()}}),e,this,[[11,19]])}))),function(e){return i.apply(this,arguments)})},{key:"_fetchRasterInfo",value:(r=(0,n.Z)(h().mark((function e(t){var r,n,i,a,s,o,l,u,c,f,p,d,m=this;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.sourceJSON,n=Math.ceil((r.extent.xmax-r.extent.xmin)/r.pixelSizeX-.1),i=Math.ceil((r.extent.ymax-r.extent.ymin)/r.pixelSizeY-.1),a=J.Z.fromJSON(r.spatialReference||r.extent.spatialReference),"Map"!==this.tileType){e.next=3;break}return e.abrupt("return",new re.Z({width:n,height:i,bandCount:3,extent:j.Z.fromJSON(r.extent),spatialReference:a,pixelSize:new fe.Z({x:r.pixelSizeX,y:r.pixelSizeY,spatialReference:a}),pixelType:"u8",statistics:null,keyProperties:{DataType:"processed"}}));case 3:return s=t.slice,o=t.signal,l=!!r.hasRasterAttributeTable&&this.request(this.url+"/rasterAttributeTable",{query:{slice:s,f:"json"},signal:o}).then((function(e){return we.default.fromJSON(e.data)})).catch((function(){return null})),u=!!r.hasColormap&&this.request(this.url+"/colormap",{query:{slice:s,f:"json"},signal:o}).then((function(e){var t;return null==(t=e.data)?void 0:t.colormap})),c=!!r.hasHistograms&&this.request(this.url+"/histograms",{query:{slice:s,f:"json"},signal:o}).then((function(e){var t;return null==(t=e.data)?void 0:t.histograms})),f=this.request(this.url+"/keyProperties",{query:{f:"json"},signal:o}).then((function(e){return e.data})).catch((function(){})),p=!!r.hasMultidimensions&&this._fetchMultidimensionalInfo(),d=!!r.hasMultidimensions&&this.request(this.url+"/slices",{query:{f:"json"},signal:o}).then((function(e){return e.data&&e.data.slices})).catch((function(){})),e.abrupt("return",Promise.all([l,u,c,f,p,d]).then((function(e){var t=null;if(r.minValues&&r.minValues.length===r.bandCount){t=[];for(var s=0;s<r.minValues.length;s++)t.push({min:r.minValues[s],max:r.maxValues[s],avg:r.meanValues[s],stddev:r.stdvValues[s]})}return m._slices=e[5]||null,new re.Z({width:n,height:i,bandCount:r.bandCount,extent:j.Z.fromJSON(r.extent),spatialReference:a,pixelSize:new fe.Z({x:r.pixelSizeX,y:r.pixelSizeY,spatialReference:a}),pixelType:r.pixelType.toLowerCase(),statistics:t,attributeTable:e[0]||null,colormap:e[1]||null,histograms:e[2]||null,keyProperties:e[3]||{},multidimensionalInfo:e[4]||null})})));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_fetchMultidimensionalInfo",value:(t=(0,n.Z)(h().mark((function e(t){var r,n;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.request(this.url+"/multidimensionalInfo",{query:{f:"json"},signal:t}).then((function(e){var t;return null==(t=e.data)?void 0:t.multidimensionalInfo}));case 2:return n=e.sent,e.abrupt("return",(null!=(r=n.variables)&&r.length&&n.variables.forEach((function(e){var t;null!=(t=e.statistics)&&t.length&&e.statistics.forEach((function(e){e.avg=e.mean,e.stddev=e.standardDeviation}))})),n));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_fixScaleInServiceInfo",value:function(){var e=this.sourceJSON;e.minScale&&e.minScale<0&&(e.minScale=0),e.maxScale&&e.maxScale<0&&(e.maxScale=0)}},{key:"_fixGCSShift",value:function(e){var t=e.extent,r=e.spatialReference;0===t.xmin&&360===t.xmax&&r.wkid&&r.isGeographic&&(e.nativeExtent=e.extent,e.transform=new Ge.Z,e.extent=e.transform.forwardTransform(t))}}]),p}(ye);(0,p._)([(0,b.Cb)({type:String,json:{write:!0}})],Ye.prototype,"datasetFormat",void 0),(0,p._)([(0,b.Cb)()],Ye.prototype,"tileType",void 0);var Xe=Ye=(0,p._)([(0,R.j)("esri.layers.support.rasterDatasets.ImageServerRaster")],Ye),Ke=r(2491),Qe=r(39603);function $e(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.Z)(e);if(t){var i=(0,c.Z)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,u.Z)(this,r)}}var et=new Map;et.set("Int8","s8"),et.set("UInt8","u8"),et.set("Int16","s16"),et.set("UInt16","u16"),et.set("Int32","s32"),et.set("UInt32","u32"),et.set("Float32","f32"),et.set("Float64","f32"),et.set("Double64","f32");var tt=new Map;tt.set("none",{blobExtension:".til",isOneSegment:!0,decoderFormat:"bip"}),tt.set("lerc",{blobExtension:".lrc",isOneSegment:!1,decoderFormat:"lerc"}),tt.set("deflate",{blobExtension:".pzp",isOneSegment:!0,decoderFormat:"deflate"}),tt.set("jpeg",{blobExtension:".pjg",isOneSegment:!0,decoderFormat:"jpg"});var rt=function(e){(0,l.Z)(u,e);var t,r,i,o=$e(u);function u(){var e;return(0,a.Z)(this,u),(e=o.apply(this,arguments))._files=null,e._storageIndex=null,e.datasetFormat="MRF",e}return(0,s.Z)(u,[{key:"open",value:(i=(0,n.Z)(h().mark((function e(t){var r,n,i,a,s,o,l,u,c,f,p,d,m,y,x,g,b,w,I,k,R,C;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.init();case 2:return this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1),n=t?(0,v.Wg)(t.signal):null,e.next=6,this.request(this.url,{responseType:"xml",signal:n});case 6:if(i=e.sent,a=this._parseHeader(i.data),s=a.rasterInfo,o=a.files,-1!==(null==(r=this.ioConfig.skipExtensions)?void 0:r.indexOf("aux.xml"))){e.next=15;break}return e.next=13,this._fetchAuxiliaryData(t);case 13:null!=(l=e.sent)&&(s.statistics=null!=(u=l.statistics)?u:s.statistics,s.histograms=l.histograms,l.histograms&&!(0,v.pC)(s.statistics)&&(s.statistics=(0,ue.Oh)(l.histograms)));case 15:return this._set("rasterInfo",s),this._files=o,e.next=18,this.request(o.index,{responseType:"array-buffer",signal:n});case 18:for(c=e.sent,this._storageIndex=this._parseIndex(c.data),f=this.rasterInfo.storageInfo,p=f.blockWidth,d=f.blockHeight,m=this.rasterInfo.storageInfo.pyramidScalingFactor,y=this.rasterInfo,x=y.width,g=y.height,b=[],w=this._getBandSegmentCount(),I=0,k=-1;I<this._storageIndex.length;)k++,R=Math.ceil(x/p/Math.pow(m,k))-1,C=Math.ceil(g/d/Math.pow(m,k))-1,I+=1*R*(1*C)*w*4,b.push({maxRow:C,maxCol:R,minCol:0,minRow:0});this.rasterInfo.storageInfo.blockBoundary=b,k>0&&(this.rasterInfo.storageInfo.firstPyramidLevel=1,this.rasterInfo.storageInfo.maximumPyramidLevel=k),this.updateTileInfo();case 24:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"fetchRawTile",value:(r=(0,n.Z)(h().mark((function e(t,r,n){var i,a,s,o,l,u,c,f,p,d,m,y,x,g,b,w,I,k,R,C,S,_,T,O,Z,P,M,F,D,B,E=arguments;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=E.length>3&&void 0!==E[3]?E[3]:{},a=this.rasterInfo.storageInfo,s=a.blockWidth,o=a.blockHeight,l=a.blockBoundary,!(!(u=l[t])||u.maxRow<r||u.maxCol<n||u.minRow>r||u.minCol>n)){e.next=4;break}return e.abrupt("return",null);case 4:if(c=this.rasterInfo,f=c.bandCount,p=c.pixelType,d=this._getTileLocation(t,r,n),m=d.ranges,y=d.actualTileWidth,x=d.actualTileHeight,m&&0!==m.length){e.next=7;break}return e.abrupt("return",null);case 7:if(0!==m[0].from||0!==m[0].to){e.next=10;break}return g=new Uint8Array(s*o),e.abrupt("return",new Ke.Z({width:s,height:o,pixels:null,mask:g,validPixelCount:0}));case 10:for(b=this.ioConfig.bandIds,w=this._getBandSegmentCount(),I=[],k=0,k=0;k<w;k++)(!b||b.indexOf[k]>-1)&&I.push(this.request(this._files.data,{range:{from:m[k].from,to:m[k].to},responseType:"array-buffer",signal:i.signal}));return e.next=15,Promise.all(I);case 15:for(R=e.sent,C=R.map((function(e){return e.data.byteLength})).reduce((function(e,t){return e+t})),S=new Uint8Array(C),_=0,k=0;k<w;k++)S.set(new Uint8Array(R[k].data),_),_+=R[k].data.byteLength;return T=tt.get(this.rasterInfo.storageInfo.compression).decoderFormat,e.next=23,this.decodePixelBlock(S.buffer,{width:s,height:o,format:T,planes:(null==b?void 0:b.length)||f,pixelType:p});case 23:if(O=e.sent,(0,v.pC)(this.rasterInfo.noDataValue)&&"lerc"!==T&&!O.mask&&null!=(Z=this.rasterInfo.noDataValue[0])){if(P=O.width*O.height,M=new Uint8Array(P),Math.abs(Z)>1e24)for(k=0;k<P;k++)Math.abs((O.pixels[0][k]-Z)/Z)>1e-6&&(M[k]=1);else for(k=0;k<P;k++)O.pixels[0][k]!==Z&&(M[k]=1);O.mask=M}if(F=0,D=0,y!==s||x!==o)if(B=O.mask)for(k=0;k<o;k++)if(D=k*s,k<x)for(F=y;F<s;F++)B[D+F]=0;else for(F=0;F<s;F++)B[D+F]=0;else for(B=new Uint8Array(s*o),O.mask=B,k=0;k<x;k++)for(D=k*s,F=0;F<y;F++)B[D+F]=1;return e.abrupt("return",O);case 28:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"_parseIndex",value:function(e){if(e.byteLength%16>0)throw"invalid array buffer must be multiples of 16";var t,r,n,i,a,s;if(Qe.f){for(r=new Uint8Array(e),i=new ArrayBuffer(e.byteLength),n=new Uint8Array(i),a=0;a<e.byteLength/4;a++)for(s=0;s<4;s++)n[4*a+s]=r[4*a+3-s];t=new Uint32Array(i)}else t=new Uint32Array(e);return t}},{key:"_getBandSegmentCount",value:function(){return tt.get(this.rasterInfo.storageInfo.compression).isOneSegment?1:this.rasterInfo.bandCount}},{key:"_getTileLocation",value:function(e,t,r){var n,i,a,s=this.rasterInfo.storageInfo,o=s.blockWidth,l=s.blockHeight,u=s.pyramidScalingFactor,c=this.rasterInfo,f=c.width,h=c.height,p=this._getBandSegmentCount(),d=0,m=0;for(a=0;a<e;a++)m=Math.pow(u,a),d+=(n=Math.ceil(f/o/m))*(i=Math.ceil(h/l/m));m=Math.pow(u,e),n=Math.ceil(f/o/m),i=Math.ceil(h/l/m),d+=t*n+r,d*=4*p;for(var y=this._storageIndex.subarray(d,d+4*p),v=0,x=0,g=[],b=0;b<p;b++)x=(v=y[4*b+0]*Math.pow(2,32)+y[4*b+1])+y[4*b+2]*Math.pow(2,32)+y[4*b+3],g.push({from:v,to:x});return{ranges:g,actualTileWidth:r<n-1?o:Math.ceil(f/m)-o*(n-1),actualTileHeight:t<i-1?l:Math.ceil(h/m)-l*(i-1)}}},{key:"_parseHeader",value:function(e){var t=Ze(e,"MRF_META/Raster");if(!t)throw new y.Z("mrf:open","not a valid MRF format");var r=Ze(t,"Size"),n=parseInt(r.getAttribute("x"),10),i=parseInt(r.getAttribute("y"),10),a=parseInt(r.getAttribute("c"),10),s=(Pe(t,"Compression")||"none").toLowerCase();if(!tt.has(s))throw new y.Z("mrf:open","currently does not support compression "+s);var o=Pe(t,"DataType")||"UInt8",l=et.get(o);if(null==l)throw new y.Z("mrf:open","currently does not support pixel type "+o);var u,c,f=Ze(t,"PageSize"),h=parseInt(f.getAttribute("x"),10),p=parseInt(f.getAttribute("y"),10),d=Ze(t,"DataValues");if(d&&(null!=(c=d.getAttribute("NoData"))&&(u=c.trim().split(" ").map((function(e){return parseFloat(e)})))),Ze(e,"MRF_META/CachedSource"))throw new y.Z("mrf:open","currently does not support MRF referencing other data files");var m=Ze(e,"MRF_META/GeoTags"),v=Ze(m,"BoundingBox");if(null==v)throw new y.Z("mrf:open","missing node MRF_META/GeoTags/BoundingBox");var x,g=parseFloat(v.getAttribute("minx")),b=parseFloat(v.getAttribute("miny")),w=parseFloat(v.getAttribute("maxx")),I=parseFloat(v.getAttribute("maxy")),k=Pe(m,"Projection")||"",R=Pe(e,"datafile"),C=Pe(e,"IndexFile");if("LOCAL_CS[]"!==k)if(k.toLowerCase().startsWith("epsg:")){var S=Number(k.slice(5));isNaN(S)||0===S||(x=new J.Z({wkid:S}))}else x=Ae(k);var _=new j.Z(g,b,w,I);_.spatialReference=x;var T=Ze(e,"MRF_META/Rsets"),O=parseInt(T&&T.getAttribute("scale")||"2",10),Z=new ne.Z({origin:new fe.Z({x:_.xmin,y:_.ymax,spatialReference:x}),blockWidth:h,blockHeight:p,pyramidBlockWidth:h,pyramidBlockHeight:p,compression:s,pyramidScalingFactor:O}),P=new fe.Z({x:(w-g)/n,y:(I-b)/i,spatialReference:x});return{rasterInfo:new re.Z({width:n,height:i,extent:_,spatialReference:x,bandCount:a,pixelType:l,pixelSize:P,noDataValue:u,storageInfo:Z}),files:{mrf:this.url,index:C||this.url.replace(".mrf",".idx"),data:R||this.url.replace(".mrf",tt.get(s).blobExtension)}}}},{key:"_fetchAuxiliaryData",value:(t=(0,n.Z)(h().mark((function e(t){var r,n;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.request(this.url+".aux.xml",{responseType:"xml",signal:null==t?void 0:t.signal});case 3:return r=e.sent,n=r.data,e.abrupt("return",Ne(n));case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",null);case 11:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e){return t.apply(this,arguments)})}]),u}(ye);(0,p._)([(0,b.Cb)()],rt.prototype,"_files",void 0),(0,p._)([(0,b.Cb)()],rt.prototype,"_storageIndex",void 0),(0,p._)([(0,b.Cb)({type:String,json:{write:!0}})],rt.prototype,"datasetFormat",void 0);var nt=rt=(0,p._)([(0,R.j)("esri.layers.support.rasterIO.MRFRaster")],rt),it=r(3983),at=r(74795);function st(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ot(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?st(Object(r),!0).forEach((function(t){(0,i.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):st(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function lt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.Z)(e);if(t){var i=(0,c.Z)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,u.Z)(this,r)}}var ut=function(e,t){var r=e.get(t);return r&&r.values},ct=function(e,t){var r=e.get(t);return r&&r.values[0]},ft=function(e){(0,l.Z)(f,e);var t,r,i,o,u,c=lt(f);function f(){var e;return(0,a.Z)(this,f),(e=c.apply(this,arguments))._files=null,e._headerInfo=null,e._bufferSize=1048576,e.datasetFormat="TIFF",e}return(0,s.Z)(f,[{key:"open",value:(u=(0,n.Z)(h().mark((function e(t){var r,n,i,a,s,o,l,u,c,f,p,d,m,x,g,b,w,I,k,R,C,S,_,T,O,Z,P,M,F,D,B,E,H,A,z,N,L,W;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.init();case 2:return a=t?(0,v.Wg)(t.signal):null,e.next=5,this.request(this.url,{range:{from:0,to:this._bufferSize},responseType:"array-buffer",signal:a});case 5:if(s=e.sent,o=s.data){e.next=9;break}throw new y.Z("tiffraster:open","failed to open url "+this.url);case 9:return this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1),l=(0,it.p)(o),u=l.littleEndian,c=l.firstIFD,f=l.isBigTiff,p=[],e.next=13,this.readIFDs(p,o,u,c,0,f?8:4,a);case 13:if(d=(0,it.g)(p),m=d.width,x=d.height,g=d.tileWidth,b=d.tileHeight,w=d.planes,I=d.pixelType,k=d.compression,R=d.firstPyramidLevel,C=d.maximumPyramidLevel,S=d.pyramidBlockWidth,_=d.pyramidBlockHeight,T=d.tileBoundary,O=d.affine,Z=d.metadata,P=(null==(r=d.extent.spatialReference)?void 0:r.wkt)||(null==(n=d.extent.spatialReference)?void 0:n.wkid),M=Ae(P),F=!1,null==M&&(F=!0,M=new J.Z({wkid:3857})),D=new j.Z(ot(ot({},d.extent),{},{spatialReference:M})),B=new fe.Z(D?{x:D.xmin,y:D.ymax,spatialReference:M}:{x:0,y:0}),E=new ne.Z({blockWidth:g,blockHeight:b,pyramidBlockWidth:S,pyramidBlockHeight:_,compression:k,origin:B,firstPyramidLevel:R,maximumPyramidLevel:C,blockBoundary:T}),H=new fe.Z({x:(D.xmax-D.xmin)/m,y:(D.ymax-D.ymin)/x,spatialReference:M}),A=Z?{BandProperties:Z.bandProperties,DataType:Z.dataType}:{},z=new re.Z({width:m,height:x,bandCount:w,pixelType:I,compression:k,pixelSize:H,storageInfo:E,spatialReference:M,isPseudoSpatialReference:F,keyProperties:A,extent:D,statistics:Z?Z.statistics:null}),null!=O&&O.length&&(z.nativeExtent=new j.Z({xmin:-.5,ymin:.5-x,xmax:m-.5,ymax:.5,spatialReference:M}),z.transform=new Ee.Z({polynomialOrder:1,forwardCoefficients:[O[2]+O[0]/2,O[5]-O[3]/2,O[0],O[3],-O[1],-O[4]]}),z.extent=z.transform.forwardTransform(z.nativeExtent),z.pixelSize=new fe.Z({x:(D.xmax-D.xmin)/m,y:(D.ymax-D.ymin)/x,spatialReference:M}),E.origin.x=-.5,E.origin.y=.5),null!=(i=this.ioConfig.skipExtensions)&&i.includes("aux.xml")){e.next=22;break}return e.next=20,this._fetchAuxiliaryData(t);case 20:null!=(N=e.sent)&&(z.statistics=null!=(L=N.statistics)?L:z.statistics,z.histograms=N.histograms,N.histograms&&!(0,v.pC)(z.statistics)&&(z.statistics=(0,ue.Oh)(N.histograms)),N.transform&&!O&&(z.transform=N.transform,z.nativeExtent=z.extent,W=z.transform.forwardTransform(z.nativeExtent),z.pixelSize=new fe.Z({x:(W.xmax-W.xmin)/m,y:(W.ymax-W.ymin)/x,spatialReference:M}),z.extent=W),z.spatialReference||(z.spatialReference=N.spatialReference));case 22:if(this._set("rasterInfo",z),this._headerInfo=ot({littleEndian:u,isBigTiff:f,ifds:p},d),this._headerInfo.isSupported){e.next=24;break}throw new y.Z("tiffraster:open","this tiff is not supported: "+this._headerInfo.message);case 24:this.updateTileInfo();case 25:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"fetchRawTile",value:(o=(0,n.Z)(h().mark((function e(t,r,n){var i,a,s,o,l,u,c,f,p,d,m,y,v,x,g,b,w,I,k,R,C,S,_,T,O,Z=this,P=arguments;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=P.length>3&&void 0!==P[3]?P[3]:{},null!=(a=this._headerInfo)&&a.isSupported&&!this.isBlockOutside(t,r,n)){e.next=3;break}return e.abrupt("return",null);case 3:if(s=this.getTileLocation(t,r,n)){e.next=6;break}return e.abrupt("return",null);case 6:return o=s.ranges,l=s.actualTileWidth,u=s.actualTileHeight,c=s.ifd,f=o.map((function(e){return Z.request(Z.url,{range:e,responseType:"array-buffer",signal:i.signal})})),e.next=13,Promise.all(f);case 13:if(p=e.sent,d=p.map((function(e){return e.data.byteLength})).reduce((function(e,t){return e+t})),m=1===p.length?p[0].data:new ArrayBuffer(d),y=[0],v=[0],p.length>1)for(x=new Uint8Array(m),g=0,b=0;g<p.length;g++)w=p[g].data,x.set(new Uint8Array(w),b),y[g]=b,b+=w.byteLength,v[g]=w.byteLength;return I=this.getBlockWidthHeight(t),k=I.blockWidth,R=I.blockHeight,e.next=24,this.decodePixelBlock(m,{format:"tiff",customOptions:{headerInfo:this._headerInfo,ifd:c,offsets:y,sizes:v},width:k,height:R,planes:null,pixelType:null});case 24:if(C=e.sent,l!==k||u!==R)if(O=C.mask)for(S=0;S<R;S++)if(T=S*k,S<u)for(_=l;_<k;_++)O[T+_]=0;else for(_=0;_<k;_++)O[T+_]=0;else for(O=new Uint8Array(k*R),C.mask=O,S=0;S<u;S++)for(T=S*k,_=0;_<l;_++)O[T+_]=1;return e.abrupt("return",C);case 27:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return o.apply(this,arguments)})},{key:"readIFDs",value:(i=(0,n.Z)(h().mark((function e(t,r,n,i,a){var s,o,l,u=arguments;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=u.length>5&&void 0!==u[5]?u[5]:4,o=u.length>6?u[6]:void 0,i){e.next=4;break}return e.abrupt("return",null);case 4:if(!(i>=r.byteLength||i<0)){e.next=10;break}return e.next=7,this.request(this.url,{range:{from:i+a,to:i+a+this._bufferSize},responseType:"array-buffer",signal:o});case 7:r=e.sent.data,a=i+a,i=0;case 10:return e.next=12,this.readIFD(r,n,i,a,at.Z.TIFF_TAGS,s,o);case 12:if(l=e.sent,t.push(l.ifd),l.nextIFD){e.next=15;break}return e.abrupt("return",null);case 15:return e.next=17,this.readIFDs(t,r,n,l.nextIFD-a,a,s,o);case 17:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n,a){return i.apply(this,arguments)})},{key:"readIFD",value:(r=(0,n.Z)(h().mark((function e(t,r,n,i){var a,s,o,l,u,c,f,p,d,m,y,v,x,g,b=arguments;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=b.length>4&&void 0!==b[4]?b[4]:at.Z.TIFF_TAGS,s=b.length>5&&void 0!==b[5]?b[5]:4,o=b.length>6?b[6]:void 0,t){e.next=5;break}return e.abrupt("return",null);case 5:if(!(l=(0,it.b)(t,r,n,i,a,s)).success){e.next=25;break}if(u=[],l.ifd.forEach((function(e){e.values||u.push(e)})),!(u.length>0)){e.next=16;break}if(c=u.map((function(e){return e.offlineOffsetSize})),f=Math.min.apply(null,c.map((function(e){return e[0]}))),!(Math.min.apply(null,c.map((function(e){return e[0]+e[1]})))-f<=this._bufferSize)){e.next=16;break}return e.next=13,this.request(this.url,{range:{from:f,to:f+this._bufferSize},responseType:"array-buffer",signal:o});case 13:p=e.sent,d=p.data,t=d,i=f,u.forEach((function(e){return(0,it.c)(t,r,e,i)}));case 16:if(!l.ifd.has("GEOKEYDIRECTORY")){e.next=24;break}if(m=l.ifd.get("GEOKEYDIRECTORY"),!((y=m.values)&&y.length>4)){e.next=24;break}return v=y[0]+"."+y[1]+"."+y[2],e.next=22,this.readIFD(t,r,m.valueOffset+6-i,i,at.Z.GEO_KEYS,2,o);case 22:x=e.sent,m.data=x.ifd,m.data&&m.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[v]});case 24:return e.abrupt("return",l);case 25:if(!l.requiredBufferSize||l.requiredBufferSize===t.byteLength){e.next=30;break}return e.next=28,this.request(this.url,{range:{from:i,to:i+l.requiredBufferSize+4},responseType:"array-buffer",signal:o});case 28:return g=e.sent,e.abrupt("return",(t=g.data).byteLength<l.requiredBufferSize?null:this.readIFD(t,r,0,i,at.Z.TIFF_TAGS,4,o));case 30:case"end":return e.stop()}}),e,this)}))),function(e,t,n,i){return r.apply(this,arguments)})},{key:"getTileLocation",value:function(e,t,r){var n=this.rasterInfo.storageInfo,i=n.firstPyramidLevel,a=n.blockBoundary,s=0===e?0:e-(i-1),o=this._headerInfo.ifds[s];if(!o)return null;var l=(0,it.i)(o,this._headerInfo),u=ut(o,"TILEOFFSETS");if(void 0===u)return null;var c=ut(o,"TILEBYTECOUNTS"),f=a[s],h=f.minRow,p=f.minCol,d=f.maxRow,m=f.maxCol;if(t>d||r>m||t<h||r<p)return null;var y=ct(o,"IMAGEWIDTH"),v=ct(o,"IMAGELENGTH"),x=ct(o,"TILEWIDTH"),g=ct(o,"TILELENGTH"),b=l?this.rasterInfo.bandCount:1,w=b*t*(m+1)+r,I=[{from:u[w],to:u[w+b-1]+c[w+b-1]-1}];if(l){for(var k=!0,R=0;R<b;R++)if(u[w+R]+c[w+R]!==u[w+R+1]){k=!1;break}if(!k)for(var C=0;C<b;C++)I[C]={from:u[w+C],to:u[w+C]+c[w+C]-1}}var S=u[w],_=c[w];return null==S||null==_?null:{ranges:I,ifd:o,actualTileWidth:r===m?y%x:x,actualTileHeight:t===d?v%g:g}}},{key:"_fetchAuxiliaryData",value:(t=(0,n.Z)(h().mark((function e(t){var r,n;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.request(this.url+".aux.xml",{responseType:"xml",signal:null==t?void 0:t.signal});case 3:return r=e.sent,n=r.data,e.abrupt("return",Ne(n));case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",null);case 11:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e){return t.apply(this,arguments)})}]),f}(ye);(0,p._)([(0,b.Cb)()],ft.prototype,"_files",void 0),(0,p._)([(0,b.Cb)()],ft.prototype,"_headerInfo",void 0),(0,p._)([(0,b.Cb)()],ft.prototype,"_bufferSize",void 0),(0,p._)([(0,b.Cb)({type:String,json:{write:!0}})],ft.prototype,"datasetFormat",void 0);var ht=ft=(0,p._)([(0,R.j)("esri.layers.support.rasterDatasets.TIFFRaster")],ft),pt=new Map;pt.set("CRF",{desc:"Cloud Raster Format",constructor:Ce}),pt.set("MRF",{desc:"Meta Raster Format",constructor:nt}),pt.set("TIFF",{desc:"GeoTIFF",constructor:ht}),pt.set("RasterTileServer",{desc:"Raster Tile Server",constructor:Xe}),pt.set("JPG",{desc:"JPG Raster Format",constructor:Je}),pt.set("PNG",{desc:"PNG Raster Format",constructor:Je}),pt.set("GIF",{desc:"GIF Raster Format",constructor:Je}),pt.set("BMP",{desc:"BMP Raster Format",constructor:Je});var dt=function(){function e(){(0,a.Z)(this,e)}var t;return(0,s.Z)(e,null,[{key:"supportedFormats",get:function(){var e=new Set;return pt.forEach((function(t,r){return e.add(r)})),e}},{key:"open",value:(t=(0,n.Z)(h().mark((function e(t){var r,n,i,a,s,o,l,u,c,f;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.url,n=t.ioConfig,i=t.sourceJSON,null==(a=t.datasetFormat)&&r.lastIndexOf(".")&&(a=r.slice(r.lastIndexOf(".")+1).toUpperCase()),"OVR"===a||"TIF"===a?a="TIFF":"JPG"!==a&&"JPEG"!==a&&"JFIF"!==a||(a="JPG"),r.toLowerCase().indexOf("/imageserver")>-1&&-1===r.toLowerCase().indexOf("/wcsserver")&&(a="RasterTileServer"),s={url:r,sourceJSON:i,datasetFormat:a,ioConfig:n||{bandIds:null,sampling:null}},!this.supportedFormats.has(a)){e.next=10;break}return o=pt.get(a).constructor,l=new o(s),e.next=9,l.open({signal:t.signal});case 9:return e.abrupt("return",l);case 10:if(!a){e.next=12;break}throw new y.Z("rasterfactory:open","not a supported format "+a);case 12:return u=Array.from(pt.keys()),c=0,f=function e(){return(a=u[c++])?(o=pt.get(a).constructor,(l=new o(s)).open({signal:t.signal}).then((function(){return l})).catch((function(){return e()}))):null},e.abrupt("return",f());case 16:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"register",value:function(e,t,r){pt.has(e.toUpperCase())||pt.set(e.toUpperCase(),{desc:t,constructor:r})}}]),e}(),mt=r(97879);function yt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function vt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?yt(Object(r),!0).forEach((function(t){(0,i.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function xt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.Z)(e);if(t){var i=(0,c.Z)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,u.Z)(this,r)}}var gt=function(e){(0,l.Z)(i,e);var t,r=xt(i);function i(){var e;(0,a.Z)(this,i);for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return(e=r.call.apply(r,[this].concat(n))).bandIds=null,e.interpolation=null,e.legendEnabled=!0,e.isReference=null,e.listMode="show",e.sourceJSON=null,e.version=null,e.title=null,e.type="imagery-tile",e.operationalLayerType="ArcGISTiledImageServiceLayer",e.popupEnabled=!0,e.popupTemplate=null,e.fields=null,e}return(0,s.Z)(i,[{key:"normalizeCtorArgs",value:function(e,t){return"string"==typeof e?vt({url:e},t):e}},{key:"load",value:function(e){var t=this,r=(0,v.pC)(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"]},e).catch(g.r9).then((function(){return t._openRaster(r)}))),Promise.resolve(this)}},{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},{key:"rasterFields",get:function(){var e,t,r=[new $.Z({name:"Raster.ServicePixelValue",alias:"Pixel Value",domain:null,editable:!1,length:50,type:"string"})],n=null==(e=this.rasterInfo)||null==(t=e.attributeTable)?void 0:t.fields;if(n){var i=n.filter((function(e){return"oid"!==e.type&&"value"!==e.name.toLowerCase()})).map((function(e){var t=e.clone();return t.name="Raster."+e.name,t}));r=r.concat(i)}var a=this.rasterInfo.dataType;if(("vector-magdir"===a||"vector-uv"===a)&&(0,v.pC)(this.rasterInfo.multidimensionalInfo)){var s,o=null==(s=this.rasterInfo.multidimensionalInfo.variables[0].unit)?void 0:s.trim(),l="Magnitude"+(o?" (".concat(o,")"):"");r.push(new $.Z({name:"Raster.Magnitude",alias:l,domain:null,editable:!1,type:"double"})),r.push(new $.Z({name:"Raster.Direction",alias:"Direction ()",domain:null,editable:!1,type:"double"}))}return r}},{key:"renderer",set:function(e){this._set("renderer",e),this.updateRenderer()}},{key:"readRenderer",value:function(e,t,r){var n=t&&t.layerDefinition&&t.layerDefinition.drawingInfo&&t.layerDefinition.drawingInfo.renderer,i=(0,m.ij)(n,r)||void 0;if(null!=i)return i}},{key:"createPopupTemplate",value:function(e){return(0,mt.eZ)({fields:this.rasterFields,title:this.title},e)}},{key:"write",value:function(e,t){var r=this.raster;if(this.loaded?"RasterTileServer"===r.datasetFormat&&("Raster"===r.tileType||"Map"===r.tileType):this.url&&/\/ImageServer(\/|\/?$)/i.test(this.url))return(0,o.Z)((0,c.Z)(i.prototype),"write",this).call(this,e,t);if(t&&t.messages){var n="".concat(t.origin,"/").concat(t.layerContainerType||"operational-layers");t.messages.push(new y.Z("layer:unsupported","Layers (".concat(this.title,", ").concat(this.id,") of type '").concat(this.declaredClass,"' are not supported in the context of '").concat(n,"'"),{layer:this}))}return null}},{key:"_openRaster",value:(t=(0,n.Z)(h().mark((function e(t){var r=this;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.raster){e.next=8;break}if(e.t0=this.raster.rasterInfo,e.t0){e.next=5;break}return e.next=5,this.raster.open();case 5:this.url=this.raster.url,e.next=11;break;case 8:return e.next=10,dt.open({url:this.url,sourceJSON:this.sourceJSON,ioConfig:vt(vt({sampling:"closest"},this.ioConfig),{},{customFetchParameters:this.customParameters}),signal:t});case 10:this.raster=e.sent;case 11:if(this.raster.rasterInfo){e.next=14;break}throw new y.Z("imagery-tile-layer:load","cannot load resources on "+this.url);case 14:this.sourceJSON=this.sourceJSON||this.raster.sourceJSON,null!=this.sourceJSON&&(this._set("version",this.sourceJSON.currentVersion),this._set("copyright",this.sourceJSON.copyrightText),this.sourceJSON.timeInfo&&this._set("timeInfo",te.Z.fromJSON(this.sourceJSON.timeInfo))),null==this.title&&(this.title=this.raster.datasetName),"Map"===this.raster.tileType&&(this.popupEnabled=!1),this._configDefaultSettings(),this.watch("customParameters",(function(e){return r.raster.ioConfig.customFetchParameters=e}));case 15:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),i}((0,S.h)((0,K.M)((0,V.q)((0,Y.I)((0,_.N)(function(e){var t=function(e){(0,l.Z)(d,e);var t,r,i,o,u,c,f,p=U(d);function d(){var e;return(0,a.Z)(this,d),(e=p.apply(this,arguments))._rasterJobHandler={instance:null,refCount:0,connectionPromise:null},e.bandIds=null,e.copyright=null,e.fullExtent=null,e.interpolation="nearest",e.multidimensionalDefinition=null,e.raster=null,e.rasterInfo=null,e.sourceJSON=null,e.spatialReference=null,e.tileInfo=null,e.symbolizer=null,e}return(0,s.Z)(d,[{key:"url",set:function(e){this._set("url",(0,F.Nm)(e,G))}},{key:"renderer",set:function(e){this._set("renderer",e),this.updateRenderer()}},{key:"convertVectorFieldData",value:(f=(0,n.Z)(h().mark((function e(t,r){var n,i;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,v.Wi)(t)){e.next=2;break}return e.abrupt("return",null);case 2:return n=this._rasterJobHandler.instance,i=this.rasterInfo.dataType,e.abrupt("return",n?n.convertVectorFieldData({pixelBlock:t,dataType:i},r):(0,A.KC)(t,i));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return f.apply(this,arguments)})},{key:"createStreamlinesMesh",value:(c=(0,n.Z)(h().mark((function e(t,r){var n;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._rasterJobHandler.instance,e.abrupt("return",n?n.createStreamlinesMesh(t,r):(0,L.z_)(t.rendererSettings,t.flowData,(0,v.pC)(r.signal)?r.signal:(new AbortController).signal));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"normalizeRasterFetchOptions",value:function(e){var t=this.rasterInfo.multidimensionalInfo;if((0,v.Wi)(t))return e;var r=e.multidimensionalDefinition||this.multidimensionalDefinition;!(0,v.Wi)(r)&&r.length||(r=this._getDefaultSlice());var n=e.timeExtent||this.timeExtent;if((0,v.pC)(r)&&(0,v.pC)(n)&&((0,v.pC)(n.start)||(0,v.pC)(n.end))){var i,a;r=r.map((function(e){return e.clone()}));var s=null==(i=t.variables.find((function(e){return e.name===r[0].variableName})))||null==(a=i.dimensions)?void 0:a.find((function(e){return"StdTime"===e.name})),o=r.find((function(e){return"StdTime"===e.dimensionName}));if(!s||!o)return q(q({},e),{},{multidimensionalDefinition:null});var l=n.start,u=n.end,c=(0,v.Wi)(l)?null:l.getTime(),f=(0,v.Wi)(u)?null:u.getTime(),h=null!=c?c:f,p=null!=f?f:c;if((0,v.pC)(s.values)){var d=s.values.filter((function(e){if(Array.isArray(e)){if(h===p)return e[0]<=h&&e[1]>=h;var t=e[0]<=h&&e[1]>h||e[0]<p&&e[1]>=p,r=e[0]>=h&&e[1]<=p||e[0]<h&&e[1]>p;return t||r}return h===p?e===h:e>=h&&e<=p}));if(d.length){var m=d.sort((function(e,t){var r,n,i,a;return h===p?(null!=(i=e[0])?i:e)-(null!=(a=t[0])?a:t):Math.abs((null!=(r=e[1])?r:e)-p)-Math.abs((null!=(n=t[1])?n:t)-p)}))[0];o.values=[m]}else r=null}else if(s.hasRegularIntervals&&s.extent){var y=(0,T.Z)(s.extent,2),x=y[0],g=y[1];h>g||p<x?r=null:o.values=h===p?[h]:[Math.max(x,h),Math.min(g,p)]}}return q(q({},e),{},{multidimensionalDefinition:r})}},{key:"updateRenderer",value:(u=(0,n.Z)(h().mark((function e(){var t;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.loaded){e.next=2;break}return e.abrupt("return");case 2:if(JSON.stringify(this._cachedRendererJson)!==JSON.stringify(this.renderer)){e.next=4;break}return e.abrupt("return");case 4:if(t=this._rasterJobHandler.instance,e.t0=t,!e.t0){e.next=12;break}return this.symbolizer.rendererJSON=(0,z.ol)(this.renderer.toJSON()),this.symbolizer.bind(),e.next=11,t.updateSymbolizer(this.symbolizer);case 11:this._cachedRendererJson=this.renderer.toJSON();case 12:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"applyRenderer",value:(o=(0,n.Z)(h().mark((function e(t,r){var n,i,a,s;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t&&t.pixelBlock,(0,v.pC)(n)&&n.pixels&&n.pixels.length>0){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=5,this.updateRenderer();case 5:if(a=this._rasterJobHandler.instance,s=this.bandIds,!a){e.next=12;break}return e.next=9,a.symbolize(q(q({},t),{},{simpleStretchParams:r,bandIds:s}));case 9:e.t0=e.sent,e.next=13;break;case 12:e.t0=this.symbolizer.symbolize(q(q({},t),{},{simpleStretchParams:r,bandIds:s}));case 13:return i=e.t0,e.abrupt("return",i);case 15:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"getTileUrl",value:function(e,t,r){return"RasterTileServer"===this.raster.datasetFormat?"".concat(this.url,"/tile/").concat(e,"/").concat(t,"/").concat(r):""}},{key:"getCompatibleTileInfo",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.loaded||(0,v.Wi)(t))return null;if(r&&e.equals(this.spatialReference))return this.tileInfo;var n=(0,M.C5)(e);return H.Z.create({size:256,spatialReference:e,origin:n?{x:n.origin[0],y:n.origin[1]}:{x:t.xmin,y:t.ymax}})}},{key:"getCompatibleFullExtent",value:function(e){return this.loaded?(this._compatibleFullExtent&&this._compatibleFullExtent.spatialReference.equals(e)||(this._compatibleFullExtent=this.raster.computeExtent(e)),this._compatibleFullExtent):null}},{key:"fetchTile",value:(i=(0,n.Z)(h().mark((function e(t,r,n){var i,a,s,o=arguments;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=o.length>3&&void 0!==o[3]?o[3]:{}).requestAsImageElement){e.next=4;break}return a=this.getTileUrl(t,r,n),e.abrupt("return",(0,O.default)(a,{responseType:"image",query:q(q({},this.refreshParameters),this.raster.ioConfig.customFetchParameters),signal:i.signal}).then((function(e){return e.data})));case 4:if(!(0,v.pC)(this.rasterInfo.multidimensionalInfo)||(i=this.normalizeRasterFetchOptions(i),!(0,v.Wi)(i.multidimensionalDefinition))){e.next=7;break}return s=i.tileInfo||this.rasterInfo.storageInfo.tileInfo,e.abrupt("return",{extent:this.raster.getTileExtentFromTileInfo(t,r,n,s),pixelBlock:null});case 7:return e.next=9,this._initJobHandler();case 9:return"raster-shaded-relief"===this.renderer.type&&(i=q(q({},i),{},{buffer:{cols:1,rows:1}})),e.abrupt("return",this.raster.fetchTile(t,r,n,i));case 11:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return i.apply(this,arguments)})},{key:"fetchPixels",value:(r=(0,n.Z)(h().mark((function e(t,r,n){var i,a=arguments;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=a.length>3&&void 0!==a[3]?a[3]:{},!(0,v.pC)(this.rasterInfo.multidimensionalInfo)||(i=this.normalizeRasterFetchOptions(i),!(0,v.Wi)(i.multidimensionalDefinition))){e.next=5;break}e.t0={extent:t,pixelBlock:null},e.next=8;break;case 5:return e.next=7,this._initJobHandler();case 7:e.t0=this.raster.fetchPixels(t,r,n,i);case 8:return e.abrupt("return",e.t0);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"identify",value:(t=(0,n.Z)(h().mark((function e(t){var r,n=arguments;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.length>1&&void 0!==n[1]?n[1]:{},e.abrupt("return",(0,v.pC)(this.rasterInfo.multidimensionalInfo)&&(r=this.normalizeRasterFetchOptions(r),(0,v.Wi)(r.multidimensionalDefinition))?{location:t,value:null}:this.raster.identify(t,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"increaseRasterJobHandlerUsage",value:function(){this._rasterJobHandler.refCount++}},{key:"decreaseRasterJobHandlerUsage",value:function(){this._rasterJobHandler.refCount--,this._rasterJobHandler.refCount<=0&&this._shutdownJobHandler()}},{key:"hasStandardTime",value:function(){var e,t=this.rasterInfo.multidimensionalInfo;if(!(0,v.pC)(t)||"standard-time"!==this.rasterInfo.dataType)return!1;var r=null==(e=this.multidimensionalDefinition[0])?void 0:e.variableName;return t.variables.some((function(e){return e.name===r&&e.dimensions.some((function(e){return"StdTime"===e.name}))}))}},{key:"getStandardTimeValue",value:function(e){return new Date(24*(e-25569)*3600*1e3).toString()}},{key:"_configDefaultSettings",value:function(){this._configDefaultInterpolation(),this.multidimensionalDefinition||(this.multidimensionalDefinition=this._getDefaultSlice()),this._configDefaultRenderer()}},{key:"_initJobHandler",value:function(){var e=this;if(null!=this._rasterJobHandler.connectionPromise)return this._rasterJobHandler.connectionPromise;var t=new E.Z;return this._rasterJobHandler.connectionPromise=t.initialize().then((function(){e._rasterJobHandler.instance=t,e.raster.rasterJobHandler=t,e.renderer&&e.updateRenderer()})).catch((function(){return null})),this._rasterJobHandler.connectionPromise}},{key:"_shutdownJobHandler",value:function(){this._rasterJobHandler.instance&&this._rasterJobHandler.instance.destroy(),this._rasterJobHandler.instance=null,this._rasterJobHandler.connectionPromise=null,this._rasterJobHandler.refCount=0,this.raster.rasterJobHandler=null}},{key:"_configDefaultInterpolation",value:function(){if(null==this.interpolation){var e,t=(0,z.In)(this.rasterInfo,this.raster.tileType,null==(e=this.sourceJSON)?void 0:e.defaultResamplingMethod);this._set("interpolation",t)}}},{key:"_getDefaultSlice",value:function(){var e=this.raster.rasterInfo.multidimensionalInfo;if(!(0,v.pC)(e))return null;var t=e.variables[0];return t.dimensions.map((function(e){var r,n;return new B.Z({variableName:t.name,dimensionName:e.name,values:[null!=(r=null==(n=e.values)?void 0:n[0])?r:e.extent[0]],isSlice:!0})}))}},{key:"_configDefaultRenderer",value:function(){var e,t=this.raster.rasterInfo;this.bandIds||(this.bandIds=(0,z.YD)(t)),this.renderer||(this.renderer=(0,z.Ob)(t,{bandIds:this.bandIds,variableName:(0,v.pC)(this.multidimensionalDefinition)?null==(e=this.multidimensionalDefinition[0])?void 0:e.variableName:null})),this.symbolizer?(this.symbolizer.rendererJSON=(0,z.ol)(this.renderer.toJSON()),this.symbolizer.rasterInfo=t):this.symbolizer=new N.Z({rendererJSON:this.renderer.toJSON(),rasterInfo:t});var r=this.symbolizer.bind();r.success||G.warn("imagery-tile-mixin",r.error||"The given renderer is not supported by the layer.")}}]),d}(e);return(0,p._)([(0,b.Cb)()],t.prototype,"_cachedRendererJson",void 0),(0,p._)([(0,b.Cb)()],t.prototype,"_compatibleFullExtent",void 0),(0,p._)([(0,b.Cb)()],t.prototype,"_rasterJobHandler",void 0),(0,p._)([(0,b.Cb)()],t.prototype,"bandIds",void 0),(0,p._)([(0,b.Cb)()],t.prototype,"copyright",void 0),(0,p._)([(0,b.Cb)({type:j.Z}),(0,P.B)("rasterInfo.extent")],t.prototype,"fullExtent",void 0),(0,p._)([(0,b.Cb)()],t.prototype,"interpolation",void 0),(0,p._)([(0,b.Cb)()],t.prototype,"ioConfig",void 0),(0,p._)([(0,b.Cb)({type:[B.Z]})],t.prototype,"multidimensionalDefinition",void 0),(0,p._)([(0,b.Cb)()],t.prototype,"raster",void 0),(0,p._)([(0,b.Cb)({readOnly:!0}),(0,P.B)("raster.rasterInfo")],t.prototype,"rasterInfo",void 0),(0,p._)([(0,b.Cb)()],t.prototype,"sourceJSON",void 0),(0,p._)([(0,b.Cb)({type:J.Z}),(0,P.B)("rasterInfo.spatialReference")],t.prototype,"spatialReference",void 0),(0,p._)([(0,b.Cb)({type:H.Z}),(0,P.B)("rasterInfo.storageInfo.tileInfo")],t.prototype,"tileInfo",void 0),(0,p._)([(0,b.Cb)(D.HQ)],t.prototype,"url",null),(0,p._)([(0,b.Cb)({types:m.dr})],t.prototype,"renderer",null),(0,p._)([(0,b.Cb)()],t.prototype,"symbolizer",void 0),t=(0,p._)([(0,R.j)("esri.layers.ImageryTileMixin")],t),t}((0,Q.n)((0,X.Q)((0,x.R)(C.Z))))))))));(0,p._)([(0,b.Cb)({type:[w.z8],json:{write:{overridePolicy:function(){var e;return{enabled:!this.loaded||"Raster"===this.raster.tileType||"0,1,2"!==(null==(e=this.bandIds)?void 0:e.join(","))}}}}})],gt.prototype,"bandIds",void 0),(0,p._)([(0,b.Cb)({json:{write:{overridePolicy:function(){return{enabled:!this.loaded||"Raster"===this.raster.tileType||"bilinear"!==this.interpolation}}}}}),(0,I.J)(ee.c)],gt.prototype,"interpolation",void 0),(0,p._)([(0,b.Cb)({json:{write:!0}})],gt.prototype,"multidimensionalDefinition",void 0),(0,p._)([(0,b.Cb)(D.rn)],gt.prototype,"legendEnabled",void 0),(0,p._)([(0,b.Cb)({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:function(){return{enabled:!1}}}}})],gt.prototype,"isReference",void 0),(0,p._)([(0,b.Cb)({type:["show","hide"]})],gt.prototype,"listMode",void 0),(0,p._)([(0,b.Cb)()],gt.prototype,"sourceJSON",void 0),(0,p._)([(0,b.Cb)({readOnly:!0})],gt.prototype,"version",void 0),(0,p._)([(0,b.Cb)()],gt.prototype,"title",void 0),(0,p._)([(0,b.Cb)({readOnly:!0,json:{read:!1}})],gt.prototype,"type",void 0),(0,p._)([(0,b.Cb)({type:["ArcGISTiledImageServiceLayer"]})],gt.prototype,"operationalLayerType",void 0),(0,p._)([(0,b.Cb)({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader:function(e,t){return!t.disablePopup}},write:{target:"disablePopup",overridePolicy:function(){return{enabled:!this.loaded||"Raster"===this.raster.tileType}},writer:function(e,t,r){t[r]=!e}}}})],gt.prototype,"popupEnabled",void 0),(0,p._)([(0,b.Cb)({type:d.Z,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:function(){return{enabled:!this.loaded||"Raster"===this.raster.tileType}}}}})],gt.prototype,"popupTemplate",void 0),(0,p._)([(0,b.Cb)({readOnly:!0})],gt.prototype,"defaultPopupTemplate",null),(0,p._)([(0,b.Cb)({readOnly:!0,type:[$.Z]})],gt.prototype,"fields",void 0),(0,p._)([(0,b.Cb)({readOnly:!0,type:[$.Z]})],gt.prototype,"rasterFields",null),(0,p._)([(0,b.Cb)({types:m.dr,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:function(){var e,t="raster-stretch"===(null==(e=this.renderer)?void 0:e.type)&&"none"===this.renderer.stretchType&&!this.renderer.useGamma;return{enabled:!this.loaded||"Raster"===this.raster.tileType||!t}}},origins:{"web-scene":{types:m.FK,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:function(e){return{enabled:e&&"vector-field"!==e.type&&"animated-flow"!==e.type}}}}}}})],gt.prototype,"renderer",null),(0,p._)([(0,k.r)("renderer")],gt.prototype,"readRenderer",null);var bt=gt=(0,p._)([(0,R.j)("esri.layers.ImageryTileLayer")],gt)}}]);
//# sourceMappingURL=9320-f8e7bbd0de4e0b78e6a3.js.map