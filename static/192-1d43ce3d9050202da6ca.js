"use strict";(self.webpackChunkenergy_and_water_dashboard=self.webpackChunkenergy_and_water_dashboard||[]).push([[192],{192:function(e,t,r){r.r(t),r.d(t,{default:function(){return ie}});var i=r(15861),n=r(15671),a=r(43144),s=r(60136),u=r(6215),o=r(61120),c=r(87757),l=r.n(c),p=r(83195),h=r(83241),y=r(89636),d=(r(43079),r(33682),r(64003),r(30732)),f=r(2103),v=r(17396),m=r(29439),w=r(9340),g=r(51916),x=r(79417),b=r(75571),_=r(10173),k=r(37566),R=r(17418),Z=r(59007),V=r(24748),C=r(18521),E=r(74023),P=r(30032),q=r(75679),D=r(74649);function B(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=(0,o.Z)(e);if(t){var n=(0,o.Z)(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return(0,u.Z)(this,r)}}var I=b.Z.getLogger("esri.views.2d.layers.imagery.ImageryGraphicsView2D"),S=function(e){(0,s.Z)(u,e);var t,r=B(u);function u(){var e;return(0,n.Z)(this,u),(e=r.apply(this,arguments)).attached=!1,e.container=new P.W,e.updateRequested=!1,e._graphicsView=null,e._projectFullExtentPromise=null,e._dataParameters={exportParametersVersion:0,extents:[],tileResolution:0,time:"",isOceanStyle:!1,isOceanographic:!1},e.type="Graphics",e._graphics=new E.J,e._updateGraphics=(0,k.Ds)(function(){var t=(0,i.Z)(l().mark((function t(r,i){var n,a,s,u,o,c,p,h,y,d,f,v,w,g,x,b,k,R,V,E,P,q;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.stationary){t.next=2;break}return t.abrupt("return");case 2:return n=r.state,a=new Z.Z({xmin:n.extent.xmin,ymin:n.extent.ymin,xmax:n.extent.xmax,ymax:n.extent.ymax,spatialReference:n.spatialReference}),s=(0,m.Z)(r.state.size,2),u=s[0],o=s[1],(c={}).timeExtent=e.timeExtent,c.requestAsImageElement=!1,c.signal=i,null==e._projectFullExtentPromise&&(e._projectFullExtentPromise=e._getProjectedFullExtent(a.spatialReference)),p="vector-field"===e.layer.renderer.type?e.layer.renderer.symbolTileSize:50,t.next=7,e._projectFullExtentPromise;case 7:return h=t.sent,y=(0,C.BH)(a,u,o,p,h),d=y.extent,f=y.resolution,v=y.width,w=y.height,t.next=15,e.layer.fetchImage(d,v,w,c);case 15:if(g=t.sent,"vector-field"!==(x=e.layer.renderer).type){t.next=28;break}return b=g.pixelData.pixelBlock,k=x.sizeVariables[0],!(0,_.pC)(b)||k.minDataValue&&k.maxDataValue||(k.minDataValue=b.statistics[0].minValue,k.maxDataValue=b.statistics[0].maxValue),e._pixelData={extent:d,pixelBlock:b},R=d.clone().normalize(),V={exportParametersVersion:e.layer.exportImageServiceParameters.version,extents:R,tileResolution:f,time:JSON.stringify(e.timeExtent||""),isOceanStyle:"flow-to"===x.flowRepresentation,isOceanographic:"ocean-current-kn"===x.style||"ocean-current-m"===x.style},E=e._canReuseVectorFieldData(V)?e._dataParameters.extents:[],t.next=25,x.getGraphicsFromPixelData(g.pixelData,"vector-uv"===e.layer.rasterInfo.dataType,E);case 25:P=t.sent,E.length?(q=e._graphics.items.filter((function(e){return(0,_.pC)(e.geometry)&&E.some((function(t){return t.intersects(e.geometry)}))&&!R.some((function(t){return t.intersects(e.geometry)}))})),e._graphics.removeMany(q),e._graphics.addMany(P)):e._graphics.set("items",P),e._graphicsView.update(r),e._dataParameters=V;case 28:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()),e}return(0,a.Z)(u,[{key:"destroy",value:function(){this.attached&&(this.detach(),this.attached=!1),this.updateRequested=!1}},{key:"updating",get:function(){return!this.attached||this.isUpdating()}},{key:"update",value:function(e){this._updateGraphics(e).catch((function(e){(0,k.D_)(e)||I.error(e)}))}},{key:"hitTest",value:function(e){return new w.Z({attributes:{},geometry:e.clone(),layer:this.layer})}},{key:"attach",value:function(){var e=this;this._graphicsView=new D.Z({view:this.view,graphics:this._graphics,requestUpdateCallback:function(){return e.requestUpdate()},container:new q.Z(this.view.featuresTilingScheme)}),this.attached=!0}},{key:"detach",value:function(){this._graphics.destroy(),this._graphicsView.destroy(),this.container.removeChild(this._graphicsView.container),this._graphicsView=null}},{key:"install",value:function(e){this.container.addChild(this._graphicsView.container),e.addChild(this.container)}},{key:"uninstall",value:function(e){this.container.removeChild(this._graphicsView.container),e.removeChild(this.container)}},{key:"isUpdating",value:function(){return this._graphicsView.updating||this.updateRequested}},{key:"getPixelData",value:function(){return this.updating?null:this._pixelData}},{key:"redraw",value:function(){}},{key:"requestUpdate",value:function(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())}},{key:"_getProjectedFullExtent",value:(t=(0,i.Z)(l().mark((function e(t){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,V.tB)(this.layer.fullExtent,t);case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),e.prev=8,e.next=11,(0,g.default)(this.layer.url,{query:{option:"footprints",outSR:t.wkid||JSON.stringify(t.toJSON()),f:"json"}});case 11:return r=e.sent.data.featureCollection.layers[0].layerDefinition.extent,e.abrupt("return",r?Z.Z.fromJSON(r):null);case 15:return e.prev=15,e.t1=e.catch(8),e.abrupt("return",null);case 18:case"end":return e.stop()}}),e,this,[[0,6],[8,15]])}))),function(e){return t.apply(this,arguments)})},{key:"_canReuseVectorFieldData",value:function(e){var t=this._dataParameters.exportParametersVersion===e.exportParametersVersion,r=this._dataParameters.time===e.time,i=Math.abs(this._dataParameters.tileResolution-e.tileResolution)/e.tileResolution<.01,n=this._dataParameters.extents.some((function(t){return e.extents.some((function(e){return t.intersects(e)}))})),a=this._dataParameters.isOceanStyle===e.isOceanStyle,s=this._dataParameters.isOceanographic===e.isOceanographic;return t&&r&&i&&n&&a&&s}}]),u}(x.Z);(0,p._)([(0,y.Cb)()],S.prototype,"attached",void 0),(0,p._)([(0,y.Cb)()],S.prototype,"container",void 0),(0,p._)([(0,y.Cb)()],S.prototype,"layer",void 0),(0,p._)([(0,y.Cb)()],S.prototype,"timeExtent",void 0),(0,p._)([(0,y.Cb)()],S.prototype,"view",void 0),(0,p._)([(0,y.Cb)()],S.prototype,"updateRequested",void 0),(0,p._)([(0,y.Cb)()],S.prototype,"updating",null),(0,p._)([(0,R.J)({graphics:"Graphics"})],S.prototype,"type",void 0);var U=S=(0,p._)([(0,d.j)("esri.views.2d.layers.imagery.ImageryGraphicsView2D")],S),O=r(7665),F=r(57047),T=r(19253),M=r(99092);function j(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=(0,o.Z)(e);if(t){var n=(0,o.Z)(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return(0,u.Z)(this,r)}}var G=b.Z.getLogger("esri.views.2d.layers.imagery.ImageryView2D"),J=function(e){(0,s.Z)(r,e);var t=j(r);function r(){var e;return(0,n.Z)(this,r),(e=t.apply(this,arguments)).attached=!1,e.container=new P.W,e.updateRequested=!1,e.type="Imagery",e._bitmapView=null,e}return(0,a.Z)(r,[{key:"destroy",value:function(){this.attached&&(this.detach(),this.attached=!1),this.updateRequested=!1}},{key:"updating",get:function(){return!this.attached||this.isUpdating()}},{key:"update",value:function(e){this.strategy.update(e).catch((function(e){(0,k.D_)(e)||G.error(e)}))}},{key:"detach",value:function(){this.strategy.destroy(),this._bitmapView.removeAllChildren(),this.container.removeAllChildren()}},{key:"hitTest",value:function(e){return new w.Z({attributes:{},geometry:e.clone(),layer:this.layer})}},{key:"attach",value:function(){var e=this,t=this.layer.version>=10,r=this.layer.version>=10.1?this.layer.imageMaxHeight:2048,i=this.layer.version>=10.1?this.layer.imageMaxWidth:2048;this._bitmapView=new F.c,this.strategy=new M.Z({container:this._bitmapView,imageNormalizationSupported:t,imageMaxHeight:r,imageMaxWidth:i,fetchSource:this._fetchImage.bind(this),requestUpdate:function(){return e.requestUpdate()}}),this.attached=!0}},{key:"install",value:function(e){this.container.addChild(this._bitmapView),e.addChild(this.container)}},{key:"uninstall",value:function(e){this.container.removeChild(this._bitmapView),e.removeChild(this.container)}},{key:"redraw",value:function(){var e=this;this.strategy.updateExports((function(t){t.source instanceof HTMLImageElement?t.requestRender():e.layer.applyRenderer({pixelBlock:t.source.pixelBlock}).then((function(r){var i=t.source;i.pixelBlock=r.pixelBlock,i.filter=function(t){return e.layer.applyFilter(t)},e.container.requestRender()}))}))}},{key:"requestUpdate",value:function(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())}},{key:"isUpdating",value:function(){return this.strategy.updating||this.updateRequested}},{key:"getPixelData",value:function(){if(this.updating)return null;var e=this.strategy.bitmaps;if(1===e.length&&e[0].source)return{extent:e[0].source.extent,pixelBlock:e[0].source.originalPixelBlock};if(e.length>1){var t=this.view.extent,r=e.map((function(e){return e.source})).filter((function(e){return e.extent&&e.extent.intersects(t)})).map((function(e){return{extent:e.extent,pixelBlock:e.originalPixelBlock}})),i=(0,O.Kh)(r,t);return(0,_.pC)(i)?{extent:i.extent,pixelBlock:i.pixelBlock}:null}return null}},{key:"_fetchImage",value:function(e,t,r,i){var n=this;return(i=i||{}).timeExtent=this.timeExtent,i.requestAsImageElement=!0,this.layer.fetchImage(e,t,r,i).then((function(e){return e.imageElement?e.imageElement:n.layer.applyRenderer(e.pixelData,{signal:i.signal}).then((function(t){var r=new T.Z(t.pixelBlock,t.extent.clone(),e.pixelData.pixelBlock);return r.filter=function(e){return n.layer.applyFilter(e)},r}))}))}}]),r}(x.Z);(0,p._)([(0,y.Cb)()],J.prototype,"attached",void 0),(0,p._)([(0,y.Cb)()],J.prototype,"container",void 0),(0,p._)([(0,y.Cb)()],J.prototype,"layer",void 0),(0,p._)([(0,y.Cb)()],J.prototype,"strategy",void 0),(0,p._)([(0,y.Cb)()],J.prototype,"timeExtent",void 0),(0,p._)([(0,y.Cb)()],J.prototype,"view",void 0),(0,p._)([(0,y.Cb)()],J.prototype,"updateRequested",void 0),(0,p._)([(0,y.Cb)()],J.prototype,"updating",null),(0,p._)([(0,R.J)({imagery:"Imagery"})],J.prototype,"type",void 0);var N=J=(0,p._)([(0,d.j)("esri.views.2d.layers.imagery.ImageryView2D")],J),z=r(11752),H=r(33300),L=r(5224),A=r(44946),W=r(56100),K=r(1815);function Y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=(0,o.Z)(e);if(t){var n=(0,o.Z)(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return(0,u.Z)(this,r)}}var Q=r(43798),X=r(51785);function $(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=(0,o.Z)(e);if(t){var n=(0,o.Z)(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return(0,u.Z)(this,r)}}var ee,te,re=function(e){(0,s.Z)(o,e);var t,r,u=$(o);function o(){var e;return(0,n.Z)(this,o),(e=u.apply(this,arguments))._exportImageVersion=-1,e}return(0,a.Z)(o,[{key:"initialize",value:function(){var e=this;this.handles.add([(0,h.S1)(this,["layer.blendMode","layer.effects"],(function(t){e.subview&&(e.subview.container.blendMode=t)}),!0),(0,h.S1)(this,"layer.effect",(function(t){e.subview&&(e.subview.container.effect=t)}),!0)])}},{key:"pixelData",get:function(){return this.updating?null:"getPixelData"in this.subview?this.subview.getPixelData():null}},{key:"updating",get:function(){return!!(!this.subview||"updating"in this.subview&&this.subview.updating)}},{key:"hitTest",value:(r=(0,i.Z)(l().mark((function e(t,r){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.subview?"hitTest"in this.subview?[this.subview.hitTest(t)]:[]:null);case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"update",value:function(e){var t;null==(t=this.subview)||t.update(e)}},{key:"attach",value:function(){var e=this;this.layer.increaseRasterJobHandlerUsage(),this._setSubView(),this.handles.add([(0,h.S1)(this,"layer.exportImageServiceParameters.version",(function(t){e._exportImageVersion!==t&&(e._exportImageVersion=t,e.requestUpdate())})),this.watch("timeExtent",(function(){"timeExtent"in e.subview&&(e.subview.timeExtent=e.timeExtent),e.requestUpdate()})),this.layer.on("redraw",(function(){"redraw"in e.subview?e.subview.redraw():e.subview.redrawOrRefetch()})),(0,h.YP)(this.layer,"renderer",(function(){return e._setSubView()}))],"imagerylayerview-update")}},{key:"detach",value:function(){this.layer.decreaseRasterJobHandlerUsage(),this.subview.destroy(),this.handles.remove("imagerylayerview-update"),this._exportImageVersion=-1}},{key:"moveStart",value:function(){}},{key:"viewChange",value:function(){}},{key:"moveEnd",value:function(){this.requestUpdate()}},{key:"doRefresh",value:(t=(0,i.Z)(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.requestUpdate();case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"isUpdating",value:function(){return!this.subview||!this.suspended&&this.subview.updating}},{key:"_setSubView",value:function(){var e,t,r,i,n="Imagery";"vector-field"===(null==(e=this.layer.renderer)?void 0:e.type)&&"lerc"===this.layer.format&&(n="Graphics"),"animated-flow"===(null==(t=this.layer.renderer)?void 0:t.type)&&(n="Flow"),this.subview&&this.subview.type===n||(null==(r=this.subview)||r.uninstall(this.container),null==(i=this.subview)||i.destroy(),this.subview="Imagery"===n?new N({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):"Graphics"===n?new U({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):new f.Z({layer:this.layer,layerView:this}),this.subview.attach(),this.subview.install(this.container),this.subview.container.blendMode=this.layer.blendMode,this.subview.container.effect=this.layer.effect),this.requestUpdate()}}]),o}((ee=(0,X.y)((0,v.y)(Q.Z)),te=function(e){(0,s.Z)(u,e);var t,r=Y(u);function u(){var e;return(0,n.Z)(this,u),(e=r.apply(this,arguments)).view=null,e}return(0,a.Z)(u,[{key:"fetchPopupFeatures",value:(t=(0,i.Z)(l().mark((function e(t,r){var i,n,a,s,u,o,c,p,h,y,d;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.layer,t){e.next=3;break}throw new H.Z("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:i});case 3:if(n=i.popupEnabled,a=(0,K.V)(i,r),n&&(0,_.pC)(a)){e.next=6;break}throw new H.Z("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:n,popupTemplate:a});case 6:return e.next=8,a.getRequiredFields();case 8:return s=e.sent,(u=new W.Z).timeExtent=this.timeExtent,u.geometry=t,u.outFields=s,u.outSpatialReference=t.spatialReference,o=this.view.resolution,c="2d"===this.view.type?new L.Z(o,o,this.view.spatialReference):new L.Z(.5*o,.5*o,this.view.spatialReference),p=a.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},h=p.returnTopmostRaster,y=p.showNoDataRecords,d={returnDomainValues:!0,returnTopmostRaster:h,pixelSize:c,showNoDataRecords:y,signal:(0,_.pC)(r)?r.signal:null},e.abrupt("return",i.queryVisibleRasters(u,d).then((function(e){return e})));case 13:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})},{key:"canResume",value:function(){var e;return!(!(0,z.Z)((0,o.Z)(u.prototype),"canResume",this).call(this)||null!=(e=this.timeExtent)&&e.isEmpty)}}]),u}(ee),(0,p._)([(0,y.Cb)()],te.prototype,"layer",void 0),(0,p._)([(0,y.Cb)()],te.prototype,"suspended",void 0),(0,p._)([(0,y.Cb)(A.qG)],te.prototype,"timeExtent",void 0),(0,p._)([(0,y.Cb)()],te.prototype,"view",void 0),te=(0,p._)([(0,d.j)("esri.views.layers.ImageryLayerView")],te)));(0,p._)([(0,y.Cb)()],re.prototype,"pixelData",null),(0,p._)([(0,y.Cb)({readOnly:!0})],re.prototype,"updating",null),(0,p._)([(0,y.Cb)()],re.prototype,"subview",void 0);var ie=re=(0,p._)([(0,d.j)("esri.views.2d.layers.ImageryLayerView2D")],re)}}]);
//# sourceMappingURL=192-1d43ce3d9050202da6ca.js.map