"use strict";(self.webpackChunkenergy_and_water_dashboard=self.webpackChunkenergy_and_water_dashboard||[]).push([[1161],{81161:function(e,t,r){r.r(t),r.d(t,{default:function(){return ce}});var n=r(15861),i=r(15671),s=r(43144),a=r(11752),u=r(60136),o=r(6215),f=r(61120),h=r(87757),c=r.n(h),l=r(83195),d=r(33682),y=r(37566),_=(r(75571),r(64003),r(43079),r(97182),r(30732)),v=r(22983),p=r(62560),g=r(10173),k=r(87637),m=r(24566),b=r(66657),x=r(70916),w=r(4761),E=r(52917),C=r(48),A=4294967296,S=function(){function e(t){(0,i.Z)(this,e),this._head=t,this._cursor=t}return(0,s.Z)(e,[{key:"id",get:function(){return this._cursor.id}},{key:"baseZoom",get:function(){return this._cursor.baseZoom}},{key:"anchorX",get:function(){return this._cursor.anchorX}},{key:"anchorY",get:function(){return this._cursor.anchorY}},{key:"directionX",get:function(){return this._cursor.directionX}},{key:"directionY",get:function(){return this._cursor.directionY}},{key:"size",get:function(){return this._cursor.size}},{key:"materialKey",get:function(){return this._cursor.materialKey}},{key:"boundsCount",get:function(){return this._cursor.boundsCount}},{key:"computedMinZoom",value:function(){return this._cursor.computedMinZoom()}},{key:"setComputedMinZoom",value:function(e){return this._cursor.setComputedMinZoom(e)}},{key:"boundsComputedAnchorX",value:function(e){return this._cursor.boundsComputedAnchorX(e)}},{key:"boundsComputedAnchorY",value:function(e){return this._cursor.boundsComputedAnchorY(e)}},{key:"setBoundsComputedAnchorX",value:function(e,t){return this._cursor.setBoundsComputedAnchorX(e,t)}},{key:"setBoundsComputedAnchorY",value:function(e,t){return this._cursor.setBoundsComputedAnchorY(e,t)}},{key:"boundsX",value:function(e){return this._cursor.boundsX(e)}},{key:"boundsY",value:function(e){return this._cursor.boundsY(e)}},{key:"boundsWidth",value:function(e){return this._cursor.boundsWidth(e)}},{key:"boundsHeight",value:function(e){return this._cursor.boundsHeight(e)}},{key:"link",value:function(e){if((0,g.pC)(e._head))return this._cursor.link(e._head)}},{key:"getCursor",value:function(){return this.copy()}},{key:"copy",value:function(){var t,r=new e(null==(t=this._head)?void 0:t.copy());if(!r._head)return r;for(var n=r._head,i=r._head._link;i;)n._link=i.copy(),i=(n=i)._link;return r}},{key:"peekId",value:function(){var e;return null!=(e=this._cursor.peekId())?e:this._cursor._link.peekId()}},{key:"nextId",value:function(){for(var e=this.id;e===this.id;)if(!this.next())return!1;return!0}},{key:"save",value:function(){this._savedCursor=this._cursor,this._savedOffset=this._cursor._offset}},{key:"restore",value:function(){this._cursor=this._savedCursor,this._cursor._offset=this._savedOffset}},{key:"next",value:function(){if(!this._cursor)return!1;if(!this._cursor.next()){if(!this._cursor._link)return!1;this._cursor=this._cursor._link,this._cursor._offset=0}return!0}},{key:"lookup",value:function(e){for(this._cursor=this._head;this._cursor&&!this._cursor.lookup(e);){if(!this._cursor._link)return!1;this._cursor=this._cursor._link}return!!this._cursor}},{key:"delete",value:function(e){for(var t=this._head,r=null;t;){if(t.delete(e))return t.isEmpty()&&(0,g.pC)(r)&&(r._link=t._link),!0;r=t,t=t._link}return!1}}],[{key:"from",value:function(t){return new e(T.from(new Float32Array(t)))}}]),e}(),T=function(){function e(t){(0,i.Z)(this,e),this._offset=-1,this._link=null,this._count=0,this._deletedCount=0,this._offsets={instance:null},this._buffer=t}return(0,s.Z)(e,[{key:"isEmpty",value:function(){return this._deletedCount===this.count}},{key:"count",get:function(){return this._count||(this._count=this._computeCount()),this._count}},{key:"id",get:function(){return this._buffer[this._offset+0]},set:function(e){this._buffer[this._offset+0]=e}},{key:"baseZoom",get:function(){return this._buffer[this._offset+1]}},{key:"anchorX",get:function(){return this._buffer[this._offset+2]}},{key:"anchorY",get:function(){return this._buffer[this._offset+3]}},{key:"directionX",get:function(){return this._buffer[this._offset+4]}},{key:"directionY",get:function(){return this._buffer[this._offset+5]}},{key:"size",get:function(){return this._buffer[this._offset+6]}},{key:"materialKey",get:function(){return this._buffer[this._offset+7]}},{key:"computedMinZoom",value:function(){return this._buffer[this._offset+8]}},{key:"setComputedMinZoom",value:function(e){this._buffer[this._offset+8]=e}},{key:"boundsCount",get:function(){return this._buffer[this._offset+9]}},{key:"boundsComputedAnchorX",value:function(e){return this._buffer[this._offset+10+6*e+0]}},{key:"boundsComputedAnchorY",value:function(e){return this._buffer[this._offset+10+6*e+1]}},{key:"setBoundsComputedAnchorX",value:function(e,t){this._buffer[this._offset+10+6*e+0]=t}},{key:"setBoundsComputedAnchorY",value:function(e,t){this._buffer[this._offset+10+6*e+1]=t}},{key:"boundsX",value:function(e){return this._buffer[this._offset+10+6*e+2]}},{key:"boundsY",value:function(e){return this._buffer[this._offset+10+6*e+3]}},{key:"boundsWidth",value:function(e){return this._buffer[this._offset+10+6*e+4]}},{key:"boundsHeight",value:function(e){return this._buffer[this._offset+10+6*e+5]}},{key:"link",value:function(e){for(var t=this;t._link;)t=t._link;t._link=e}},{key:"getCursor",value:function(){return this.copy()}},{key:"copy",value:function(){var t=new e(this._buffer);return t._link=this._link,t._offset=this._offset,t._deletedCount=this._deletedCount,t._offsets=this._offsets,t._count=this._count,t}},{key:"peekId",value:function(){var e=this._offset+10+6*this.boundsCount+0;return e>=this._buffer.length?0:this._buffer[e]}},{key:"next",value:function(){for(var e=0;this._offset<this._buffer.length&&e++<100&&(-1===this._offset?this._offset=0:this._offset+=10+6*this.boundsCount,this.id===A););return this.id!==A&&this._offset<this._buffer.length}},{key:"delete",value:function(e){var t=this._offset,r=this.lookup(e);if(r)for(this.id=4294967295,++this._deletedCount;this.next()&&this.id===e;)this.id=4294967295,++this._deletedCount;return this._offset=t,r}},{key:"lookup",value:function(e){var t=this._offset;if((0,g.Wi)(this._offsets.instance)){this._offsets.instance=new Map;var r=this.copy();r._offset=-1;for(var n=0;r.next();)r.id!==n&&(this._offsets.instance.set(r.id,r._offset),n=r.id)}return!!this._offsets.instance.has(e)&&(this._offset=this._offsets.instance.get(e),this.id!==A||(this._offset=t,!1))}},{key:"_computeCount",value:function(){var e=this._offset,t=0;for(this._offset=-1;this.next();)t++;return this._offset=e,t}}],[{key:"from",value:function(t){return new e(new Float32Array(t))}}]),e}(),Z=function(){function e(t){if((0,i.Z)(this,e),Array.isArray(t)){this.data=t[0];for(var r=this,n=1;n<t.length;n++)r.next=new e([t[n]]),r=r.next}else this.data=t}return(0,s.Z)(e,[{key:"values",value:c().mark((function e(){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this;case 1:if(!t){e.next=7;break}return e.next=4,t.data;case 4:t=t.next;case 5:e.next=1;break;case 7:case"end":return e.stop()}}),e,this)}))},{key:"forEach",value:function(e){for(var t=this;t;)e(t.data),t=t.next}},{key:"find",value:function(e){var t;return e(this.data)?this:null==(t=this.next)?void 0:t.find(e)}},{key:"max",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this,r=e(this.data)>e(t.data)?this:t;return this.next?this.next.max(e,r):r}},{key:"remove",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this===e?t?(t.next=this.next,t):this.next:this.next.remove(e,this)}},{key:"last",get:function(){return this.next?this.next.last:this}}]),e}(),B=function(){function e(t){(0,i.Z)(this,e),this._head=null,(0,g.Wi)(t)||(this._head=new Z(t))}return(0,s.Z)(e,[{key:"head",get:function(){return this._head}},{key:"maxAvailableSpace",value:function(){if((0,g.Wi)(this._head))return 0;var e=this._head.max((function(e){return e.end-e.start}));return e.data.end-e.data.start}},{key:"firstFit",value:function(e){if((0,g.Wi)(this._head))return null;for(var t=null,r=this._head;r;){var n=r.data.end-r.data.start;if(n===e)return t?t.next=r.next:this._head=r.next,r.data.start;if(n>e){var i=r.data.start;return r.data.start+=e,i}t=r,r=r.next}return null}},{key:"free",value:function(e,t){var r=e+t;if((0,g.Wi)(this._head)){var n=new Z({start:e,end:r});this._head=n}else{if(r<=this._head.data.start){if(r===this._head.data.start)return void(this._head.data.start-=t);var i=new Z({start:e,end:r});return i.next=this._head,void(this._head=i)}for(var s=this._head,a=s.next;a;){if(a.data.start>=r){if(s.data.end===e){if(s.data.end+=t,s.data.end===a.data.start){var u=a.data.end-a.data.start;return s.data.end+=u,void(s.next=a.next)}return}if(a.data.start===r)return void(a.data.start-=t);var o=new Z({start:e,end:r});return o.next=s.next,void(s.next=o)}s=a,a=a.next}if(e!==s.data.end){var f=new Z({start:e,end:r});s.next=f}else s.data.end+=t}}}]),e}();function V(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return L(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return L(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){u=!0,s=e},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw s}}}}function L(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var I=function(){function e(t,r,n,s,a){(0,i.Z)(this,e),this.target=t,this.geometryType=r,this.materialKey=n,this.indexFrom=s,this.indexCount=a}return(0,s.Z)(e,[{key:"indexEnd",get:function(){return this.indexFrom+this.indexCount}},{key:"extend",value:function(e){this.indexCount+=e}},{key:"draw",value:function(e,t,r){this.target.draw(e,t,r,this.indexFrom,this.indexCount)}}]),e}(),M=function(){function e(t,r){(0,i.Z)(this,e),this.geometryType=0,this._target=t,this.geometryType=r}return(0,s.Z)(e,[{key:"addRecord",value:function(e){var t=this._target,r=this.geometryType,n=e.materialKey,i=e.indexFrom,s=e.indexCount;if((0,g.Wi)(this._head)){var a=new I(t,r,n,i,s);this._head=new Z(a)}else{for(var u=null,o=this._head;o;){if(i<o.data.indexFrom)return this._insert(n,i,s,u,o);u=o,o=o.next}this._insert(n,i,s,u,null)}}},{key:"forEach",value:function(e){(0,g.pC)(this._head)&&this._head.forEach(e)}},{key:"infos",value:c().mark((function e(){var t,r,n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,g.pC)(this._head)){e.next=18;break}t=V(this._head.values()),e.prev=2,t.s();case 4:if((r=t.n()).done){e.next=10;break}return n=r.value,e.next=8,n;case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),t.e(e.t0);case 15:return e.prev=15,t.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])}))},{key:"_insert",value:function(e,t,r,n,i){if((0,g.Wi)(n)&&(0,g.Wi)(i)){var s=new I(this._target,this.geometryType,e,t,r);this._head=new Z(s)}return(0,g.Wi)(n)&&(0,g.pC)(i)?this._insertAtHead(e,t,r,i):(0,g.pC)(n)&&(0,g.Wi)(i)?this._insertAtEnd(e,t,r,n):(0,g.pC)(n)&&(0,g.pC)(i)?this._insertAtMiddle(e,t,r,n,i):void 0}},{key:"_insertAtHead",value:function(e,t,r,n){var i=t+r;if(e===n.data.materialKey&&i===n.data.indexFrom)n.data.indexFrom=t,n.data.indexCount+=r;else{var s=new I(this._target,this.geometryType,e,t,r);this._head=new Z(s),this._head.next=n}}},{key:"_insertAtEnd",value:function(e,t,r,n){if(n.data.materialKey===e&&n.data.indexEnd===t)n.data.indexCount+=r;else{var i=new I(this._target,this.geometryType,e,t,r),s=new Z(i);n.next=s}}},{key:"_insertAtMiddle",value:function(e,t,r,n,i){var s=t+r;if(n.data.materialKey===e&&n.data.indexEnd===t)n.data.indexCount+=r,n.data.materialKey===i.data.materialKey&&n.data.indexEnd===i.data.indexFrom&&(n.data.indexCount+=i.data.indexCount,n.next=i.next);else if(e===i.data.materialKey&&s===i.data.indexFrom)i.data.indexFrom=t,i.data.indexCount+=r;else{var a=new I(this._target,this.geometryType,e,t,r),u=new Z(a);n.next=u,u.next=i}}}],[{key:"from",value:function(t,r,n,i){var s=new e(t,r);if((0,g.pC)(i)){var a,u=V(i);try{for(u.s();!(a=u.n()).done;){var o=a.value;n.seekIndex(o),s.addRecord(n)}}catch(f){u.e(f)}finally{u.f()}}else for(;n.next();)s.addRecord(n);return s}}]),e}(),R=r(199),U=(r(64994),r(60183),r(42572),r(56947),r(3776),r(48604));function P(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return F(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return F(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){u=!0,s=e},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw s}}}}function F(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var W=(0,d.Z)("esri-2d-log-allocations"),q=function(){function e(t){(0,i.Z)(this,e),this._array=t}return(0,s.Z)(e,[{key:"array",get:function(){return this._array}},{key:"length",get:function(){return this._array.length}},{key:"expand",value:function(e){var t=j.acquire(e);t.set(this._array),j.release(this._array),this._array=t}},{key:"destroy",value:function(){j.release(this._array)}},{key:"set",value:function(e,t){this._array.set(e._array,t)}},{key:"slice",value:function(){var t=j.acquire(this._array.byteLength);return t.set(this._array),new e(t)}}],[{key:"create",value:function(t){return new e(j.acquire(t))}}]),e}(),Y=function(){function e(){(0,i.Z)(this,e),this._data=new ArrayBuffer(e.BYTE_LENGTH),this._freeList=new B({start:0,end:this._data.byteLength})}return(0,s.Z)(e,[{key:"buffer",get:function(){return this._data}},{key:"allocate",value:function(e){var t=this._freeList.firstFit(e);return(0,g.Wi)(t)?null:new Uint32Array(this._data,t,e/Uint32Array.BYTES_PER_ELEMENT)}},{key:"free",value:function(e){this._freeList.free(e.byteOffset,e.byteLength)}}],[{key:"BYTE_LENGTH",get:function(){return 64e6}}]),e}(),O=function(){function e(){(0,i.Z)(this,e),this._bytesAllocated=0,this._pages=[],this._pagesByBuffer=new Map,this._addPage()}return(0,s.Z)(e,[{key:"_bytesTotal",get:function(){return this._pages.length*Y.BYTE_LENGTH}},{key:"acquire",value:function(e){if(this._bytesAllocated+=e,W&&console.log("Allocating ".concat(e,", (").concat(this._bytesAllocated," / ").concat(this._bytesTotal,")")),e>Y.BYTE_LENGTH)return new Uint32Array(e/Uint32Array.BYTES_PER_ELEMENT);var t,r=P(this._pages);try{for(r.s();!(t=r.n()).done;){var n=t.value.allocate(e);if((0,g.pC)(n))return n}}catch(i){r.e(i)}finally{r.f()}return(0,g.s3)(this._addPage().allocate(e),"Expected to allocate page")}},{key:"release",value:function(e){this._bytesAllocated-=e.byteLength,W&&console.log("Freeing ".concat(e.byteLength,", (").concat(this._bytesAllocated," / ").concat(this._bytesTotal,")"));var t=this._pagesByBuffer.get(e.buffer);t&&t.free(e)}},{key:"_addPage",value:function(){var e=new Y;return this._pages.push(e),this._pagesByBuffer.set(e.buffer,e),e}}]),e}(),j=new O,K=function(){function e(t,r,n){(0,i.Z)(this,e);var s=q.create(r*n*Uint32Array.BYTES_PER_ELEMENT);this.strideInt=n,this.bufferType=t,this.dirty={start:1/0,end:0},this.gpu=null,this._cpu=s,this.clear()}return(0,s.Z)(e,[{key:"elementSize",get:function(){return this._cpu.length/this.strideInt}},{key:"destroy",value:function(){(0,g.Po)(this.gpu,(function(e){return e.dispose()})),(0,g.Po)(this._cpu,(function(e){return e.destroy()})),(0,g.Po)(this._cpu2,(function(e){return e.destroy()}))}},{key:"clear",value:function(){this.dirty.start=1/0,this.dirty.end=0,this.freeList=new B({start:0,end:this._cpu.length/this.strideInt}),this.fillPointer=0}},{key:"ensure",value:function(e){if(!(this.maxAvailableSpace()>=e)&&e*this.strideInt>this._cpu.length-this.fillPointer){(0,g.pC)(this.gpu)&&(this.gpu=null);var t=this._cpu.length/this.strideInt,r=Math.round(1.25*(t+e)),n=r*this.strideInt;this._cpu.expand(n*Uint32Array.BYTES_PER_ELEMENT),this.freeList.free(t,r-t)}}},{key:"set",value:function(e,t){this._cpu.array[e]!==t&&(this._cpu.array[e]=t,this.dirty.start=Math.min(e,this.dirty.start),this.dirty.end=Math.max(e,this.dirty.end))}},{key:"getBuffer",value:function(){if(!this._cpu2){var e=this._cpu.slice();this._cpu2=e}return this._cpu2.length!==this._cpu.length&&this._cpu2.expand(this._cpu.length*this._cpu.array.BYTES_PER_ELEMENT),this._cpu2.set(this._cpu),this._cpu2}},{key:"bufferSize",get:function(){return this._cpu.length/this.strideInt}},{key:"maxAvailableSpace",value:function(){return this.freeList.maxAvailableSpace()}},{key:"insert",value:function(e,t,r,n){var i=r*this.strideInt,s=t*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,a=new Uint32Array(e,s,i),u=(0,g.s3)(this.freeList.firstFit(r),"First fit region must be defined")*this.strideInt,o=i,f=u/this.strideInt-t;if(0!==n)for(var h=0;h<a.length;h++)a[h]+=n;return this._cpu.array.set(a,u),this.dirty.start=Math.min(this.dirty.start,u),this.dirty.end=Math.max(this.dirty.end,u+o),this.fillPointer=Math.max(this.fillPointer,u+o),f}},{key:"free",value:function(e,t,r){var n=e*this.strideInt,i=(e+t)*this.strideInt;if(!0===r)for(var s=e;s!==e+t;s++)this._cpu.array[s*this.strideInt]=2147450879;this.dirty.start=Math.min(this.dirty.start,n),this.dirty.end=Math.max(this.dirty.end,i),this.freeList.free(e,t)}},{key:"upload",value:function(e){if(this.dirty.end){if((0,g.Wi)(this.gpu))return this.gpu=this._createBuffer(e),this.dirty.start=1/0,void(this.dirty.end=0);this.gpu.setSubDataFromView(this._cpu.array,this.dirty.start,this.dirty.start,this.dirty.end),this.dirty.start=1/0,this.dirty.end=0}}},{key:"_createBuffer",value:function(e){return"index"===this.bufferType?R.Z.createIndex(e,35048,this._cpu.array):R.Z.createVertex(e,35048,this._cpu.array)}}]),e}(),X=r(53504);function z(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return H(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return H(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){u=!0,s=e},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw s}}}}function H(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var N=function(){function e(t,r){(0,i.Z)(this,e),this._indicesInvalid=!1,this.geometryType=t}return(0,s.Z)(e,[{key:"destroy",value:function(){this._vao&&(this._vao.dispose(),this._vao=null),this._indexBuffer&&this._indexBuffer.destroy(),this._vertexBuffer&&this._vertexBuffer.destroy()}},{key:"insert",value:function(e,t,r){if(e.records.byteLength){var n=e.stride;if(this._vertexBuffer&&this._indexBuffer){var i=e.indices.byteLength/4,s=e.vertices.byteLength/n;this._indexBuffer.ensure(i),this._vertexBuffer.ensure(s);var a=e.vertices,u=e.indices,o=X.$.from(e.records),f=this._vertexBuffer.insert(a,0,a.byteLength/n,0),h=this._indexBuffer.insert(u,0,u.byteLength/4,f);if(o.forEach((function(e){e.indexFrom+=h,e.vertexFrom+=f})),(0,g.s3)(this._records,"Expected records to be defined").link(o),t)this._indicesInvalid=!0;else if(this._displayList)for(var c=o.getCursor();c.next();)this._displayList.addRecord(c)}else{var l=e.indices.byteLength/4,d=e.vertices.byteLength/n,y=n/Uint32Array.BYTES_PER_ELEMENT;this._records=X.$.from(e.records),this._indexBuffer=new K("index",l,1),this._vertexBuffer=new K("vertex",d,y),this._indexBuffer.insert(e.indices,0,e.indices.byteLength/4,0),this._vertexBuffer.insert(e.vertices,0,e.vertices.byteLength/n,0),t&&(this._indicesInvalid=!0)}}}},{key:"remove",value:function(e){if(!(0,g.Wi)(this._records)){var t,r=z(e);try{for(r.s();!(t=r.n()).done;){var n=t.value,i=this._records.getCursor();if(i.lookup(n)){for(var s=i.indexFrom,a=i.vertexFrom,u=i.indexCount,o=i.vertexCount;i.next()&&i.id===n;)u+=i.indexCount,o+=i.vertexCount;this._indexBuffer.free(s,u),this._vertexBuffer.free(a,o,!0),this._records.delete(n)}}}catch(f){r.e(f)}finally{r.f()}}}},{key:"draw",value:function(e,t,r,n,i){if(this._vertexBuffer&&this._indexBuffer&&!(0,g.Wi)(this._records)){if(((0,g.Wi)(this._vertexBuffer.gpu)||(0,g.Wi)(this._indexBuffer.gpu))&&(this._vao&&(this._vao.dispose(),this._vao=null),this._vertexBuffer.gpu=null,this._indexBuffer.gpu=null),this._vertexBuffer.upload(e),this._indexBuffer.upload(e),!this._vao){var s=this._vertexBuffer.gpu,a=this._indexBuffer.gpu;if(!a||!s)return;this._vao=new U.Z(e,r,t,{geometry:s},a)}var u=this._vao,o=n*Uint32Array.BYTES_PER_ELEMENT;e.bindVAO(u),e.drawElements(4,i,5125,o)}}},{key:"forEachCommand",value:function(e){if(!(0,g.Wi)(this._records)){if(this._sortIndices(this._records),!this._displayList){var t=this._cursorIndexOrder;this._displayList=M.from(this,this.geometryType,this._records.getCursor(),t)}this._displayList.forEach(e)}}},{key:"_sortIndices",value:function(e){if(this._indicesInvalid){this._indicesInvalid=!1;for(var t=0,r=e.getCursor(),n=this._indexBuffer.getBuffer(),i=[],s=[],a=[];r.next();)s.push(r.index),a.push(r.sortKey),i.push(r.id);s.sort((function(e,t){var r=a[t],n=a[e];return n===r?i[t]-i[e]:r-n}));for(var u=e.getCursor(),o=0,f=s;o<f.length;o++){var h=f[o];if(!u.seekIndex(h))throw new Error("Expected to find index");var c=u.indexFrom,l=u.indexCount;u.indexFrom=t;for(var d=0;d<l;d++)this._indexBuffer.set(t++,n.array[c+d])}this._cursorIndexOrder=s,this._displayList=null}}}]),e}();function D(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return G(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return G(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){u=!0,s=e},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw s}}}}function G(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function $(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,f.Z)(e);if(t){var i=(0,f.Z)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,o.Z)(this,r)}}var J=0,Q=function(e){(0,u.Z)(r,e);var t=$(r);function r(e,n,s,a,u){var o;return(0,i.Z)(this,r),(o=t.call(this,e,n,s)).instanceId=J++,o.patchCount=0,o._renderState={current:{geometry:new Map,metrics:null},next:null,swap:!1,swapFrames:0,locked:!1},o._patches=new p.Z(100),o._bufferPatches=new p.Z(100),o._lastCommitTime=0,o._lastMessageWasClear=!1,o.transforms.labelMat2d=(0,m.c)(),o._store=a,o._requestLabelUpdate=u,o}return(0,s.Z)(r,[{key:"destroy",value:function(){(0,a.Z)((0,f.Z)(r.prototype),"destroy",this).call(this),this._renderState.current.geometry.forEach((function(e){return e.destroy()}))}},{key:"labelMetrics",get:function(){return this._renderState.current.metrics}},{key:"hasData",get:function(){return!!this._renderState.current.geometry.size}},{key:"getGeometry",value:function(e){return this._renderState.current.geometry.get(e)}},{key:"setTransform",value:function(e,t){(0,a.Z)((0,f.Z)(r.prototype),"setTransform",this).call(this,e,t);var n=this.transforms.labelMat2d,i=e.getScreenTransform(n,t),s=(0,x.c)();(0,b.t)(s,[this.x,this.y],i),(0,k.i)(n),(0,k.t)(n,n,s),(0,k.m)(n,e.viewMat2d,n)}},{key:"patch",value:function(e,t){if(this.patchCount++,!e.clear||!this._lastMessageWasClear){this._lastMessageWasClear=e.clear,e.clear&&this._patches.size>=50&&this._dropPatches();var r=e,n=r.addOrUpdate&&this.key.id!==r.addOrUpdate.tileKeyOrigin;t&&n?this._bufferPatches.enqueue(r):(r.sort=r.sort&&!t,this._patches.enqueue(r)),this.requestRender()}}},{key:"commit",value:function(e){if(this._lastCommitTime!==e.time){this._lastCommitTime=e.time;for(var t=0;t<4;t++)this._updateMesh(),this.isReady&&this._updateBufferMesh();this._renderState.swap&&(this._swapRenderStates(),this.requestRender())}}},{key:"lock",value:function(){this._renderState.locked=!0}},{key:"unlock",value:function(){this._renderState.locked=!1,this._flushUpdates(),this._swap()}},{key:"_swapRenderStates",value:function(){if(this._renderState.next){if(this._renderState.locked)return this._renderState.swap=!0,void this.requestRender();if(this._renderState.swap=!0,0===this._renderState.swapFrames)return this._renderState.swapFrames=8,void this.requestRender();1==this._renderState.swapFrames--?this._swap():this.requestRender()}}},{key:"_swap",value:function(){this._renderState.swap&&(this._renderState.swap=!1,(0,g.pC)(this._renderState.next)&&(this._renderState.current.geometry.forEach((function(e){return e.destroy()})),this._renderState.current=this._renderState.next,this._renderState.next=null,this._requestLabelUpdate()))}},{key:"_flushUpdates",value:function(){for(var e=this._patches.maxSize;this._patches.size&&e--;)this._updateMesh(),this._swap()}},{key:"_updateBufferMesh",value:function(){var e=this._bufferPatches.peek();if(!(0,g.pC)(e)||!e.clear||null===this._renderState.next)for(;this._bufferPatches.size;){var t=this._bufferPatches.dequeue();(0,g.pC)(t)&&this._patchBuffer(t)}}},{key:"_updateMesh",value:function(){var e=this._patches.peek();if(!(0,g.pC)(e)||!e.clear||null===this._renderState.next){var t=this._patches.dequeue();if((0,g.pC)(t)){if(!0===t.clear){if(!this.isReady)return;return this._renderState.next,void(this._renderState.next={geometry:new Map,metrics:null})}this.requestRender(),this._patch(t),t.end&&(this.ready(),this._swapRenderStates())}}}},{key:"_patch",value:function(e){var t=this;(0,E.Z_)((function(r){t._remove(r,e.remove),t._insert(r,e,!1)}))}},{key:"_patchBuffer",value:function(e){var t=this;(0,E.Z_)((function(r){t._insert(r,e,!0)}))}},{key:"_insert",value:function(e,t,r){try{var n,i=(0,g.Pt)(this._renderState.next,this._renderState.current),s=null==(n=t.addOrUpdate)?void 0:n.data[e],a=i.geometry;if((0,g.Wi)(s))return;a.has(e)||a.set(e,new N(e,this.stage)),a.get(e).insert(s,t.sort,r),e===w.LW.LABEL&&this._insertLabelMetrics(t.type,s.metrics,t.clear)}catch(I){}}},{key:"_insertLabelMetrics",value:function(e,t,r){var n=(0,g.Pt)(this._renderState.next,this._renderState.current);if(!(0,g.Wi)(t)){var i=S.from(t);if((0,g.Wi)(n.metrics))n.metrics=i;else{if("update"===e)for(var s=i.getCursor();s.next();)n.metrics.delete(s.id);n.metrics.link(i)}}}},{key:"_remove",value:function(e,t){var r=(0,g.Pt)(this._renderState.next,this._renderState.current).geometry.get(e);t&&t.length&&r&&(r.remove(t),this._removeLabelMetrics(t))}},{key:"_removeLabelMetrics",value:function(e){var t=(0,g.Pt)(this._renderState.next,this._renderState.current).metrics;if(!(0,g.Wi)(t)&&e.length){var r,n=D(e);try{for(n.s();!(r=n.n()).done;)for(var i=r.value;t.delete(i););}catch(s){n.e(s)}finally{n.f()}}}},{key:"_dropPatches",value:function(){for(var e=this,t=new Array,r=!1;this._patches.size;){var n=this._patches.dequeue();if((0,g.Wi)(n))break;if(n.clear){if(r)break;r=!0}t.push(n)}this._patches.clear(),t.forEach((function(t){return e._patches.enqueue(t)}))}}]),r}(C.o),ee=r(92055),te=r(71559),re=r(26915),ne=r(93433),ie=r(84055),se=r(58188);function ae(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,f.Z)(e);if(t){var i=(0,f.Z)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,o.Z)(this,r)}}var ue=(0,d.Z)("featurelayer-order-by-server-enabled"),oe=function(e){(0,u.Z)(r,e);var t=ae(r);function r(e,n,s,a){var u;return(0,i.Z)(this,r),(u=t.call(this,e))._pointToCallbacks=new Map,u._layer=s,u._layerView=n,u._onUpdate=a,u}return(0,s.Z)(r,[{key:"renderChildren",value:function(e){this.attributeView.update(),this.hasAnimation&&e.painter.effects.integrate.draw(e,e.attributeView),(0,a.Z)((0,f.Z)(r.prototype),"renderChildren",this).call(this,e)}},{key:"hasEmptyAttributeView",value:function(){return this.attributeView.isEmpty()}},{key:"isUpdating",value:function(){return this.attributeView.isUpdating()}},{key:"hitTest",value:function(e){var t=(0,y.hh)();return this._pointToCallbacks.set(e,t),this.requestRender(),t.promise}},{key:"onTileData",value:function(e,t){var r=ue&&"orderBy"in this._layer&&this._layer.orderBy,n=(null==r?void 0:r.length)&&!r[0].valueExpression&&r[0].field,i=r&&this._layerView.orderByFields===n;e.patch(t,i),this.contains(e)||this.addChild(e),this.requestRender()}},{key:"onTileError",value:function(e){this.contains(e)||this.addChild(e)}},{key:"updateTransitionProperties",value:function(e,t){(0,a.Z)((0,f.Z)(r.prototype),"updateTransitionProperties",this).call(this,e,t),this._layerView.featureEffectView.transitionStep(e,t),this._layerView.featureEffectView.transitioning&&this.requestRender()}},{key:"doRender",value:function(e){var t=this._layer,n=t.minScale,i=t.maxScale,s=e.state.scale;s<=(n||1/0)&&s>=i&&(0,a.Z)((0,f.Z)(r.prototype),"doRender",this).call(this,e)}},{key:"onAttributeStoreUpdate",value:function(){this.hasLabels&&this._layerView.view.labelManager.requestUpdate(),this._onUpdate()}},{key:"hasAnimation",get:function(){return this.hasLabels}},{key:"hasLabels",get:function(){if("sublayers"in this._layer)return this._layer.sublayers.some((function(e){return e.labelingInfo&&e.labelingInfo.length&&e.labelsVisible}));var e=this._layer.featureReduction,t=e&&"cluster"===e.type&&e.labelsVisible&&e.labelingInfo&&e.labelingInfo.length;return this._layer.labelingInfo&&this._layer.labelingInfo.length&&this._layer.labelsVisible||!!t}},{key:"prepareRenderPasses",value:function(e){var t=this,n=e.registerRenderPass({name:"label",brushes:[ie.U.label],target:function(){return t.hasLabels?t.children:null},drawPhase:w.jx.LABEL|w.jx.LABEL_ALPHA}),i=e.registerRenderPass({name:"geometry",brushes:[ie.U.fill,ie.U.line,ie.U.marker,ie.U.text],target:function(){return t.children},enableDefaultDraw:function(){return!t._layerView.featureEffectView.hasEffects},effects:[{apply:e.effects.outsideEffect,enable:function(){return t._layerView.featureEffectView.hasEffects},args:function(){return t._layerView.featureEffectView.excludedEffects}},{apply:e.effects.insideEffect,enable:function(){return t._layerView.featureEffectView.hasEffects},args:function(){return t._layerView.featureEffectView.includedEffects}},{apply:e.effects.hittest,enable:function(){return!!t._pointToCallbacks.size},args:function(){return t._pointToCallbacks}}]}),s=e.registerRenderPass({name:"highlight",brushes:[ie.U.fill,ie.U.line,ie.U.marker,ie.U.text],target:function(){return t.children},drawPhase:w.jx.HIGHLIGHT,enableDefaultDraw:function(){return!1},effects:[{apply:e.effects.highlight,enable:function(){return!!t._layerView.hasHighlight()}}]});return[].concat((0,ne.Z)((0,a.Z)((0,f.Z)(r.prototype),"prepareRenderPasses",this).call(this,e)),[i,s,n])}}]),r}(se.T);function fe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,f.Z)(e);if(t){var i=(0,f.Z)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,o.Z)(this,r)}}var he=function(e){(0,u.Z)(o,e);var t,r=fe(o);function o(){return(0,i.Z)(this,o),r.apply(this,arguments)}return(0,s.Z)(o,[{key:"install",value:function(e){var t=this,r=new oe(this.tileInfoView,this.layerView,this.layer,(function(){return t.notifyChange("updating")}));this.featuresView=r,e.addChild(r)}},{key:"uninstall",value:function(e){e.removeChild(this.featuresView),this.featuresView.destroy()}},{key:"fetchResource",value:function(e,t){var r=e.url,n=this.featuresView.stage;try{return n.resourceManager.fetchResource(r,{signal:t.signal})}catch(M){return(0,y.D_)(M)?Promise.resolve({width:0,height:0}):Promise.reject(M)}}},{key:"isUpdating",value:function(){var e,t=(0,a.Z)((0,f.Z)(o.prototype),"isUpdating",this).call(this),r=!this.featuresView||this.featuresView.isUpdating(),n=null==(e=this.featuresView)?void 0:e.hasEmptyAttributeView(),i=t||r||t&&n;return(0,d.Z)("esri-2d-log-updating")&&console.log("Updating SymbolTileRenderer ".concat(i,"\n  -> updatingTiles ").concat(t,"\n  -> hasFeaturesView ").concat(!!this.featuresView,"\n  -> updatingFeaturesView ").concat(r)),i}},{key:"hitTest",value:function(e){return this.featuresView.hitTest(e)}},{key:"supportsRenderer",value:function(e){return null!=e&&-1!==["simple","class-breaks","unique-value","dot-density","dictionary"].indexOf(e.type)}},{key:"onConfigUpdate",value:function(e){var t=null;if("visualVariables"in e){var r=((0,ee.a)(e).visualVariables||[]).map((function(e){var t=e.clone();return"normalizationField"in e&&(t.normalizationField=null),e.valueExpression&&"$view.scale"!==e.valueExpression&&(t.valueExpression=null,t.field="nop"),t}));t=(0,re.I)(r)}this.featuresView.setRendererInfo(e,t,this.layerView.featureEffect)}},{key:"onTileData",value:function(e){var t=this.tiles.get(e.tileKey);t&&e.data&&this.featuresView.onTileData(t,e.data),this.layerView.view.labelManager.requestUpdate()}},{key:"onTileError",value:function(e){var t=this.tiles.get(e.tileKey);t&&this.featuresView.onTileError(t)}},{key:"forceAttributeTextureUpload",value:function(){this.featuresView.attributeView.forceTextureUpload()}},{key:"lockGPUUploads",value:function(){this.featuresView.attributeView.lockTextureUpload(),this.tiles.forEach((function(e){return e.lock()}))}},{key:"unlockGPUUploads",value:function(){this.featuresView.attributeView.unlockTextureUpload(),this.tiles.forEach((function(e){return e.unlock()}))}},{key:"getMaterialItems",value:(t=(0,n.Z)(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.featuresView.getMaterialItems(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"invalidateLabels",value:function(){this.featuresView.hasLabels&&this.layerView.view.labelManager.requestUpdate()}},{key:"createTile",value:function(e){var t=this,r=this.tileInfoView.getTileBounds((0,v.Ue)(),e);return new Q(e,r[0],r[3],this.featuresView.attributeView,(function(){return t.layerView.view.labelManager.requestUpdate()}))}},{key:"disposeTile",value:function(e){this.featuresView.removeChild(e),e.destroy(),this.layerView.view.labelManager.requestUpdate()}}]),o}(te.Z),ce=he=(0,l._)([(0,_.j)("esri.views.2d.layers.features.tileRenderers.SymbolTileRenderer")],he)}}]);
//# sourceMappingURL=1161-61fe8ce6903ecd0b5471.js.map