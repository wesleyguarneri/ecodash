"use strict";(self.webpackChunkenergy_and_water_dashboard=self.webpackChunkenergy_and_water_dashboard||[]).push([[3721],{13721:function(e,t,n){n.r(t),n.d(t,{default:function(){return z},inferFieldType:function(){return ne},inferFields:function(){return te},inferLocationInfo:function(){return ee}});var r=n(4942),i=n(29439),a=n(15861),u=n(43144),o=n(15671),s=n(87757),l=n.n(s),c=(n(58168),n(51916)),f=n(33300),d=n(75571),p=n(20806),h=n(37566),y=n(98840),m=n(93269),v=n(98699),g=n(50810),b=n(7093),x=n(96654),w=n(18378),k=n(85222),F=n(56282),_=n(2749);function I(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return N(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return N(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,u=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return u=e.done,e},e:function(e){o=!0,a=e},f:function(){try{u||null==n.return||n.return()}finally{if(o)throw a}}}}function N(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var T=l().mark(j),E=l().mark(P),O=/^\s*"([\S\s]*)"\s*$/,S=/""/g,Z=[","," ",";","|","\t"];function j(e,t,n){var r,i,a;return l().wrap((function(u){for(;;)switch(u.prev=u.next){case 0:r=0;case 1:if(!(r<=e.length)){u.next=10;break}if(i=e.indexOf(t,r),a=e.substring(r,i>-1?i:void 0),r+=a.length+t.length,u.t0=n&&!a.trim(),u.t0){u.next=8;break}return u.next=8,a;case 8:u.next=1;break;case 10:case"end":return u.stop()}}),T)}function D(e){var t=e.includes("\r\n")?"\r\n":"\n";return j(e,t,!0)}function C(e,t){return j(e,t,!1)}function q(e){var t,n=e.trim(),r=0,i="",a=I(Z);try{for(a.s();!(t=a.n()).done;){var u=t.value,o=n.split(u).length;o>r&&(r=o,i=u)}}catch(s){a.e(s)}finally{a.f()}return""===i?null:i}function P(e,t,n){var r,i,a,u,o,s,c,f,d,p,h,y,m,v,g=arguments;return l().wrap((function(l){for(;;)switch(l.prev=l.next){case 0:r=g.length>3&&void 0!==g[3]?g[3]:function(){return Object.create(null)},i="",a="",u=0,o=r(),s=0,c=I(e),l.prev=3,c.s();case 5:if((f=c.n()).done){l.next=47;break}d=f.value,p=C(d,n),h=I(p),l.prev=9,h.s();case 11:if((y=h.n()).done){l.next=29;break}if(m=y.value,i+=a+m,a="",(u+=A(m))%2!=0){l.next=26;break}if(!(u>0)){l.next=22;break}if(v=O.exec(i)){l.next=19;break}return o=r(),s=0,i="",u=0,l.abrupt("continue",45);case 19:o[t[s]]=v[1].replace(S,'"'),s++,l.next=23;break;case 22:o[t[s]]=i,s++;case 23:i="",u=0,l.next=27;break;case 26:a=n;case 27:l.next=11;break;case 29:l.next=34;break;case 31:l.prev=31,l.t0=l.catch(9),h.e(l.t0);case 34:return l.prev=34,h.f(),l.finish(34);case 37:if(0!==u){l.next=44;break}return l.next=40,o;case 40:o=r(),s=0,l.next=45;break;case 44:a="\n";case 45:l.next=5;break;case 47:l.next=52;break;case 49:l.prev=49,l.t1=l.catch(3),c.e(l.t1);case 52:return l.prev=52,c.f(),l.finish(52);case 55:case"end":return l.stop()}}),E,null,[[3,49,52,55],[9,31,34,37]])}function A(e){var t=0,n=0;for(n=e.indexOf('"',n);n>=0;)t++,n=e.indexOf('"',n+1);return t}var V=n(47e3),G=n(8747),M=n(43749),Q=n(39356);function R(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return L(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return L(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,u=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return u=e.done,e},e:function(e){o=!0,a=e},f:function(){try{u||null==n.return||n.return()}finally{if(o)throw a}}}}function L(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function $(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function U(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Y=(0,V.bU)("esriGeometryPoint"),W=["csv"],B=[0,0],J=(0,u.Z)((function e(t,n){(0,o.Z)(this,e),this.x=t,this.y=n})),z=function(){function e(){var t=this;(0,o.Z)(this,e),this._queryEngine=null,this._snapshotFeatures=function(){var e=(0,a.Z)(l().mark((function e(n){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._fetch(n);case 2:return r=e.sent,e.abrupt("return",t._createFeatures(r));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}var t,n,r,s,p,I,N,T,E,O,S,Z;return(0,u.Z)(e,[{key:"destroy",value:function(){var e;null==(e=this._queryEngine)||e.destroy(),this._queryEngine=null}},{key:"load",value:(Z=(0,a.Z)(l().mark((function e(t){var n,r,a,u,o,s,c,f,d,p,h=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=h.length>1&&void 0!==h[1]?h[1]:{},this.loadOptions=t,e.next=4,Promise.all([this._fetch(n.signal),this._checkProjection(null==t||null==(r=t.parsingOptions)?void 0:r.spatialReference)]);case 4:return a=e.sent,u=(0,i.Z)(a,1),o=u[0],s=H(o,t),this.locationInfo=s.locationInfo,this.delimiter=s.delimiter,this._queryEngine=this._createQueryEngine(s),e.next=11,this._createFeatures(o);case 11:return c=e.sent,this._queryEngine.featureStore.addMany(c),s.layerDefinition.extent=this._queryEngine.fullExtent,s.layerDefinition.timeInfo&&(f=this._queryEngine.timeExtent,d=f.start,p=f.end,s.layerDefinition.timeInfo.timeExtent=[d,p]),e.abrupt("return",s);case 14:case"end":return e.stop()}}),e,this)}))),function(e){return Z.apply(this,arguments)})},{key:"applyEdits",value:(S=(0,a.Z)(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new f.Z("csv-layer:editing-not-supported","applyEdits() is not supported on CSVLayer");case 1:case"end":return e.stop()}}),e)}))),function(){return S.apply(this,arguments)})},{key:"queryFeatures",value:(O=(0,a.Z)(l().mark((function e(){var t,n,r=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=4,this._waitSnapshotComplete();case 4:return e.abrupt("return",this._queryEngine.executeQuery(t,n.signal));case 5:case"end":return e.stop()}}),e,this)}))),function(){return O.apply(this,arguments)})},{key:"queryFeatureCount",value:(E=(0,a.Z)(l().mark((function e(){var t,n,r=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=4,this._waitSnapshotComplete();case 4:return e.abrupt("return",this._queryEngine.executeQueryForCount(t,n.signal));case 5:case"end":return e.stop()}}),e,this)}))),function(){return E.apply(this,arguments)})},{key:"queryObjectIds",value:(T=(0,a.Z)(l().mark((function e(){var t,n,r=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=4,this._waitSnapshotComplete();case 4:return e.abrupt("return",this._queryEngine.executeQueryForIds(t,n.signal));case 5:case"end":return e.stop()}}),e,this)}))),function(){return T.apply(this,arguments)})},{key:"queryExtent",value:(N=(0,a.Z)(l().mark((function e(){var t,n,r=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=4,this._waitSnapshotComplete();case 4:return e.abrupt("return",this._queryEngine.executeQueryForExtent(t,n.signal));case 5:case"end":return e.stop()}}),e,this)}))),function(){return N.apply(this,arguments)})},{key:"querySnapping",value:(I=(0,a.Z)(l().mark((function e(t){var n,r=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this._waitSnapshotComplete();case 3:return e.abrupt("return",this._queryEngine.executeQueryForSnapping(t,n.signal));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return I.apply(this,arguments)})},{key:"refresh",value:(p=(0,a.Z)(l().mark((function e(t){var n,r=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loadOptions.customParameters=t,null==(n=this._snapshotTask)||n.abort(),this._snapshotTask=(0,h.vr)(this._snapshotFeatures),this._snapshotTask.promise.then((function(e){r._queryEngine.featureStore.clear(),e&&r._queryEngine.featureStore.addMany(e)}),(function(e){r._queryEngine.featureStore.clear(),(0,h.D_)(e)||d.Z.getLogger("esri.layers.CSVLayer").error(new f.Z("csv-layer:refresh","An error occurred during refresh",{error:e}))})),e.next=6,this._waitSnapshotComplete();case 6:return e.abrupt("return",{extent:this._queryEngine.fullExtent,timeExtent:this._queryEngine.timeExtent});case 7:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"_waitSnapshotComplete",value:(s=(0,a.Z)(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._snapshotTask||this._snapshotTask.finished){e.next=9;break}return e.prev=1,e.next=4,this._snapshotTask.promise;case 4:e.next=8;break;case 6:e.prev=6,e.t0=e.catch(1);case 8:return e.abrupt("return",this._waitSnapshotComplete());case 9:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(){return s.apply(this,arguments)})},{key:"_fetch",value:(r=(0,a.Z)(l().mark((function e(t){var n,r,i,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.loadOptions,r=n.url,i=n.customParameters,r){e.next=3;break}throw new f.Z("csv-layer:invalid-source","url not defined");case 3:return a=(0,y.mN)(r),e.next=6,(0,c.default)(a.path,{query:U(U({},a.query),i),responseType:"text",signal:t});case 6:return e.abrupt("return",e.sent.data);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_createQueryEngine",value:function(e){var t=e.layerDefinition,n=t.objectIdField,r=t.fields,i=t.extent,a=t.timeInfo,u=new k.Z({geometryType:"esriGeometryPoint",hasM:!1,hasZ:!1});return new _.Z({fields:r,geometryType:"esriGeometryPoint",hasM:!1,hasZ:!1,timeInfo:a,objectIdField:n,spatialReference:i.spatialReference||{wkid:4326},cacheSpatialQueries:!0,featureStore:u})}},{key:"_createFeatures",value:(n=(0,a.Z)(l().mark((function e(t){var n,r,a,u,o,s,c,f,d,p,h,y,k,F,_,I,N,T,E,O,S,Z,j,C,q,A,G,L,$,U,Y,W,z,H,K,X,ee;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.locationInfo,r=n.latitudeFieldName,a=n.longitudeFieldName,u=this._queryEngine,o=u.objectIdField,s=u.fieldsIndex,c=u.spatialReference,f=[],d=[],p=s.fields.filter((function(e){return e.name!==o})).map((function(e){return e.name})),h=0,(y=D(t)).next(),k={},F=R(s.fields);try{for(F.s();!(_=F.n()).done;)"esriFieldTypeOID"!==(I=_.value).type&&"esriFieldTypeGlobalID"!==I.type&&void 0!==(N=(0,M.os)(I))&&(k[I.name]=N)}catch(l){F.e(l)}finally{F.f()}T=P(y,p,this.delimiter,(0,V.Dm)(k,o)),E=R(T);try{for(E.s();!(O=E.n()).done;)if(S=O.value,Z=this._parseCoordinateValue(S[r]),null!=(j=this._parseCoordinateValue(S[a]))&&null!=Z&&!isNaN(Z)&&!isNaN(j)){for(C in S[r]=Z,S[a]=j,S)C!==r&&C!==a&&(s.isDateField(C)?(q=new Date(S[C]),S[C]=ae(q,S[C])?q.getTime():null):s.isNumericField(C)&&(A=ue(S[C]),isNaN(A)?S[C]=null:S[C]=A));S[o]=h,h++,f.push(new J(j,Z)),d.push(S)}}catch(l){E.e(l)}finally{E.f()}if(!(0,g.fS)({wkid:4326},c))if((0,g.sS)(c)){G=R(f);try{for(G.s();!(L=G.n()).done;)$=L.value,U=(0,b.hG)($.x,$.y,B),Y=(0,i.Z)(U,2),$.x=Y[0],$.y=Y[1]}catch(l){G.e(l)}finally{G.f()}}else f=(0,m.oj)(v.N,f,Q.Z.WGS84,c,null);for(W=[],z=0;z<f.length;z++)H=f[z],K=H.x,X=H.y,(ee=d[z])[o]=z+1,W.push(new x.ZP(new w.Z([],[K,X]),ee,null,ee[o]));return e.abrupt("return",W);case 16:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"_parseCoordinateValue",value:function(e){if(null==e||""===e)return null;var t=ue(e);return(isNaN(t)||Math.abs(t)>181)&&(t=parseFloat(e)),t}},{key:"_checkProjection",value:(t=(0,a.Z)(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,F._W)(g.Zn,t);case 3:e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(0),new f.Z("csv-layer:projection-not-supported","Projection not supported");case 8:case"end":return e.stop()}}),e,null,[[0,5]])}))),function(e){return t.apply(this,arguments)})}]),e}();function H(e,t){var n=t.parsingOptions||{},r={delimiter:n.delimiter,layerDefinition:null,locationInfo:{latitudeFieldName:n.latitudeField,longitudeFieldName:n.longitudeField}},i=D(e),a=i.next().value;if(!a)throw new f.Z("csv-layer:empty-csv","CSV is empty",{csv:e});if(a=a.trim(),!n.delimiter){var u=q(a);if(!u)throw new f.Z("csv-layer:invalid-delimiter","Unable to detect the delimiter from CSV");r.delimiter=u}var o=a.split(r.delimiter).filter((function(e){return!!e})),s=r.layerDefinition={name:(0,y.vt)(t.url,W)||"csv",drawingInfo:Y,geometryType:"esriGeometryPoint",objectIdField:null,fields:[],timeInfo:n.timeInfo,extent:{xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,spatialReference:n.spatialReference||{wkid:102100}}};if(!n.latitudeField||!n.longitudeField){var l=ee(o);if(!n.longitudeField&&!l.longitudeFieldName||!n.latitudeField&&!l.latitudeFieldName)throw new f.Z("csv-layer:location-fields-not-found","Unable to identify latitude and longitude fields from the CSV file");r.locationInfo={longitudeFieldName:n.longitudeField||l.longitudeFieldName,latitudeFieldName:n.latitudeField||l.latitudeFieldName}}var c=te(i,r.delimiter,o,r.locationInfo);if(n.fields&&n.fields.length){var d,p=new Map,h=R(n.fields);try{for(h.s();!(d=h.n()).done;){var m=d.value;p.set(m.name.toLowerCase(),m)}}catch(E){h.e(E)}finally{h.f()}var v,g=R(c);try{for(g.s();!(v=g.n()).done;){var b=v.value,x=p.get(b.name.toLowerCase());if(x){var w=b.name;Object.assign(b,x),b.name=w}}}catch(E){g.e(E)}finally{g.f()}}if(s.fields=c,!s.fields.some((function(e){return"esriFieldTypeOID"===e.type&&(s.objectIdField=e.name,!0)}))){var k={name:"__OBJECTID",alias:"__OBJECTID",type:"esriFieldTypeOID",editable:!1,nullable:!1};s.objectIdField=k.name,s.fields.unshift(k)}if(s.timeInfo){var F=new G.Z(s.fields),_=s.timeInfo;if(_.startTimeField){var I=F.get(_.startTimeField);I?(_.startTimeField=I.name,I.type="esriFieldTypeDate"):_.startTimeField=null}if(_.endTimeField){var N=F.get(_.endTimeField);N?(_.endTimeField=N.name,N.type="esriFieldTypeDate"):_.endTimeField=null}if(_.trackIdField){var T=F.get(_.trackIdField);_.trackIdField=T?T.name:null}_.startTimeField||_.endTimeField||(s.timeInfo=null)}return r}var K=["lat","latitude","latitude83","latdecdeg","lat_dd","y","ycenter","point-y"],X=["lon","lng","long","longitude","longitude83","longdecdeg","long_dd","x","xcenter","point-x"];function ee(e){var t=e.map((function(e){return e.toLowerCase()}));return{longitudeFieldName:e[t.indexOf(X.find((function(e){return t.includes(e)})))],latitudeFieldName:e[t.indexOf(K.find((function(e){return t.includes(e)})))]}}function te(e,t,n,r){var i,a=[],u=P(e,n,t),o=[],s=R(u);try{for(s.s();!(i=s.n()).done;){var l=i.value;if(10===o.length)break;o.push(l)}}catch(p){s.e(p)}finally{s.f()}var c,f=R(n);try{var d=function(){var e=c.value;if(e===r.longitudeFieldName||e===r.latitudeFieldName)a.push({name:e,type:"esriFieldTypeDouble",alias:e});else{var t=ne(o.map((function(t){return t[e]}))),n={name:e,type:null,alias:e};switch(t){case"integer":n.type="esriFieldTypeInteger";break;case"double":n.type="esriFieldTypeDouble";break;case"date":n.type="esriFieldTypeDate",n.length=36;break;default:n.type="esriFieldTypeString",n.length=255}a.push(n)}};for(f.s();!(c=f.n()).done;)d()}catch(p){f.e(p)}finally{f.f()}return a}function ne(e){if(!e.length)return"string";var t=/[^+-.,0-9]/;return e.map((function(e){var n=!1;if(""!==e){if(t.test(e))n=!0;else{var r=ue(e);if(!isNaN(r))return/[.,]/.test(e)||!Number.isInteger(r)||r>214783647||r<-214783648?"double":"integer";if(-1===e.indexOf("E"))n=!0;else{if(r=Number(e),!isNaN(r))return"double";if(-1===e.indexOf(","))n=!0;else{if(e=e.replace(",","."),r=Number(e),!isNaN(r))return"double";n=!0}}}return n?/^[-]?\d*[.,]?\d*$/.test(e)?"string":ae(new Date(e),e)?"date":"string":"string"}})).reduce((function(e,t){return void 0===e||e===t?t:"string"===e||"string"===t?"string":"double"===e||"double"===t?"double":void 0}))}var re=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i,ie=Number.isNaN(new Date("technology 10").getTime());function ae(e,t){if(!e||"[object Date]"!==Object.prototype.toString.call(e)||isNaN(e.getTime()))return!1;var n=!0;if(!ie&&/\d+\W*$/.test(t)){var r=t.match(/[a-zA-Z]{2,}/);if(r){for(var i=!1,a=0;!i&&a<=r.length;)i=!re.test(r[a]),a++;n=!i}}return n}var ue=function(){var e=(0,p.lt)(),t=new RegExp("^"+e.regexp+"$"),n=new RegExp("["+e.group+"\\s\\xa0]","g"),r=e.factor;return function(i){var a=t.exec(i);if(e.factor=r,!a)return NaN;var u=a[1];if(!a[1]){if(!a[2])return NaN;u=a[2],e.factor*=-1}return+(u=u.replace(n,"").replace(e.decimal,"."))*e.factor}}()}}]);
//# sourceMappingURL=3721-59f631e8de354ed49a64.js.map