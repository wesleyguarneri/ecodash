"use strict";(self.webpackChunkenergy_and_water_dashboard=self.webpackChunkenergy_and_water_dashboard||[]).push([[2840],{62840:function(e,t,r){r.r(t),r.d(t,{default:function(){return Ce}});var i=r(15861),n=r(15671),a=r(43144),s=r(60136),o=r(6215),l=r(61120),u=r(87757),c=r.n(u),h=r(83195),f=r(9340),y=r(75571),p=r(37566),d=r(83241),v=r(89636),m=(r(43079),r(33682),r(64003),r(30732)),b=r(2103),g=r(17396),_=r(29439),w=r(11752),k=r(10173),P=r(93433),x=r(22983),R=r(95518),Z=r(84055),V=r(75428),T=r(87354),C=r(85147);function I(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=(0,l.Z)(e);if(t){var n=(0,l.Z)(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return(0,o.Z)(this,r)}}var S=function(e){(0,s.Z)(r,e);var t=I(r);function r(e,i,a,s,o){var l,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return(0,n.Z)(this,r),(l=t.call(this,e,i,a,s,o)).bitmap=new T.br(u,null,null),l.bitmap.coordScale=[s,o],l.bitmap.once("isReady",(function(){return l.ready()})),l}return(0,a.Z)(r,[{key:"destroy",value:function(){(0,w.Z)((0,l.Z)(r.prototype),"destroy",this).call(this),this.bitmap.destroy(),this.bitmap=null,this.stage=null}},{key:"stencilRef",get:function(){return this.bitmap.stencilRef},set:function(e){this.bitmap.stencilRef=e}},{key:"setTransform",value:function(e,t){(0,w.Z)((0,l.Z)(r.prototype),"setTransform",this).call(this,e,t),this.bitmap.transforms.dvs=this.transforms.dvs}},{key:"_createTransforms",value:function(){return{dvs:(0,V.c)(),tileMat3:(0,V.c)()}}},{key:"onAttach",value:function(){this.bitmap.stage=this.stage}},{key:"onDetach",value:function(){this.bitmap.stage=null}}]),r}(C.I),z=r(4761),D=r(62345);function F(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=(0,l.Z)(e);if(t){var n=(0,l.Z)(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return(0,o.Z)(this,r)}}var U=function(e){(0,s.Z)(r,e);var t=F(r);function r(){var e;return(0,n.Z)(this,r),(e=t.apply(this,arguments)).isCustomTilingScheme=!1,e}return(0,a.Z)(r,[{key:"createTile",value:function(e){var t=this._getTileBounds(e),r=(0,_.Z)(this._tileInfoView.tileInfo.size,2),i=r[0],n=r[1];return new S(e,t[0],t[3],i,n)}},{key:"destroyTile",value:function(){}},{key:"prepareRenderPasses",value:function(e){var t=this,i=e.registerRenderPass({name:"imagery (tile)",brushes:[Z.U.raster],target:function(){return t.children.map((function(e){return e.bitmap}))},drawPhase:z.jx.MAP});return[].concat((0,P.Z)((0,w.Z)((0,l.Z)(r.prototype),"prepareRenderPasses",this).call(this,e)),[i])}},{key:"doRender",value:function(e){this.visible&&e.drawPhase===z.jx.MAP&&(0,w.Z)((0,l.Z)(r.prototype),"doRender",this).call(this,e)}},{key:"_getTileBounds",value:function(e){var t=this._tileInfoView.getTileBounds((0,x.Ue)(),e);if(this.isCustomTilingScheme&&e.world){var r=this._tileInfoView.tileInfo,i=(0,R.ut)(r.spatialReference);if(i){var n=r.lodAt(e.level).resolution,a=i/n%r.size[0],s=a?(r.size[0]-a)*n:0;t[0]-=s*e.world,t[2]-=s*e.world}}return t}}]),r}(D.Z),B=(r(58168),r(80896)),L=r(5224),O=r(2491),E=r(22176),G=r(25907),A=r(7665),q=r(24748),W=(r(62387),r(99675)),j=(r(90832),r(75998)),M=r(64621),N=r(76665),Q=r(59007);function J(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=(0,l.Z)(e);if(t){var n=(0,l.Z)(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return(0,o.Z)(this,r)}}var H=[0,0],K=y.Z.getLogger("esri.views.2d.layers.ImageryTileLayerView2D"),Y=function(e){(0,s.Z)(h,e);var t,r,o,l,u=J(h);function h(){var e;return(0,n.Z)(this,h),(e=u.apply(this,arguments))._emptyTilePixelBlock=null,e._tileStrategy=null,e._tileInfoView=null,e._fetchQueue=null,e._blockCacheRegistryUrl=null,e._blockCacheRegistryId=null,e._srcResolutions=null,e.previousLOD=null,e._needBlockCacheUpdate=!1,e._globalSymbolizerParams=null,e._symbolizerParams=null,e._abortController=null,e._isCustomTilingScheme=!1,e._globalUpdateRequested=!1,e.container=null,e.layer=null,e.redrawOrRefetch=(0,p.Ds)((function(t,r){return!e.previousLOD||e.layerView.suspended?Promise.resolve():t?e.doRefresh():e._redrawImage(r)})),e}return(0,a.Z)(h,[{key:"useWebGLForProcessing",get:function(){var e;return null==(e=this._get("useWebGLForProcessing"))||e},set:function(e){this._set("useWebGLForProcessing",e)}},{key:"useProgressiveUpdate",get:function(){return null==this._get("useProgressiveUpdate")||this._get("useProgressiveUpdate")},set:function(e){var t=this;if(this._tileStrategy&&this.useProgressiveUpdate!==e){this._tileStrategy.destroy(),this.container.removeAllChildren();var r=this._getCacheSize(e);this._tileStrategy=new M.Z({cachePolicy:"purge",acquireTile:function(e){return t.acquireTile(e)},releaseTile:function(e){return t.releaseTile(e)},cacheSize:r,tileInfoView:this._tileInfoView}),this._set("useProgressiveUpdate",e),this.layerView.requestUpdate()}}},{key:"update",value:function(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume();var t=e.state,r=t.extent,i=t.resolution,n=t.scale,a=this._tileInfoView.getClosestInfoForScale(n);if(this.layer.raster){var s;if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){var o=this._srcResolutions[a.level],l=r.toJSON?r:Q.Z.fromJSON(r);(0,G.Vx)(this._blockCacheRegistryUrl,this._blockCacheRegistryId,l,i,o,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1,(null==(s=this.previousLOD)?void 0:s.level)!==a.level&&(this.previousLOD=a,null==this._symbolizerParams||this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}}},{key:"moveEnd",value:function(){var e=this;!this.layerView.hasTilingEffects&&this.useProgressiveUpdate||(this._abortController&&this._abortController.abort(),this._abortController=new AbortController,0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then((function(){e._globalUpdateRequested=!1,e.layerView.requestUpdate()})));var t=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(t),this.layerView.requestUpdate()}},{key:"updating",get:function(){return this._fetchQueue.length>0||this._globalUpdateRequested||!(!this.updatingHandles||!this.updatingHandles.updating)}},{key:"attach",value:function(){var e=this;(0,N.Z)().supportsTextureFloat||(this.useWebGLForProcessing=!1),this._initializeTileInfo(),this._tileInfoView=new W.Z(this.layerView.tileInfo,this.layerView.fullExtent);var t=this._computeFetchConcurrency();this._fetchQueue=new j.Z({tileInfoView:this._tileInfoView,concurrency:t,process:function(t,r){return e._fetchTile1(t,r)}});var r=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy=new M.Z({cachePolicy:"purge",acquireTile:function(t){return e.acquireTile(t)},releaseTile:function(t){return e.releaseTile(t)},cacheSize:r,tileInfoView:this._tileInfoView}),this._updateBlockCacheRegistry()}},{key:"acquireTile",value:function(e){var t=this.container.createTile(e);return this._enqueueTileFetch(t),this.layerView.requestUpdate(),this._needBlockCacheUpdate=!0,this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate,t}},{key:"releaseTile",value:function(e){var t=this;this._fetchQueue.abort(e.key.id),this.container.removeChild(e),e.once("detach",(function(){e.destroy(),t.layerView.requestUpdate()})),this.layerView.requestUpdate()}},{key:"uninstall",value:function(){this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null,this.notifyChange("updating"),(0,G.ET)(this._blockCacheRegistryUrl,this._blockCacheRegistryId)}},{key:"createEmptyTilePixelBlock",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=null==e||e.join(",")===this._tileInfoView.tileInfo.size.join(",");if(t&&(0,k.pC)(this._emptyTilePixelBlock))return this._emptyTilePixelBlock;var r=e=e||this._tileInfoView.tileInfo.size,i=(0,_.Z)(r,2),n=i[0],a=i[1],s=new O.Z({width:n,height:a,pixels:[new Uint8Array(n*a)],mask:new Uint8Array(n*a),pixelType:"u8"});return t&&(this._emptyTilePixelBlock=s),s}},{key:"_fetchTile1",value:function(e,t){var r=!(0,k.Wi)(t)&&t.signal,i=this.canUseWebGLForProcessing(),n={allowPartialFill:!0,datumTransformation:this.layerView.datumTransformation,interpolation:i?"nearest":this.layer.interpolation,registryId:this._blockCacheRegistryId,requestRawData:i,signal:(0,k.Wg)(r),srcResolution:this._srcResolutions[e.level],timeExtent:this.layerView.timeExtent,tileInfo:this.layerView.tileInfo};return this.fetchTile(e,n)}},{key:"_getCacheSize",value:function(e){return e?40:0}},{key:"_initializeTileInfo",value:function(){var e=this.layerView.view.spatialReference,t=new L.Z({x:this.layerView.fullExtent.xmin,y:this.layerView.fullExtent.ymax,spatialReference:e}),r=(0,q.vF)(this.layer.rasterInfo,e),i=r.scales,n=r.srcResolutions,a=r.isCustomTilingScheme,s=E.Z.create({spatialReference:e,size:512,scales:i});(0===s.origin.x||s.origin.x>t.x)&&(s.origin=t),this._isCustomTilingScheme=a,this.layerView.set("tileInfo",s),this._srcResolutions=null!=n?n:[]}},{key:"_computeFetchConcurrency",value:function(){var e=this.layer.rasterInfo.storageInfo.blockBoundary,t=e[e.length-1];return(t.maxCol-t.minCol+1)*(t.maxRow-t.minRow+1)>64?2:10}},{key:"_enqueueTileFetch",value:(l=(0,i.Z)(c().mark((function e(t,r){var i,n,a,s,o,l=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._fetchQueue.has(t.key.id)){e.next=31;break}return e.prev=1,e.next=4,this._fetchQueue.push(t.key);case 4:if(i=e.sent,this.notifyChange("updating"),n=this.layer.bandIds,a=!this.useProgressiveUpdate||this.layerView.hasTilingEffects&&!this._globalSymbolizerParams,!this._globalUpdateRequested||this.layerView.moving||0!==this._fetchQueue.length){e.next=19;break}return a=!1,e.prev=10,e.next=13,this._redrawImage(this._abortController&&this._abortController.signal);case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(10),(0,p.D_)(e.t0)&&K.error(e.t0);case 18:this._globalUpdateRequested=!1;case 19:return!this.canUseWebGLForProcessing()&&"rasterVF"!==this.type||this.layerView.hasTilingEffects||null!=this._symbolizerParams||this._updateSymbolizerParams(),s=this._tileInfoView.getTileCoords(H,t.key),o=this._tileInfoView.getTileResolution(t.key),e.next=23,this.updateTileSource(t,{source:i,symbolizerParams:this._symbolizerParams,globalSymbolizerParams:this._globalSymbolizerParams,suspended:a,bandIds:n,coords:s,resolution:o});case 23:t.once("attach",(function(){return l.layerView.requestUpdate()})),this.container.addChild(t),e.next=30;break;case 27:e.prev=27,e.t1=e.catch(1),(0,p.D_)(e.t1)||K.error(e.t1);case 30:this.layerView.requestUpdate();case 31:case"end":return e.stop()}}),e,this,[[1,27],[10,15]])}))),function(e,t){return l.apply(this,arguments)})},{key:"_redrawImage",value:(o=(0,i.Z)(c().mark((function e(t){var r,n=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.container.children.length){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.updatingHandles.addPromise(this.layer.updateRenderer());case 4:if(!this.layerView.hasTilingEffects){e.next=9;break}return e.next=7,this._updateGlobalSymbolizerParams(t);case 7:e.next=10;break;case 9:this._updateSymbolizerParams(),this._globalSymbolizerParams=null;case 10:return r=this.container.children.map(function(){var e=(0,i.Z)(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.updateTileSymbolizerParameters(t,{local:n._symbolizerParams,global:n._globalSymbolizerParams}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=13,(0,p.as)(r);case 13:this.container.requestRender();case 14:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"_updateGlobalSymbolizerParams",value:(r=(0,i.Z)(c().mark((function e(t){var r,i,n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={srcResolution:this._srcResolutions[this.previousLOD.level],registryId:this._blockCacheRegistryId,signal:t},e.next=3,this.layer.fetchPixels(this.layerView.view.extent,this.layerView.view.width,this.layerView.view.height,r);case 3:if((i=e.sent)&&i.pixelBlock){e.next=6;break}return e.abrupt("return");case 6:n=this.layer.symbolizer.generateWebGLParameters({pixelBlock:(0,A.qF)(i.pixelBlock,this.layer.bandIds),isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:this.previousLOD.resolution,y:this.previousLOD.resolution},bandIds:this.layer.bandIds}),!this.canUseWebGLForProcessing()&&n&&"stretch"===n.type&&this.layer.renderer&&"raster-stretch"===this.layer.renderer.type&&(n.factor=n.factor.map((function(e){return 255*e})),n.outMin=Math.round(255*n.outMin),n.outMax=Math.round(255*n.outMax)),this._globalSymbolizerParams=n;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_updateSymbolizerParams",value:function(){this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:this.previousLOD.resolution,y:this.previousLOD.resolution},bandIds:this.layer.bandIds})}},{key:"_updateBlockCacheRegistry",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.layer,r=t.url,i=t.rasterInfo,n=t.raster,a=this.layer.normalizeRasterFetchOptions({multidimensionalDefinition:this.layer.multidimensionalDefinition,timeExtent:this.layerView.timeExtent}),s=a.multidimensionalDefinition,o=null!=i&&i.multidimensionalInfo?n.getSliceIndex(s):null,l=(0,G.Rq)(r,o);if(l!==this._blockCacheRegistryUrl){if(null!=this._blockCacheRegistryUrl&&(0,G.ET)(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=(0,G.z2)(l,this.layer.raster.rasterInfo),e){var u=this._tileInfoView.getClosestInfoForScale(this.layerView.view.scale),c=this._srcResolutions[u.level];(0,G.Vx)(l,this._blockCacheRegistryId,this.layerView.view.extent,this.layerView.view.resolution,c,this.layer.raster.ioConfig.sampling)}this._blockCacheRegistryUrl=l}}},{key:"doRefresh",value:(t=(0,i.Z)(c().mark((function e(){var t,r=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.updatingHandles.addPromise(this.layer.updateRenderer());case 2:return this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._updateBlockCacheRegistry(!0),this._fetchQueue.reset(),this.notifyChange("updating"),t=[],this._tileStrategy.tiles.forEach((function(e){return t.push(r._enqueueTileFetch(e))})),e.next=10,(0,p.as)(t);case 10:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),h}(B.r);(0,h._)([(0,v.Cb)()],Y.prototype,"_globalUpdateRequested",void 0),(0,h._)([(0,v.Cb)()],Y.prototype,"container",void 0),(0,h._)([(0,v.Cb)()],Y.prototype,"layer",void 0),(0,h._)([(0,v.Cb)()],Y.prototype,"layerView",void 0),(0,h._)([(0,v.Cb)()],Y.prototype,"type",void 0),(0,h._)([(0,v.Cb)()],Y.prototype,"useWebGLForProcessing",null),(0,h._)([(0,v.Cb)()],Y.prototype,"useProgressiveUpdate",null),(0,h._)([(0,v.Cb)()],Y.prototype,"updating",null),Y=(0,h._)([(0,m.j)("esri.views.2d.layers.imagery.BaseImageryTileSubView2D")],Y);var X=r(80941);function $(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=(0,l.Z)(e);if(t){var n=(0,l.Z)(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return(0,o.Z)(this,r)}}var ee=function(e){(0,s.Z)(u,e);var t,r,o=$(u);function u(){var e;return(0,n.Z)(this,u),(e=o.apply(this,arguments)).container=null,e.layer=null,e.type="raster",e}return(0,a.Z)(u,[{key:"canUseWebGLForProcessing",value:function(){return this.useWebGLForProcessing&&this.layer.symbolizer.canRenderInWebGL&&!("majority"===this.layer.interpolation&&(0,X.JV)(this.layer))}},{key:"fetchTile",value:function(e,t){return this.layer.fetchTile(e.level,e.row,e.col,t)}},{key:"updateTileSource",value:(r=(0,i.Z)(c().mark((function e(t,r){var i,n,a,s,o,l,u,h,f,y,p,d,v,m,b;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.layer.bandIds,s=this._getLayerInterpolation(),o=this.canUseWebGLForProcessing(),l=r.source,u=r.symbolizerParams,h=r.globalSymbolizerParams,f=r.suspended,y=r.coords,p=r.resolution,d=t.bitmap,i=y,n=(0,_.Z)(i,2),d.x=n[0],d.y=n[1],d.resolution=p,!(l&&(0,k.pC)(l)&&(0,k.pC)(l.pixelBlock))){e.next=14;break}if(v={extent:l.extent,pixelBlock:l.pixelBlock},d.rawPixelData=v,!o){e.next=7;break}d.source=l.pixelBlock,d.isRendereredSource=!1,e.next=11;break;case 7:return e.next=9,this.layer.applyRenderer(v,"stretch"===(null==h?void 0:h.type)?h:null);case 9:m=e.sent,d.source=m,d.isRendereredSource=!0;case 11:d.symbolizerParameters=o?u:null,o?d.transformGrid||(d.transformGrid=l.transformGrid):d.transformGrid=null,e.next=16;break;case 14:b=this.createEmptyTilePixelBlock(),d.source=b,d.symbolizerParameters=o?u:null,d.transformGrid=null;case 16:d.bandIds=o?a:null,d.width=this._tileInfoView.tileInfo.size[0],d.height=this._tileInfoView.tileInfo.size[1],d.interpolation=s,d.suspended=f,d.invalidateTexture();case 17:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"updateTileSymbolizerParameters",value:(t=(0,i.Z)(c().mark((function e(t,r){var i,n,a,s,o,l,u;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r.local,n=r.global,a=this.layer.bandIds,s=this._getLayerInterpolation(),o=this.canUseWebGLForProcessing(),l=t.bitmap,u=l.rawPixelData,o||!(0,k.pC)(u)){e.next=8;break}return e.next=4,this.layer.applyRenderer(u,"stretch"===(null==n?void 0:n.type)?n:null);case 4:l.source=e.sent,l.isRendereredSource=!0,e.next=9;break;case 8:l.isRendereredSource&&(0,k.pC)(u)&&(l.source=u.pixelBlock),l.isRendereredSource=!1;case 9:l.symbolizerParameters=o?n||i:null,l.bandIds=o?a:null,l.interpolation=s,l.suspended=!1;case 13:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})},{key:"install",value:function(e){this.container=new U(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme,e.addChild(this.container)}},{key:"uninstall",value:function(){this.container.removeAllChildren(),this.container.remove(),(0,w.Z)((0,l.Z)(u.prototype),"uninstall",this).call(this)}},{key:"_getLayerInterpolation",value:function(){var e=this.layer.renderer.type;if("raster-colormap"===e||"unique-value"===e||"class-breaks"===e)return"nearest";var t=this.layer.interpolation,r=this.layer.renderer;return"raster-stretch"===r.type&&null!=r.colorRamp?"bilinear"===t||"cubic"===t?"bilinear":"nearest":t}}]),u}(Y);(0,h._)([(0,v.Cb)()],ee.prototype,"container",void 0),(0,h._)([(0,v.Cb)()],ee.prototype,"layer",void 0),(0,h._)([(0,v.Cb)()],ee.prototype,"type",void 0);var te=ee=(0,h._)([(0,m.j)("esri.views.2d.layers.imagery.ImageryTileView2D")],ee),re=r(18521),ie=r(2834),ne=r(199),ae=(r(64994),r(60183),r(42572),r(56947),r(3776),r(48604)),se=r(21170),oe=r(52917);function le(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=(0,l.Z)(e);if(t){var n=(0,l.Z)(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return(0,o.Z)(this,r)}}var ue=function(e){(0,s.Z)(r,e);var t=le(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return(0,n.Z)(this,r),(e=t.call(this))._source=null,e._symbolizerParameters=null,e._vaoInvalidated=!0,e.coordScale=[1,1],e.height=null,e.stencilRef=0,e.rawPixelData=null,e.width=null,e.source=i,e}return(0,a.Z)(r,[{key:"destroy",value:function(){var e,t;(0,k.pC)(this.vaoData)&&(null==(e=this.vaoData.magdir)||e.vao.dispose(),null==(t=this.vaoData.scalar)||t.vao.dispose(),this.vaoData=null)}},{key:"symbolizerParameters",get:function(){return this._symbolizerParameters},set:function(e){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(e)&&(this._symbolizerParameters=e,this.invalidateVAO())}},{key:"source",get:function(){return this._source},set:function(e){this._source=e,this.invalidateVAO()}},{key:"invalidateVAO",value:function(){var e,t;!this._vaoInvalidated&&(0,k.pC)(this.vaoData)&&(null==(e=this.vaoData.magdir)||e.vao.dispose(),null==(t=this.vaoData.scalar)||t.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())}},{key:"updateVectorFieldVAO",value:function(e){if(this._vaoInvalidated){if(this._vaoInvalidated=!1,(0,k.pC)(this.source)&&!(0,k.pC)(this.vaoData))switch(this.symbolizerParameters.style){case"beaufort_ft":case"beaufort_km":case"beaufort_kn":case"beaufort_m":case"beaufort_mi":case"classified_arrow":case"ocean_current_kn":case"ocean_current_m":case"single_arrow":var t=(0,re.wF)(this.source,this.symbolizerParameters),r=this._createVectorFieldVAO(e.context,t);this.vaoData={magdir:r};break;case"simple_scalar":var i=(0,re.K)(this.source,this.symbolizerParameters),n=this._createVectorFieldVAO(e.context,i);this.vaoData={scalar:n};break;case"wind_speed":var a=(0,re.wF)(this.source,this.symbolizerParameters),s=this._createVectorFieldVAO(e.context,a),o=(0,re.K)(this.source,this.symbolizerParameters),l=this._createVectorFieldVAO(e.context,o);this.vaoData={magdir:s,scalar:l}}this.ready(),this.requestRender()}}},{key:"_createTransforms",value:function(){return{dvs:(0,V.c)()}}},{key:"onAttach",value:function(){this.invalidateVAO()}},{key:"onDetach",value:function(){this.invalidateVAO()}},{key:"_createVectorFieldVAO",value:function(e,t){var r=t.vertexData,i=t.indexData,n=ne.Z.createVertex(e,35044,new Float32Array(r)),a=ne.Z.createIndex(e,35044,new Uint32Array(i)),s=(0,oe.cM)("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:5126,normalized:!1},{location:1,name:"a_offset",count:2,type:5126,normalized:!1},{location:2,name:"a_vv",count:2,type:5126,normalized:!1}]});return{vao:new ae.Z(e,s.attributes,s.bufferLayouts,{geometry:n},a),elementCount:i.length}}}]),r}(se.s);function ce(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=(0,l.Z)(e);if(t){var n=(0,l.Z)(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return(0,o.Z)(this,r)}}var he=function(e){(0,s.Z)(r,e);var t=ce(r);function r(e,i,a,s,o){var l,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return(0,n.Z)(this,r),(l=t.call(this,e,i,a,s,o)).tileData=new ue(u),l.tileData.coordScale=[s,o],l.tileData.once("isReady",(function(){return l.ready()})),l}return(0,a.Z)(r,[{key:"destroy",value:function(){(0,w.Z)((0,l.Z)(r.prototype),"destroy",this).call(this),this.tileData.destroy(),this.tileData=null,this.stage=null}},{key:"stencilRef",get:function(){return this.tileData.stencilRef},set:function(e){this.tileData.stencilRef=e}},{key:"_createTransforms",value:function(){return{dvs:(0,V.c)(),tileMat3:(0,V.c)()}}},{key:"setTransform",value:function(e,t){(0,w.Z)((0,l.Z)(r.prototype),"setTransform",this).call(this,e,t);var i=t/(e.resolution*e.pixelRatio),n=this.transforms.tileMat3,a=(0,_.Z)(this.tileData.offset,2),s=a[0],o=a[1],u=[this.x+s*t,this.y-o*t],c=e.toScreenNoRotation([0,0],u),h=(0,_.Z)(c,2),f=h[0],y=h[1],p=this.tileData.symbolizerParameters.symbolTileSize,d=Math.round((this.width-this.tileData.offset[0])/p)*p,v=Math.round((this.height-this.tileData.offset[1])/p)*p,m=d/this.rangeX*i,b=v/this.rangeY*i;(0,ie.s)(n,m,0,0,0,b,0,f,y,1),(0,ie.m)(this.transforms.dvs,e.displayViewMat3,n),this.tileData.transforms.dvs=this.transforms.dvs}},{key:"onAttach",value:function(){this.tileData.stage=this.stage}},{key:"onDetach",value:function(){this.tileData.stage=null}}]),r}(C.I),fe=r(86879);function ye(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=(0,l.Z)(e);if(t){var n=(0,l.Z)(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return(0,o.Z)(this,r)}}var pe=function(e){(0,s.Z)(r,e);var t=ye(r);function r(){var e;return(0,n.Z)(this,r),(e=t.apply(this,arguments)).isCustomTilingScheme=!1,e.symbolTypes=["triangle"],e}return(0,a.Z)(r,[{key:"createTile",value:function(e){var t=this._tileInfoView.getTileBounds((0,x.Ue)(),e),r=(0,_.Z)(this._tileInfoView.tileInfo.size,2),i=r[0],n=r[1];return new he(e,t[0],t[3],i,n)}},{key:"destroyTile",value:function(){}},{key:"prepareRenderPasses",value:function(e){var t=this,i=e.registerRenderPass({name:"imagery (vf tile)",brushes:[fe.Z],target:function(){return t.children.map((function(e){return e.tileData}))},drawPhase:z.jx.MAP});return[].concat((0,P.Z)((0,w.Z)((0,l.Z)(r.prototype),"prepareRenderPasses",this).call(this,e)),[i])}},{key:"doRender",value:function(e){var t=this;this.visible&&e.drawPhase===z.jx.MAP&&this.symbolTypes.forEach((function(i){e.renderPass=i,(0,w.Z)((0,l.Z)(r.prototype),"doRender",t).call(t,e)}))}}]),r}(D.Z);function de(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=(0,l.Z)(e);if(t){var n=(0,l.Z)(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return(0,o.Z)(this,r)}}var ve=function(e){(0,s.Z)(o,e);var t,r=de(o);function o(){var e;return(0,n.Z)(this,o),(e=r.apply(this,arguments))._handle=null,e.container=null,e.layer=null,e.type="rasterVF",e}return(0,a.Z)(o,[{key:"canUseWebGLForProcessing",value:function(){return!1}},{key:"fetchTile",value:(t=(0,i.Z)(c().mark((function e(t,r){var i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.fetchTile(t.level,t.row,t.col,r);case 2:if(i=e.sent,e.t0="vector-magdir"===this.layer.rasterInfo.dataType&&null!=i&&i.pixelBlock,!e.t0){e.next=8;break}return e.next=7,this.layer.convertVectorFieldData(i.pixelBlock,r);case 7:i.pixelBlock=e.sent;case 8:return e.abrupt("return",i);case 9:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})},{key:"updateTileSource",value:function(e,t){var r=t.symbolizerParams,i=e.tileData;i.key=e.key,i.width=this._tileInfoView.tileInfo.size[0],i.height=this._tileInfoView.tileInfo.size[1];var n=r.symbolTileSize,a=t.source;if(i.offset=this._getTileSymbolOffset(i.key,n),(0,k.pC)(a)&&(0,k.pC)(a.pixelBlock)){var s={extent:a.extent,pixelBlock:a.pixelBlock};i.rawPixelData=s,i.source=this._sampleVectorFieldData(a.pixelBlock,r,i.offset),i.symbolizerParameters=r}else{var o=[Math.round((this._tileInfoView.tileInfo[0]-i.offset[0])/n),Math.round((this._tileInfoView.tileInfo[1]-i.offset[1])/n)],l=this.createEmptyTilePixelBlock(o);i.source=l,i.symbolizerParameters=r}return i.invalidateVAO(),Promise.resolve(null)}},{key:"updateTileSymbolizerParameters",value:function(e,t){var r,i=t.local,n=i.symbolTileSize,a=e.tileData;a.offset=this._getTileSymbolOffset(a.key,n);var s=a.symbolizerParameters.symbolTileSize;return a.symbolizerParameters=i,(0,k.pC)(null==(r=a.rawPixelData)?void 0:r.pixelBlock)&&s!==n&&(a.source=this._sampleVectorFieldData(a.rawPixelData.pixelBlock,a.symbolizerParameters,a.offset)),Promise.resolve(null)}},{key:"install",value:function(e){var t=this;this.container=new pe(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme,this._updateSymbolType(this.layer.renderer),this._handle=this.layer.watch("renderer",(function(e){return t._updateSymbolType(e)})),e.addChild(this.container)}},{key:"uninstall",value:function(){this.container.removeAllChildren(),this._handle.remove(),this._handle=null,this.container.remove(),(0,w.Z)((0,l.Z)(o.prototype),"uninstall",this).call(this)}},{key:"_getTileSymbolOffset",value:function(e,t){var r=e.col*this._tileInfoView.tileInfo.size[0]%t,i=e.row*this._tileInfoView.tileInfo.size[1]%t;return[r>t/2?t-r:-r,i>t/2?t-i:-i]}},{key:"_sampleVectorFieldData",value:function(e,t,r){var i=t.symbolTileSize;return(0,re.nb)(e,"vector-uv",i,r)}},{key:"_updateSymbolType",value:function(e){"vector-field"===e.type&&(this.container.symbolTypes="wind-barb"===e.style?["scalar","triangle"]:"simple-scalar"===e.style?["scalar"]:["triangle"])}}]),o}(Y);(0,h._)([(0,v.Cb)()],ve.prototype,"container",void 0),(0,h._)([(0,v.Cb)()],ve.prototype,"layer",void 0),(0,h._)([(0,v.Cb)()],ve.prototype,"type",void 0);var me=ve=(0,h._)([(0,m.j)("esri.views.2d.layers.imagery.VectorFieldTileView2D")],ve),be=r(33300),ge=r(44946),_e=r(1815);function we(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=(0,l.Z)(e);if(t){var n=(0,l.Z)(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return(0,o.Z)(this,r)}}var ke=r(43798),Pe=r(51785);function xe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=(0,l.Z)(e);if(t){var n=(0,l.Z)(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return(0,o.Z)(this,r)}}var Re,Ze,Ve=y.Z.getLogger("esri.views.2d.layers.ImageryTileLayerView2D"),Te=function(e){(0,s.Z)(o,e);var t,r=xe(o);function o(){var e;return(0,n.Z)(this,o),(e=r.apply(this,arguments))._useWebGLForProcessing=!0,e._useProgressiveUpdate=!0,e.subview=null,e}return(0,a.Z)(o,[{key:"initialize",value:function(){var e=this.updateFullExtent();this.addResolvingPromise(e)}},{key:"useWebGLForProcessing",get:function(){return this._useWebGLForProcessing},set:function(e){this._useWebGLForProcessing=e,this.subview&&"useWebGLForProcessing"in this.subview&&(this.subview.useWebGLForProcessing=e)}},{key:"useProgressiveUpdate",get:function(){return this._useWebGLForProcessing},set:function(e){this._useProgressiveUpdate=e,this.subview&&"useProgressiveUpdate"in this.subview&&(this.subview.useProgressiveUpdate=e)}},{key:"update",value:function(e){this.subview.update(e),this.notifyChange("updating")}},{key:"isUpdating",value:function(){return!this.subview||this.subview.updating}},{key:"attach",value:function(){var e=this;this.layer.increaseRasterJobHandlerUsage(),this._updateSubview(),this.handles.add([(0,d.YP)(this.layer,["bandIds","renderer","interpolation","multidimensionalDefinition"],(function(t,r,i){var n="multidimensionalDefinition"===i,a="interpolation"===i&&("majority"===t||"majority"===r)&&(0,X.JV)(e.layer),s="renderer"===i&&r.type!==t.type;s&&e._updateSubview();var o=n||a||s;e.subview.redrawOrRefetch(o).catch((function(e){(0,p.D_)(e)||Ve.error(e)})),e.notifyChange("updating")})),(0,d.S1)(this,["layer.blendMode"],(function(t){e.subview&&(e.subview.container.blendMode=t)}),!0),(0,d.S1)(this,["layer.effect"],(function(t){e.subview&&(e.subview.container.effect=t)}),!0),(0,d.S1)(this,"timeExtent",(function(){e.subview.redrawOrRefetch(!0).catch((function(e){(0,p.D_)(e)||Ve.error(e)}))}))],"attach")}},{key:"detach",value:function(){this.handles.remove("attach"),this.layer.decreaseRasterJobHandlerUsage(),this.subview.uninstall()}},{key:"moveStart",value:function(){this.requestUpdate()}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"moveEnd",value:function(){this.subview.moveEnd()}},{key:"hitTest",value:(t=(0,i.Z)(c().mark((function e(t,r){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[new f.Z({attributes:{},geometry:t.clone()})]);case 1:case"end":return e.stop()}}),e)}))),function(e,r){return t.apply(this,arguments)})},{key:"doRefresh",value:function(){return this.subview.doRefresh()}},{key:"_updateSubview",value:function(){var e="vector-field"===this.layer.renderer.type?"rasterVF":"animated-flow"===this.layer.renderer.type?"rasterAnimatedFlow":"raster";if(this.subview){if(this.subview.type===e)return;this.subview.uninstall()}var t,r=this.layer;"useWebGLForProcessing"in(t="rasterVF"===e?new me({layer:r,layerView:this}):"rasterAnimatedFlow"===e?new b.Z({layer:r,layerView:this}):new te({layer:r,layerView:this}))&&(t.useWebGLForProcessing=this._useWebGLForProcessing),"useProgressiveUpdate"in t&&(t.useProgressiveUpdate=this._useProgressiveUpdate),"previousLOD"in t&&(t.previousLOD=this.subview&&"previousLOD"in this.subview&&this.subview.previousLOD),t.attach(),t.install(this.container),t.container.blendMode=r.blendMode,t.container.effect=r.effect,this.subview=t,this.requestUpdate()}}]),o}((Re=(0,Pe.y)((0,g.y)(ke.Z)),Ze=function(e){(0,s.Z)(o,e);var t,r=we(o);function o(){var e;return(0,n.Z)(this,o),(e=r.apply(this,arguments))._rasterFieldPrefix="Raster.",e.layer=null,e.view=null,e.fullExtent=null,e.tileInfo=null,e.datumTransformation=null,e}return(0,a.Z)(o,[{key:"hasTilingEffects",get:function(){return this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment}},{key:"fetchPopupFeatures",value:(t=(0,i.Z)(c().mark((function e(t,r){var i,n,a,s,o,l,u,h,y,p,d,v,m,b,g,_,w,P,x;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.layer,t){e.next=3;break}return e.abrupt("return",Promise.reject(new be.Z("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:i})));case 3:if(n=i.popupEnabled,a=(0,_e.V)(i,r),n&&(0,k.pC)(a)){e.next=6;break}throw new be.Z("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:n,popupTemplate:a});case 6:return s=[],e.next=9,i.identify(t,{timeExtent:this.timeExtent});case 9:if(o=e.sent,l=o.value,u=o.magdirValue,h="",l&&l.length){if(h="imagery-tile"===i.type&&i.hasStandardTime()&&null!=l[0]?l.map((function(e){return i.getStandardTimeValue(e)})).join(", "):l.join(", "),(d={ObjectId:0})[v="Raster.ServicePixelValue"]=this._formatAttributeValue(h,v),(m=null==(y=i.rasterInfo)||null==(p=y.attributeTable)?void 0:p.features)&&m.length>0&&(b=m.filter((function(e){var t=e.attributes.value||e.attributes.Value||e.attributes.VALUE;return String(t)===h})),b.length>0&&(g=b[0])))for(_ in g.attributes)g.attributes.hasOwnProperty(_)&&(w=this._rasterFieldPrefix+_,d[w]=this._formatAttributeValue(g.attributes[_],w));"vector-magdir"!==(P=i.rasterInfo.dataType)&&"vector-uv"!==P||(d["Raster.Magnitude"]=null==u?void 0:u[0],d["Raster.Direction"]=null==u?void 0:u[1]),(x=new f.Z(this.fullExtent.clone(),null,d)).layer=i,x.sourceLayer=x.layer,s.push(x)}return e.abrupt("return",s);case 15:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})},{key:"updateFullExtent",value:function(){var e=this.layer.tileInfo;if(!e||!e.spatialReference)return Promise.reject(new be.Z("layerview:tiling-information-missing","The layer doesn't provide tiling information",{layer:this.layer}));if((0,k.Wi)(this.layer.fullExtent))return Promise.reject(new be.Z("layerview:extent-missing","The layer doesn't provide a full extent.",{layer:this.layer}));var t=(0,q._D)(this.layer.fullExtent,this.view.spatialReference,!1),r=(0,q.tB)(this.layer.fullExtent,this.view.spatialReference,t);return null==r?Promise.reject(new be.Z("layerview:projection-not-supported","The layer extent cannot be projected to the view's spatial reference",{layer:this.layer})):(this._set("fullExtent",r),this.datumTransformation||(this.datumTransformation=(0,q._D)(this.layer.fullExtent,this.view.spatialReference,!0)),Promise.resolve())}},{key:"_formatAttributeValue",value:function(e,t){if("string"==typeof e){var r,i,n=this.layer.popupTemplate&&this.layer.popupTemplate.fieldInfos,a=this._getFieldInfo(n,t),s=a&&a.format;if(s)return e.trim().indexOf(",")>-1?(i=(r=",")+" ",this._formatDelimitedString(e,r,i,s)):e.trim().indexOf(" ")>-1?(r=i=" ",this._formatDelimitedString(e,r,i,s)):this._formatNumberFromString(e,s)}return e}},{key:"_getFieldInfo",value:function(e,t){if(e&&e.length&&t){var r,i=t.toLowerCase();return e.some((function(e){return!(!e.fieldName||e.fieldName.toLowerCase()!==i&&e.fieldName.toLowerCase()!==i.replace(/ /g,"_")||(r=e,0))})),r}}},{key:"_formatDelimitedString",value:function(e,t,r,i){var n=this;return e&&t&&r&&i?e.trim().split(t).map((function(e){return n._formatNumberFromString(e,i)})).join(r):e}},{key:"_formatNumberFromString",value:function(e,t){if(!e||!t)return e;var r=Number(e);return isNaN(r)?e:t.format(r)}}]),o}(Re),(0,h._)([(0,v.Cb)()],Ze.prototype,"layer",void 0),(0,h._)([(0,v.Cb)(ge.qG)],Ze.prototype,"timeExtent",void 0),(0,h._)([(0,v.Cb)()],Ze.prototype,"view",void 0),(0,h._)([(0,v.Cb)()],Ze.prototype,"fullExtent",void 0),(0,h._)([(0,v.Cb)()],Ze.prototype,"tileInfo",void 0),(0,h._)([(0,v.Cb)({readOnly:!0})],Ze.prototype,"hasTilingEffects",null),Ze=(0,h._)([(0,m.j)("esri.views.layers.ImageryTileLayerView")],Ze)));(0,h._)([(0,v.Cb)()],Te.prototype,"subview",void 0),(0,h._)([(0,v.Cb)()],Te.prototype,"useWebGLForProcessing",null),(0,h._)([(0,v.Cb)()],Te.prototype,"useProgressiveUpdate",null);var Ce=Te=(0,h._)([(0,m.j)("esri.views.2d.layers.ImageryTileLayerView2D")],Te)}}]);
//# sourceMappingURL=2840-947b1c386fbe2258c8ae.js.map