{"version":3,"file":"2052.render-page.js","mappings":"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","sources":["webpack://energy-and-water-dashboard/./node_modules/@arcgis/core/layers/support/kmlUtils.js","webpack://energy-and-water-dashboard/./node_modules/@arcgis/core/views/2d/engine/Bitmap.js","webpack://energy-and-water-dashboard/./node_modules/@arcgis/core/views/2d/engine/BitmapContainer.js","webpack://energy-and-water-dashboard/./node_modules/@arcgis/core/views/2d/engine/ImageryBitmapSource.js","webpack://energy-and-water-dashboard/./node_modules/@arcgis/core/views/2d/layers/KMLLayerView2D.js","webpack://energy-and-water-dashboard/./node_modules/@arcgis/core/views/2d/layers/graphics/GraphicContainer.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport e from\"../../config.js\";import{id as o}from\"../../kernel.js\";import t from\"../../PopupTemplate.js\";import r from\"../../request.js\";import{clone as s}from\"../../core/lang.js\";import{addQueryParameters as n}from\"../../core/urlUtils.js\";import i from\"../../geometry/SpatialReference.js\";import{equals as f,create as a,NEGATIVE_INFINITY as l,expandWithAABB as u}from\"../../geometry/support/aaBoundingBox.js\";import{getBoundsXYZ as p}from\"../../geometry/support/boundsUtils.js\";import{fromJSON as m}from\"../../renderers/support/jsonUtils.js\";import y from\"../../rest/support/FeatureSet.js\";const c={esriGeometryPoint:\"points\",esriGeometryPolyline:\"polylines\",esriGeometryPolygon:\"polygons\"};function d(e){const o=e.folders||[],t=o.slice(),r=new Map,n=new Map,i=new Map,f=new Map,a=new Map,l={esriGeometryPoint:n,esriGeometryPolyline:i,esriGeometryPolygon:f};(e.featureCollection&&e.featureCollection.layers||[]).forEach((e=>{const o=s(e);o.featureSet.features=[];const t=e.featureSet.geometryType;r.set(t,o);const a=e.layerDefinition.objectIdField;\"esriGeometryPoint\"===t?G(n,a,e.featureSet.features):\"esriGeometryPolyline\"===t?G(i,a,e.featureSet.features):\"esriGeometryPolygon\"===t&&G(f,a,e.featureSet.features)})),e.groundOverlays&&e.groundOverlays.forEach((e=>{a.set(e.id,e)})),o.forEach((o=>{o.networkLinkIds.forEach((r=>{const s=P(r,o.id,e.networkLinks);s&&t.push(s)}))})),t.forEach((e=>{if(e.featureInfos){e.points=s(r.get(\"esriGeometryPoint\")),e.polylines=s(r.get(\"esriGeometryPolyline\")),e.polygons=s(r.get(\"esriGeometryPolygon\")),e.mapImages=[];for(const o of e.featureInfos)switch(o.type){case\"esriGeometryPoint\":case\"esriGeometryPolyline\":case\"esriGeometryPolygon\":{const t=l[o.type].get(o.id);t&&e[c[o.type]].featureSet.features.push(t);break}case\"GroundOverlay\":{const t=a.get(o.id);t&&e.mapImages.push(t);break}}e.fullExtent=j([e])}}));const u=j(t);return{folders:o,sublayers:t,extent:u}}function g(t,s,i,f){const a=o&&o.findCredential(t);t=n(t,{token:a&&a.token});const l=e.kmlServiceUrl;return r(l,{query:{url:t,model:\"simple\",folders:\"\",refresh:0!==i||void 0,outSR:JSON.stringify(s)},responseType:\"json\",signal:f})}function S(e,o,t=null,r=[]){const s=[],n={},i=o.sublayers,f=o.folders.map((e=>e.id));return i.forEach((o=>{const i=new e;if(t?i.read(o,t):i.read(o),r.length&&f.indexOf(i.id)>-1&&(i.visible=-1!==r.indexOf(i.id)),n[o.id]=i,null!=o.parentFolderId&&-1!==o.parentFolderId){const e=n[o.parentFolderId];e.sublayers||(e.sublayers=[]),e.sublayers.unshift(i)}else s.unshift(i)})),s}function G(e,o,t){t.forEach((t=>{e.set(t.attributes[o],t)}))}function h(e,o){let t;return o.some((o=>o.id===e&&(t=o,!0))),t}function P(e,o,t){const r=h(e,t);return r&&(r.parentFolderId=o,r.networkLink=r),r}async function b(e){const o=y.fromJSON(e.featureSet).features,r=e.layerDefinition,s=m(r.drawingInfo.renderer),n=t.fromJSON(e.popupInfo),i=[];for(const t of o){const e=await s.getSymbolAsync(t);t.symbol=e,t.popupTemplate=n,t.visible=!0,i.push(t)}return i}function j(e){const o=a(l),t=a(l);for(const r of e){if(r.polygons&&r.polygons.featureSet&&r.polygons.featureSet.features)for(const e of r.polygons.featureSet.features)p(o,e.geometry),u(t,o);if(r.polylines&&r.polylines.featureSet&&r.polylines.featureSet.features)for(const e of r.polylines.featureSet.features)p(o,e.geometry),u(t,o);if(r.points&&r.points.featureSet&&r.points.featureSet.features)for(const e of r.points.featureSet.features)p(o,e.geometry),u(t,o);if(r.mapImages)for(const e of r.mapImages)p(o,e.extent),u(t,o)}return f(t,l)?null:{xmin:t[0],ymin:t[1],zmin:t[2],xmax:t[3],ymax:t[4],zmax:t[5],spatialReference:i.WGS84}}export{j as computeExtent,g as fetchService,b as getGraphics,d as parseKML,S as sublayersFromJSON};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"../../../core/maybe.js\";import{b as e,c as i,r as s,j as r,m as h}from\"../../../chunks/mat3.js\";import{c as n}from\"../../../chunks/mat3f32.js\";import{f as u}from\"../../../chunks/vec2f32.js\";import{DisplayObject as o}from\"./DisplayObject.js\";import a from\"./ImageryBitmapSource.js\";import d from\"../../webgl/Texture.js\";function c(t){return t&&\"render\"in t}function l(t){return t&&!(\"render\"in t)}function x(t){const e=document.createElement(\"canvas\");return e.width=t.width,e.height=t.height,t.render(e.getContext(\"2d\")),e}function _(t,e,i){const s={target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071};return e&&i&&(s.width=e,s.height=i),new d(t,s)}class g extends o{constructor(t=null,e,i=!0){super(),this.requestRenderOnSourceChangedEnabled=i,this._textureInvalidated=!0,this.stencilRef=0,this.coordScale=[1,1],this._height=void 0,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._width=void 0,this.x=0,this.y=0,this.blendFunction=e,this.source=t,this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null)}get isSourceScaled(){return this.width!==this.sourceWidth||this.height!==this.sourceHeight}get height(){return void 0!==this._height?this._height:this.sourceHeight}set height(t){this._height=t}get source(){return this._source}set source(t){this._source=t,this.invalidateTexture()}get sourceHeight(){return this._source instanceof HTMLImageElement?this._source.naturalHeight:this._source.height}get sourceWidth(){return this._source instanceof HTMLImageElement?this._source.naturalWidth:this._source.width}get width(){return void 0!==this._width?this._width:this.sourceWidth}set width(t){this._width=t}beforeRender(t){super.beforeRender(t),this.updateTexture(t.context)}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRenderOnSourceChangedEnabled&&this.requestRender())}_createTransforms(){return{dvs:n()}}setTransform(t){const n=e(this.transforms.dvs),[o,a]=t.toScreenNoRotation([0,0],[this.x,this.y]),d=this.resolution/this.pixelRatio/t.resolution,c=d*this.width,l=d*this.height,x=Math.PI*this.rotation/180;i(n,n,u(o,a)),i(n,n,u(c/2,l/2)),s(n,n,-x),i(n,n,u(-c/2,-l/2)),r(n,n,u(c,l)),h(this.transforms.dvs,t.displayViewMat3,n)}setSamplingProfile(t){this._texture&&(t.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(t.samplingMode))}bind(t,e){this._texture&&t.bindTexture(this._texture,e)}updateTexture(e){var i;if(!this.stage)return null==(i=this._texture)||i.dispose(),void(this._texture=null);if(!this._textureInvalidated)return;this._textureInvalidated=!1,this._texture||(this.source?this._texture=_(e,this.sourceWidth,this.sourceHeight):this._texture=_(e));const s=this.source;if(s){if(this._texture.resize(this.sourceWidth,this.sourceHeight),c(s))if(s instanceof a){const e=s.getRenderedRasterPixels();this._texture.setData(t(e)?e.renderedRasterPixels:null)}else this._texture.setData(x(s));else l(s)&&this._texture.setData(s);this.ready()}else this._texture.setData(null)}onAttach(){this.invalidateTexture()}onDetach(){this.invalidateTexture()}}export{g as Bitmap,c as isImageSource,x as rasterize};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{brushes as e}from\"./brushes.js\";import{WGLDrawPhase as r}from\"./webgl/enums.js\";import s from\"./webgl/WGLContainer.js\";class t extends s{get requiresDedicatedFBO(){return this.children.some((e=>\"additive\"===e.blendFunction))}prepareRenderPasses(s){const t=s.registerRenderPass({name:\"bitmap\",brushes:[e.bitmap],target:()=>this.children,drawPhase:r.MAP});return[...super.prepareRenderPasses(s),t]}}export{t as BitmapContainer};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{isSome as e,isNone as t}from\"../../../core/maybe.js\";class i{constructor(e,t,i){this.pixelBlock=e,this.extent=t,this.originalPixelBlock=i}get width(){return e(this.pixelBlock)?this.pixelBlock.width:0}get height(){return e(this.pixelBlock)?this.pixelBlock.height:0}render(e){const i=this.pixelBlock;if(t(i))return;const l=this.filter({pixelBlock:i});if(t(l.pixelBlock))return;const r=l.pixelBlock.getAsRGBA(),o=e.createImageData(l.pixelBlock.width,l.pixelBlock.height);o.data.set(r),e.putImageData(o,0,0)}getRenderedRasterPixels(){const e=this.filter({pixelBlock:this.pixelBlock});return t(e.pixelBlock)?null:{width:e.pixelBlock.width,height:e.pixelBlock.height,renderedRasterPixels:new Uint8Array(e.pixelBlock.getAsRGBA().buffer)}}}export{i as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import{version as i}from\"../../../kernel.js\";import t from\"../../../request.js\";import s from\"../../../core/Collection.js\";import a from\"../../../core/Handles.js\";import{isSome as o,isNone as l}from\"../../../core/maybe.js\";import{queryToObject as r,objectToQuery as n}from\"../../../core/urlUtils.js\";import{property as h}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as p}from\"../../../core/accessorSupport/decorators/subclass.js\";import m from\"../../../geometry/Extent.js\";import{load as c,project as d}from\"../../../geometry/projection.js\";import y from\"../../../geometry/SpatialReference.js\";import{canProject as w,project as g}from\"../../../geometry/support/webMercatorUtils.js\";import{getGraphics as u,fetchService as _,parseKML as V}from\"../../../layers/support/kmlUtils.js\";import{parseUrl as b}from\"../../../rest/utils.js\";import{GraphicsCollection as f}from\"../../../support/GraphicsCollection.js\";import{Bitmap as v}from\"../engine/Bitmap.js\";import{BitmapContainer as S}from\"../engine/BitmapContainer.js\";import{LayerView2DMixin as I}from\"./LayerView2D.js\";import x from\"./graphics/GraphicContainer.js\";import P from\"./graphics/GraphicsView2D.js\";import k from\"../../layers/LayerView.js\";class C{constructor(){this.allSublayers=new Map,this.allPoints=[],this.allPolylines=[],this.allPolygons=[],this.allMapImages=[]}}let j=class extends(I(k)){constructor(){super(...arguments),this._handles=new a,this._bitmapIndex=new Map,this._mapImageContainer=new S,this._kmlVisualData=new C,this.allVisiblePoints=new f,this.allVisiblePolylines=new f,this.allVisiblePolygons=new f,this.allVisibleMapImages=new s}async hitTest(e,i){var t,s,a;return(await Promise.all([null==(t=this._pointsView)?void 0:t.hitTest(e),null==(s=this._polylinesView)?void 0:s.hitTest(e),null==(a=this._polygonsView)?void 0:a.hitTest(e)])).flat().filter((e=>!!e&&(e.layer=this.layer,e.sourceLayer=this.layer,!0)))}update(e){this._polygonsView&&this._polygonsView.processUpdate(e),this._polylinesView&&this._polylinesView.processUpdate(e),this._pointsView&&this._pointsView.processUpdate(e)}attach(){this._handles.add([this.allVisibleMapImages.on(\"change\",(e=>{e.added.forEach((e=>this._addMapImage(e))),e.removed.forEach((e=>this._removeMapImage(e)))}))]),this.container.addChild(this._mapImageContainer),this._polygonsView=new P({view:this.view,graphics:this.allVisiblePolygons,requestUpdateCallback:()=>this.requestUpdate(),container:new x(this.view.featuresTilingScheme)}),this.container.addChild(this._polygonsView.container),this._polylinesView=new P({view:this.view,graphics:this.allVisiblePolylines,requestUpdateCallback:()=>this.requestUpdate(),container:new x(this.view.featuresTilingScheme)}),this.container.addChild(this._polylinesView.container),this._pointsView=new P({view:this.view,graphics:this.allVisiblePoints,requestUpdateCallback:()=>this.requestUpdate(),container:new x(this.view.featuresTilingScheme)}),this.container.addChild(this._pointsView.container),this.watch(\"layer.visibleSublayers\",(e=>{for(const[i,t]of this._kmlVisualData.allSublayers)t.visibility=0;for(const i of e){const e=this._kmlVisualData.allSublayers.get(i.id);e&&(e.visibility=1)}this._refreshCollections()})),this._fetchingPromise=this._fetchService().then((()=>{this._fetchingPromise=null,this.notifyChange(\"updating\")}))}detach(){this._handles.removeAll(),this._mapImageContainer.removeAllChildren(),this.container.removeAllChildren(),this._bitmapIndex.clear(),this._polygonsView&&(this._polygonsView.destroy(),this._polygonsView=null),this._polylinesView&&(this._polylinesView.destroy(),this._polylinesView=null),this._pointsView&&(this._pointsView.destroy(),this._pointsView=null)}moveStart(){}viewChange(){this._polygonsView.viewChange(),this._polylinesView.viewChange(),this._pointsView.viewChange()}moveEnd(){}isUpdating(){return null!=this._fetchingPromise||this._pointsView.updating||this._polygonsView.updating||this._polylinesView.updating}_addMapImage(e){(this.view.spatialReference.isWGS84||this.view.spatialReference.isWebMercator)&&t(e.href,{responseType:\"image\"}).then((({data:i})=>{let t=m.fromJSON(e.extent);w(t,this.view.spatialReference)&&(t=g(t,this.view.spatialReference));const s=new v(i,\"standard\");s.x=t.xmin,s.y=t.ymax,s.resolution=t.width/i.naturalWidth,s.rotation=e.rotation,this._mapImageContainer.addChild(s),this._bitmapIndex.set(e,s)}))}async _getViewDependentUrl(e,t){const{viewFormat:s,viewBoundScale:a,httpQuery:h}=e;if(o(s)){if(l(t))throw new Error(\"Loading this network link requires a view state.\");let p;if(await c(),o(a)&&1!==a){const e=new m(t.extent);e.expand(a),p=e}else p=t.extent;p=d(p,y.WGS84);const w=d(p,y.WebMercator),g=p.xmin,u=p.xmax,_=p.ymin,V=p.ymax,f=t.size[0]*t.pixelRatio,v=t.size[1]*t.pixelRatio,S=Math.max(w.width,w.height),I={\"[bboxWest]\":g.toString(),\"[bboxEast]\":u.toString(),\"[bboxSouth]\":_.toString(),\"[bboxNorth]\":V.toString(),\"[lookatLon]\":p.center.x.toString(),\"[lookatLat]\":p.center.y.toString(),\"[lookatRange]\":S.toString(),\"[lookatTilt]\":\"0\",\"[lookatHeading]\":t.rotation.toString(),\"[lookatTerrainLon]\":p.center.x.toString(),\"[lookatTerrainLat]\":p.center.y.toString(),\"[lookatTerrainAlt]\":\"0\",\"[cameraLon]\":p.center.x.toString(),\"[cameraLat]\":p.center.y.toString(),\"[cameraAlt]\":S.toString(),\"[horizFov]\":\"60\",\"[vertFov]\":\"60\",\"[horizPixels]\":f.toString(),\"[vertPixels]\":v.toString(),\"[terrainEnabled]\":\"0\",\"[clientVersion]\":i,\"[kmlVersion]\":\"2.2\",\"[clientName]\":\"ArcGIS API for JavaScript\",\"[language]\":\"en-US\"},x=e=>{for(const i in e)for(const t in I)e[i]=e[i].replace(t,I[t])},P=r(s);x(P);let k={};o(h)&&(k=r(h),x(k));const C=b(e.href);C.query={...C.query,...P,...k};return`${C.path}?${n(P)}`}return e.href}async _fetchService(){const e=new C;await this._loadVisualData(this.layer.url,e),this._kmlVisualData=e,this._refreshCollections()}_refreshCollections(){this.allVisiblePoints.removeAll(),this.allVisiblePolylines.removeAll(),this.allVisiblePolygons.removeAll(),this.allVisibleMapImages.removeAll(),this.allVisiblePoints.addMany(this._kmlVisualData.allPoints.filter((e=>this._isSublayerVisible(e.sublayerId))).map((({item:e})=>e))),this.allVisiblePolylines.addMany(this._kmlVisualData.allPolylines.filter((e=>this._isSublayerVisible(e.sublayerId))).map((({item:e})=>e))),this.allVisiblePolygons.addMany(this._kmlVisualData.allPolygons.filter((e=>this._isSublayerVisible(e.sublayerId))).map((({item:e})=>e))),this.allVisibleMapImages.addMany(this._kmlVisualData.allMapImages.filter((e=>this._isSublayerVisible(e.sublayerId))).map((({item:e})=>e)))}_isSublayerVisible(e){const i=this._kmlVisualData.allSublayers.get(e);return!!i.visibility&&(-1===i.parentFolderId||this._isSublayerVisible(i.parentFolderId))}_loadVisualData(e,i){return this._fetchParsedKML(e).then((async e=>{for(const t of e.sublayers){i.allSublayers.set(t.id,t);const e=t.points?await u(t.points):[],s=t.polylines?await u(t.polylines):[],a=t.polygons?await u(t.polygons):[],o=t.mapImages||[];if(i.allPoints.push(...e.map((e=>({item:e,sublayerId:t.id})))),i.allPolylines.push(...s.map((e=>({item:e,sublayerId:t.id})))),i.allPolygons.push(...a.map((e=>({item:e,sublayerId:t.id})))),i.allMapImages.push(...o.map((e=>({item:e,sublayerId:t.id})))),t.networkLink){const e=await this._getViewDependentUrl(t.networkLink,this.view.state);await this._loadVisualData(e,i)}}}))}_fetchParsedKML(e){return _(e,this.view.spatialReference,this.layer.refreshInterval).then((e=>V(e.data)))}_removeMapImage(e){const i=this._bitmapIndex.get(e);i&&(this._mapImageContainer.removeChild(i),this._bitmapIndex.delete(e))}};e([h()],j.prototype,\"_pointsView\",void 0),e([h()],j.prototype,\"_polylinesView\",void 0),e([h()],j.prototype,\"_polygonsView\",void 0),e([h()],j.prototype,\"_fetchingPromise\",void 0),e([h()],j.prototype,\"updating\",void 0),j=e([p(\"esri.views.2d.layers.KMLLayerView2D\")],j);const M=j;export{M as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{WGLDrawPhase as e}from\"../../engine/webgl/enums.js\";import r from\"./BaseGraphicContainer.js\";class i extends r{renderChildren(r){this.attributeView.bindTextures(r.context,!1),this.children.some((e=>e.hasData))&&(super.renderChildren(r),r.drawPhase===e.MAP&&this._renderChildren(r),this.hasHighlight()&&r.drawPhase===e.HIGHLIGHT&&this._renderHighlight(r),this._boundsRenderer&&this._boundsRenderer.doRender(r))}_renderHighlight(e){const{painter:r}=e,i=r.effects.highlight;i.bind(e),this._renderChildren(e,i.defines),i.draw(e),i.unbind()}}export{i as default};\n"],"names":[],"sourceRoot":""}