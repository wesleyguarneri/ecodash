"use strict";(self.webpackChunkenergy_and_water_dashboard=self.webpackChunkenergy_and_water_dashboard||[]).push([[8978],{38978:function(e,n,t){t.r(n),t.d(n,{registerFunctions:function(){return O}});var r=t(74849),a=t(93993),i=t(89126),l=t(15979),o=t(47518),s=t(36862),u=t(48522),f=t(29189),c=t(93981),d=t(66142),y=t(6287),p=t(49701),m=t(46789),h=t(94349),v=t(27498),g=t(17658),F=t(46424),E=t(88374),I=t(37566),D=t(27274),w=t(67124),b=t(35166);function N(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,n){if(!e)return;if("string"==typeof e)return x(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return x(e,n)}(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,l=!0,o=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return l=e.done,e},e:function(e){o=!0,i=e},f:function(){try{l||null==t.return||t.return()}finally{if(o)throw i}}}}function x(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function A(e,n,t){var r=e.getVariables();if(r.length>0){for(var a=[],i=0;i<r.length;i++){var l={name:r[i]};a.push(n.evaluateIdentifier(t,l))}return(0,I.$6)(a).then((function(n){for(var t={},a=0;a<r.length;a++)t[r[a]]=n[a];return e.parameters=t,e}))}return(0,I.DB)(e)}function S(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;for(var r in e)if(r.toLowerCase()===n.toLowerCase())return e[r];return t}function C(e){if(null===e)return null;var n={type:S(e,"type",""),name:S(e,"name","")};if("range"===n.type)n.range=S(e,"range",[]);else{n.codedValues=[];var t,r=N(S(e,"codedValues",[]));try{for(r.s();!(t=r.n()).done;){var a=t.value;n.codedValues.push({name:S(a,"name",""),code:S(a,"code",null)})}}catch(i){r.e(i)}finally{r.f()}}return n}function T(e){if(null===e)return null;var n={},t=S(e,"wkt",null);null!==t&&(n.wkt=t);var r=S(e,"wkid",null);return null!==r&&(n.wkid=r),n}function L(e){if(null===e)return null;var n={hasZ:S(e,"hasz",!1),hasM:S(e,"hasm",!1)},t=S(e,"spatialreference",null);t&&(n.spatialReference=T(t));var r=S(e,"x",null);if(null!==r)return n.x=r,n.y=S(e,"y",null),n;var a=S(e,"rings",null);if(null!==a)return n.rings=a,n;var i=S(e,"paths",null);if(null!==i)return n.paths=i,n;var l=S(e,"points",null);if(null!==l)return n.points=l,n;for(var o=0,s=["xmin","xmax","ymin","ymax","zmin","zmax","mmin","mmax"];o<s.length;o++){var u=s[o],f=S(e,u,null);null!==f&&(n[u]=f)}return n}function P(e){return!!e.layerDefinition&&!!e.featureSet&&!1!==function(e,n){var t,r=N(n);try{for(r.s();!(t=r.n()).done;)if(t.value===e)return!0}catch(a){r.e(a)}finally{r.f()}return!1}(e.layerDefinition.geometryType,["","esriGeometryPoint","esriGeometryPolyline","esriGeometryPolygon","esriGeometryMultipoint","esriGeometryEnvelope"])&&null!==e.layerDefinition.objectIdField&&""!==e.layerDefinition.objectIdField&&!1!==(0,f.a)(e.layerDefinition.fields)&&!1!==(0,f.a)(e.featureSet.features)}function O(e){"async"===e.mode&&(e.functions.getuser=function(n,t){return e.standardFunctionAsync(n,t,(function(e,t,i){(0,f.p)(i,1,2);var l=(0,f.E)(i[1],""),s=!0===l;if(l=!0===l||!1===l?"":(0,f.d)(l),i[0]instanceof r.Z){var u=null;return n.services&&n.services.portal&&(u=n.services.portal),u=(0,o.getPortal)(i[0],u),(0,o.lookupUser)(u,l,s).then((function(e){if(e){for(var n=JSON.parse(JSON.stringify(e)),t=0,r=["lastLogin","created","modified"];t<r.length;t++){var i=r[t];void 0!==n[i]&&null!==n[i]&&(n[i]=new Date(n[i]))}return a.Z.convertObjectToArcadeDictionary(n)}return null}))}var c=null;if((0,f.o)(i[0])&&(c=i[0]),c)return s=!1,l?null:c.load().then((function(){return c.getOwningSystemUrl()})).then((function(e){if(!e)return l?null:c.getIdentityUser().then((function(e){return e?a.Z.convertObjectToArcadeDictionary({username:e}):null}));var t=null;return n.services&&n.services.portal&&(t=n.services.portal),t=(0,o.getPortal)(new r.Z(e),t),(0,o.lookupUser)(t,l,s).then((function(e){if(e){for(var n=JSON.parse(JSON.stringify(e)),t=0,r=["lastLogin","created","modified"];t<r.length;t++){var i=r[t];void 0!==n[i]&&null!==n[i]&&(n[i]=new Date(n[i]))}return a.Z.convertObjectToArcadeDictionary(n)}return null}))}));throw new Error("Invalid Parameter")}))},e.signatures.push({name:"getuser",min:"1",max:"2"}),e.functions.featuresetbyid=function(n,t){return e.standardFunctionAsync(n,t,(function(e,n,t){if((0,f.p)(t,2,4),t[0]instanceof l.Z){var r=(0,f.d)(t[1]),a=(0,f.E)(t[2],null),i=(0,f.y)((0,f.E)(t[3],!0));if(null===a&&(a=["*"]),!1===(0,f.a)(a))throw new Error("Invalid Parameter");return t[0].featureSetById(r,i,a)}throw new Error("Invalid Parameter")}))},e.signatures.push({name:"featuresetbyid",min:"2",max:"4"}),e.functions.getfeatureset=function(n,t){return e.standardFunctionAsync(n,t,(function(e,t,r){if((0,f.p)(r,1,2),r[0]instanceof i.Z){var a=(0,f.E)(r[1],"datasource");return null===a&&(a="datasource"),a=(0,f.d)(a).toLowerCase(),(0,o.convertToFeatureSet)(r[0]._layer,a,n.lrucache,n.interceptor,n.spatialReference)}throw new Error("Invalid Parameter")}))},e.signatures.push({name:"getfeatureset",min:"1",max:"2"}),e.functions.featuresetbyportalitem=function(n,t){return e.standardFunctionAsync(n,t,(function(e,t,a){if((0,f.p)(a,2,5),null===a[0])throw new Error("Portal is required");if(a[0]instanceof r.Z){var i=(0,f.d)(a[1]),l=(0,f.d)(a[2]),s=(0,f.E)(a[3],null),u=(0,f.y)((0,f.E)(a[4],!0));if(null===s&&(s=["*"]),!1===(0,f.a)(s))throw new Error("Invalid Parameter");var c=null;return n.services&&n.services.portal&&(c=n.services.portal),c=(0,o.getPortal)(a[0],c),(0,o.constructFeatureSetFromPortalItem)(i,l,n.spatialReference,s,u,c,n.lrucache,n.interceptor)}if(!1===(0,f.f)(a[0]))throw new Error("Portal is required");var d=(0,f.d)(a[0]),y=(0,f.d)(a[1]),p=(0,f.E)(a[2],null),m=(0,f.y)((0,f.E)(a[3],!0));if(null===p&&(p=["*"]),!1===(0,f.a)(p))throw new Error("Invalid Parameter");if(n.services&&n.services.portal)return(0,o.constructFeatureSetFromPortalItem)(d,y,n.spatialReference,p,m,n.services.portal,n.lrucache,n.interceptor);throw new Error("Portal is required")}))},e.signatures.push({name:"featuresetbyportalitem",min:"2",max:"5"}),e.functions.featuresetbyname=function(n,t){return e.standardFunctionAsync(n,t,(function(e,n,t){if((0,f.p)(t,2,4),t[0]instanceof l.Z){var r=(0,f.d)(t[1]),a=(0,f.E)(t[2],null),i=(0,f.y)((0,f.E)(t[3],!0));if(null===a&&(a=["*"]),!1===(0,f.a)(a))throw new Error("Invalid Parameter");return t[0].featureSetByName(r,i,a)}throw new Error("Invalid Parameter")}))},e.signatures.push({name:"featuresetbyname",min:"2",max:"4"}),e.functions.featureset=function(n,t){return e.standardFunction(n,t,(function(e,t,r){(0,f.p)(r,1,1);var i=r[0],l={layerDefinition:{geometryType:"",objectIdField:"",globalIdField:"",typeIdField:"",fields:[]},featureSet:{geometryType:"",features:[]}};if((0,f.f)(i))void 0!==(i=JSON.parse(i)).layerDefinition?(l.layerDefinition=i.layerDefinition,l.featureSet=i.featureSet,i.layerDefinition.spatialReference&&(l.layerDefinition.spatialReference=i.layerDefinition.spatialReference)):(l.featureSet.features=i.features,l.featureSet.geometryType=i.geometryType,l.layerDefinition.geometryType=l.featureSet.geometryType,l.layerDefinition.objectIdField=i.objectIdFieldName,l.layerDefinition.typeIdField=i.typeIdFieldName,l.layerDefinition.globalIdField=i.globalIdFieldName,l.layerDefinition.fields=i.fields,i.spatialReference&&(l.layerDefinition.spatialReference=i.spatialReference));else{if(!(r[0]instanceof a.Z))throw new Error("Invalid Parameter");var o=S(i=JSON.parse(r[0].castToText()),"layerdefinition");if(null!==o){l.layerDefinition.geometryType=S(o,"geometrytype",""),l.featureSet.geometryType=l.layerDefinition.geometryType,l.layerDefinition.globalIdField=S(o,"globalidfield",""),l.layerDefinition.objectIdField=S(o,"objectidfield",""),l.layerDefinition.typeIdField=S(o,"typeidfield","");var s=S(o,"spatialreference",null);s&&(l.layerDefinition.spatialReference=T(s));var u,c=N(S(o,"fields",[]));try{for(c.s();!(u=c.n()).done;){var d=u.value,y={name:S(d,"name",""),alias:S(d,"alias",""),type:S(d,"type",""),nullable:S(d,"nullable",!0),editable:S(d,"editable",!0),length:S(d,"length",null),domain:C(S(d,"domain"))};l.layerDefinition.fields.push(y)}}catch(U){c.e(U)}finally{c.f()}var p=S(i,"featureset",null);if(p){var m,v={},g=N(l.layerDefinition.fields);try{for(g.s();!(m=g.n()).done;){var F=m.value;v[F.name.toLowerCase()]=F.name}}catch(U){g.e(U)}finally{g.f()}var E,I=N(S(p,"features",[]));try{for(I.s();!(E=I.n()).done;){var D=E.value,w={},b=S(D,"attributes",{});for(var x in b)w[v[x.toLowerCase()]]=b[x];l.featureSet.features.push({attributes:w,geometry:L(S(D,"geometry",null))})}}catch(U){I.e(U)}finally{I.f()}}}else{l.layerDefinition.geometryType=S(i,"geometrytype",""),l.featureSet.geometryType=l.layerDefinition.geometryType,l.layerDefinition.objectIdField=S(i,"objectidfieldname",""),l.layerDefinition.typeIdField=S(i,"typeidfieldname","");var A=S(i,"spatialreference",null);A&&(l.layerDefinition.spatialReference=T(A));var O,Z=N(S(i,"fields",[]));try{for(Z.s();!(O=Z.n()).done;){var R=O.value,W={name:S(R,"name",""),alias:S(R,"alias",""),type:S(R,"type",""),nullable:S(R,"nullable",!0),editable:S(R,"editable",!0),length:S(R,"length",null),domain:C(S(R,"domain"))};l.layerDefinition.fields.push(W)}}catch(U){Z.e(U)}finally{Z.f()}var B,k={},M=N(l.layerDefinition.fields);try{for(M.s();!(B=M.n()).done;){var j=B.value;k[j.name.toLowerCase()]=j.name}}catch(U){M.e(U)}finally{M.f()}var G,V=N(S(i,"features",[]));try{for(V.s();!(G=V.n()).done;){var _=G.value,H={},X=S(_,"attributes",{});for(var z in X)H[k[z.toLowerCase()]]=X[z];l.featureSet.features.push({attributes:H,geometry:L(S(_,"geometry",null))})}}catch(U){V.e(U)}finally{V.f()}}}if(!1===P(l))throw new Error("Invalid Parameter");return h.Z.create(l,n.spatialReference)}))},e.signatures.push({name:"featureset",min:"1",max:"1"}),e.functions.filter=function(n,t){return e.standardFunctionAsync(n,t,(function(t,r,a){if((0,f.p)(a,2,2),(0,f.a)(a[0])||(0,f.b)(a[0])){var i=[],l=a[0];l instanceof u.Z&&(l=l.toArray());var o=null;if(a[1]instanceof s.Z)o=e.arcadeCustomFunctionHandler(a[1]);else if(a[1]instanceof f.N)o=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return a[1].fn(n,{preparsed:!0,arguments:t})};else{if(!(a[1]instanceof f.S))throw new Error("Invalid Parameter");o=function(){var e;if(arguments.length!==a[1].paramCount)throw new Error("Invalid parameters");return(e=a[1]).fn.apply(e,arguments)}}return l.reduce((function(e,n,t){return e.then((function(e){t>0&&!0===e&&i.push(l[t-1]);var r=o(n);return(0,I.y8)(r)?r:(0,I.DB)(r)}))}),Promise.resolve(!1)).then((function(e){return!0===e&&l.length>0&&i.push(l[l.length-1]),i}))}return(0,f.o)(a[0])?a[0].load().then((function(t){var r=D.WhereClause.create(a[1],t.getFieldsIndex()),i=r.getVariables();if(i.length>0){for(var l=[],o=0;o<i.length;o++){var s={name:i[o]};l.push(e.evaluateIdentifier(n,s))}return(0,I.$6)(l).then((function(e){for(var n={},t=0;t<i.length;t++)n[i[t]]=e[t];return r.parameters=n,new d.Z({parentfeatureset:a[0],whereclause:r})}))}return(0,I.DB)(new d.Z({parentfeatureset:a[0],whereclause:r}))})):e.failDefferred("Filter cannot accept this parameter type")}))},e.signatures.push({name:"filter",min:"2",max:"2"}),e.functions.orderby=function(n,t){return e.standardFunctionAsync(n,t,(function(n,t,r){if((0,f.p)(r,2,2),(0,f.o)(r[0])){var a=new v.Z(r[1]);return(0,I.DB)(new y.Z({parentfeatureset:r[0],orderbyclause:a}))}return e.failDefferred("Order cannot accept this parameter type")}))},e.signatures.push({name:"orderby",min:"2",max:"2"}),e.functions.top=function(n,t){return e.standardFunctionAsync(n,t,(function(n,t,r){return(0,f.p)(r,2,2),(0,f.o)(r[0])?(0,I.DB)(new p.Z({parentfeatureset:r[0],topnum:r[1]})):(0,f.a)(r[0])?(0,f.t)(r[1])>=r[0].length?r[0].slice(0):r[0].slice(0,(0,f.t)(r[1])):(0,f.b)(r[0])?(0,f.t)(r[1])>=r[0].length()?r[0].slice(0):r[0].slice(0,(0,f.t)(r[1])):e.failDefferred("Top cannot accept this parameter type")}))},e.signatures.push({name:"top",min:"2",max:"2"}),e.functions.first=function(n,t){return e.standardFunctionAsync(n,t,(function(e,n,t){return(0,f.p)(t,1,1),(0,f.o)(t[0])?t[0].first(e.abortSignal).then((function(e){if(null!==e){var n=i.Z.createFromGraphicLikeObject(e.geometry,e.attributes,t[0]);n._underlyingGraphic=e,e=n}return e})):(0,f.a)(t[0])?0===t[0].length?(0,I.DB)(null):(0,I.DB)(t[0][0]):(0,f.b)(t[0])?0===t[0].length()?(0,I.DB)(null):(0,I.DB)(t[0].get(0)):null}))},e.signatures.push({name:"first",min:"1",max:"1"}),e.functions.attachments=function(n,t){return e.standardFunctionAsync(n,t,(function(e,t,r){(0,f.p)(r,1,2);var l={minsize:-1,maxsize:-1,types:null,returnMetadata:!1};if(r.length>1)if(r[1]instanceof a.Z){if(r[1].hasField("minsize")&&(l.minsize=(0,f.t)(r[1].field("minsize"))),r[1].hasField("metadata")&&(l.returnMetadata=(0,f.y)(r[1].field("metadata"))),r[1].hasField("maxsize")&&(l.maxsize=(0,f.t)(r[1].field("maxsize"))),r[1].hasField("types")){var s=(0,f.V)(r[1].field("types"),!1);s.length>0&&(l.types=s)}}else if(null!==r[1])throw new Error("Invalid Parameter");if(r[0]instanceof i.Z){var u=r[0]._layer;return u instanceof w.default&&(u=(0,o.constructFeatureSet)(u,n.spatialReference,["*"],!0,n.lrucache,n.interceptor)),null===u||!1===(0,f.o)(u)?[]:u.load().then((function(){return u.queryAttachments(r[0].field(u.objectIdField),l.minsize,l.maxsize,l.types,l.returnMetadata)}))}if(null===r[0])return[];throw new Error("Invalid Parameter")}))},e.signatures.push({name:"attachments",min:"1",max:"2"}),e.functions.featuresetbyrelationshipname=function(n,t){return e.standardFunctionAsync(n,t,(function(e,t,r){(0,f.p)(r,2,4);var a=r[0],l=(0,f.d)(r[1]),s=(0,f.E)(r[2],null),u=(0,f.y)((0,f.E)(r[3],!0));if(null===s&&(s=["*"]),!1===(0,f.a)(s))throw new Error("Invalid Parameter");if(null===r[0])return null;if(!(r[0]instanceof i.Z))throw new Error("Invalid Parameter");var c=a._layer;return c instanceof w.default&&(c=(0,o.constructFeatureSet)(c,n.spatialReference,["*"],!0,n.lrucache,n.interceptor)),null===c||!1===(0,f.o)(c)?null:c.load().then((function(e){var t=e.relationshipMetaData().filter((function(e){return e.name===l}));if(0===t.length)return null;if(void 0!==t[0].relationshipTableId&&null!==t[0].relationshipTableId&&t[0].relationshipTableId>-1)return(0,o.constructFeatureSetFromRelationship)(e,t[0],a.field(e.objectIdField),e.spatialReference,s,u,n.lrucache,n.interceptor);var r=e.serviceUrl();return r?(r="/"===r.charAt(r.length-1)?r+t[0].relatedTableId.toString():r+"/"+t[0].relatedTableId.toString(),(0,o.constructFeatureSetFromUrl)(r,e.spatialReference,s,u,n.lrucache,n.interceptor).then((function(n){return n.load().then((function(){return n.relationshipMetaData()})).then((function(r){if(r=r.filter((function(e){return e.id===t[0].id})),!1===a.hasField(t[0].keyField)||null===a.field(t[0].keyField))return e.getFeatureByObjectId(a.field(e.objectIdField),[t[0].keyField]).then((function(e){if(e){var a=D.WhereClause.create(r[0].keyField+"= @id",n.getFieldsIndex());return a.parameters={id:e.attributes[t[0].keyField]},n.filter(a)}return new m.Z({parentfeatureset:n})}));var i=D.WhereClause.create(r[0].keyField+"= @id",n.getFieldsIndex());return i.parameters={id:a.field(t[0].keyField)},n.filter(i)}))}))):null}))}))},e.signatures.push({name:"featuresetbyrelationshipname",min:"2",max:"4"}),e.functions.featuresetbyassociation=function(n,t){return e.standardFunctionAsync(n,t,(function(e,t,r){(0,f.p)(r,2,3);var a=r[0],l=(0,f.d)((0,f.E)(r[1],"")).toLowerCase(),s=(0,f.f)(r[2])?(0,f.d)(r[2]):null;if(null===r[0])return null;if(!(r[0]instanceof i.Z))throw new Error("Invalid Parameter");var u=a._layer;return u instanceof w.default&&(u=(0,o.constructFeatureSet)(u,n.spatialReference,["*"],!0,n.lrucache,n.interceptor)),null===u||!1===(0,f.o)(u)?null:u.load().then((function(){var e=u.serviceUrl();return(0,o.constructAssociationMetaDataFeatureSetFromUrl)(e,n.spatialReference)})).then((function(e){var n=null,t=null,r=!1;if(null!==s&&""!==s&&void 0!==s){var i,o=N(e.terminals);try{for(o.s();!(i=o.n()).done;){var d=i.value;d.terminalName===s&&(t=d.terminalId)}}catch(H){o.e(H)}finally{o.f()}null===t&&(r=!0)}var y,p=e.associations.getFieldsIndex(),m=p.get("TOGLOBALID").name,h=p.get("FROMGLOBALID").name,v=p.get("TOTERMINALID").name,F=p.get("FROMTERMINALID").name,E=p.get("FROMNETWORKSOURCEID").name,I=p.get("TONETWORKSOURCEID").name,w=p.get("ASSOCIATIONTYPE").name,x=p.get("ISCONTENTVISIBLE").name,A=p.get("OBJECTID").name,S=N(u.fields);try{for(S.s();!(y=S.n()).done;){var C=y.value;if("global-id"===C.type){n=a.field(C.name);break}}}catch(H){S.e(H)}finally{S.f()}var T=null,L=new c.yN(new b.Z({name:"percentalong",alias:"percentalong",type:"double"}),D.WhereClause.create("0",e.associations.getFieldsIndex())),P=new c.yN(new b.Z({name:"side",alias:"side",type:"string"}),D.WhereClause.create("''",e.associations.getFieldsIndex())),O="globalid",Z="globalId",R={};for(var W in e.lkp)R[W]=e.lkp[W].sourceId;var B=new c.TO(new b.Z({name:"classname",alias:"classname",type:"string"}),null,R),k="";switch(l){case"midspan":k="((".concat(m,"='").concat(n,"') OR ( ").concat(h,"='").concat(n,"')) AND (").concat(w," IN (5))"),B.codefield=D.WhereClause.create("CASE WHEN (".concat(m,"='").concat(n,"') THEN ").concat(E," ELSE ").concat(I," END"),e.associations.getFieldsIndex());var M=(0,g.JW)(c.Xx.findField(e.associations.fields,h));M.name=O,M.alias=O,T=new c.yN(M,D.WhereClause.create("CASE WHEN (".concat(h,"='").concat(n,"') THEN ").concat(m," ELSE ").concat(h," END"),e.associations.getFieldsIndex())),L=e.unVersion>=4?new c.$X(c.Xx.findField(e.associations.fields,p.get("PERCENTALONG").name)):new c.yN(new b.Z({name:"percentalong",alias:"percentalong",type:"double"}),D.WhereClause.create("0",e.associations.getFieldsIndex()));break;case"junctionedge":k="((".concat(m,"='").concat(n,"') OR ( ").concat(h,"='").concat(n,"')) AND (").concat(w," IN (4,6))"),B.codefield=D.WhereClause.create("CASE WHEN (".concat(m,"='").concat(n,"') THEN ").concat(E," ELSE ").concat(I," END"),e.associations.getFieldsIndex());var j=(0,g.JW)(c.Xx.findField(e.associations.fields,h));j.name=O,j.alias=O,T=new c.yN(j,D.WhereClause.create("CASE WHEN (".concat(h,"='").concat(n,"') THEN ").concat(m," ELSE ").concat(h," END"),e.associations.getFieldsIndex())),P=new c.yN(new b.Z({name:"side",alias:"side",type:"string"}),D.WhereClause.create("CASE WHEN (".concat(w,"=4) THEN 'from' ELSE 'to' END"),e.associations.getFieldsIndex()));break;case"connected":var G="".concat(m,"='@T'"),V="".concat(h,"='@T'");null!==t&&(G+=" AND ".concat(v,"=@A"),V+=" AND ".concat(F,"=@A")),k="(("+G+") OR ("+V+"))",k=(0,f.P)(k,"@T",n),G=(0,f.P)(G,"@T",n),null!==t&&(G=(0,f.P)(G,"@A",t.toString()),k=(0,f.P)(k,"@A",t.toString())),B.codefield=D.WhereClause.create("CASE WHEN "+G+" THEN ".concat(E," ELSE ").concat(I," END"),e.associations.getFieldsIndex());var _=(0,g.JW)(c.Xx.findField(e.associations.fields,h));_.name=O,_.alias=O,T=new c.yN(_,D.WhereClause.create("CASE WHEN "+G+" THEN ".concat(h," ELSE ").concat(m," END"),e.associations.getFieldsIndex()));break;case"container":k="".concat(m,"='").concat(n,"' AND ").concat(w," = 2"),null!==t&&(k+=" AND ".concat(v," = ")+t.toString()),B.codefield=E,k="( "+k+" )",T=new c.QP(c.Xx.findField(e.associations.fields,h),O,O);case"content":k="(".concat(h,"='").concat(n,"' AND ").concat(w," = 2)"),null!==t&&(k+=" AND ".concat(F," = ")+t.toString()),B.codefield=I,k="( "+k+" )",T=new c.QP(c.Xx.findField(e.associations.fields,m),O,O);break;case"structure":k="(".concat(m,"='").concat(n,"' AND ").concat(w," = 3)"),null!==t&&(k+=" AND ".concat(v," = ")+t.toString()),B.codefield=E,k="( "+k+" )",T=new c.QP(c.Xx.findField(e.associations.fields,h),O,Z);break;case"attached":k="(".concat(h,"='").concat(n,"' AND ").concat(w," = 3)"),null!==t&&(k+=" AND ".concat(F," = ")+t.toString()),B.codefield=I,k="( "+k+" )",T=new c.QP(c.Xx.findField(e.associations.fields,m),O,Z);break;default:throw new Error("Invalid Parameter")}return r&&(k="1 <> 1"),new c.Xx({parentfeatureset:e.associations,adaptedFields:[new c.$X(c.Xx.findField(e.associations.fields,A)),new c.$X(c.Xx.findField(e.associations.fields,x)),T,P,B,L],extraFilter:k?D.WhereClause.create(k,e.associations.getFieldsIndex()):null})}))}))},e.signatures.push({name:"featuresetbyassociation",min:"2",max:"6"}),e.functions.groupby=function(n,t){return e.standardFunctionAsync(n,t,(function(t,r,i){return(0,f.p)(i,3,3),(0,f.o)(i[0])?i[0].load().then((function(t){var r=[],l=[],o=!1,s=[];if((0,f.f)(i[1]))s.push(i[1]);else if(i[1]instanceof a.Z)s.push(i[1]);else if((0,f.a)(i[1]))s=i[1];else{if(!(0,f.b)(i[1]))return e.failDefferred("Illegal Value: GroupBy");s=i[1].toArray()}var u,c=N(s);try{for(c.s();!(u=c.n()).done;){var d=u.value;if((0,f.f)(d)){var y=D.WhereClause.create((0,f.d)(d),t.getFieldsIndex()),p=!0===(0,F.y5)(y)?(0,f.d)(d):"%%%%FIELDNAME";r.push({name:p,expression:y}),"%%%%FIELDNAME"===p&&(o=!0)}else{if(!(d instanceof a.Z))return e.failDefferred("Illegal Value: GroupBy");var m=d.hasField("name")?d.field("name"):"%%%%FIELDNAME",h=d.hasField("expression")?d.field("expression"):"";if("%%%%FIELDNAME"===m&&(o=!0),!m)return e.failDefferred("Illegal Value: GroupBy");r.push({name:m,expression:D.WhereClause.create(h||m,t.getFieldsIndex())})}}}catch(J){c.e(J)}finally{c.f()}if(s=[],(0,f.f)(i[2]))s.push(i[2]);else if((0,f.a)(i[2]))s=i[2];else if((0,f.b)(i[2]))s=i[2].toArray();else{if(!(i[2]instanceof a.Z))return e.failDefferred("Illegal Value: GroupBy");s.push(i[2])}var v,g=N(s);try{for(g.s();!(v=g.n()).done;){var E=v.value;if(!(E instanceof a.Z))return e.failDefferred("Illegal Value: GroupBy");var w=E.hasField("name")?E.field("name"):"",b=E.hasField("statistic")?E.field("statistic"):"",x=E.hasField("expression")?E.field("expression"):"";if(!w||!b||!x)return e.failDefferred("Illegal Value: GroupBy");l.push({name:w,statistic:b.toLowerCase(),expression:D.WhereClause.create(x,t.getFieldsIndex())})}}catch(J){g.e(J)}finally{g.f()}if(o){var S,C={},T=N(t.fields);try{for(T.s();!(S=T.n()).done;){C[S.value.name.toLowerCase()]=1}}catch(J){T.e(J)}finally{T.f()}var L,P=N(r);try{for(P.s();!(L=P.n()).done;){var O=L.value;"%%%%FIELDNAME"!==O.name&&(C[O.name.toLowerCase()]=1)}}catch(J){P.e(J)}finally{P.f()}var Z,R=N(l);try{for(R.s();!(Z=R.n()).done;){var W=Z.value;"%%%%FIELDNAME"!==W.name&&(C[W.name.toLowerCase()]=1)}}catch(J){R.e(J)}finally{R.f()}var B,k=0,M=N(r);try{for(M.s();!(B=M.n()).done;){var j=B.value;if("%%%%FIELDNAME"===j.name){for(;1===C["field_"+k.toString()];)k++;C["field_"+k.toString()]=1,j.name="FIELD_"+k.toString()}}}catch(J){M.e(J)}finally{M.f()}}for(var G=[],V=0,_=r;V<_.length;V++){var H=_[V];G.push(A(H.expression,e,n))}for(var X=0,z=l;X<z.length;X++){var U=z[X];G.push(A(U.expression,e,n))}return G.length>0?(0,I.$6)(G).then((function(){return(0,I.DB)(i[0].groupby(r,l))})):(0,I.DB)(i[0].groupby(r,l))})):e.failDefferred("Illegal Value: GroupBy")}))},e.signatures.push({name:"groupby",min:"3",max:"3"}),e.functions.distinct=function(n,t){return e.standardFunctionAsync(n,t,(function(t,r,i){return(0,f.o)(i[0])?((0,f.p)(i,2,2),i[0].load().then((function(t){var r=[],l=[];if((0,f.f)(i[1]))l.push(i[1]);else if(i[1]instanceof a.Z)l.push(i[1]);else if((0,f.a)(i[1]))l=i[1];else{if(!(0,f.b)(i[1]))return e.failDefferred("Illegal Value: GroupBy");l=i[1].toArray()}var o,s=!1,u=N(l);try{for(u.s();!(o=u.n()).done;){var c=o.value;if((0,f.f)(c)){var d=D.WhereClause.create((0,f.d)(c),t.getFieldsIndex()),y=!0===(0,F.y5)(d)?(0,f.d)(c):"%%%%FIELDNAME";r.push({name:y,expression:d}),"%%%%FIELDNAME"===y&&(s=!0)}else{if(!(c instanceof a.Z))return e.failDefferred("Illegal Value: GroupBy");var p=c.hasField("name")?c.field("name"):"%%%%FIELDNAME",m=c.hasField("expression")?c.field("expression"):"";if("%%%%FIELDNAME"===p&&(s=!0),!p)return e.failDefferred("Illegal Value: GroupBy");r.push({name:p,expression:D.WhereClause.create(m||p,t.getFieldsIndex())})}}}catch(R){u.e(R)}finally{u.f()}if(s){var h,v={},g=N(t.fields);try{for(g.s();!(h=g.n()).done;){v[h.value.name.toLowerCase()]=1}}catch(R){g.e(R)}finally{g.f()}var E,w=N(r);try{for(w.s();!(E=w.n()).done;){var b=E.value;"%%%%FIELDNAME"!==b.name&&(v[b.name.toLowerCase()]=1)}}catch(R){w.e(R)}finally{w.f()}var x,S=0,C=N(r);try{for(C.s();!(x=C.n()).done;){var T=x.value;if("%%%%FIELDNAME"===T.name){for(;1===v["field_"+S.toString()];)S++;v["field_"+S.toString()]=1,T.name="FIELD_"+S.toString()}}}catch(R){C.e(R)}finally{C.f()}}for(var L=[],P=0,O=r;P<O.length;P++){var Z=O[P];L.push(A(Z.expression,e,n))}return L.length>0?(0,I.$6)(L).then((function(){return(0,I.DB)(i[0].groupby(r,[]))})):(0,I.DB)(i[0].groupby(r,[]))}))):function(e,n,t,r){if(1===r.length){if((0,f.a)(r[0]))return(0,E.t)(e,r[0],-1);if((0,f.b)(r[0]))return(0,E.t)(e,r[0].toArray(),-1)}return(0,E.t)(e,r,-1)}("distinct",0,0,i)}))})}}}]);
//# sourceMappingURL=8978-162d4f36bb7ba80e530f.js.map