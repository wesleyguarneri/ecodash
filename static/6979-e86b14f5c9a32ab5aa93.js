"use strict";(self.webpackChunkenergy_and_water_dashboard=self.webpackChunkenergy_and_water_dashboard||[]).push([[6979],{96979:function(e,t,i){i.r(t),i.d(t,{GraphicContainer:function(){return an.Z},GraphicsView2D:function(){return nn.Z},LabelManager:function(){return rn},MagnifierView2D:function(){return ta},MapViewNavigation:function(){return Hn},Stage:function(){return Br}});var r=i(4942),n=i(15861),a=i(15671),s=i(43144),o=i(97326),u=i(11752),l=i(60136),c=i(6215),h=i(61120),f=i(87757),d=i.n(f),p=i(33300),_=i(23178),v=i(33682),m=i(10173),g=i(94029),y=i(83241),b=i(47032),w=i(87637),x=i(42027),T=i(75428),F=i(66657),E=i(76796),k=i(98865),S=i(199),R=i(64994),O=i(60183),C=i(42572),B=(i(56947),i(3131)),M=i(3776),A=i(48604),P=i(29603),D=i(30032),Z=i(4761),I=i(54527),z=i(84055),U=i(7668),L=i(68645),V={background:{"background.frag":"#ifdef PATTERN\nuniform lowp float u_opacity;\nuniform lowp sampler2D u_texture;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_tileTextureCoord;\n#else\nuniform lowp vec4 u_color;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main() {\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord = mod(v_tileTextureCoord, 1.0);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\ngl_FragColor = u_opacity * color;\n#else\ngl_FragColor = u_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","background.vert":"precision mediump float;\nattribute vec2 a_pos;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_coord_range;\nuniform mediump float u_depth;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\nuniform mediump vec4 u_tlbr;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\n#endif\nvoid main() {\ngl_Position = vec4((u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0)).xy, u_depth, 1.0);\n#ifdef PATTERN\nv_tileTextureCoord = (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\nv_tlbr             = u_tlbr / u_mosaicSize.xyxy;\n#endif\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\n}"},circle:{"circle.frag":"precision lowp float;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nmediump float dist = length(v_offset);\nmediump float alpha = smoothstep(0.0, -v_blur, dist - 1.0);\nlowp float color_mix_ratio = v_stroke_width < 0.01 ? 0.0 : smoothstep(-v_blur, 0.0, dist - v_radius / (v_radius + v_stroke_width));\ngl_FragColor = alpha * mix(v_color, v_stroke_color, color_mix_ratio);\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","circle.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_circleTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_antialiasingWidth;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\nv_stroke_color = stroke_color * stroke_opacity;\nv_stroke_width = stroke_width;\nv_radius = radius;\nv_blur = max(blur, u_antialiasingWidth / (radius + stroke_width));\nmediump vec2 offset = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\nv_offset = offset;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos * 0.5, 1.0) + u_displayMat3 * vec3((v_radius + v_stroke_width) * offset + u_circleTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},fill:{"fill.frag":"precision lowp float;\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord = fract(v_tileTextureCoord);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\ngl_FragColor = v_color[3] * color;\n#else\ngl_FragColor = v_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","fill.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_fillTranslation;\n#ifdef PATTERN\n#include <util/util.glsl>\nuniform mediump vec2 u_mosaicSize;\nuniform mediump float u_patternFactor;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\n#ifdef PATTERN\nfloat patternWidth = nextPOT(tlbr.z - tlbr.x);\nfloat patternHeight = nextPOT(tlbr.w - tlbr.y);\nfloat scaleX = 1.0 / (patternWidth * u_patternFactor);\nfloat scaleY = 1.0 / (patternHeight * u_patternFactor);\nmat3 patterMat = mat3(scaleX, 0.0,    0.0,\n0.0,    -scaleY, 0.0,\n0.0,    0.0,    1.0);\nv_tileTextureCoord = (patterMat * vec3(a_pos, 1.0)).xy;\nv_tlbr             = tlbr / u_mosaicSize.xyxy;\n#endif\nvec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(u_fillTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},icon:{"icon.frag":"precision mediump float;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nuniform lowp vec4 u_color;\nuniform lowp vec4 u_outlineColor;\n#endif\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump flaot v_halo_width;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\n#include <util/encoding.glsl>\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef SDF\nlowp vec4 fillPixelColor = v_color;\nfloat d = rgba2float(texture2D(u_texture, v_tex)) - 0.5;\nconst float softEdgeRatio = 0.248062016;\nfloat size = max(v_size.x, v_size.y);\nfloat dist = d * softEdgeRatio * size;\nfillPixelColor *= clamp(0.5 - dist, 0.0, 1.0);\nif (v_halo_width > 0.25) {\nlowp vec4 outlinePixelColor = u_outlineColor;\nconst float outlineLimitRatio = (16.0 / 86.0);\nfloat clampedOutlineSize = softEdgeRatio * min(v_halo_width, outlineLimitRatio * max(v_size.x, v_size.y));\noutlinePixelColor *= clamp(0.5 - (abs(dist) - clampedOutlineSize), 0.0, 1.0);\ngl_FragColor = v_opacity * mixColors(fillPixelColor, outlinePixelColor);\n}\nelse {\ngl_FragColor = v_opacity * fillPixelColor;\n}\n#else\nlowp vec4 texColor = texture2D(u_texture, v_tex);\ngl_FragColor = v_opacity * texColor;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","icon.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump float v_halo_width;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_iconTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nconst float C_OFFSET_PRECISION = 1.0 / 8.0;\nconst float C_256_TO_RAD = 3.14159265359 / 128.0;\nconst float C_DEG_TO_RAD = 3.14159265359 / 180.0;\nconst float tileCoordRatio = 1.0 / 8.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nv_color = color;\nv_opacity = opacity;\n#ifdef SDF\nv_halo_width = halo_width;\n#endif\nfloat modded = mod(a_opacityInfo, 128.0);\nfloat targetOpacity = (a_opacityInfo - modded) / 128.0;\nfloat startOpacity = modded / 127.0;\nfloat interpolatedOpacity = clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_opacity *= interpolatedOpacity;\nmediump float a_angle         = a_levelInfo[1];\nmediump float a_minLevel      = a_levelInfo[2];\nmediump float a_maxLevel      = a_levelInfo[3];\nmediump vec2 a_tex            = a_texAngleRange.xy;\nmediump float delta_z = 0.0;\nmediump float rotated = mod(a_angle + u_mapRotation, 256.0);\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\ndelta_z += 1.0 - step(a_minLevel, u_level);\ndelta_z += step(a_maxLevel, u_level);\ndelta_z += step(v_opacity, 0.0);\nvec2 offset = C_OFFSET_PRECISION * a_vertexOffset;\nv_size = abs(offset);\n#ifdef SDF\noffset = (120.0 / 86.0) * offset;\n#endif\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayViewMat3 * vec3(size * offset, 0.0) + u_displayMat3 * vec3(u_iconTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth + delta_z, 1.0);\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nv_tex = a_tex.xy / u_mosaicSize;\n}"},line:{"line.frag":"precision lowp float;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nvarying mediump float v_lineHalfWidth;\nvarying lowp vec4 v_color;\nvarying mediump float v_blur;\n#if defined (PATTERN) || defined(SDF)\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\nuniform sampler2D u_texture;\nuniform mediump float u_antialiasing;\n#endif\n#ifdef SDF\n#include <util/encoding.glsl>\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nmediump float fragDist = length(v_normal) * v_lineHalfWidth;\nlowp float alpha = clamp((v_lineHalfWidth - fragDist) / v_blur, 0.0, 1.0);\n#ifdef PATTERN\nmediump float relativeTexX = mod(v_accumulatedDistance / (v_patternSize.x * v_widthRatio), 1.0);\nmediump float relativeTexY = 0.5 + v_normal.y * v_lineHalfWidth / (v_patternSize.y * v_widthRatio);\nmediump vec2 texCoord = mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nlowp vec4 color = texture2D(u_texture, texCoord);\ngl_FragColor = alpha * v_color[3] * color;\n#elif defined(SDF)\nmediump float relativeTexX = mod((v_accumulatedDistance * 0.5) / (v_patternSize.x * v_widthRatio), 1.0);\nmediump float relativeTexY =  0.5 + 0.25 * v_normal.y;\nmediump vec2 texCoord = mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nmediump float d = rgba2float(texture2D(u_texture, texCoord)) - 0.5;\nfloat dist = d * v_lineHalfWidth;\ngl_FragColor = alpha * clamp(0.5 - dist, 0.0, 1.0) * v_color;\n#else\ngl_FragColor = alpha * v_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","line.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_extrude_offset;\nattribute vec4 a_dir_normal;\nattribute vec2 a_accumulatedDistance;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump float u_zoomFactor;\nuniform mediump vec2 u_lineTranslation;\nuniform mediump float u_antialiasing;\nuniform mediump float u_depth;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nconst float scale = 1.0 / 31.0;\nconst mediump float tileCoordRatio = 8.0;\n#if defined (SDF)\nconst mediump float sdfPatternHalfWidth = 15.5;\n#endif\n#if defined (PATTERN) || defined(SDF)\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvarying mediump float v_lineHalfWidth;\nvarying mediump float v_blur;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\nv_blur = blur + u_antialiasing;\nv_normal = a_dir_normal.zw * scale;\n#if defined (PATTERN) || defined(SDF)\nv_tlbr          = tlbr / u_mosaicSize.xyxy;\nv_patternSize   = vec2(tlbr.z - tlbr.x, tlbr.y - tlbr.w);\n#if defined (PATTERN)\nv_widthRatio = width / v_patternSize.y;\n#else\nv_widthRatio = width / sdfPatternHalfWidth / 2.0;\n#endif\n#endif\nv_lineHalfWidth = (width + u_antialiasing) * 0.5;\nmediump vec2 dir = a_dir_normal.xy * scale;\nmediump vec2 offset_ = a_extrude_offset.zw * scale * offset;\nmediump vec2 dist = v_lineHalfWidth * scale * a_extrude_offset.xy;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos + offset_ * tileCoordRatio / u_zoomFactor, 1.0) + u_displayViewMat3 * vec3(dist, 0.0) + u_displayMat3 * vec3(u_lineTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n#if defined (PATTERN) || defined(SDF)\nv_accumulatedDistance = a_accumulatedDistance.x * u_zoomFactor / tileCoordRatio + dot(dir, dist + offset_);\n#endif\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\n}"},outline:{"outline.frag":"varying lowp vec4 v_color;\nvarying mediump vec2 v_normal;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nlowp float dist = abs(v_normal.y);\nlowp float alpha = smoothstep(1.0, 0.0, dist);\ngl_FragColor = alpha * v_color;\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","outline.vert":"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_xnormal;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_fillTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_outline_width;\nvarying lowp vec2 v_normal;\nconst float scale = 1.0 / 15.0;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nv_normal = a_xnormal;\nmediump vec2 dist = u_outline_width * scale * a_offset;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(dist + u_fillTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},text:{"text.frag":"uniform lowp sampler2D u_texture;\nvarying lowp vec2 v_tex;\nvarying lowp vec4 v_color;\nvarying mediump float v_edgeWidth;\nvarying mediump float v_edgeDistance;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nlowp float dist = texture2D(u_texture, v_tex).a;\nmediump float alpha = smoothstep(v_edgeDistance - v_edgeWidth, v_edgeDistance + v_edgeWidth, dist);\ngl_FragColor = alpha * v_color;\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","text.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_textTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying lowp vec2 v_tex;\nconst float offsetPrecision = 1.0 / 8.0;\nconst mediump float edgePos = 0.75;\nuniform mediump float u_antialiasingWidth;\nvarying mediump float v_edgeDistance;\nvarying mediump float v_edgeWidth;\nuniform lowp float u_halo;\nconst float sdfFontScale = 1.0 / 24.0;\nconst float sdfPixel = 3.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nif (u_halo > 0.5)\n{\nv_color = halo_color * opacity;\nhalo_width *= sdfPixel;\nhalo_blur *= sdfPixel;\n}\nelse\n{\nv_color = color * opacity;\nhalo_width = 0.0;\nhalo_blur = 0.0;\n}\nfloat modded = mod(a_opacityInfo, 128.0);\nfloat targetOpacity = (a_opacityInfo - modded) / 128.0;\nfloat startOpacity = modded / 127.0;\nfloat interpolatedOpacity = clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_color *= interpolatedOpacity;\nmediump float a_angle       = a_levelInfo[1];\nmediump float a_minLevel    = a_levelInfo[2];\nmediump float a_maxLevel    = a_levelInfo[3];\nmediump vec2 a_tex          = a_texAngleRange.xy;\nmediump float a_visMinAngle    = a_texAngleRange.z;\nmediump float a_visMaxAngle    = a_texAngleRange.w;\nmediump float delta_z = 0.0;\nmediump float angle = mod(a_angle + u_mapRotation, 256.0);\nif (a_visMinAngle < a_visMaxAngle)\n{\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) + (1.0 - step(a_visMinAngle, angle)));\n}\nelse\n{\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) * (1.0 - step(a_visMinAngle, angle)));\n}\ndelta_z += 1.0 - step(a_minLevel, u_level);\ndelta_z += step(a_maxLevel, u_level);\ndelta_z += step(v_color[3], 0.0);\nv_tex = a_tex.xy / u_mosaicSize;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nv_edgeDistance = edgePos - halo_width / size;\nv_edgeWidth = (u_antialiasingWidth + halo_blur) / size;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + sdfFontScale * u_displayViewMat3 * vec3(offsetPrecision * size * a_vertexOffset, 0.0) + u_displayMat3 * vec3(u_textTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth + delta_z, 1.0);\n}"},util:{"encoding.glsl":"const vec4 rgba2float_factors = vec4(\n255.0 / (256.0),\n255.0 / (256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\nreturn dot(rgba, rgba2float_factors);\n}","util.glsl":"float nextPOT(in float x) {\nreturn pow(2.0, ceil(log2(abs(x))));\n}"}};var N=new L.Z((function(e){var t=V;return e.split("/").forEach((function(e){t&&(t=t[e])})),t}));function G(e){return N.resolveIncludes(e)}var W=function(e){return(0,B.K)({ID:e.id,PATTERN:e.pattern})},j={shaders:function(e){return{vertexShader:W(e)+G("background/background.vert"),fragmentShader:W(e)+G("background/background.frag")}}},H=function(e){return(0,B.K)({ID:e.id})},q={shaders:function(e){return{vertexShader:H(e)+G("circle/circle.vert"),fragmentShader:H(e)+G("circle/circle.frag")}}},X=function(e){return(0,B.K)({ID:e.id,PATTERN:e.pattern})},Y={shaders:function(e){return{vertexShader:X(e)+G("fill/fill.vert"),fragmentShader:X(e)+G("fill/fill.frag")}}},Q=function(e){return(0,B.K)({ID:e.id})},K={shaders:function(e){return{vertexShader:Q(e)+G("outline/outline.vert"),fragmentShader:Q(e)+G("outline/outline.frag")}}},$=function(e){return(0,B.K)({ID:e.id,SDF:e.sdf})},J={shaders:function(e){return{vertexShader:$(e)+G("icon/icon.vert"),fragmentShader:$(e)+G("icon/icon.frag")}}},ee=function(e){return(0,B.K)({ID:e.id,PATTERN:e.pattern,SDF:e.sdf})},te={shaders:function(e){return{vertexShader:ee(e)+G("line/line.vert"),fragmentShader:ee(e)+G("line/line.frag")}}},ie=function(e){return(0,B.K)({ID:e.id})},re={shaders:function(e){return{vertexShader:ie(e)+G("text/text.vert"),fragmentShader:ie(e)+G("text/text.frag")}}},ne=function(){function e(){(0,a.Z)(this,e),this._programByKey=new Map}return(0,s.Z)(e,[{key:"dispose",value:function(){this._programByKey.forEach((function(e){return e.dispose()})),this._programByKey.clear()}},{key:"getMaterialProgram",value:function(e,t,i){var r=t.key<<3|this._getMaterialOptionsValue(t.type,i);if(this._programByKey.has(r))return this._programByKey.get(r);var n=(0,this._getProgramTemplate(t.type).shaders)(i),a=n.vertexShader,s=n.fragmentShader,o=t.getShaderHeader(),u=t.getShaderMain(),l=a.replace("#pragma header",o).replace("#pragma main",u),c=new U.$(e,l,s,t.getAttributeLocations());return this._programByKey.set(r,c),c}},{key:"_getMaterialOptionsValue",value:function(e,t){switch(e){case 0:var i=t;return(i.pattern?1:0)<<1|(i.id?1:0);case 1:var r=t;return(r.pattern?1:0)<<1|(r.id?1:0);case 2:case 5:case 6:return t.id?1:0;case 3:var n=t;return(n.sdf?1:0)<<2|(n.pattern?1:0)<<1|(n.id?1:0);case 4:var a=t;return(a.sdf?1:0)<<1|(a.id?1:0);default:return 0}}},{key:"_getProgramTemplate",value:function(e){switch(e){case 0:return j;case 5:return q;case 1:return Y;case 4:return J;case 3:return te;case 2:return K;case 6:return re;default:return null}}}]),e}(),ae=i(57365),se={shaders:{vertexShader:(0,ae.w)("bitBlit/bitBlit.vert"),fragmentShader:(0,ae.w)("bitBlit/bitBlit.frag")},attributes:new Map([["a_pos",0],["a_tex",1]])},oe=function(){function e(){(0,a.Z)(this,e),this._initialized=!1}return(0,s.Z)(e,[{key:"dispose",value:function(){this._program&&(this._program.dispose(),this._program=null),this._vertexArrayObject&&(this._vertexArrayObject.dispose(),this._vertexArrayObject=null)}},{key:"render",value:function(e,t,i,r){e&&(this._initialized||this._initialize(e),e.setBlendFunctionSeparate(1,771,1,771),e.bindVAO(this._vertexArrayObject),e.useProgram(this._program),t.setSamplingMode(i),e.bindTexture(t,0),this._program.setUniform1i("u_tex",0),this._program.setUniform1f("u_opacity",r),e.drawArrays(5,0,4),e.bindTexture(null,0),e.bindVAO())}},{key:"_initialize",value:function(e){if(this._initialized)return!0;var t=se.attributes,i=(0,B.H)(e,se);if(!i)return!1;var r=new Int8Array(16);r[0]=-1,r[1]=-1,r[2]=0,r[3]=0,r[4]=1,r[5]=-1,r[6]=1,r[7]=0,r[8]=-1,r[9]=1,r[10]=0,r[11]=1,r[12]=1,r[13]=1,r[14]=1,r[15]=1;var n=new A.Z(e,t,{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:4,normalized:!1,divisor:0},{name:"a_tex",count:2,type:5120,offset:2,stride:4,normalized:!1,divisor:0}]},{geometry:S.Z.createVertex(e,35044,r)});return this._program=i,this._vertexArrayObject=n,this._initialized=!0,!0}}]),e}(),ue=i(51862),le=function(e){var t="";t+=e[0].toUpperCase();for(var i=1;i<e.length;i++){var r=e[i];r===r.toUpperCase()?(t+="_",t+=r):t+=r.toUpperCase()}return t},ce=function(e){var t={};for(var i in e)t[le(i)]=e[i];return(0,B.K)(t)},he=function(e,t,i){var r=e+e.substring(e.lastIndexOf("/")),n=t+t.substring(t.lastIndexOf("/"));return{attributes:i,shaders:function(e){return{vertexShader:ce(e)+(0,ae.w)("".concat(r,".vert")),fragmentShader:ce(e)+(0,ae.w)("".concat(n,".frag"))}}}};function fe(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"==typeof e)return de(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return de(e,t)}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==i.return||i.return()}finally{if(o)throw a}}}}function de(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function pe(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function _e(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?pe(Object(i),!0).forEach((function(t){(0,r.Z)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):pe(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var ve=function(e){return e===Z.jx.HITTEST||e===Z.jx.LABEL_ALPHA},me=function(e,t,i,r){var n=e.rendererInfo,a=e.drawPhase;return"".concat(t.getVariationHash(),"-").concat(r.join("."),"-").concat(function(e){return(ve(e)?1:0)|(e===Z.jx.HIGHLIGHT?2:0)}(a),"-").concat(n.getVariationHash(),"-").concat((0,m.pC)(i)&&i.join("."))},ge=function(e,t,i,n){var a=n.reduce((function(t,i){return _e(_e({},t),{},(0,r.Z)({},i,e.context.driverTest[i]))}),{}),s=_e(_e(_e({},t.getVariation()),e.rendererInfo.getVariation()),{},{highlight:e.drawPhase===Z.jx.HIGHLIGHT,id:ve(e.drawPhase)},a);if((0,m.pC)(i)){var o,u=fe(i);try{for(u.s();!(o=u.n()).done;){s[o.value]=!0}}catch(l){u.e(l)}finally{u.f()}}return s},ye=function(){function e(t){(0,a.Z)(this,e),this._programByKey=new Map,this._programCache=new ue.Z(t)}return(0,s.Z)(e,[{key:"dispose",value:function(){this._programCache&&this._programCache.dispose()}},{key:"getProgram",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=t.vsPath+"."+t.fsPath+JSON.stringify(i)+n.join(".");if(this._programByKey.has(a))return this._programByKey.get(a);var s=n.reduce((function(t,i){return _e(_e({},t),{},(0,r.Z)({},i,e.context.driverTest[i]))}),{}),o=_e(_e({},i.map((function(e){return"string"==typeof e?{name:e,value:!0}:e})).reduce((function(e,t){return _e(_e({},e),{},(0,r.Z)({},t.name,t.value))}),{})),s),u=t.vsPath,l=t.fsPath,c=t.attributes,h=this._programCache.getProgram(he(u,l,c),o);if(!h)throw new Error("Unable to get program for key: ${key}");return this._programByKey.set(a,h),h}},{key:"getMaterialProgram",value:function(e,t,i,r,n){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:["ignoresSamplerPrecision"],s=me(e,t,n,a);if(this._programByKey.has(s))return this._programByKey.get(s);var o=ge(e,t,n,a),u=this._programCache.getProgram(he(i,i,r),o);if(!u)throw new Error("Unable to get program for key: ${key}");return this._programByKey.set(s,u),u}}]),e}(),be=i(59965),we=i(51916),xe=i(83569),Te=i(75571),Fe=i(37566),Ee=i(8792),ke=i(70916),Se=i(86228),Re=i(4402);function Oe(e){var t=function(e){if(!e.weight)return"";switch(e.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}(e)+function(e){if(!e.style)return"";switch(e.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}(e);return function(e){var t=e.toLowerCase().split(" ").join("-");switch(t){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return t}}(e.family)+(t.length>0?t:"-regular")}var Ce=i(90415),Be=function(){function e(t,i){(0,a.Z)(this,e),this._width=0,this._height=0,this._free=[],this._width=t,this._height=i,this._free.push(new Ce.Z(0,0,t,i))}return(0,s.Z)(e,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"allocate",value:function(e,t){if(e>this._width||t>this._height)return new Ce.Z;for(var i=null,r=-1,n=0;n<this._free.length;++n){var a=this._free[n];e<=a.width&&t<=a.height&&(null===i||a.y<=i.y&&a.x<=i.x)&&(i=a,r=n)}return null===i?new Ce.Z:(this._free.splice(r,1),i.width<i.height?(i.width>e&&this._free.push(new Ce.Z(i.x+e,i.y,i.width-e,t)),i.height>t&&this._free.push(new Ce.Z(i.x,i.y+t,i.width,i.height-t))):(i.width>e&&this._free.push(new Ce.Z(i.x+e,i.y,i.width-e,i.height)),i.height>t&&this._free.push(new Ce.Z(i.x,i.y+t,e,i.height-t))),new Ce.Z(i.x,i.y,e,t))}},{key:"release",value:function(e){for(var t=0;t<this._free.length;++t){var i=this._free[t];if(i.y===e.y&&i.height===e.height&&i.x+i.width===e.x)i.width+=e.width;else if(i.x===e.x&&i.width===e.width&&i.y+i.height===e.y)i.height+=e.height;else if(e.y===i.y&&e.height===i.height&&e.x+e.width===i.x)i.x=e.x,i.width+=e.width;else{if(e.x!==i.x||e.width!==i.width||e.y+e.height!==i.y)continue;i.y=e.y,i.height+=e.height}this._free.splice(t,1),this.release(e)}this._free.push(e)}}]),e}();function Me(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"==typeof e)return Ae(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Ae(e,t)}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==i.return||i.return()}finally{if(o)throw a}}}}function Ae(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}var Pe=function(e){return Math.floor(e/256)};function De(e){var t,i=new Set,r=Me(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;i.add(Pe(n))}}catch(a){r.e(a)}finally{r.f()}return i}function Ze(e,t,i){return e.has(t)||e.set(t,i().then((function(){e.delete(t)})).catch((function(i){e.delete(t),(0,Fe.H9)(i)}))),e.get(t)}var Ie=function(){function e(t,i,r){(0,a.Z)(this,e),this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphCache={},this._textures=[],this._rangePromises=new Map,this.width=t,this.height=i,this._glyphSource=r,this._binPack=new Be(t-4,i-4),this._glyphData.push(new Uint8Array(t*i)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyph()}var t,i,r;return(0,s.Z)(e,[{key:"dispose",value:function(){this._binPack=null;var e,t=Me(this._textures);try{for(t.s();!(e=t.n()).done;){var i=e.value;i&&i.dispose()}}catch(r){t.e(r)}finally{t.f()}this._textures.length=0,this._glyphData.length=0}},{key:"_initDecorationGlyph",value:function(){for(var e=[117,149,181,207,207,181,149,117],t=[],i=0;i<e.length;i++)for(var r=e[i],n=0;n<11;n++)t.push(r);var a={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(t)};this._recordGlyph(a)}},{key:"getGlyphItems",value:(r=(0,n.Z)(d().mark((function e(t,i,r){var n,a=this;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._getGlyphCache(t),e.next=3,this._fetchRanges(t,i,r);case 3:return e.abrupt("return",i.map((function(e){return a._getMosaicItem(n,t,e)})));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,i){return r.apply(this,arguments)})},{key:"bind",value:function(e,t,i,r){var n=this._getTexture(e,i);n.setSamplingMode(t),this._dirties[i]&&(n.setData(this._glyphData[i]),this._dirties[i]=!1),e.bindTexture(n,r)}},{key:"_getGlyphCache",value:function(e){return this._glyphCache[e]||(this._glyphCache[e]={}),this._glyphCache[e]}},{key:"_getTexture",value:function(e,t){return this._textures[t]||(this._textures[t]=new M.Z(e,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height))),this._textures[t]}},{key:"_invalidate",value:function(){this._dirties[this._currentPage]=!0}},{key:"_fetchRanges",value:(i=(0,n.Z)(d().mark((function e(t,i,r){var n,a,s=this;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=De(i),a=[],n.forEach((function(e){a.push(s._fetchRange(t,e,r))})),e.next=4,Promise.all(a);case 4:case"end":return e.stop()}}),e)}))),function(e,t,r){return i.apply(this,arguments)})},{key:"_fetchRange",value:(t=(0,n.Z)(d().mark((function e(t,i,r){var n,a=this;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i>256)){e.next=2;break}return e.abrupt("return",null);case 2:return n=t+i,e.abrupt("return",Ze(this._rangePromises,n,(function(){return a._glyphSource.getRange(t,i,r)})));case 4:case"end":return e.stop()}}),e,this)}))),function(e,i,r){return t.apply(this,arguments)})},{key:"_getMosaicItem",value:function(e,t,i){if(!e[i]){var r=this._glyphSource.getGlyph(t,i);if(!r||!r.metrics)return function(e){return{rect:new Ce.Z(0,0,0,0),page:0,metrics:{left:0,width:0,height:0,advance:0,top:0},code:e,sdf:!0}}(i);var n=this._recordGlyph(r),a=this._currentPage,s=r.metrics;e[i]={rect:n,page:a,metrics:s,code:i,sdf:!0},this._invalidate()}return e[i]}},{key:"_recordGlyph",value:function(e){var t,i=e.metrics;if(0===i.width)t=new Ce.Z(0,0,0,0);else{var r=i.width+6,n=i.height+6;(t=this._binPack.allocate(r,n)).isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyph(),this._binPack=new Be(this.width-4,this.height-4),t=this._binPack.allocate(r,n));var a,s,o=this._glyphData[this._currentPage],u=e.bitmap;if(u)for(var l=0;l<n;l++){a=r*l,s=this.width*(t.y+l)+t.x;for(var c=0;c<r;c++)o[s+c]=u[a+c]}(0,v.Z)("esri-glyph-debug")&&this._showDebugPage(o)}return t}},{key:"_showDebugPage",value:function(e){var t=document.createElement("canvas"),i=t.getContext("2d"),r=new ImageData(this.width,this.height),n=r.data;t.width=this.width,t.height=this.height,t.style.border="1px solid black";for(var a=0;a<e.length;++a)n[4*a+0]=e[a],n[4*a+1]=0,n[4*a+2]=0,n[4*a+3]=255;i.putImageData(r,0,0),document.body.appendChild(t)}}]),e}(),ze=i(87980);function Ue(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}var Le=function(){function e(t){for((0,a.Z)(this,e),this._metrics=[],this._bitmaps=[];t.next();)if(1===t.tag()){for(var i=t.getMessage();i.next();)if(3===i.tag()){for(var r=i.getMessage(),n=void 0,s=void 0,o=void 0,u=void 0,l=void 0,c=void 0,h=void 0;r.next();)switch(r.tag()){case 1:n=r.getUInt32();break;case 2:s=r.getBytes();break;case 3:o=r.getUInt32();break;case 4:u=r.getUInt32();break;case 5:l=r.getSInt32();break;case 6:c=r.getSInt32();break;case 7:h=r.getUInt32();break;default:r.skip()}r.release(),n&&(this._metrics[n]={width:o,height:u,left:l,top:c,advance:h},this._bitmaps[n]=s)}else i.skip();i.release()}else t.skip()}return(0,s.Z)(e,[{key:"getMetrics",value:function(e){return this._metrics[e]}},{key:"getBitmap",value:function(e){return this._bitmaps[e]}}]),e}(),Ve=function(){function e(){(0,a.Z)(this,e),this._ranges=[]}return(0,s.Z)(e,[{key:"getRange",value:function(e){return this._ranges[e]}},{key:"addRange",value:function(e,t){this._ranges[e]=t}}]),e}(),Ne=function(){function e(t){(0,a.Z)(this,e),this._glyphInfo={},this._baseURL=t}return(0,s.Z)(e,[{key:"getRange",value:function(e,t,i){var n=this._getFontStack(e);if(n.getRange(t))return Promise.resolve();var a=256*t,s=a+255,o=this._baseURL.replace("{fontstack}",e).replace("{range}",a+"-"+s);return(0,we.default)(o,function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Ue(Object(i),!0).forEach((function(t){(0,r.Z)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Ue(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({responseType:"array-buffer"},i)).then((function(e){n.addRange(t,new Le(new ze.Z(new Uint8Array(e.data),new DataView(e.data))))}))}},{key:"getGlyph",value:function(e,t){var i=this._getFontStack(e);if(i){var r=Math.floor(t/256);if(!(r>256)){var n=i.getRange(r);return n?{metrics:n.getMetrics(t),bitmap:n.getBitmap(t)}:void 0}}}},{key:"_getFontStack",value:function(e){var t=this._glyphInfo[e];return t||(t=this._glyphInfo[e]=new Ve),t}}]),e}(),Ge=i(12730),We=1e20,je=function(){function e(t){(0,a.Z)(this,e),this.size=t;var i=document.createElement("canvas");i.width=i.height=t,this._context=i.getContext("2d"),this._gridOuter=new Float64Array(t*t),this._gridInner=new Float64Array(t*t),this._f=new Float64Array(t),this._d=new Float64Array(t),this._z=new Float64Array(t+1),this._v=new Int16Array(t)}return(0,s.Z)(e,[{key:"dispose",value:function(){this._context=this._gridOuter=this._gridInner=this._f=this._d=this._z=this._v=null,this._svg&&(document.body.removeChild(this._svg),this._svg=null)}},{key:"draw",value:function(e,t){var i=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:31;this._initSVG();var n=this.createSVGString(e);return new Promise((function(e,a){var s=new Image;s.src="data:image/svg+xml; charset=utf8, "+encodeURIComponent(n),s.onload=function(){s.onload=null,i._context.clearRect(0,0,i.size,i.size),i._context.drawImage(s,0,0,i.size,i.size);for(var t=i._context.getImageData(0,0,i.size,i.size),n=new Uint8Array(i.size*i.size*4),a=0;a<i.size*i.size;a++){var o=t.data[4*a+3]/255;i._gridOuter[a]=1===o?0:0===o?We:Math.pow(Math.max(0,.5-o),2),i._gridInner[a]=1===o?We:0===o?0:Math.pow(Math.max(0,o-.5),2)}i._edt(i._gridOuter,i.size,i.size),i._edt(i._gridInner,i.size,i.size);for(var u=0;u<i.size*i.size;u++){var l=i._gridOuter[u]-i._gridInner[u];(0,Ge.I)(.5-l/(2*r),n,4*u)}e(n)};var o=t&&t.signal;o&&(0,Fe.fu)(o,(function(){return a((0,Fe.zE)())}))}))}},{key:"_initSVG",value:function(){if(!this._svg){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("style","position: absolute;"),e.setAttribute("width","0"),e.setAttribute("height","0"),e.setAttribute("aria-hidden","true"),e.setAttribute("role","presentation"),document.body.appendChild(e),this._svg=e}}},{key:"createSVGString",value:function(e){this._initSVG();var t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("d",e),this._svg.appendChild(t);var i,r,n,a,s=t.getBBox(),o=s.width/s.height,u=this.size/2;if(o>1){r=i=u/s.width;var l=u*(1/o);n=this.size/4,a=u-l/2}else i=r=u/s.height,n=u-u*o/2,a=this.size/4;var c=-s.x*i+n,h=-s.y*r+a;t.setAttribute("style","transform: matrix(".concat(i,", 0, 0, ").concat(r,", ").concat(c,", ").concat(h,")"));var f='<svg style="fill:red;" height="'.concat(this.size,'" width="').concat(this.size,'" xmlns="http://www.w3.org/2000/svg">').concat(this._svg.innerHTML,"</svg>");return this._svg.removeChild(t),f}},{key:"_edt",value:function(e,t,i){for(var r=this._f,n=this._d,a=this._v,s=this._z,o=0;o<t;o++){for(var u=0;u<i;u++)r[u]=e[u*t+o];this._edt1d(r,n,a,s,i);for(var l=0;l<i;l++)e[l*t+o]=n[l]}for(var c=0;c<i;c++){for(var h=0;h<t;h++)r[h]=e[c*t+h];this._edt1d(r,n,a,s,t);for(var f=0;f<t;f++)e[c*t+f]=Math.sqrt(n[f])}}},{key:"_edt1d",value:function(e,t,i,r,n){i[0]=0,r[0]=-We,r[1]=+We;for(var a=1,s=0;a<n;a++){for(var o=(e[a]+a*a-(e[i[s]]+i[s]*i[s]))/(2*a-2*i[s]);o<=r[s];)s--,o=(e[a]+a*a-(e[i[s]]+i[s]*i[s]))/(2*a-2*i[s]);i[++s]=a,r[s]=o,r[s+1]=+We}for(var u=0,l=0;u<n;u++){for(;r[l+1]<u;)l++;t[u]=(u-i[l])*(u-i[l])+e[i[l]]}}}]),e}(),He=i(29439),qe=i(17245);function Xe(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"==typeof e)return Ye(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Ye(e,t)}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==i.return||i.return()}finally{if(o)throw a}}}}function Ye(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function Qe(e){return e&&"static"===e.type}var Ke=function(){function e(t,i,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;(0,a.Z)(this,e),this._mosaicPages=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects=new Map,this._spriteCopyQueue=[],this.pixelRatio=1,(i<=0||r<=0)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=i,this._pageHeight=r,this._requestRender=t,n>0&&(this._maxItemSize=n),this.pixelRatio=window.devicePixelRatio||1,this._binPack=new Be(this._pageWidth,this._pageHeight);var s=Math.floor(this._pageWidth),o=Math.floor(this._pageHeight);this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(s*o)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0})}return(0,s.Z)(e,[{key:"getWidth",value:function(e){return e>=this._mosaicPages.length?-1:this._mosaicPages[e].size[0]}},{key:"getHeight",value:function(e){return e>=this._mosaicPages.length?-1:this._mosaicPages[e].size[1]}},{key:"getPageTexture",value:function(e){return e<this._mosaicPages.length?this._mosaicPages[e].texture:null}},{key:"has",value:function(e){return this._mosaicRects.has(e)}},{key:"itemCount",get:function(){return this._mosaicRects.size}},{key:"getSpriteItem",value:function(e){return this._mosaicRects.get(e)}},{key:"addSpriteItem",value:function(e,t,i,r,n,a){if(this._mosaicRects.has(e))return this._mosaicRects.get(e);var s,o,u;if(Qe(i)){var l=this._allocateImage(t[0],t[1]),c=(0,He.Z)(l,3);s=c[0],o=c[1],u=c[2]}else{s=new Ce.Z(0,0,t[0],t[1]),o=this._mosaicPages.length;this._mosaicPages.push({mosaicsData:i,size:t,dirty:!0,texture:void 0})}if(s.width<=0||s.height<=0)return null;var h={rect:s,width:t[0],height:t[1],sdf:n,simplePattern:a,pixelRatio:1,page:o};return this._mosaicRects.set(e,h),Qe(i)&&this._copy({rect:s,spriteSize:t,spriteData:i.data,page:o,pageSize:u,repeat:r,sdf:n}),h}},{key:"hasItemsToProcess",value:function(){return 0!==this._spriteCopyQueue.length}},{key:"processNextItem",value:function(){var e=this._spriteCopyQueue.pop();e&&this._copy(e)}},{key:"getSpriteItems",value:function(e){var t,i={},r=Xe(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;i[n]=this.getSpriteItem(n)}}catch(a){r.e(a)}finally{r.f()}return i}},{key:"getMosaicItemPosition",value:function(e){var t=this.getSpriteItem(e),i=t&&t.rect;if(!i)return null;i.width=t.width,i.height=t.height;var r=t.width,n=t.height,a=Re.fL,s=this._mosaicPages[t.page];return{size:[t.width,t.height],tl:[(i.x+a)/s[0],(i.y+a)/s[1]],br:[(i.x+a+r)/s[0],(i.y+a+n)/s[1]],page:t.page}}},{key:"bind",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=this._mosaicPages[i],a=n.mosaicsData,s=n.texture;if(s||(s=$e(e,a,n.size),n.texture=s),s.setSamplingMode(t),Qe(a))e.bindTexture(s,r),n.dirty&&(s.setData(new Uint8Array(a.data.buffer)),s.generateMipmap());else{var o=a.data,u=o.bindFrame(e,s,r);(0,m.pC)(this._requestRender)&&u&&o.frameCount>0&&this._requestRender.requestRender(),o.bindFrame(e,s,r)}n.dirty=!1}},{key:"_copy",value:function(t){if(!(t.page>=this._mosaicPages.length)){var i=this._mosaicPages[t.page],r=i.mosaicsData;if(!Qe(i.mosaicsData))throw new p.Z("mapview-invalid-resource","unsuitable data type!");var n=t.spriteData,a=r.data;a&&n||console.error("Source or target images are uninitialized!"),e._copyBits(n,t.spriteSize[0],0,0,a,t.pageSize[0],t.rect.x+Re.fL,t.rect.y+Re.fL,t.spriteSize[0],t.spriteSize[1],t.repeat),i.dirty=!0}}},{key:"_allocateImage",value:function(e,t){e+=2*Re.fL,t+=2*Re.fL;var i=Math.max(e,t);if(this._maxItemSize&&this._maxItemSize<i){var r=Math.pow(2,Math.ceil((0,qe.k3)(e))),n=Math.pow(2,Math.ceil((0,qe.k3)(t))),a=new Ce.Z(0,0,e,t);return this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(r*n)},size:[r,n],dirty:!0,texture:void 0}),[a,this._mosaicPages.length-1,[r,n]]}var s=this._binPack.allocate(e,t);if(s.width<=0){var o=this._mosaicPages[this._currentPage];return!o.dirty&&Qe(o.mosaicsData)&&(o.mosaicsData.data=null),this._currentPage=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(this._pageWidth*this._pageHeight)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0}),this._binPack=new Be(this._pageWidth,this._pageHeight),this._allocateImage(e,t)}return[s,this._currentPage,[this._pageWidth,this._pageHeight]]}},{key:"dispose",value:function(){this._binPack=null;var e,t=Xe(this._mosaicPages);try{for(t.s();!(e=t.n()).done;){var i=e.value,r=i.texture;r&&r.dispose();var n=i.mosaicsData;Qe(n)||n.data.pause()}}catch(a){t.e(a)}finally{t.f()}this._mosaicPages=null,this._mosaicRects.clear()}}],[{key:"_copyBits",value:function(e,t,i,r,n,a,s,o,u,l,c){var h=r*t+i,f=o*a+s;if(c){f-=a;for(var d=-1;d<=l;h=((++d+l)%l+r)*t+i,f+=a)for(var p=-1;p<=u;p++)n[f+p]=e[h+(p+u)%u]}else for(var _=0;_<l;_++){for(var v=0;v<u;v++)n[f+v]=e[h+v];h+=t,f+=a}}}]),e}();function $e(e,t,i){return Qe(t)?new M.Z(e,{pixelFormat:6408,dataType:5121,width:i[0],height:i[1]},new Uint8Array(t.data.buffer)):new M.Z(e,{pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:i[0],height:i[1]},null)}for(var Je=i(52917),et=new Uint32Array(256),tt=0;tt<256;tt++){for(var it=tt,rt=0;rt<8;rt++)it=0!=(1&it)?3988292384^it>>>1:it>>>1;et[tt]=it}var nt=new p.Z("Not a PNG"),at=new p.Z("Not an animated PNG"),st=new Uint8Array([137,80,78,71,13,10,26,10]);function ot(e){var t=e.constructor===Uint8Array?e:new Uint8Array(e);return!st.some((function(e,i){return e!==t[i]}))}function ut(e){var t=new Uint8Array(e);if(!ot(t))return!1;var i=!1;return dt(t,(function(e){return!(i="acTL"===e)})),i}var lt=function(){function e(){(0,a.Z)(this,e),this.width=0,this.height=0,this.numPlays=0,this.playTime=0,this.frames=[],this.paused=!1,this.playing=!1,this.playSpeed=1,this.currentFrameNumber=0,this._lastUsedFrame=-1}var t,i;return(0,s.Z)(e,[{key:"play",value:function(){this.playing||(this.paused=!1,this.playing=!0,this._play())}},{key:"pause",value:function(){this.paused=!0,this.playing=!1,clearTimeout(this.timerID)}},{key:"togglePlay",value:function(){this.paused||!this.playing?this.play():this.pause()}},{key:"bindFrame",value:function(e,t,i){e.bindTexture(t,i);var r=this.frameChanged();if(!r)return!1;var n=this.currentFrame,a=n.frameData,s=t.descriptor;return(n.left||n.top||n.width!==s.width||n.height!==s.height)&&t.setData(null),t.updateData(0,n.left,n.top,n.width,n.height,a),this.updateUsedFrame(),r}},{key:"frameChanged",value:function(){return this._lastUsedFrame!==this.currentFrameNumber}},{key:"updateUsedFrame",value:function(){this._lastUsedFrame=this.currentFrameNumber}},{key:"_load",value:(i=(0,n.Z)(d().mark((function e(t,i){var r,n=this;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,(r=ft(this,t))===this){e.next=4;break}return e.abrupt("return",r);case 4:return this._resizeCanvas=document.createElement("canvas"),this._resizeCanvas.width=this.width,this._resizeCanvas.height=this.height,e.next=9,Promise.all(this.frames.map((function(e){return e.createImage(n._resizeCanvas)})));case 9:e.next=15;break;case 11:if(e.prev=11,e.t0=e.catch(0),(0,Fe.D_)(e.t0)){e.next=15;break}return e.abrupt("return",new p.Z("invalid-resource","Could not parse PNG"));case 15:this.play();case 16:case"end":return e.stop()}}),e,this,[[0,11]])}))),function(e,t){return i.apply(this,arguments)})},{key:"_play",value:function(){var e,t,i=this;if(0!==this.playSpeed){this.playSpeed<0?(this.currentFrameNumber-=1,this.currentFrameNumber<0&&(this.currentFrameNumber=this.frames.length-1),t=this.currentFrameNumber,(t-=1)<0&&(t=this.frames.length-1),e=1*-this.frames[t].delay/this.playSpeed):(this.currentFrameNumber+=1,this.currentFrameNumber%=this.frames.length,e=1*this.frames[this.currentFrameNumber].delay/this.playSpeed);var r=this.frames[this.currentFrameNumber];this.currentFrame={frameData:r.imageData,top:r.top,left:r.left,width:r.width,height:r.height},this.timerID=window.setTimeout((function(){return i._play()}),e)}else this.pause()}}],[{key:"create",value:(t=(0,n.Z)(d().mark((function t(i,r){var n;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new e,t.prev=1,t.next=4,n._load(i,r);case 4:t.next=10;break;case 6:if(t.prev=6,t.t0=t.catch(1),(0,Fe.D_)(t.t0)){t.next=10;break}return t.abrupt("return",new p.Z("invalid-resource","Could not load PNG: ".concat(t.t0.message)));case 10:return t.abrupt("return",n);case 11:case"end":return t.stop()}}),t,null,[[1,6]])}))),function(e,i){return t.apply(this,arguments)})}]),e}(),ct=function(){function e(){(0,a.Z)(this,e),this.left=0,this.top=0,this.width=0,this.height=0,this.delay=0,this.disposeOp=0,this.blendOp=0,this.data=null,this.imageData=null}var t;return(0,s.Z)(e,[{key:"createImage",value:(t=(0,n.Z)(d().mark((function e(t){var i=this;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this.imageData){e.next=2;break}return e.abrupt("return",new Promise((function(e,r){var n=URL.createObjectURL(i.data),a=document.createElement("img");a.onload=function(){URL.revokeObjectURL(n),i.imageData=ht(a,t),e()},a.onerror=function(){URL.revokeObjectURL(n),i.imageData=null,r(new Error("Image creation error"))},a.src=n})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();function ht(e,t){t.width=e.width,t.height=e.height;var i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);for(var r,n=i.getImageData(0,0,e.width,e.height),a=new Uint8Array(n.data),s=0;s<a.length;s+=4)r=a[s+3]/255,a[s]=a[s]*r,a[s+1]=a[s+1]*r,a[s+2]=a[s+2]*r;return new ImageData(new Uint8ClampedArray(a.buffer),e.width,e.height)}function ft(e,t){var i=new Uint8Array(t);if(st.some((function(e,t){return e!==i[t]})))return nt;var r=!1;if(dt(i,(function(e){return!(r="acTL"===e)})),!r)return at;var n=[],a=[],s=null,o=null,u=0;if(dt(i,(function(t,i,r,l){var c=new DataView(i.buffer);switch(t){case"IHDR":s=i.subarray(r+8,r+8+l),e.width=c.getUint32(r+8),e.height=c.getUint32(r+12);break;case"acTL":e.numPlays=c.getUint32(r+8+4);break;case"fcTL":o&&(e.frames.push(o),u++),(o=new ct).width=c.getUint32(r+8+4),o.height=c.getUint32(r+8+8),o.left=c.getUint32(r+8+12),o.top=c.getUint32(r+8+16);var h=c.getUint16(r+8+20),f=c.getUint16(r+8+22);0===f&&(f=100),o.delay=1e3*h/f,o.delay<=10&&(o.delay=100),e.playTime+=o.delay,o.disposeOp=c.getUint8(r+8+24),o.blendOp=c.getUint8(r+8+25),o.dataParts=[],0===u&&2===o.disposeOp&&(o.disposeOp=1);break;case"fdAT":o&&o.dataParts.push(i.subarray(r+8+4,r+8+l));break;case"IDAT":o&&o.dataParts.push(i.subarray(r+8,r+8+l));break;case"IEND":a.push(_t(i,r,12+l));break;default:n.push(_t(i,r,12+l))}})),0===e.frames.length)return at;e.frameCount=e.frames.length;var l=new Blob(n),c=new Blob(a);return e.frames.forEach((function(e){var t=[];t.push(st),s.set(mt(e.width),0),s.set(mt(e.height),4),t.push(vt("IHDR",s)),t.push(l),e.dataParts.forEach((function(e){return t.push(vt("IDAT",e))})),t.push(c),e.data=new Blob(t,{type:"image/png"}),delete e.dataParts,t=null})),e}function dt(e,t){var i,r,n,a=new DataView(e.buffer),s=8;do{r=a.getUint32(s),n=t(i=pt(e,s+4,4),e,s,r),s+=12+r}while(!1!==n&&"IEND"!==i&&s<e.length)}function pt(e,t,i){var r=Array.prototype.slice.call(e.subarray(t,t+i));return String.fromCharCode.apply(String,r)}function _t(e,t,i){var r=new Uint8Array(i);return r.set(e.subarray(t,t+i)),r}function vt(e,t){var i=e.length+t.length,r=new Uint8Array(i+8),n=new DataView(r.buffer);n.setUint32(0,t.length),r.set(function(e){for(var t=new Uint8Array(e.length),i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t}(e),4),r.set(t,8);var a=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length-t,r=-1,n=t,a=t+i;n<a;n++)r=r>>>8^et[255&(r^e[n])];return-1^r}(r,4,i);return n.setUint32(i+4,a),r}function mt(e){return new Uint8Array([e>>>24&255,e>>>16&255,e>>>8&255,255&e])}var gt=249,yt=254,bt=255,wt=1,xt=44,Tt=59;function Ft(e){if(!e||0===e.byteLength)return!1;var t=e.constructor===Uint8Array?e:new Uint8Array(e);return 71===t[0]&&73===t[1]&&70===t[2]&&56===t[3]}function Et(e){if(!e||0===e.byteLength)return!1;var t=new Uint8Array(e);if(!Ft(t))return!1;for(var i=0,r=0,n=t.length-9;r<n&&(0!==t[r]||33!==t[r+1]||249!==t[r+2]||4!==t[r+3]||0!==t[r+8]||44!==t[r+9]&&33!==t[r+9]||!(++i>1));++r);return i>1}var kt=function(){function e(){(0,a.Z)(this,e),this.paused=!1,this.playing=!1,this.waitTillDone=!0,this.loading=!1,this.firstFrameOnly=!1,this.frames=[],this.comment="",this.length=0,this.currentFrameNumber=0,this.frameCount=0,this.playSpeed=1,this.lastFrame=null,this.playOnLoad=!0,this.complete=!1,this.interlaceOffsets=[0,4,2,1],this.interlaceSteps=[8,8,4,2],this._lastUsedFrame=-1}var t,i,r;return(0,s.Z)(e,[{key:"play",value:function(){this.playing||(this.paused=!1,this.playing=!0,this._play())}},{key:"pause",value:function(){this.paused=!0,this.playing=!1,clearTimeout(this.timerID)}},{key:"togglePlay",value:function(){this.paused||!this.playing?this.play():this.pause()}},{key:"bindFrame",value:function(e,t,i){e.bindTexture(t,i);var r=this.frameChanged();if(r){var n=this.currentFrame,a=n.frameData;t.updateData(0,0,0,n.width,n.height,a),this.updateUsedFrame()}return r}},{key:"seekFrame",value:function(e){clearTimeout(this.timerID),this.currentFrameNumber=e%this.frames.length,this.playing?this._play():this._setCurrentFrame(this.currentFrameNumber)}},{key:"seek",value:function(e){clearTimeout(this.timerID),e<0&&(e=0),e*=1e3,e%=this.length;for(var t=0;e>this.frames[t].time+this.frames[t].delay&&t<this.frames.length;)t+=1;this.currentFrameNumber=t,this.playing?this._play():this._setCurrentFrame(this.currentFrameNumber)}},{key:"frameChanged",value:function(){return this._lastUsedFrame!==this.currentFrameNumber}},{key:"updateUsedFrame",value:function(){this._lastUsedFrame=this.currentFrameNumber}},{key:"_load",value:(r=(0,n.Z)(d().mark((function e(t,i){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.loading=!0,e.next=4,this._parse(t,i);case 4:this.loading=!1,this.play(),e.next=12;break;case 8:if(e.prev=8,e.t0=e.catch(0),(0,Fe.D_)(e.t0)){e.next=12;break}return e.abrupt("return",new p.Z("invalid-resource","Could not parse gif!"));case 12:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e,t){return r.apply(this,arguments)})},{key:"_parse",value:function(e,t){var i=this,r=new St(e);r.pos+=6,this.width=r.data[r.pos++]+(r.data[r.pos++]<<8),this.height=r.data[r.pos++]+(r.data[r.pos++]<<8);var n=r.data[r.pos++];return this.globalColourCount=1<<1+(7&n),r.pos++,r.pos++,128&n&&(this.globalColourTable=this._parseColourTable(this.globalColourCount,r)),new Promise((function(e,n){setTimeout((function(){return i._parseBlock(r,e,n,t)}),0)}))}},{key:"_parseBlock",value:(i=(0,n.Z)(d().mark((function e(t,i,r,n){var a,s=this;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n&&n.signal&&(0,Fe.Hc)(n.signal))){e.next=2;break}return e.abrupt("return",void r((0,Fe.zE)()));case 2:if((a=t.data[t.pos++])!==xt){e.next=8;break}if(this._parseImg(t),!this.firstFrameOnly){e.next=6;break}return e.abrupt("return",(this._finishedLoading(),void i()));case 6:e.next=11;break;case 8:if(a!==Tt){e.next=10;break}return e.abrupt("return",(this._finishedLoading(),void i()));case 10:this._parseExt(t);case 11:"function"==typeof this.onprogress&&this.onprogress({bytesRead:t.pos,totalBytes:t.data.length,frame:this.frames.length}),setTimeout((function(){return s._parseBlock(t,i,r,n)}),0);case 12:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n){return i.apply(this,arguments)})},{key:"_parseColourTable",value:function(e,t){for(var i=[],r=0;r<e;r++)i.push([t.data[t.pos++],t.data[t.pos++],t.data[t.pos++]]);return i}},{key:"_parseImg",value:function(e){var t=this,i={};this.frames.push(i),i.disposalMethod=this.disposalMethod,i.time=this.length,i.delay=10*this.delayTime,this.length+=i.delay,this.transparencyGiven?i.transparencyIndex=this.transparencyIndex:i.transparencyIndex=void 0,i.leftPos=e.data[e.pos++]+(e.data[e.pos++]<<8),i.topPos=e.data[e.pos++]+(e.data[e.pos++]<<8),i.width=e.data[e.pos++]+(e.data[e.pos++]<<8),i.height=e.data[e.pos++]+(e.data[e.pos++]<<8);var r=e.data[e.pos++];i.localColourTableFlag=!!(128&r),i.localColourTableFlag&&(i.localColourTable=this._parseColourTable(1<<1+(7&r),e)),this.pixelBufSize!==i.width*i.height&&(this.pixelBuf=new Uint8Array(i.width*i.height),this.pixelBufSize=i.width*i.height),this._lzwDecode(e.data[e.pos++],e.readSubBlocksB()),64&r?(i.interlaced=!0,function(e){var i=t.pixelBufSize/e;t.interlacedBufSize!==t.pixelBufSize&&(t.deinterlaceBuf=new Uint8Array(t.pixelBufSize),t.interlacedBufSize=t.pixelBufSize);for(var r=0,n=0;n<4;n++)for(var a=t.interlaceOffsets[n];a<i;a+=t.interlaceSteps[n])t.deinterlaceBuf.set(t.pixelBuf.subarray(r,r+e),a*e),r+=e}(i.width)):i.interlaced=!1,this._processFrame(i)}},{key:"_lzwDecode",value:function(e,t){var i,r,n,a,s,o,u,l,c;n=r=0;var h=[],f=1<<e,d=f+1;for(a=e+1,c=!1;!c;){for(o=s,s=0,i=0;i<a;i++)t[n>>3]&1<<(7&n)&&(s|=1<<i),n++;if(s===f){for(h=[],a=e+1,i=0;i<f;i++)h[i]=[i];h[f]=[],h[d]=null}else{if(s===d)return void(c=!0);for(s>=h.length?h.push(h[o].concat(h[o][0])):o!==f&&h.push(h[o].concat(h[s][0])),l=(u=h[s]).length,i=0;i<l;i++)this.pixelBuf[r++]=u[i];h.length===1<<a&&a<12&&a++}}}},{key:"_processFrame",value:function(e){e.image=document.createElement("canvas"),e.image.width=this.width,e.image.height=this.height,e.ctx=e.image.getContext("2d");var t=e.localColourTableFlag?e.localColourTable:this.globalColourTable;null===this.lastFrame&&(this.lastFrame=e);var i=2===this.lastFrame.disposalMethod||3===this.lastFrame.disposalMethod;i||e.ctx.drawImage(this.lastFrame.image,0,0,this.width,this.height);for(var r,n,a=e.ctx.getImageData(e.leftPos,e.topPos,e.width,e.height),s=e.transparencyIndex,o=a.data,u=e.interlaced?this.deinterlaceBuf:this.pixelBuf,l=u.length,c=0,h=0;h<l;h++)n=t[r=u[h]],s!==r?(o[c++]=n[0],o[c++]=n[1],o[c++]=n[2],o[c++]=255):i?(o[c+3]=0,c+=4):c+=4;e.ctx.putImageData(a,e.leftPos,e.topPos),this.lastFrame=e}},{key:"_parseExt",value:function(e){var t=e.data[e.pos++];t===gt?this._parseGCExt(e):t===yt?this.comment+=e.readSubBlocks():t===bt?this._parseAppExt(e):(t===wt&&(e.pos+=13),e.readSubBlocks())}},{key:"_parseAppExt",value:function(e){e.pos+=1,"NETSCAPE"===e.getString(8)?e.pos+=8:(e.pos+=3,e.readSubBlocks())}},{key:"_parseGCExt",value:function(e){e.pos++;var t=e.data[e.pos++];this.disposalMethod=(28&t)>>2,this.transparencyGiven=!!(1&t),this.delayTime=e.data[e.pos++]+(e.data[e.pos++]<<8),this.transparencyIndex=e.data[e.pos++],e.pos++}},{key:"_finishedLoading",value:function(){this.loading=!1,this.frameCount=this.frames.length,this.lastFrame=null,this.complete=!0,this.disposalMethod=void 0,this.transparencyGiven=void 0,this.delayTime=void 0,this.transparencyIndex=void 0,this.waitTillDone=void 0,this.pixelBuf=void 0,this.deinterlaceBuf=void 0,this.pixelBufSize=void 0,this.deinterlaceBuf=void 0,this.currentFrameNumber=0,this.frames.length>0&&this._setCurrentFrame(0),this.playOnLoad&&this.play()}},{key:"_play",value:function(){var e,t,i=this;0!==this.playSpeed?(this.playSpeed<0?(this.currentFrameNumber-=1,this.currentFrameNumber<0&&(this.currentFrameNumber=this.frames.length-1),t=this.currentFrameNumber,(t-=1)<0&&(t=this.frames.length-1),e=1*-this.frames[t].delay/this.playSpeed):(this.currentFrameNumber+=1,this.currentFrameNumber%=this.frames.length,e=1*this.frames[this.currentFrameNumber].delay/this.playSpeed),this._setCurrentFrame(this.currentFrameNumber),this.timerID=window.setTimeout((function(){return i._play()}),e)):this.pause()}},{key:"_setCurrentFrame",value:function(e){var t=this.frames[e];this.currentFrame={frameData:t.image,top:0,left:0,width:this.width,height:this.height}}}],[{key:"create",value:(t=(0,n.Z)(d().mark((function t(i,r){var n;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new e,t.prev=1,t.next=4,n._load(i,r);case 4:t.next=10;break;case 6:if(t.prev=6,t.t0=t.catch(1),(0,Fe.D_)(t.t0)){t.next=10;break}return t.abrupt("return",new p.Z("invalid-resource","Could not load PNG: ".concat(t.t0.message)));case 10:return t.abrupt("return",n);case 11:case"end":return t.stop()}}),t,null,[[1,6]])}))),function(e,i){return t.apply(this,arguments)})}]),e}(),St=function(){function e(t){(0,a.Z)(this,e),this.pos=0,this.data=new Uint8ClampedArray(t),this.len=this.data.length}return(0,s.Z)(e,[{key:"getString",value:function(e){for(var t="";e--;)t+=String.fromCharCode(this.data[this.pos++]);return t}},{key:"readSubBlocks",value:function(){var e,t,i="";do{for(t=e=this.data[this.pos++];t--;)i+=String.fromCharCode(this.data[this.pos++])}while(0!==e&&this.pos<this.len);return i}},{key:"readSubBlocksB",value:function(){var e,t,i=[];do{for(t=e=this.data[this.pos++];t--;)i.push(this.data[this.pos++])}while(0!==e&&this.pos<this.len);return i}}]),e}(),Rt=i(10243);function Ot(e){switch(e.type){case"esriSMS":return"".concat(e.style,".").concat(e.path);case"esriSLS":return"".concat(e.style,".").concat(e.cap);case"esriSFS":return"".concat(e.style);case"esriPFS":case"esriPMS":return e.imageData?"".concat(e.imageData).concat(e.width).concat(e.height):"".concat(e.url).concat(e.width).concat(e.height);default:return"mosaicHash"in e?e.mosaicHash:JSON.stringify(e)}}var Ct=i(23277);function Bt(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function Mt(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Bt(Object(i),!0).forEach((function(t){(0,r.Z)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Bt(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var At=(0,ke.c)(),Pt="arial-unicode-ms-regular",Dt=Te.Z.getLogger("esri.views.2d.engine.webgl.TextureManager");function Zt(e,t){return It.apply(this,arguments)}function It(){return It=(0,n.Z)(d().mark((function e(t,i){var r,n,a,s,o,u,l,c,h,f;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(0,Je.Gr)(t),a=";base64,",!r.includes(a)){e.next=8;break}for(s=r.indexOf(a)+a.length,o=r.substring(s),u=atob(o),l=new Uint8Array(u.length),c=0;c<u.length;c++)l[c]=u.charCodeAt(c);n=l.buffer,e.next=20;break;case 8:return e.prev=8,e.next=11,(0,we.default)(r,Mt({responseType:"array-buffer"},i));case 11:h=e.sent,f=h.data,n=f,e.next=20;break;case 16:if(e.prev=16,e.t0=e.catch(8),(0,Fe.D_)(e.t0)){e.next=20;break}return e.abrupt("return",new p.Z("mapview-invalid-resource","Could not fetch requested resource at ".concat(r)));case 20:return e.abrupt("return",n);case 21:case"end":return e.stop()}}),e,null,[[8,16]])}))),It.apply(this,arguments)}function zt(e,t){var i=Math.round((0,Ee.F2)(t)*window.devicePixelRatio),r=i>=128?2:4;return Math.min(e,i*r)}var Ut=function(e,t,i){return Dt.error(new p.Z(e,t,i))},Lt=function(){function e(t,i,r){(0,a.Z)(this,e),this.mosaicType=t,this.page=i,this.sdf=r}return(0,s.Z)(e,null,[{key:"fromMosaic",value:function(t,i){return new e(t,i.page,i.sdf)}}]),e}(),Vt=function(){function e(t,i){var r;(0,a.Z)(this,e),this.resourceManager=i,this._invalidFontsMap=new Map,this._sdfConverter=new je(126),this._bindingInfos=new Array,this._hashToBindingIndex=new Map,this._ongoingRasterizations=new Map,this._imageRequestQueue=new Ct.e({concurrency:10,process:(r=(0,n.Z)(d().mark((function e(t,i){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,Fe.k_)(i),e.prev=1,e.next=4,(0,we.default)(t,{responseType:"image",signal:i});case 4:return e.abrupt("return",e.sent);case 7:if(e.prev=7,e.t0=e.catch(1),(0,Fe.D_)(e.t0)){e.next=11;break}throw new p.Z("mapview-invalid-resource","Could not fetch requested resource at ".concat(t),e.t0);case 11:throw e.t0;case 12:case"end":return e.stop()}}),e,null,[[1,7]])}))),function(e,t){return r.apply(this,arguments)})}),this._spriteMosaic=new Ke(t,2048,2048,500),this._glyphSource=new Ne("".concat(be.Z.fontsUrl,"/{fontstack}/{range}.pbf")),this._glyphMosaic=new Ie(1024,1024,this._glyphSource),this._rasterizer=new Se.Z(i)}var t,i,r,o,u,l,c,h;return(0,s.Z)(e,[{key:"dispose",value:function(){this._spriteMosaic.dispose(),this._glyphMosaic.dispose(),this._rasterizer.dispose(),this._sdfConverter.dispose(),this._spriteMosaic=null,this._glyphMosaic=null,this._sdfConverter=null,this._hashToBindingIndex.clear(),this._hashToBindingIndex=null,this._bindingInfos=null,this._ongoingRasterizations.clear(),this._ongoingRasterizations=null,this._imageRequestQueue.clear(),this._imageRequestQueue=null}},{key:"sprites",get:function(){return this._spriteMosaic}},{key:"glyphs",get:function(){return this._glyphMosaic}},{key:"rasterizeItem",value:(h=(0,n.Z)(d().mark((function e(t,i,r,n){var a,s,o=this;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,m.Wi)(t)){e.next=2;break}return e.abrupt("return",(Ut("mapview-null-resource","Unable to rasterize null resource"),null));case 2:e.t0=t.type,e.next="text"===e.t0||"esriTS"===e.t0?5:9;break;case 5:return e.next=7,this._rasterizeText(t,r,n);case 7:return a=e.sent,e.abrupt("return",(a.forEach((function(e){return o._setTextureBinding(Z.Un.GLYPH,e)})),{glyphMosaicItems:a}));case 9:if(!(0,Je.Ll)(t)){e.next=11;break}return e.abrupt("return",(Ut("mapview-invalid-type","MapView does not support symbol type: ".concat(t.type),t),null));case 11:return e.next=13,this._rasterizeSpriteSymbol(t,i,n);case 13:return s=e.sent,e.abrupt("return",((0,Rt.ok)(s)&&s&&this._setTextureBinding(Z.Un.SPRITE,s),{spriteMosaicItem:s}));case 15:case"end":return e.stop()}}),e,this)}))),function(e,t,i,r){return h.apply(this,arguments)})},{key:"bindTextures",value:function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(0!==i.textureBinding){var n=this._bindingInfos[i.textureBinding-1],a=n.page,s=r?9987:9729;switch(n.mosaicType){case Z.Un.SPRITE:var o=this.sprites.getWidth(a),u=this.sprites.getHeight(a),l=(0,F.s)(At,o,u);return this._spriteMosaic.bind(e,s,a,Re.D3),t.setUniform1i("u_texture",Re.D3),void t.setUniform2fv("u_mosaicSize",l);case Z.Un.GLYPH:var c=this.glyphs.width,h=this.glyphs.height,f=(0,F.s)(At,c,h);return this._glyphMosaic.bind(e,s,a,Re.Al),t.setUniform1i("u_texture",Re.Al),void t.setUniform2fv("u_mosaicSize",f);default:Dt.error("mapview-texture-manager","Cannot handle unknown type ".concat(n.mosaicType))}}}},{key:"_hashMosaic",value:function(e,t){return 1|e<<1|(t.sdf?1:0)<<2|t.page<<3}},{key:"_setTextureBinding",value:function(e,t){var i=this._hashMosaic(e,t);if(!this._hashToBindingIndex.has(i)){var r=Lt.fromMosaic(e,t),n=this._bindingInfos.length+1;this._hashToBindingIndex.set(i,n),this._bindingInfos.push(r)}t.textureBinding=this._hashToBindingIndex.get(i)}},{key:"_rasterizeText",value:(c=(0,n.Z)(d().mark((function e(t,i,r){var n,a,s,o,u,l;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"cim"in t?(n=(s=t).fontName,a=s.text):(n=Oe((o=t).font),a=o.text),u=this._invalidFontsMap.has(n),l=i||(0,Je.Jq)((0,xe.E)(a)[0]),e.prev=2,e.next=5,this._glyphMosaic.getGlyphItems(u?Pt:n,l,r);case 5:return e.abrupt("return",e.sent);case 8:return e.prev=8,e.t0=e.catch(2),e.abrupt("return",(Ut("mapview-invalid-resource","Couldn't find font ".concat(n,". Falling back to Arial Unicode MS Regular")),this._invalidFontsMap.set(n,!0),this._glyphMosaic.getGlyphItems(Pt,l,r)));case 11:case"end":return e.stop()}}),e,this,[[2,8]])}))),function(e,t,i){return c.apply(this,arguments)})},{key:"_rasterizeSpriteSymbol",value:(l=(0,n.Z)(d().mark((function e(t,i,r){var n,a,s,o,u,l;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,Je.Gg)(t)){e.next=2;break}return e.abrupt("return",null);case 2:if(n=Ot(t),!this._spriteMosaic.has(n)){e.next=5;break}return e.abrupt("return",this._spriteMosaic.getSpriteItem(n));case 5:if(!(0,Je.sG)(t)&&!(0,Je.HX)(t)){e.next=7;break}return e.abrupt("return",this._handleAsyncResource(n,t,r));case 7:if(!(a=this._rasterizer.rasterizeJSONResource(t,1))){e.next=11;break}return s=a.size,o=a.image,u=a.sdf,l=a.simplePattern,e.abrupt("return",this._addItemToMosaic(n,s,{type:"static",data:o},(0,Je.js)(t),u,l));case 11:return e.abrupt("return",new p.Z("TextureManager","unrecognized or null rasterized image"));case 12:case"end":return e.stop()}}),e,this)}))),function(e,t,i){return l.apply(this,arguments)})},{key:"_handleAsyncResource",value:(u=(0,n.Z)(d().mark((function e(t,i,r){var n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._ongoingRasterizations.has(t)){e.next=2;break}return e.abrupt("return",this._ongoingRasterizations.get(t));case 2:return n=(0,Je.sG)(i)?this._handleSVG(i,t,r):this._handleImage(i,t,r),this._ongoingRasterizations.set(t,n),e.prev=3,e.next=6,n;case 6:this._ongoingRasterizations.delete(t),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),this._ongoingRasterizations.delete(t);case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}}),e,this,[[3,9]])}))),function(e,t,i){return u.apply(this,arguments)})},{key:"_handleSVG",value:(o=(0,n.Z)(d().mark((function e(t,i,r){var n,a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[126,126],e.next=3,this._sdfConverter.draw(t.path,r);case 3:return a=e.sent,e.abrupt("return",this._addItemToMosaic(i,n,{type:"static",data:new Uint32Array(a.buffer)},!1,!0,!0));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,i){return o.apply(this,arguments)})},{key:"_handleGIFOrPNG",value:(r=(0,n.Z)(d().mark((function e(t,i,r){var n,a,s,o,u,l,c,h,f,_,v,m,g;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Zt(t,r);case 2:if(n=e.sent,!(0,Rt.ok)(n)){e.next=36;break}if(a=Ft(n),s=ot(n),a||s){e.next=7;break}return e.abrupt("return",new p.Z("mapview-invalid-resource","Image data is neither GIF nor PNG!"));case 7:if(e.prev=7,!a||!Et(n)){e.next=14;break}return e.next=11,kt.create(n,r);case 11:o=e.sent,e.next=19;break;case 14:if(e.t0=s&&ut(n),!e.t0){e.next=19;break}return e.next=18,lt.create(n,r);case 18:o=e.sent;case 19:e.next=25;break;case 21:if(e.prev=21,e.t1=e.catch(7),(0,Fe.D_)(e.t1)){e.next=25;break}return e.abrupt("return",new p.Z("mapview-invalid-resource","Could not fetch requested resource!"));case 25:if(!o||!(0,Rt.ok)(o)){e.next=27;break}return e.abrupt("return",this._addItemToMosaic(i,[o.width,o.height],{type:"animated",data:o},(0,Je.js)(t),!1,!1));case 27:return u=new Blob([n],{type:a?"image/gif":"image/png"}),e.next=30,this._imageFromBlob(u);case 30:if(!((l=e.sent)&&l instanceof HTMLImageElement)){e.next=36;break}return c=l.width,h=l.height,"esriPMS"===t.type&&(c=Math.round(zt(l.width,(0,Je.Ub)(t))),h=Math.round(l.height*(c/l.width))),f="cim"in t?t.cim.colorSubstitutions:void 0,_=this._rasterizer.rasterizeImageResource(c,h,l,f),v=_.size,m=_.sdf,g=_.image,e.abrupt("return",this._addItemToMosaic(i,v,{type:"static",data:g},(0,Je.js)(t),m,!1));case 36:return e.abrupt("return",new p.Z("mapview-invalid-resource","Could not handle resource!"));case 37:case"end":return e.stop()}}),e,this,[[7,21]])}))),function(e,t,i){return r.apply(this,arguments)})},{key:"_handleImage",value:(i=(0,n.Z)(d().mark((function e(t,i,r){var n,a,s,o,u,l,c,h,f,_,v,g,y,b;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,Je.DQ)(t)&&!(0,Je.iw)(t)){e.next=2;break}return e.abrupt("return",this._handleGIFOrPNG(t,i,r));case 2:if(n=(0,Je.Gr)(t),e.prev=3,s=this.resourceManager.getResource(n),!(0,m.pC)(s)){e.next=9;break}a=s,e.next=14;break;case 9:return e.next=11,this._imageRequestQueue.push(n,Mt({},r));case 11:o=e.sent,u=o.data,a=u;case 14:if((0,Je.TB)(n)&&("width"in t&&"height"in t?(a.width=(0,Ee.F2)(t.width),a.height=(0,Ee.F2)(t.height)):"cim"in t&&(c=t.cim,a.width=(0,Ee.F2)(null!=(l=c.width)?l:c.scaleX*c.size),a.height=(0,Ee.F2)(c.size))),a.width&&a.height){e.next=17;break}return e.abrupt("return",null);case 17:return h=a.width,f=a.height,"esriPMS"===t.type&&(h=Math.round(zt(a.width,(0,Je.Ub)(t))),f=Math.round(a.height*(h/a.width))),_="cim"in t?t.cim.colorSubstitutions:void 0,v=this._rasterizer.rasterizeImageResource(h,f,a,_),g=v.size,y=v.sdf,b=v.image,e.abrupt("return",this._addItemToMosaic(i,g,{type:"static",data:b},(0,Je.js)(t),y,!1));case 23:if(e.prev=23,e.t0=e.catch(3),(0,Fe.D_)(e.t0)){e.next=27;break}return e.abrupt("return",new p.Z("mapview-invalid-resource","Could not fetch requested resource at ".concat(n,". ").concat(e.t0.message)));case 27:case"end":return e.stop()}}),e,this,[[3,23]])}))),function(e,t,r){return i.apply(this,arguments)})},{key:"_imageFromBlob",value:(t=(0,n.Z)(d().mark((function e(t){var i,r,n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=window.URL.createObjectURL(t),e.prev=1,e.next=4,this._imageRequestQueue.push(i);case 4:return r=e.sent,n=r.data,e.abrupt("return",(window.URL.revokeObjectURL(i),n));case 9:if(e.prev=9,e.t0=e.catch(1),window.URL.revokeObjectURL(i),(0,Fe.D_)(e.t0)){e.next=13;break}return e.abrupt("return",new p.Z("mapview-invalid-resource","Could not fetch requested resource at ".concat(i)));case 13:throw e.t0;case 14:case"end":return e.stop()}}),e,this,[[1,9]])}))),function(e){return t.apply(this,arguments)})},{key:"_addItemToMosaic",value:function(e,t,i,r,n,a){return this._spriteMosaic.addSpriteItem(e,t,i,r,n,a)}}]),e}(),Nt=i(66629),Gt=(0,s.Z)((function e(){(0,a.Z)(this,e),this.name=this.constructor.name}));function Wt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(V){return!1}}();return function(){var i,r=(0,h.Z)(e);if(t){var n=(0,h.Z)(this).constructor;i=Reflect.construct(r,arguments,n)}else i=r.apply(this,arguments);return(0,c.Z)(this,i)}}var jt=function(e){(0,l.Z)(i,e);var t=Wt(i);function i(){var e;return(0,a.Z)(this,i),(e=t.apply(this,arguments)).defines=[],e._desc={vsPath:"fx/integrate",fsPath:"fx/integrate",attributes:new Map([["a_position",0]])},e}return(0,s.Z)(i,[{key:"dispose",value:function(){this._quad&&this._quad.dispose()}},{key:"bind",value:function(){}},{key:"unbind",value:function(){}},{key:"draw",value:function(e,t){if(t.size){var i=e.context,r=e.renderingOptions;this._quad||(this._quad=new Nt.Z(i,[0,0,1,0,0,1,1,1]));var n=i.getBoundFramebufferObject(),a=i.getViewport(),s=a.x,o=a.y,u=a.width,l=a.height;t.bindTextures(i);var c=t.getBlock(Re.xl);if(!(0,m.Wi)(c)){var h=c.getFBO(i),f=c.getFBO(i,1);i.setViewport(0,0,t.size,t.size),this._computeDelta(e,f,r.labelsAnimationTime),this._updateAnimationState(e,f,h),i.bindFramebuffer(n),i.setViewport(s,o,u,l)}}}},{key:"_computeDelta",value:function(e,t,i){var r=e.context,n=e.painter,a=e.displayLevel,s=n.materialManager.getProgram(e,this._desc,["delta"]);r.bindFramebuffer(t),r.setClearColor(0,0,0,0),r.clear(r.gl.COLOR_BUFFER_BIT),r.useProgram(s),s.setUniform1i("u_maskTexture",Re.iJ),s.setUniform1i("u_sourceTexture",Re.nM),s.setUniform1f("u_timeDelta",e.deltaTime),s.setUniform1f("u_animationTime",i),s.setUniform1f("u_zoomLevel",Math.round(10*a)),this._quad.draw()}},{key:"_updateAnimationState",value:function(e,t,i){var r=e.context,n=e.painter.materialManager.getProgram(e,this._desc,["update"]);r.bindTexture(t.colorTexture,1),r.useProgram(n),n.setUniform1i("u_sourceTexture",1),r.bindFramebuffer(i),r.setClearColor(0,0,0,0),r.clear(r.gl.COLOR_BUFFER_BIT),this._quad.draw()}}]),i}(Gt),Ht=function(e){return"#define ".concat(function(e){return e.replace("-","_").toUpperCase()}(e),"\n")},qt={attributes:new Map([["a_pos",0],["a_tex",1]]),shaders:function(e){return{vertexShader:Ht(e)+(0,ae.w)("blend/blend.vert"),fragmentShader:Ht(e)+(0,ae.w)("blend/blend.frag")}}},Xt=Te.Z.getLogger("esri.views.2d.engine.webgl.effects.blendEffects.BlendEffect"),Yt=function(){function e(){(0,a.Z)(this,e),this._size=[0,0]}return(0,s.Z)(e,[{key:"dispose",value:function(e){this._backBufferTexture&&(this._backBufferTexture.dispose(),this._backBufferTexture=null),this._programCache&&(this._programCache.dispose(),this._programCache=null),this._quad&&(this._quad.dispose(),this._quad=null)}},{key:"draw",value:function(e,t,i,r,n){var a=e.context,s=e.drawPhase;if(this._setupShader(a),r&&"normal"!==r&&s!==Z.jx.LABEL)this._drawBlended(e,t,i,r,n);else{var o=this._programCache.getProgram(qt,"normal");if(o){a.useProgram(o),t.setSamplingMode(i),a.bindTexture(t,0),o.setUniform1i("u_layerTexture",0),o.setUniform1f("u_opacity",n),a.setBlendingEnabled(!0),a.setBlendFunction(1,771);var u=this._quad;u.draw(),u.unbind()}else Xt.error(new p.Z("mapview-BlendEffect",'Error creating shader program for blend mode "normal"'))}}},{key:"_drawBlended",value:function(e,t,i,r,n){var a,s,o=e.context,u=e.state,l=e.pixelRatio,c=e.inFadeTransition,h=u.size,f=o.getBoundFramebufferObject();if((0,m.pC)(f)){var d=f.descriptor;a=d.width,s=d.height}else a=Math.round(l*h[0]),s=Math.round(l*h[1]);this._createOrResizeTexture(e,a,s);var _=this._backBufferTexture;f.copyToTexture(0,0,a,s,0,0,_),o.setStencilTestEnabled(!1),o.setStencilWriteMask(0),o.setBlendingEnabled(!0),o.setDepthTestEnabled(!1),o.setDepthWriteEnabled(!1);var v=this._programCache.getProgram(qt,r);if(v){o.useProgram(v),_.setSamplingMode(i),o.bindTexture(_,0),v.setUniform1i("u_backbufferTexture",0),t.setSamplingMode(i),o.bindTexture(t,1),v.setUniform1i("u_layerTexture",1),v.setUniform1f("u_opacity",n),v.setUniform1f("u_inFadeOpacity",c?1:0),o.setBlendFunction(1,0);var g=this._quad;g.draw(),g.unbind(),o.setBlendFunction(1,771)}else Xt.error(new p.Z("mapview-BlendEffect","Error creating shader program for blend mode ".concat(r)))}},{key:"_setupShader",value:function(e){this._programCache||(this._programCache=new ue.Z(e),this._quad||(this._quad=new Nt.Z(e,[-1,-1,1,-1,-1,1,1,1])))}},{key:"_createOrResizeTexture",value:function(e,t,i){var r=e.context;null!==this._backBufferTexture&&t===this._size[0]&&i===this._size[1]||(this._backBufferTexture?this._backBufferTexture.resize(t,i):this._backBufferTexture=new M.Z(r,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:t,height:i}),this._size[0]=t,this._size[1]=i)}}]),e}();function Qt(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"==typeof e)return Kt(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Kt(e,t)}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==i.return||i.return()}finally{if(o)throw a}}}}function Kt(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function $t(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(V){return!1}}();return function(){var i,r=(0,h.Z)(e);if(t){var n=(0,h.Z)(this).constructor;i=Reflect.construct(r,arguments,n)}else i=r.apply(this,arguments);return(0,c.Z)(this,i)}}var Jt=function(e){(0,l.Z)(i,e);var t=$t(i);function i(e){var r;return(0,a.Z)(this,i),(r=t.call(this)).name=r.constructor.name,r.defines=[e],r}return(0,s.Z)(i,[{key:"dispose",value:function(){}},{key:"bind",value:function(e){var t=e.context,i=e.painter;this._prev=t.getBoundFramebufferObject();var r=t.getViewport(),n=r.width,a=r.height,s=i.getFbos(n,a).effect0;t.bindFramebuffer(s),t.setColorMask(!0,!0,!0,!0),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT)}},{key:"unbind",value:function(){}},{key:"draw",value:function(e,t){var i,r=e.context,n=e.painter,a=n.getPostProcessingEffects(t),s=r.getBoundFramebufferObject(),o=Qt(a);try{for(o.s();!(i=o.n()).done;){var u=i.value,l=u.postProcessingEffect,c=u.effect;l.draw(e,s,c)}}catch(h){o.e(h)}finally{o.f()}r.bindFramebuffer(this._prev),r.setStencilTestEnabled(!1),n.blitTexture(r,s.colorTexture,9728),r.setStencilTestEnabled(!0)}}]),i}(Gt),ei=[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],ti=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],ii=256,ri=.7,ni=.7,ai=.7,si=0,oi=Te.Z.getLogger("esri.views.2d.engine.webgl.painter.highlight.HighlightGradient");var ui=[0,0,0,0],li=function(){function e(){(0,a.Z)(this,e),this._convertedHighlightOptions={fillColor:[.2*.75,.6*.75,.675,.75],outlineColor:[.2*.9,.54,.81,.9],outlinePosition:si,outlineWidth:ri,innerHaloWidth:ai,outerHaloWidth:ni},this.shadeTexChanged=!0,this.texelData=new Uint8Array(1024),this.minMaxDistance=[0,0]}return(0,s.Z)(e,[{key:"setHighlightOptions",value:function(e){var t=this._convertedHighlightOptions;!function(e,t){t.fillColor[0]=e.color.r/255,t.fillColor[1]=e.color.g/255,t.fillColor[2]=e.color.b/255,t.fillColor[3]=e.color.a,e.haloColor?(t.outlineColor[0]=e.haloColor.r/255,t.outlineColor[1]=e.haloColor.g/255,t.outlineColor[2]=e.haloColor.b/255,t.outlineColor[3]=e.haloColor.a):(t.outlineColor[0]=t.fillColor[0],t.outlineColor[1]=t.fillColor[1],t.outlineColor[2]=t.fillColor[2],t.outlineColor[3]=t.fillColor[3]),t.fillColor[3]*=e.fillOpacity,t.outlineColor[3]*=e.haloOpacity,t.fillColor[0]*=t.fillColor[3],t.fillColor[1]*=t.fillColor[3],t.fillColor[2]*=t.fillColor[3],t.outlineColor[0]*=t.outlineColor[3],t.outlineColor[1]*=t.outlineColor[3],t.outlineColor[2]*=t.outlineColor[3],t.outlineWidth=ri,t.outerHaloWidth=ni,t.innerHaloWidth=ai,t.outlinePosition=si}(e,t);var i,r=t.outlinePosition-t.outlineWidth/2-t.outerHaloWidth,n=t.outlinePosition-t.outlineWidth/2,a=t.outlinePosition+t.outlineWidth/2,s=t.outlinePosition+t.outlineWidth/2+t.innerHaloWidth,o=1*Math.sqrt(Math.PI/2),u=Math.abs(r)>o?Math.round(10*(Math.abs(r)-o))/10:0,l=Math.abs(s)>o?Math.round(10*(Math.abs(s)-o))/10:0;u&&!l?oi.error("The outer rim of the highlight is "+u+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards)."):!u&&l?oi.error("The inner rim of the highlight is "+l+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards)."):u&&l&&oi.error("The highlight is "+Math.max(u,l)+"px away from the edge of the feature; consider reducing some width values.");var c=[void 0,void 0,void 0,void 0];function h(e,t,i){c[0]=(1-i)*e[0]+i*t[0],c[1]=(1-i)*e[1]+i*t[1],c[2]=(1-i)*e[2]+i*t[2],c[3]=(1-i)*e[3]+i*t[3]}for(var f=this.texelData,d=0;d<ii;++d){var p,_,v,m;(i=r+d/255*(s-r))<r?(c[4*d+0]=0,c[4*d+1]=0,c[4*d+2]=0,c[4*d+3]=0):i<n?h(ui,t.outlineColor,(i-r)/(n-r)):i<a?(p=t.outlineColor,_=(0,He.Z)(p,4),c[0]=_[0],c[1]=_[1],c[2]=_[2],c[3]=_[3]):i<s?h(t.outlineColor,t.fillColor,(i-a)/(s-a)):(v=t.fillColor,m=(0,He.Z)(v,4),c[4*d+0]=m[0],c[4*d+1]=m[1],c[4*d+2]=m[2],c[4*d+3]=m[3]),f[4*d+0]=255*c[0],f[4*d+1]=255*c[1],f[4*d+2]=255*c[2],f[4*d+3]=255*c[3]}this.minMaxDistance[0]=r,this.minMaxDistance[1]=s,this.shadeTexChanged=!0}},{key:"applyHighlightOptions",value:function(e,t){this.shadeTex||(this.shadeTex=new M.Z(e,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,width:ii,height:1,samplingMode:9729})),this.shadeTexChanged&&(this.shadeTex.updateData(0,0,0,ii,1,this.texelData),this.shadeTexChanged=!1),e.bindTexture(this.shadeTex,Re.Jw),t.setUniform2fv("u_minMaxDistance",this.minMaxDistance)}},{key:"destroy",value:function(){this.shadeTex&&(this.shadeTex.dispose(),this.shadeTex=null)}}]),e}(),ci={shaders:{vertexShader:(0,ae.w)("highlight/textured.vert"),fragmentShader:(0,ae.w)("highlight/highlight.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])},hi={shaders:{vertexShader:(0,ae.w)("highlight/textured.vert"),fragmentShader:(0,ae.w)("highlight/blur.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])},fi=function(){function e(){(0,a.Z)(this,e),this._width=void 0,this._height=void 0,this._resources=null}return(0,s.Z)(e,[{key:"dispose",value:function(){this._resources&&(this._resources.quadGeometry.dispose(),this._resources.quadVAO.dispose(),this._resources.highlightProgram.dispose(),this._resources.blurProgram.dispose(),this._resources=null)}},{key:"preBlur",value:function(e,t){e.bindTexture(t,Re.QU),e.useProgram(this._resources.blurProgram),this._resources.blurProgram.setUniform4fv("u_direction",[1,0,1/this._width,0]),this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",ei),e.bindVAO(this._resources.quadVAO),e.drawArrays(5,0,4),e.bindVAO()}},{key:"finalBlur",value:function(e,t){e.bindTexture(t,Re.QU),e.useProgram(this._resources.blurProgram),this._resources.blurProgram.setUniform4fv("u_direction",[0,1,0,1/this._height]),this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",ti),e.bindVAO(this._resources.quadVAO),e.drawArrays(5,0,4),e.bindVAO()}},{key:"renderHighlight",value:function(e,t,i){e.bindTexture(t,Re.QU),e.useProgram(this._resources.highlightProgram),i.applyHighlightOptions(e,this._resources.highlightProgram),e.bindVAO(this._resources.quadVAO),e.setBlendingEnabled(!0),e.setBlendFunction(1,771),e.drawArrays(5,0,4),e.bindVAO()}},{key:"_initialize",value:function(e,t,i){this._width=t,this._height=i;var r=S.Z.createVertex(e,35044,new Int8Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]).buffer),n=new A.Z(e,new Map([["a_position",0],["a_texcoord",1]]),{geometry:[{name:"a_position",count:2,type:5120,offset:0,stride:4,normalized:!1},{name:"a_texcoord",count:2,type:5121,offset:2,stride:4,normalized:!1}]},{geometry:r}),a=(0,B.H)(e,ci),s=(0,B.H)(e,hi);a.setUniform1i("u_texture",Re.QU),a.setUniform1i("u_shade",Re.Jw),a.setUniform1f("u_sigma",1),s.setUniform1i("u_texture",Re.QU),s.setUniform1f("u_sigma",1),this._resources={quadGeometry:r,quadVAO:n,highlightProgram:a,blurProgram:s}}},{key:"setup",value:function(e,t,i){this._resources?(this._width=t,this._height=i):this._initialize(e,t,i)}}]),e}();function di(e,t,i){var r=new M.Z(e,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,width:t,height:i,samplingMode:9729});return[r,new R.Z(e,{colorTarget:0,depthStencilTarget:2},r)]}var pi=function(){function e(){(0,a.Z)(this,e),this._width=void 0,this._height=void 0,this._resources=null}return(0,s.Z)(e,[{key:"dispose",value:function(){this._resources&&(this._resources.sharedBlur1Tex.dispose(),this._resources.sharedBlur1Fbo.dispose(),this._resources.sharedBlur2Tex.dispose(),this._resources.sharedBlur2Fbo.dispose(),this._resources=null)}},{key:"_initialize",value:function(e,t,i){this._width=t,this._height=i;var r=di(e,t,i),n=(0,He.Z)(r,2),a=n[0],s=n[1],o=di(e,t,i),u=(0,He.Z)(o,2),l=u[0],c=u[1];this._resources={sharedBlur1Tex:a,sharedBlur1Fbo:s,sharedBlur2Tex:l,sharedBlur2Fbo:c}}},{key:"setup",value:function(e,t,i){!this._resources||this._width===t&&this._height===i||this.dispose(),this._resources||this._initialize(e,t,i)}},{key:"sharedBlur1Tex",get:function(){return this._resources.sharedBlur1Tex}},{key:"sharedBlur1Fbo",get:function(){return this._resources.sharedBlur1Fbo}},{key:"sharedBlur2Tex",get:function(){return this._resources.sharedBlur2Tex}},{key:"sharedBlur2Fbo",get:function(){return this._resources.sharedBlur2Fbo}}]),e}();function _i(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(V){return!1}}();return function(){var i,r=(0,h.Z)(e);if(t){var n=(0,h.Z)(this).constructor;i=Reflect.construct(r,arguments,n)}else i=r.apply(this,arguments);return(0,c.Z)(this,i)}}var vi=function(e){(0,l.Z)(i,e);var t=_i(i);function i(){var e;return(0,a.Z)(this,i),(e=t.apply(this,arguments)).defines=["highlight"],e._hlRenderer=new fi,e._hlGradient=new li,e._width=void 0,e._height=void 0,e._hlSurfaces=new pi,e._adjustedWidth=void 0,e._adjustedHeight=void 0,e._blitRenderer=new oe,e}return(0,s.Z)(i,[{key:"dispose",value:function(){this._hlSurfaces&&this._hlSurfaces.dispose(),this._hlRenderer&&this._hlRenderer.dispose(),this._hlGradient&&this._hlGradient.destroy(),this._boundFBO=null}},{key:"bind",value:function(e){var t=e.context,i=e.painter,r=t.getViewport(),n=r.width,a=r.height,s=i.getFbos(n,a).effect0;this.setup(e,n,a),t.bindFramebuffer(s),t.setColorMask(!0,!0,!0,!0),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT)}},{key:"unbind",value:function(){}},{key:"setup",value:function(e,t,i){var r=e.context;this._width=t,this._height=i;var n=t%4,a=i%4;t+=n<2?-n:4-n,i+=a<2?-a:4-a,this._adjustedWidth=t,this._adjustedHeight=i,this._boundFBO=r.getBoundFramebufferObject();var s=Math.round(1*t),o=Math.round(1*i);this._hlRenderer.setup(r,s,o),this._hlSurfaces.setup(r,s,o)}},{key:"draw",value:function(e){var t=e.context,i=t.getBoundFramebufferObject();t.setViewport(0,0,1*this._adjustedWidth,1*this._adjustedHeight),t.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),t.setStencilTestEnabled(!1),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT),this._blitRenderer.render(t,i.colorTexture,9728,1),t.setStencilTestEnabled(!1),t.setBlendingEnabled(!1),t.setColorMask(!1,!1,!1,!0),t.bindFramebuffer(this._hlSurfaces.sharedBlur2Fbo),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT),this._hlRenderer.preBlur(t,this._hlSurfaces.sharedBlur1Tex),t.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT),this._hlRenderer.finalBlur(t,this._hlSurfaces.sharedBlur2Tex),t.bindFramebuffer(this._boundFBO),t.setBlendingEnabled(!0),t.setColorMask(!0,!0,!0,!0),t.setViewport(0,0,this._width,this._height),this._hlRenderer.renderHighlight(t,this._hlSurfaces.sharedBlur1Tex,this._hlGradient),this._boundFBO=null}},{key:"setHighlightOptions",value:function(e){this._hlGradient.setHighlightOptions(e)}}]),i}(Gt);function mi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(V){return!1}}();return function(){var i,r=(0,h.Z)(e);if(t){var n=(0,h.Z)(this).constructor;i=Reflect.construct(r,arguments,n)}else i=r.apply(this,arguments);return(0,c.Z)(this,i)}}var gi=function(e){(0,l.Z)(i,e);var t=mi(i);function i(){var e;return(0,a.Z)(this,i),(e=t.apply(this,arguments)).name=e.constructor.name,e.defines=["id"],e._lastSize=0,e}return(0,s.Z)(i,[{key:"dispose",value:function(){(0,m.pC)(this._fbo)&&this._fbo.dispose()}},{key:"bind",value:function(e){var t=e.context,i=e.painter,r=t.getViewport(),n=r.width,a=r.height;this._boundFBO=t.getBoundFramebufferObject();var s=i.getFbos(n,a).effect0;t.bindFramebuffer(s),t.setColorMask(!0,!0,!0,!0),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT)}},{key:"unbind",value:function(e){e.context.bindFramebuffer(this._boundFBO),this._boundFBO=null}},{key:"draw",value:function(e,t){var i=this,r=e.context,n=e.state,a=e.pixelRatio,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Re.Jc,o=r.getBoundFramebufferObject(),u=n.size[1]*a,l=Math.round(s*a),c=l/2,h=l/2;this._ensureBuffer(l),t.forEach((function(e,r){var n=new Map,s=Math.floor(r.x*a-l/2),f=Math.floor(u-r.y*a-l/2);o.readPixels(s,f,l,l,6408,5121,i._buf);for(var d=0;d<i._buf32.length;d++){var p=i._buf32[d];if(4294967295!==p&&0!==p){var _=d%l,v=l-Math.floor(d/l),m=(c-_)*(c-_)+(h-v)*(h-v),g=n.has(p)?n.get(p):4294967295;n.set(p,Math.min(m,g))}}var y=Array.from(n).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}));e.resolve(y),t.delete(r)}))}},{key:"_ensureBuffer",value:function(e){this._lastSize!==e&&(this._lastSize=e,this._buf=new Uint8Array(4*e*e),this._buf32=new Uint32Array(this._buf.buffer))}}]),i}(Gt),yi=[1,0],bi=[0,1],wi=[1,.8,.6,.4,.2],xi=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],Ti=function(){function e(){(0,a.Z)(this,e),this._intensityFBO=null,this._compositeFBO=null,this._mipsFBOs=new Array(5),this._nMips=5,this._kernelSizeArray=[3,5,7,9,11],this._size=[0,0],this._programDesc={luminosityHighPass:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/luminosityHighPass",attributes:new Map([["a_position",0]])},gaussianBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/gaussianBlur",attributes:new Map([["a_position",0]])},composite:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/composite",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:new Map([["a_position",0]])}}}return(0,s.Z)(e,[{key:"dispose",value:function(){if(this._quad&&(this._quad.dispose(),this._quad=null),this._intensityFBO&&(this._intensityFBO.dispose(),this._intensityFBO=null),this._compositeFBO&&(this._compositeFBO.dispose(),this._compositeFBO=null),this._mipsFBOs){for(var e=0;e<this._nMips;e++)this._mipsFBOs[e]&&(this._mipsFBOs[e].horizontal.dispose(),this._mipsFBOs[e].vertical.dispose());this._mipsFBOs=null}}},{key:"draw",value:function(e,t,i){var r=t.width,n=t.height,a=e.context,s=e.painter.materialManager,o=a.gl,u=this._programDesc,l=i.strength,c=i.radius,h=i.threshold;this._quad||(this._quad=new Nt.Z(a,[-1,-1,1,-1,-1,1,1,1])),this._createOrResizeResources(e,r,n),a.setStencilTestEnabled(!1),a.setBlendingEnabled(!0),a.setBlendFunction(1,771),a.setStencilWriteMask(0);var f=this._quad;f.bind(),a.bindFramebuffer(this._intensityFBO);var d=s.getProgram(e,u.luminosityHighPass);a.useProgram(d),a.bindTexture(t.colorTexture,0),d.setUniform1i("u_texture",0),d.setUniform3fv("u_defaultColor",[0,0,0]),d.setUniform1f("u_defaultOpacity",0),d.setUniform1f("u_luminosityThreshold",h),d.setUniform1f("u_smoothWidth",.01);var p=[Math.round(r/2),Math.round(n/2)];a.setViewport(0,0,p[0],p[1]),a.setClearColor(0,0,0,0),a.clear(o.COLOR_BUFFER_BIT),f.draw(),a.setBlendingEnabled(!1);for(var _=this._intensityFBO.colorTexture,v=0;v<this._nMips;v++){var m=s.getProgram(e,u.gaussianBlur,[{name:"radius",value:this._kernelSizeArray[v]}]);a.useProgram(m),a.bindTexture(_,v+1),m.setUniform1i("u_colorTexture",v+1),m.setUniform2fv("u_texSize",p),m.setUniform2fv("u_direction",yi),a.setViewport(0,0,p[0],p[1]);var g=this._mipsFBOs[v];a.bindFramebuffer(g.horizontal),f.draw(),_=g.horizontal.colorTexture,a.bindFramebuffer(g.vertical),a.bindTexture(_,v+1),m.setUniform2fv("u_direction",bi),f.draw(),_=g.vertical.colorTexture,p[0]=Math.round(p[0]/2),p[1]=Math.round(p[1]/2)}a.setViewport(0,0,r,n);var y=s.getProgram(e,u.composite,[{name:"nummips",value:5}]);a.bindFramebuffer(this._compositeFBO),a.useProgram(y),y.setUniform1f("u_bloomStrength",l),y.setUniform1f("u_bloomRadius",c),y.setUniform1fv("u_bloomFactors",wi),y.setUniform3fv("u_bloomTintColors",xi),a.bindTexture(this._mipsFBOs[0].vertical.colorTexture,1),y.setUniform1i("u_blurTexture1",1),a.bindTexture(this._mipsFBOs[1].vertical.colorTexture,2),y.setUniform1i("u_blurTexture2",2),a.bindTexture(this._mipsFBOs[2].vertical.colorTexture,3),y.setUniform1i("u_blurTexture3",3),a.bindTexture(this._mipsFBOs[3].vertical.colorTexture,4),y.setUniform1i("u_blurTexture4",4),a.bindTexture(this._mipsFBOs[4].vertical.colorTexture,5),y.setUniform1i("u_blurTexture5",5),f.draw(),a.bindFramebuffer(t),a.setBlendingEnabled(!0);var b=s.getProgram(e,u.blit);a.useProgram(b),a.bindTexture(this._compositeFBO.colorTexture,6),b.setUniform1i("u_texture",6),a.setBlendFunction(1,1),f.draw(),f.unbind(),a.setBlendFunction(1,771),a.setStencilTestEnabled(!0)}},{key:"_createOrResizeResources",value:function(e,t,i){var r=e.context;if(!this._compositeFBO||this._size[0]!==t||this._size[1]!==i){this._size[0]=t,this._size[1]=i;var n=[Math.round(t/2),Math.round(i/2)];this._compositeFBO?this._compositeFBO.resize(t,i):this._compositeFBO=new R.Z(r,{colorTarget:0,depthStencilTarget:0,width:t,height:i}),this._intensityFBO?this._intensityFBO.resize(n[0],n[1]):this._intensityFBO=new R.Z(r,{colorTarget:0,depthStencilTarget:0,width:n[0],height:n[1]},{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:n[0],height:n[1]});for(var a=0;a<this._nMips;a++)this._mipsFBOs[a]?(this._mipsFBOs[a].horizontal.resize(n[0],n[1]),this._mipsFBOs[a].vertical.resize(n[0],n[1])):this._mipsFBOs[a]={horizontal:new R.Z(r,{colorTarget:0,depthStencilTarget:0,width:n[0],height:n[1]},{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:n[0],height:n[1]}),vertical:new R.Z(r,{colorTarget:0,depthStencilTarget:0,width:n[0],height:n[1]},{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:n[0],height:n[1]})},n[0]=Math.round(n[0]/2),n[1]=Math.round(n[1]/2)}}}]),e}(),Fi=[1,0],Ei=[0,1],ki=function(){function e(){(0,a.Z)(this,e),this._blurFBO=null,this._size=[0,0],this._programDesc={gaussianBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/gaussianBlur",attributes:new Map([["a_position",0]])},radialBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/radial-blur",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:new Map([["a_position",0]])}}}return(0,s.Z)(e,[{key:"dispose",value:function(){this._blurFBO&&(this._blurFBO.dispose(),this._blurFBO=null)}},{key:"draw",value:function(e,t,i){var r=e.context,n=i.type,a=i.radius;if(0!==a){this._createOrResizeResources(e),this._quad||(this._quad=new Nt.Z(r,[-1,-1,1,-1,-1,1,1,1]));var s=this._quad;s.bind(),"blur"===n?this._gaussianBlur(e,t,a):this._radialBlur(e,t),s.unbind()}}},{key:"_gaussianBlur",value:function(e,t,i){var r=e.context,n=e.state,a=e.painter,s=e.pixelRatio,o=n.size,u=a.materialManager,l=this._programDesc,c=this._quad,h=[Math.round(s*o[0]),Math.round(s*o[1])],f=this._blurFBO,d=u.getProgram(e,l.gaussianBlur,[{name:"radius",value:Math.ceil(i)}]);r.useProgram(d),r.setBlendingEnabled(!1),r.bindFramebuffer(f),r.bindTexture(t.colorTexture,4),d.setUniform1i("u_colorTexture",4),d.setUniform2fv("u_texSize",h),d.setUniform2fv("u_direction",Fi),d.setUniform1f("u_sigma",i),c.draw(),r.bindFramebuffer(t),r.setStencilWriteMask(0),r.setStencilTestEnabled(!1),r.setDepthWriteEnabled(!1),r.setDepthTestEnabled(!1),r.bindTexture(f.colorTexture,5),d.setUniform1i("u_colorTexture",5),d.setUniform2fv("u_direction",Ei),c.draw(),r.setBlendingEnabled(!0),r.setBlendFunction(1,771),r.setStencilTestEnabled(!0)}},{key:"_radialBlur",value:function(e,t){var i=e.context,r=e.painter.materialManager,n=this._programDesc,a=this._quad,s=this._blurFBO;i.bindFramebuffer(s);var o=r.getProgram(e,n.radialBlur);i.useProgram(o),i.setBlendingEnabled(!1),i.bindTexture(t.colorTexture,4),o.setUniform1i("u_colorTexture",4),a.draw(),i.bindFramebuffer(t),i.setStencilWriteMask(0),i.setStencilTestEnabled(!1),i.setDepthWriteEnabled(!1),i.setDepthTestEnabled(!1),i.setBlendingEnabled(!0);var u=r.getProgram(e,n.blit);i.useProgram(u),i.bindTexture(s.colorTexture,5),u.setUniform1i("u_texture",5),i.setBlendFunction(1,771),a.draw()}},{key:"_createOrResizeResources",value:function(e){var t=e.context,i=e.state,r=e.pixelRatio,n=i.size,a=Math.round(r*n[0]),s=Math.round(r*n[1]);this._blurFBO&&this._size[0]===a&&this._size[1]===s||(this._size[0]=a,this._size[1]=s,this._blurFBO?this._blurFBO.resize(a,s):this._blurFBO=new R.Z(t,{colorTarget:0,depthStencilTarget:0,width:a,height:s},{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:a,height:s}))}}]),e}(),Si=function(){function e(){(0,a.Z)(this,e),this._size=[0,0],this._programDesc={vsPath:"post-processing/pp",fsPath:"post-processing/filterEffect",attributes:new Map([["a_position",0]])}}return(0,s.Z)(e,[{key:"dispose",value:function(){this._layerFBOTexture&&(this._layerFBOTexture.dispose(),this._layerFBOTexture=null)}},{key:"draw",value:function(e,t,i){var r=t.width,n=t.height;this._createOrResizeResources(e,r,n);var a=e.context,s=e.painter.materialManager,o=this._programDesc,u=this._quad,l=i.colorMatrix;u.bind();var c=this._layerFBOTexture;a.bindFramebuffer(t),t.copyToTexture(0,0,r,n,0,0,c),a.setBlendingEnabled(!1),a.setStencilTestEnabled(!1);var h=s.getProgram(e,o);a.useProgram(h),a.bindTexture(c,2),h.setUniformMatrix4fv("u_coefficients",l),h.setUniform1i("u_colorTexture",2),u.draw(),a.setBlendingEnabled(!0),a.setBlendFunction(1,771),a.setStencilTestEnabled(!0),u.unbind()}},{key:"_createOrResizeResources",value:function(e,t,i){var r=e.context;this._layerFBOTexture&&this._size[0]===t&&this._size[1]===i||(this._size[0]=t,this._size[1]=i,this._layerFBOTexture?this._layerFBOTexture.resize(t,i):this._layerFBOTexture=new M.Z(r,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:t,height:i}),this._quad||(this._quad=new Nt.Z(r,[-1,-1,1,-1,-1,1,1,1])))}}]),e}(),Ri=[1,0],Oi=[0,1],Ci=function(){function e(){(0,a.Z)(this,e),this._horizontalBlurFBO=null,this._verticalBlurFBO=null,this._size=[0,0],this._programDesc={blur:{vsPath:"post-processing/drop-shadow",fsPath:"post-processing/blur/gaussianBlur",attributes:new Map([["a_position",0]])},composite:{vsPath:"post-processing/pp",fsPath:"post-processing/drop-shadow/composite",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:new Map([["a_position",0]])}}}return(0,s.Z)(e,[{key:"dispose",value:function(){this._layerFBOTexture&&(this._layerFBOTexture.dispose(),this._layerFBOTexture=null),this._horizontalBlurFBO&&(this._horizontalBlurFBO.dispose(),this._horizontalBlurFBO=null),this._verticalBlurFBO&&(this._verticalBlurFBO.dispose(),this._verticalBlurFBO=null)}},{key:"draw",value:function(e,t,i){var r=e.context,n=e.state,a=e.painter.materialManager,s=this._programDesc,o=t.width,u=t.height,l=[Math.round(o/2),Math.round(u/2)],c=i.blurRadius,h=i.offsetX,f=i.offsetY,d=i.color,p=[(0,Ee.F2)(h/2),(0,Ee.F2)(f/2)];this._createOrResizeResources(e,o,u,l);var _=this._horizontalBlurFBO,v=this._verticalBlurFBO;r.setStencilWriteMask(0),r.setStencilTestEnabled(!1),r.setDepthWriteEnabled(!1),r.setDepthTestEnabled(!1);var m=this._layerFBOTexture;t.copyToTexture(0,0,o,u,0,0,m),this._quad||(this._quad=new Nt.Z(r,[-1,-1,1,-1,-1,1,1,1])),r.setViewport(0,0,l[0],l[1]);var g=this._quad;g.bind(),r.setBlendingEnabled(!1);var y=a.getProgram(e,s.blur,[{name:"radius",value:Math.ceil(c)}]);r.useProgram(y),r.bindFramebuffer(_),r.bindTexture(t.colorTexture,4),y.setUniformMatrix3fv("u_displayViewMat3",n.displayMat3),y.setUniform2fv("u_offset",p),y.setUniform1i("u_colorTexture",4),y.setUniform2fv("u_texSize",l),y.setUniform2fv("u_direction",Ri),y.setUniform1f("u_sigma",c),g.draw(),r.bindFramebuffer(v),r.bindTexture(_.colorTexture,5),y.setUniformMatrix3fv("u_displayViewMat3",n.displayMat3),y.setUniform2fv("u_offset",[0,0]),y.setUniform1i("u_colorTexture",5),y.setUniform2fv("u_direction",Oi),g.draw(),r.bindFramebuffer(t),r.setViewport(0,0,o,u);var b=a.getProgram(e,s.composite);r.useProgram(b),r.bindTexture(v.colorTexture,2),b.setUniform1i("u_blurTexture",2),r.bindTexture(m,3),b.setUniform1i("u_layerFBOTexture",3),b.setUniform4fv("u_shadowColor",[d[3]*(d[0]/255),d[3]*(d[1]/255),d[3]*(d[2]/255),d[3]]),g.draw(),r.setBlendingEnabled(!0),r.setStencilTestEnabled(!0),r.setBlendFunction(1,771),g.unbind()}},{key:"_createOrResizeResources",value:function(e,t,i,r){var n=e.context;this._horizontalBlurFBO&&this._size[0]===t&&this._size[1]===i||(this._size[0]=t,this._size[1]=i,this._horizontalBlurFBO?this._horizontalBlurFBO.resize(r[0],r[1]):this._horizontalBlurFBO=new R.Z(n,{colorTarget:0,depthStencilTarget:0,width:r[0],height:r[1]},{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:r[0],height:r[1]}),this._verticalBlurFBO?this._verticalBlurFBO.resize(r[0],r[1]):this._verticalBlurFBO=new R.Z(n,{colorTarget:0,depthStencilTarget:0,width:r[0],height:r[1]},{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:r[0],height:r[1]}),this._layerFBOTexture?this._layerFBOTexture.resize(t,i):this._layerFBOTexture=new M.Z(n,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:t,height:i}))}}]),e}(),Bi=function(){function e(){(0,a.Z)(this,e),this._size=[0,0]}return(0,s.Z)(e,[{key:"dispose",value:function(){this._layerFBOTexture&&(this._layerFBOTexture.dispose(),this._layerFBOTexture=null)}},{key:"draw",value:function(e,t,i){var r=t.width,n=t.height;this._createOrResizeResources(e,r,n);var a=e.context,s=e.painter,o=i.amount,u=a.gl,l=this._layerFBOTexture;a.bindFramebuffer(t),t.copyToTexture(0,0,r,n,0,0,l),a.setBlendingEnabled(!0),a.setStencilTestEnabled(!1),a.setDepthTestEnabled(!1),a.setClearColor(0,0,0,0),a.clear(u.COLOR_BUFFER_BIT),s.blitTexture(a,l,9728,o)}},{key:"_createOrResizeResources",value:function(e,t,i){var r=e.context;this._layerFBOTexture&&this._size[0]===t&&this._size[1]===i||(this._size[0]=t,this._size[1]=i,this._layerFBOTexture?this._layerFBOTexture.resize(t,i):this._layerFBOTexture=new M.Z(r,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!1,width:t,height:i}))}}]),e}();function Mi(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"==typeof e)return Ai(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Ai(e,t)}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==i.return||i.return()}finally{if(o)throw a}}}}function Ai(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function Pi(e){switch(e){case"bloom":case"blur":case"opacity":case"drop-shadow":return e;default:return"colorize"}}var Di={colorize:function(){return new Si},blur:function(){return new ki},bloom:function(){return new Ti},opacity:function(){return new Bi},"drop-shadow":function(){return new Ci}},Zi=function(){function e(t){(0,a.Z)(this,e),this._requestRender=t,this._effectMap=new Map}return(0,s.Z)(e,[{key:"dispose",value:function(){this._requestRender&&(this._requestRender=null),this._effectMap.forEach((function(e){return e.dispose()})),this._effectMap.clear()}},{key:"getPostProcessingEffects",value:function(e){if(!e||0===e.length)return[];var t,i=[],r=Mi(e);try{for(r.s();!(t=r.n()).done;){var n=t.value,a=Pi(n.type),s=this._effectMap.get(a);s||(s=Di[a](),this._effectMap.set(a,s)),i.push({postProcessingEffect:s,effect:n})}}catch(o){r.e(o)}finally{r.f()}return i}}]),e}(),Ii=i(43079);function zi(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"==typeof e)return Ui(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Ui(e,t)}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==i.return||i.return()}finally{if(o)throw a}}}}function Ui(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}var Li,Vi=function(){function e(t,i){var r;(0,a.Z)(this,e),this.brushes=t,this.name=i.name,this.drawPhase=i.drawPhase||Z.jx.MAP,this._targetFn=i.target,this.effects=i.effects||[],this.enableDefaultDraw=null!=(r=i.enableDefaultDraw)?r:function(){return!0}}return(0,s.Z)(e,[{key:"render",value:function(e){var t=e.context,i=e.profiler,r=this._targetFn(),n=this.drawPhase&e.drawPhase;if(i.recordPassStart(this.name),n){this.enableDefaultDraw()&&this._doRender(e,r),i.recordPassEnd();var a,s=zi(this.effects);try{for(s.s();!(a=s.n()).done;){var o=a.value;if(o.enable()){var u=o.apply;i.recordPassStart(this.name+"."+u.name),i.recordBrushStart(u.name);var l=o.args&&o.args(),c=t.getViewport(),h=c.x,f=c.y,d=c.width,p=c.height,_=t.getBoundFramebufferObject();u.bind(e,l),this._doRender(e,r,u.defines),u.draw(e,l),u.unbind(e,l),t.bindFramebuffer(_),t.setViewport(h,f,d,p),i.recordBrushEnd(),i.recordPassEnd()}}}catch(v){s.e(v)}finally{s.f()}}}},{key:"_doRender",value:function(e,t,i){if(!(0,m.Wi)(t))if((0,Ii.zG)(t)){var r,n=zi(t);try{for(n.s();!(r=n.n()).done;){var a=r.value;if(a.visible){var s,o=zi(this.brushes);try{for(o.s();!(s=o.n()).done;){var u=s.value;e.profiler.recordBrushStart(u.name),u.prepareState(e,a,i),u.draw(e,a,i),e.profiler.recordBrushEnd()}}catch(f){o.e(f)}finally{o.f()}}}}catch(f){n.e(f)}finally{n.f()}}else{var l,c=zi(this.brushes);try{for(c.s();!(l=c.n()).done;){var h=l.value;e.profiler.recordBrushStart(h.name),h.prepareState(e,t,i),h.draw(e,t,i),e.profiler.recordBrushEnd()}}catch(f){c.e(f)}finally{c.f()}}}}]),e}();function Ni(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"==typeof e)return Gi(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Gi(e,t)}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==i.return||i.return()}finally{if(o)throw a}}}}function Gi(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}var Wi=(Li={},(0,r.Z)(Li,Z.LW.FILL,z.U.fill),(0,r.Z)(Li,Z.LW.LINE,z.U.line),(0,r.Z)(Li,Z.LW.MARKER,z.U.marker),(0,r.Z)(Li,Z.LW.TEXT,z.U.text),Li),ji=function(){function e(t,i,r){(0,a.Z)(this,e),this.context=t,this._blitRenderer=new oe,this._brushCache=new Map,this._vtlMaterialManager=new ne,this._blendEffect=new Yt,this.effects={highlight:new vi,hittest:new gi,integrate:new jt,insideEffect:new Jt("inside"),outsideEffect:new Jt("outside")},this.materialManager=new ye(t),this.textureManager=new Vt(i,r),this._effectsManager=new Zi(i)}return(0,s.Z)(e,[{key:"vectorTilesMaterialManager",get:function(){return this._vtlMaterialManager}},{key:"getRenderTarget",value:function(){return this._renderTarget}},{key:"setRenderTarget",value:function(e){this._renderTarget=e}},{key:"getFbos",value:function(e,t){if(e!==this._lastWidth||t!==this._lastHeight){if(this._lastWidth=e,this._lastHeight=t,this._fbos){for(var i in this._fbos)this._fbos[i].resize(e,t);return this._fbos}var r={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:e,height:t},n={colorTarget:0,depthStencilTarget:3},a=new I.Z(this.context,{width:e,height:t,internalFormat:34041});this._stencilBuf=a,this._fbos={output:new R.Z(this.context,n,r,a),blend:new R.Z(this.context,n,r,a),effect0:new R.Z(this.context,n,r,a)}}return this._fbos}},{key:"getSharedStencilBuffer",value:function(){return this._stencilBuf}},{key:"beforeRenderLayers",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=e.getViewport(),r=i.width,n=i.height;this._prevFBO=e.getBoundFramebufferObject();var a=this.getFbos(r,n);if(e.bindFramebuffer(a.output),e.setColorMask(!0,!0,!0,!0),e.setDepthWriteEnabled(!0),(0,m.pC)(t)){var s=t.color,o=s.r,u=s.g,l=s.b,c=s.a;e.setClearColor(c*o/255,c*u/255,c*l/255,c)}else e.setClearColor(0,0,0,0);e.setClearDepth(1),e.clear(e.gl.COLOR_BUFFER_BIT|e.gl.DEPTH_BUFFER_BIT),e.setDepthWriteEnabled(!1)}},{key:"beforeRenderLayer",value:function(e,t,i){var r=e.context,n=e.blendMode,a=e.effects,s=e.requireFBO,o=e.drawPhase;if(s||Hi(o,n,a,i))r.bindFramebuffer(this._fbos.blend),r.setColorMask(!0,!0,!0,!0),r.setClearColor(0,0,0,0),r.setDepthWriteEnabled(!0),r.setClearDepth(1),r.clear(r.gl.COLOR_BUFFER_BIT|r.gl.DEPTH_BUFFER_BIT),r.setDepthWriteEnabled(!1);else{var u=this._getOutputFBO();r.bindFramebuffer(u)}r.setDepthWriteEnabled(!1),r.setDepthTestEnabled(!1),r.setStencilTestEnabled(!0),r.setClearStencil(t),r.setStencilWriteMask(255),r.clear(r.gl.STENCIL_BUFFER_BIT)}},{key:"compositeLayer",value:function(e,t){var i=e.context,r=e.blendMode,n=e.effects,a=e.requireFBO,s=e.drawPhase;if(a||Hi(s,r,n,t)){(0,m.pC)(n)&&n.length>0&&s===Z.jx.MAP&&this._applyEffects(e,n);var o=this._getOutputFBO();i.bindFramebuffer(o),i.setStencilTestEnabled(!1),i.setStencilWriteMask(0),i.setBlendingEnabled(!0),i.setBlendFunctionSeparate(1,771,1,771),i.setColorMask(!0,!0,!0,!0);var u=(0,m.Wi)(r)||s===Z.jx.HIGHLIGHT?"normal":r;this._blendEffect.draw(e,this._fbos.blend.colorTexture,9728,u,t)}}},{key:"renderLayers",value:function(e){if(e.bindFramebuffer(this._prevFBO),this._fbos){var t=this._getOutputFBO();e.setStencilTestEnabled(!1),e.setStencilWriteMask(0),this.blitTexture(e,t.colorTexture,9728)}}},{key:"dispose",value:function(){if(this.materialManager.dispose(),this.textureManager.dispose(),this._blitRenderer&&(this._blitRenderer.dispose(),this._blitRenderer=null),this._brushCache&&(this._brushCache.forEach((function(e){return e.dispose()})),this._brushCache.clear(),this._brushCache=null),this._fbos)for(var e in this._fbos)this._fbos[e]&&this._fbos[e].dispose();if(this.effects)for(var t in this.effects)this.effects[t]&&this.effects[t].dispose();this._effectsManager.dispose(),this._vtlMaterialManager&&(this._vtlMaterialManager.dispose(),this._vtlMaterialManager=null),this._prevFBO=null}},{key:"getGeometryBrush",value:function(e){var t=Wi[e],i=this._brushCache.get(t);return void 0===i&&(i=new t,this._brushCache.set(t,i)),this._brushCache.get(t)}},{key:"renderObject",value:function(e,t,i,r){var n=z.U[i];if(!n)return null;var a=this._brushCache.get(n);void 0===a&&(a=new n,this._brushCache.set(n,a)),a.prepareState(e,t,r),a.draw(e,t,r)}},{key:"renderObjects",value:function(e,t,i,r){var n=z.U[i];if(!n)return null;var a=this._brushCache.get(n);void 0===a&&(a=new n,this._brushCache.set(n,a)),a.drawMany(e,t,r)}},{key:"registerRenderPass",value:function(e){var t=this,i=e.brushes.map((function(e){return t._brushCache.has(e)||t._brushCache.set(e,new e),t._brushCache.get(e)}));return new Vi(i,e)}},{key:"setHighlightOptions",value:function(e){this.effects.highlight.setHighlightOptions(e)}},{key:"blitTexture",value:function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(1,771,1,771),e.setColorMask(!0,!0,!0,!0),this._blitRenderer.render(e,t,i,r)}},{key:"getPostProcessingEffects",value:function(e){return this._effectsManager.getPostProcessingEffects(e)}},{key:"_getOutputFBO",value:function(){return null!=this._renderTarget?this._renderTarget:this._fbos.output}},{key:"_applyEffects",value:function(e,t){var i,r=e.context,n=Ni(this._effectsManager.getPostProcessingEffects(t));try{for(n.s();!(i=n.n()).done;){var a=i.value,s=a.postProcessingEffect,o=a.effect;r.bindFramebuffer(this._fbos.blend),s.draw(e,this._fbos.blend,o)}}catch(u){n.e(u)}finally{n.f()}}}]),e}();function Hi(e,t,i,r){return e!==Z.jx.HIGHLIGHT&&(1!==r||(0,m.pC)(t)&&"normal"!==t||(0,m.pC)(i)&&i.length>0)}var qi=i(62560),Xi=i(92332),Yi=i(4970),Qi=(0,s.Z)((function e(t,i,r,n,s,o,u,l){(0,a.Z)(this,e),this.createQuery=t,this.resultAvailable=i,this.getResult=r,this.disjoint=n,this.beginTimeElapsed=s,this.endTimeElapsed=o,this.createTimestamp=u,this.timestampBits=l}));function Ki(e,t){if(t.disjointTimerQuery)return null;var i=e.getExtension("EXT_disjoint_timer_query_webgl2");return i&&(0,Yi.Z)(e)?new Qi((function(){return e.createQuery()}),(function(t){return e.getQueryParameter(t,e.QUERY_RESULT_AVAILABLE)}),(function(t){return e.getQueryParameter(t,e.QUERY_RESULT)}),(function(){return e.getParameter(i.GPU_DISJOINT_EXT)}),(function(t){return e.beginQuery(i.TIME_ELAPSED_EXT,t)}),(function(){return e.endQuery(i.TIME_ELAPSED_EXT)}),(function(e){return i.queryCounterEXT(e,i.TIMESTAMP_EXT)}),(function(){return e.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)})):(i=e.getExtension("EXT_disjoint_timer_query"))?new Qi((function(){return i.createQueryEXT()}),(function(e){return i.getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT)}),(function(e){return i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT)}),(function(){return e.getParameter(i.GPU_DISJOINT_EXT)}),(function(e){return i.beginQueryEXT(i.TIME_ELAPSED_EXT,e)}),(function(){return i.endQueryEXT(i.TIME_ELAPSED_EXT)}),(function(e){return i.queryCounterEXT(e,i.TIMESTAMP_EXT)}),(function(){return i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)})):null}function $i(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"==typeof e)return Ji(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Ji(e,t)}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==i.return||i.return()}finally{if(o)throw a}}}}function Ji(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}var er=(0,v.Z)("esri-2d-profiler"),tr=function(){function e(t,i){var r=this;if((0,a.Z)(this,e),this._events=new Xi.Z,this._entries=new Map,this._timings=new qi.Z(10),er){this._ext=Ki(t.gl,{}),this._debugOutput=i;var n=t.gl;if(this.enableCommandLogging){var s=function(e){if("function"==typeof n[e]){var t=n[e],i=-1!==e.indexOf("draw");n[e]=function(){for(var a=arguments.length,s=new Array(a),o=0;o<a;o++)s[o]=arguments[o];return r._events.emit("command",{container:r._currentContainer,pass:r._currentPass,brush:r._currentBrush,method:e,args:s,isDrawCommand:i}),r._currentSummary&&(r._currentSummary.commands++,i&&r._currentSummary.drawCommands++),t.apply(n,s)}}};for(var o in n)s(o)}}}return(0,s.Z)(e,[{key:"enableCommandLogging",get:function(){return!("object"==typeof er&&er.disableCommands)}},{key:"recordContainerStart",value:function(e){er&&(this._currentContainer=e)}},{key:"recordContainerEnd",value:function(){er&&(this._currentContainer=null)}},{key:"recordPassStart",value:function(e){er&&(this._currentPass=e,this._initSummary())}},{key:"recordPassEnd",value:function(){er&&(this._currentPass=null,this._emitSummary())}},{key:"recordBrushStart",value:function(e){er&&(this._currentBrush=e)}},{key:"recordBrushEnd",value:function(){er&&(this._currentBrush=null)}},{key:"recordStart",value:function(e){if(er&&(0,m.pC)(this._ext)){if(this._entries.has(e)){var t=this._entries.get(e),i=this._ext.resultAvailable(t.query),r=this._ext.disjoint();if(i&&!r){var n=this._ext.getResult(t.query)/1e6,a=0;if((0,m.pC)(this._timings.enqueue(n))){var s,o=this._timings.entries,u=o.length,l=0,c=$i(o);try{for(c.s();!(s=c.n()).done;){l+=s.value}}catch(v){c.e(v)}finally{c.f()}a=l/u}var h=n.toFixed(2),f=a?a.toFixed(2):"--";this.enableCommandLogging?(console.groupCollapsed("Frame report for ".concat(e,", ").concat(h," ms (").concat(f," last 10 avg)\n").concat(t.commandsLen," Commands (").concat(t.drawCommands," draw)")),console.log("RenderPass breakdown: "),console.table(t.summaries),console.log("Commands: ",t.commands),console.groupEnd()):console.log("Frame report for ".concat(e,", ").concat(h," ms (").concat(f," last 10 avg)")),this._debugOutput.innerHTML="".concat(h," (").concat(f,")")}var d,p=$i(t.handles);try{for(p.s();!(d=p.n()).done;){d.value.remove()}}catch(v){p.e(v)}finally{p.f()}this._entries.delete(e)}var _={name:e,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(_.handles.push(this._events.on("command",(function(e){_.commandsLen++,_.commands.push(e),e.isDrawCommand&&_.drawCommands++}))),_.handles.push(this._events.on("summary",(function(e){_.summaries.push(e)})))),this._ext.beginTimeElapsed(_.query),this._entries.set(e,_)}}},{key:"recordEnd",value:function(e){er&&(0,m.pC)(this._ext)&&this._entries.has(e)&&this._ext.endTimeElapsed()}},{key:"_initSummary",value:function(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0})}},{key:"_emitSummary",value:function(){this.enableCommandLogging&&this._events.emit("summary",this._currentSummary)}}]),e}(),ir={shaders:{vertexShader:(0,ae.w)("stencil/stencil.vert"),fragmentShader:(0,ae.w)("stencil/stencil.frag")},attributes:new Map([["a_pos",0]])},rr=i(78637),nr=i(11849),ar=function(){function e(t){(0,a.Z)(this,e),this._allocations=new Map,t?Error.stackTraceLimit=1/0:(this.add=function(){},this.remove=function(){})}return(0,s.Z)(e,[{key:"add",value:function(e){this._allocations.set(e,(new Error).stack)}},{key:"remove",value:function(e){this._allocations.delete(e)}},{key:"print",value:function(){if(this._allocations.size>0){console.log("".concat(this._allocations.size," live object allocations:"));var e=new Map;this._allocations.forEach((function(t){var i;e.set(t,(null!=(i=e.get(t))?i:0)+1)})),e.forEach((function(e,t){var i=t.split("\n");i.shift(),i.shift(),console.log("".concat(e,": ").concat(i.shift())),i.forEach((function(e){return console.log("   ",e)}))}))}}}]),e}(),sr=function(){function e(){for((0,a.Z)(this,e),this._current=new Array,this._max=new Array,this._allocations=new ar(false);this._current.length<C._g.COUNT;)this._current.push(0),this._max.push(0)}return(0,s.Z)(e,[{key:"resetMax",value:function(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}},{key:"increment",value:function(e,t){var i=++this._current[e];this._max[e]=Math.max(i,this._max[e]),this._allocations.add(t)}},{key:"decrement",value:function(e,t){--this._current[e],this._allocations.remove(t)}},{key:"max",get:function(){return this._max}},{key:"current",get:function(){return this._current}},{key:"total",get:function(){return this.current.reduce((function(e,t){return e+t}),0)}},{key:"printResourceCount",value:function(){if(this.total>0){console.log("Live objects:");for(var e=0;e<C._g.COUNT;++e){var t=this._current[e];t>0&&console.log("".concat(C._g[e],": ").concat(t))}}this._allocations.print()}}]),e}(),or=i(46255),ur=i(73415),lr=i(48407);function cr(e,t){var i=new R.Z(e,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1});var r=S.Z.createVertex(e,35044,new Uint16Array([0,0,1,0,0,1,1,1])),n=new A.Z(e,new Map([["position",0]]),{geometry:[{name:"position",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:r}),a=(0,ur.f)(5633261.287538229,2626832.878767164,1434988.0495278358),s=(0,ur.f)(5633271.46742708,2626873.6381334523,1434963.231608387),o=function(i,r){var n=new U.$(e,"\n\n  precision highp float;\n\n  attribute vec2 position;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ".concat(t?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":"","\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n  }\n  "),"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor = v_color;\n  }\n  ",new Map([["position",0]])),a=new Float32Array(6);(0,lr.LF)(i,a,3);var s=new Float32Array(6);return(0,lr.LF)(r,s,3),e.useProgram(n),n.setUniform3f("u_highA",a[0],a[2],a[4]),n.setUniform3f("u_lowA",a[1],a[3],a[5]),n.setUniform3f("u_highB",s[0],s[2],s[4]),n.setUniform3f("u_lowB",s[1],s[3],s[5]),n}(a,s),u=e.getBoundFramebufferObject(),l=e.getViewport(),c=l.x,h=l.y,f=l.width,d=l.height;e.bindFramebuffer(i),e.setViewport(0,0,1,1),e.bindVAO(n),e.drawArrays(5,0,4);var p=new Uint8Array(4);i.readPixels(0,0,1,1,6408,5121,p),o.dispose(),n.dispose(!1),r.dispose(),i.dispose(),e.setViewport(c,h,f,d),e.bindFramebuffer(u);var _=(a[2]-s[2])/25,v=(0,Ge.v)(p);return Math.abs(_-v)}var hr,fr,dr,pr=i(91133),_r={exports:{}};hr=_r,fr=function(){var e=function(e){window.console&&window.console.error?window.console.error(e):function(e){window.console&&window.console.log&&window.console.log(e)}(e)},t={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},i=null,r=null;function n(e){if(null==i)for(var t in i={},r={},e)"number"==typeof e[t]&&(i[e[t]]=t,r[t]=e[t])}function a(){if(null==i)throw"WebGLDebugUtils.init(ctx) not called"}function s(e){return a(),void 0!==i[e]}function o(e){a();var t=i[e];return void 0!==t?"gl."+t:"/*UNKNOWN WebGL ENUM*/ 0x"+e.toString(16)}function u(e,i,n,a){var s;if(void 0!==(s=t[e])&&void 0!==(s=s[i])&&s[n]){if("object"==typeof s[n]&&void 0!==s[n].enumBitwiseOr){for(var u=s[n].enumBitwiseOr,l=0,c=[],h=0;h<u.length;++h){var f=r[u[h]];0!=(a&f)&&(l|=f,c.push(o(f)))}return l===a?c.join(" | "):o(a)}return o(a)}return null===a?"null":void 0===a?"undefined":a.toString()}function l(e,t,i){e.__defineGetter__(i,(function(){return t[i]})),e.__defineSetter__(i,(function(e){t[i]=e}))}function c(e){var t=e.getParameter(e.MAX_VERTEX_ATTRIBS),i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i);for(var r=0;r<t;++r)e.disableVertexAttribArray(r),e.vertexAttribPointer(r,4,e.FLOAT,!1,0,0),e.vertexAttrib1f(r,0);e.deleteBuffer(i);var n=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);for(r=0;r<n;++r)e.activeTexture(e.TEXTURE0+r),e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.bindTexture(e.TEXTURE_2D,null);for(e.activeTexture(e.TEXTURE0),e.useProgram(null),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.DITHER),e.disable(e.SCISSOR_TEST),e.blendColor(0,0,0,0),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.clearColor(0,0,0,0),e.clearDepth(1),e.clearStencil(-1),e.colorMask(!0,!0,!0,!0),e.cullFace(e.BACK),e.depthFunc(e.LESS),e.depthMask(!0),e.depthRange(0,1),e.frontFace(e.CCW),e.hint(e.GENERATE_MIPMAP_HINT,e.DONT_CARE),e.lineWidth(1),e.pixelStorei(e.PACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.UNPACK_COLORSPACE_CONVERSION_WEBGL&&e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.BROWSER_DEFAULT_WEBGL),e.polygonOffset(0,0),e.sampleCoverage(1,!1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilMask(4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT);e.getError(););}return{init:n,mightBeEnum:s,glEnumToString:o,glFunctionArgToString:u,glFunctionArgsToString:function(e,t){for(var i="",r=t.length,n=0;n<r;++n)i+=(0==n?"":", ")+u(e,r,n,t[n]);return i},makeDebugContext:function t(i,r,a,s){s=s||i,n(i),r=r||function(t,i,r){for(var n="",a=r.length,s=0;s<a;++s)n+=(0==s?"":", ")+u(i,a,s,r[s]);e("WebGL error "+o(t)+" in "+i+"("+n+")")};var c={};function h(e,t){return function(){a&&a(t,arguments);var i=e[t].apply(e,arguments),n=s.getError();return 0!=n&&(c[n]=!0,r(n,t,arguments)),i}}var f={};for(var d in i)if("function"==typeof i[d])if("getExtension"!=d)f[d]=h(i,d);else{var p=h(i,d);f[d]=function(){return t(p.apply(i,arguments),r,a,s)}}else l(f,i,d);return f.getError=function(){for(var e in c)if(c.hasOwnProperty(e)&&c[e])return c[e]=!1,e;return i.NO_ERROR},f},makeLostContextSimulatingCanvas:function(e){var t,i,r=[],n=[],a={},s=1,o=!1,u=[],h=0,f=0,d=!1,p=0,_={};function v(e){return"function"==typeof e?e:function(t){e.handleEvent(t)}}e.getContext=(i=e.getContext,function(){var r=i.apply(e,arguments);if(r instanceof WebGLRenderingContext){if(r!=t){if(t)throw"got different context";a=x(t=r)}return a}return r});var m=function(e){r.push(v(e))},g=function(e){n.push(v(e))};function y(){++f,o||h==f&&e.loseContext()}function b(e,t){var i=e[t];return function(){if(y(),!o)return i.apply(e,arguments)}}function w(e){return{statusMessage:e,preventDefault:function(){d=!0}}}return function(e){var t=e.addEventListener;e.addEventListener=function(i,r,n){switch(i){case"webglcontextlost":m(r);break;case"webglcontextrestored":g(r);break;default:t.apply(e,arguments)}}}(e),e.loseContext=function(){if(!o){for(o=!0,h=0,++s;t.getError(););(function(){for(var e=Object.keys(_),t=0;t<e.length;++t)delete _[e]})(),_[t.CONTEXT_LOST_WEBGL]=!0;var i=w("context lost"),n=r.slice();setTimeout((function(){for(var t=0;t<n.length;++t)n[t](i);p>=0&&setTimeout((function(){e.restoreContext()}),p)}),0)}},e.restoreContext=function(){o&&n.length&&setTimeout((function(){if(!d)throw"can not restore. webglcontestlost listener did not call event.preventDefault";(function(){for(var e=0;e<u.length;++e){var i=u[e];i instanceof WebGLBuffer?t.deleteBuffer(i):i instanceof WebGLFramebuffer?t.deleteFramebuffer(i):i instanceof WebGLProgram?t.deleteProgram(i):i instanceof WebGLRenderbuffer?t.deleteRenderbuffer(i):i instanceof WebGLShader?t.deleteShader(i):i instanceof WebGLTexture&&t.deleteTexture(i)}})(),c(t),o=!1,f=0,d=!1;for(var e=n.slice(),i=w("context restored"),r=0;r<e.length;++r)e[r](i)}),0)},e.loseContextInNCalls=function(e){if(o)throw"You can not ask a lost contet to be lost";h=f+e},e.getNumCalls=function(){return f},e.setRestoreTimeout=function(e){p=e},e;function x(e){for(var i in e)"function"==typeof e[i]?a[i]=b(e,i):l(a,e,i);a.getError=function(){if(y(),!o)for(;e=t.getError();)_[e]=!0;for(var e in _)if(_[e])return delete _[e],e;return a.NO_ERROR};for(var r=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],n=0;n<r.length;++n){var c=r[n];a[c]=function(t){return function(){if(y(),o)return null;var i=t.apply(e,arguments);return i.__webglDebugContextLostId__=s,u.push(i),i}}(e[c])}var h=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(n=0;n<h.length;++n)a[c=h[n]]=function(t){return function(){return y(),o?null:t.apply(e,arguments)}}(a[c]);var f=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(n=0;n<f.length;++n)a[c=f[n]]=function(t){return function(){return y(),!o&&t.apply(e,arguments)}}(a[c]);return a.checkFramebufferStatus=function(t){return function(){return y(),o?a.FRAMEBUFFER_UNSUPPORTED:t.apply(e,arguments)}}(a.checkFramebufferStatus),a.getAttribLocation=function(t){return function(){return y(),o?-1:t.apply(e,arguments)}}(a.getAttribLocation),a.getVertexAttribOffset=function(t){return function(){return y(),o?0:t.apply(e,arguments)}}(a.getVertexAttribOffset),a.isContextLost=function(){return o},a}},resetToInitialState:c}},void 0!==(dr=fr())&&(hr.exports=dr);var vr=Te.Z.getLogger("esri.views.WebGLDriverTest");function mr(){return mr=(0,n.Z)(d().mark((function e(t){var i,r,n,a,s,o,u,l,c,h,f,p,_;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(i=new Image).src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",i.width=5,i.height=5,e.next=6,i.decode();case 6:if(t.gl){e.next=8;break}return e.abrupt("return",!0);case 8:return r=new R.Z(t,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1}),n=S.Z.createVertex(t,35044,new Uint16Array([0,0,1,0,0,1,1,1])),a=new A.Z(t,new Map([["a_pos",0]]),{geometry:[{name:"a_pos",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:n}),s=new U.$(t,"\n  precision highp float;\n\n  attribute vec2 a_pos;\n  varying vec2 v_uv;\n\n  void main() {\n    v_uv = a_pos;\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ","\n  precision highp float;\n\n  varying vec2 v_uv;\n  uniform sampler2D u_texture;\n\n  void main() {\n    gl_FragColor = texture2D(u_texture, v_uv);\n  }\n  ",new Map([["a_pos",0]])),t.useProgram(s),o=new M.Z(t,{dataType:5121,pixelFormat:6408,preMultiplyAlpha:!1,wrapMode:33071,samplingMode:9729},i),t.bindTexture(o,0),s.setUniform1i("u_texture",0),u=t.getBoundFramebufferObject(),l=t.getViewport(),c=l.x,h=l.y,f=l.width,p=l.height,t.bindFramebuffer(r),t.setViewport(0,0,1,1),t.setClearColor(0,0,0,0),t.setBlendingEnabled(!1),t.clearSafe(16384),t.bindVAO(a),t.drawArrays(5,0,4),_=new Uint8Array(4),e.abrupt("return",(r.readPixels(0,0,1,1,6408,5121,_),s.dispose(),a.dispose(!1),n.dispose(),r.dispose(),o.dispose(),t.setViewport(c,h,f,p),t.bindFramebuffer(u),i.src="",255===_[0]));case 16:case"end":return e.stop()}}),e)}))),mr.apply(this,arguments)}var gr=function(){function e(t){var i=this;(0,a.Z)(this,e),this.context=t,this._floatBufferBlendWorking=function(e){var t,i,r,n,a;if(!e.gl)return!1;if("webgl"===e.webglVersion)return(null==(n=e.capabilities.textureFloat)?void 0:n.textureFloat)&&(null==(a=e.capabilities.colorBufferFloat)?void 0:a.textureFloat);if(!((null==(t=e.capabilities.textureFloat)?void 0:t.textureFloat)&&(null==(i=e.capabilities.colorBufferFloat)?void 0:i.textureFloat)&&(null==(r=e.capabilities.colorBufferFloat)?void 0:r.floatBlend)))return!1;var s=new R.Z(e,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5126,internalFormat:34836,samplingMode:9728,width:1,height:1}),o=S.Z.createVertex(e,35044,new Uint16Array([0,0,1,0,0,1,1,1])),u=new A.Z(e,new Map([["a_pos",0]]),{geometry:[{name:"a_pos",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:o}),l=new U.$(e,"\n  precision highp float;\n  attribute vec2 a_pos;\n\n  void main() {\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ","\n   precision highp float;\n\n   void main() {\n    gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);\n   }\n  ",new Map([["a_pos",0]]));e.useProgram(l);var c=e.getBoundFramebufferObject(),h=e.getViewport(),f=h.x,d=h.y,p=h.width,_=h.height;e.bindFramebuffer(s),e.setViewport(0,0,1,1),e.bindVAO(u),e.drawArrays(5,0,4);var v=(0,or.sm)({blending:pr.IB});e.setPipelineState(v),e.drawArrays(5,0,4),_r.exports.init(e);var m=e.gl.getError();return e.setViewport(f,d,p,_),e.bindFramebuffer(c),l.dispose(),u.dispose(!1),o.dispose(),s.dispose(),1282!==m||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}(t),function(e){return mr.apply(this,arguments)}(t).then((function(e){return i._svgAlwaysPremultipliesAlpha=!e}))}return(0,s.Z)(e,[{key:"floatBufferBlendWorking",get:function(){if((0,m.Wi)(this._floatBufferBlendWorking))throw new Error("floatBufferBlendWorking test not yet available");return this._floatBufferBlendWorking}},{key:"svgAlwaysPremultipliesAlpha",get:function(){if((0,m.Wi)(this._svgAlwaysPremultipliesAlpha))throw new Error("svgAlwaysPremultipliesAlpha test not yet available");return this._svgAlwaysPremultipliesAlpha}},{key:"doublePrecisionRequiresObfuscation",get:function(){if((0,m.Wi)(this._doublePrecisionRequiresObfuscation)){var e=cr(this.context,!1),t=cr(this.context,!0);this._doublePrecisionRequiresObfuscation=0!==e&&(0===t||e/t>5)}return this._doublePrecisionRequiresObfuscation}},{key:"ignoresSamplerPrecision",get:function(){return(0,m.Wi)(this._ignoresSamplerPrecision)&&(this._ignoresSamplerPrecision=function(e){var t=new R.Z(e,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1}),i=new Uint8Array(4),r=S.Z.createVertex(e,35044,new Uint16Array([0,0,1,0,0,1,1,1])),n=new A.Z(e,new Map([["a_position",0]]),{geometry:[{name:"a_position",count:2,type:5122,offset:0,stride:4,normalized:!1}]},{geometry:r}),a=new U.$(e,"\nprecision highp float;\nattribute vec2 a_pos;\nuniform highp sampler2D u_texture;\nvarying vec4 v_color;\n\nfloat getBit(in float bitset, in int bitIndex) {\n  float offset = pow(2.0, float(bitIndex));\n  return mod(floor(bitset / offset), 2.0);\n}\n\nvoid main() {\n  vec4 value = texture2D(u_texture, vec2(0.0));\n  float bit = getBit(value.x * 255.0, 1);\n\n  v_color = bit * vec4(1.0);\n  gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}\n","\nprecision highp float;\nvarying vec4 v_color;\n\nvoid main() {\n  gl_FragColor = v_color;\n}\n",new Map([["a_pos",0]])),s=new M.Z(e,{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([2,255,0,0]));a.setUniform1i("u_texture",0),e.bindTexture(s,0);var o=e.getBoundFramebufferObject();e.bindFramebuffer(t),e.useProgram(a);var u=e.getViewport(),l=u.x,c=u.y,h=u.width,f=u.height;e.setViewport(0,0,1,1),e.bindVAO(n),e.drawArrays(5,0,4),e.setViewport(l,c,h,f),t.readPixels(0,0,1,1,6408,5121,i),a.dispose(),n.dispose(!1),r.dispose(),t.dispose();var d=255!==i[0]||255!==i[1]||255!==i[2]||255!==i[3];return d&&vr.warn("A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [".concat(i[0],".").concat(i[1],".").concat(i[2],".").concat(i[3],"]")),e.bindFramebuffer(o),d}(this.context)),this._ignoresSamplerPrecision}}]),e}();function yr(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"==typeof e)return br(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return br(e,t)}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==i.return||i.return()}finally{if(o)throw a}}}}function br(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function wr(e,t){var i,r,n,a,s,o,u,l,c,h,f,d,p=t.disabledExtensions||{},_=t.debugWebGLExtensions||{},v=null,m=null,g=null,y=null;return{get drawBuffers(){return f||(f=function(e,t){if(t.disjointTimerQuery)return null;if((0,Yi.Z)(e))return{drawBuffers:e.drawBuffers.bind(e),MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS};if(t.drawBuffers)return null;var i=e.getExtension("WEBGL_draw_buffers");return i?{drawBuffers:i.drawBuffersWEBGL.bind(i),MAX_DRAW_BUFFERS:i.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:i.MAX_COLOR_ATTACHMENTS_WEBGL}:null}(e,p)),f},get instancing(){return i||(i=function(e){if((0,Yi.Z)(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e)};var t=e.getExtension("ANGLE_instanced_arrays");return t?{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t)}:null}(e)),i},get vao(){return r||(r=function(e,t){if((0,Yi.Z)(e))return{createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),bindVertexArray:e.bindVertexArray.bind(e)};if(t.vao)return null;var i=e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object");return i?{createVertexArray:i.createVertexArrayOES.bind(i),deleteVertexArray:i.deleteVertexArrayOES.bind(i),bindVertexArray:i.bindVertexArrayOES.bind(i)}:null}(e,p)),r},get compressedTextureETC(){return n||(n=function(e,t){if(t.compressedTextureETC)return null;var i=e.getExtension("WEBGL_compressed_texture_etc");return i?{COMPRESSED_R11_EAC:i.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:i.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:i.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:i.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:i.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:i.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}(e,p)),n},get compressedTextureS3TC(){return a||(a=function(e,t){if(t.compressedTextureS3TC)return null;var i=e.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}(e,p)),a},get textureFilterAnisotropic(){return s||(s=function(e,t){if(t.textureFilterAnisotropic)return null;var i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null}(e,p)),s},get disjointTimerQuery(){return o||(o=Ki(e,p)),o},get textureFloat(){return u||(u=function(e,t){if((0,Yi.Z)(e))return{textureFloat:!0,textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:e.HALF_FLOAT};if(e instanceof WebGLRenderingContext){var i=!t.textureHalfFloat&&e.getExtension("OES_texture_half_float");return{textureFloat:!t.textureFloat&&!!e.getExtension("OES_texture_float"),textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!!i,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:i?i.HALF_FLOAT_OES:void 0}}return null}(e,p)),u},get colorBufferFloat(){return l||(l=function(e,t){if((0,Yi.Z)(e)){var i=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_half_float"),r=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),n=!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return i||r||n?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!n,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F}:null}if(e instanceof WebGLRenderingContext){var a=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_half_float"),s=!t.colorBufferFloat&&e.getExtension("WEBGL_color_buffer_float"),o=!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return a||s||o?{textureFloat:!!s,textureHalfFloat:!!a,floatBlend:!!o,RGBA16F:a?a.RGBA16F_EXT:void 0,RGB16F:a?a.RGB16F_EXT:void 0,RGBA32F:s?s.RGBA32F_EXT:void 0}:null}return null}(e,p)),l},get blendMinMax(){return c||(c=function(e,t){if((0,Yi.Z)(e))return{MIN:e.MIN,MAX:e.MAX};if(t.blendMinMax)return null;var i=e.getExtension("EXT_blend_minmax");return i?{MIN:i.MIN_EXT,MAX:i.MAX_EXT}:null}(e,p)),c},get depthTexture(){return null===v&&(v=xr(e,p,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),v},get standardDerivatives(){return null===m&&(m=xr(e,p,"standardDerivatives",!0,["OES_standard_derivatives"])),m},get shaderTextureLOD(){return null===g&&(g=xr(e,p,"shaderTextureLOD",!0,["EXT_shader_texture_lod"])),g},get fragDepth(){return null===y&&(y=xr(e,p,"fragDepth",!0,["EXT_frag_depth"])),y},get loseContext(){return h||(h=function(e,t){var i=t.loseContext&&e.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:function(){return i.loseContext()}}:null}(e,_)),h},get textureNorm16(){return d||(d=function(e,t){if(!(0,Yi.Z)(e))return null;if(t.textureNorm16)return null;var i=e.getExtension("EXT_texture_norm16");return i?{R16:i.R16,RG16:i.RG16,RGB16:i.RGB16,RGBA16:i.RGBA16,R16_SNORM:i.R16_SNORM,RG16_SNORM:i.RG16_SNORM,RGB16_SNORM:i.RGB16_SNORM,RGBA16_SNORM:i.RGBA16_SNORM}:null}(e,p)),d},enable:function(e){return this[e]}}}function xr(e,t,i,r,n){if(r&&(0,Yi.Z)(e))return!0;if(t[i])return!1;var a,s=yr(n);try{for(s.s();!(a=s.n()).done;){var o=a.value;if(e.getExtension(o))return!0}}catch(u){s.e(u)}finally{s.f()}return!1}var Tr=function(){function e(t,i){var r=this;(0,a.Z)(this,e),this.gl=t,this.instanceCounter=new sr,this._blendEnabled=!1,this._blendColorState={r:0,g:0,b:0,a:0},this._blendFunctionState={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0},this._blendEquationState={mode:32774,modeAlpha:32774},this._colorMaskState={r:!0,g:!0,b:!0,a:!0},this._polygonCullingEnabled=!1,this._cullFace=1029,this._frontFace=2305,this._scissorTestEnabled=!1,this._scissorRect={x:0,y:0,width:0,height:0},this._depthTestEnabled=!1,this._depthFunction=513,this._clearDepth=1,this._depthWriteEnabled=!0,this._depthRange={zNear:0,zFar:1},this._viewport=null,this._stencilTestEnabled=!1,this._polygonOffsetFillEnabled=!1,this._polygonOffset=[0,0],this._stencilFunction={face:1032,func:519,ref:0,mask:1},this._clearStencil=0,this._stencilWriteMask=1,this._stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680},this._clearColor={r:0,g:0,b:0,a:0},this._activeShaderProgram=null,this._activeVertexBuffer=null,this._activeIndexBuffer=null,this._activeFramebuffer=null,this._activeRenderbuffer=null,this._activeTextureUnit=0,this._textureUnitMap=new Array,this._numOfDrawCalls=0,this._numOfTriangles=0,this.webglVersion=(0,Yi.Z)(t)?"webgl2":"webgl","webgl"===this.webglVersion&&this.gl.getExtension("OES_element_index_uint"),this._capabilities=wr(t,i),this._parameters=this._loadParameters(i);var n=this.gl.getParameter(this.gl.VIEWPORT);this._viewport={x:n[0],y:n[1],width:n[2],height:n[3]},this._stateTracker=new or.jp({setBlending:function(e){if(e){r.setBlendingEnabled(!0),r.setBlendEquationSeparate(e.opRgb,e.opAlpha),r.setBlendFunctionSeparate(e.srcRgb,e.dstRgb,e.srcAlpha,e.dstAlpha);var t=e.color;r.setBlendColor(t.r,t.g,t.b,t.a)}else r.setBlendingEnabled(!1)},setCulling:function(e){e?(r.setFaceCullingEnabled(!0),r.setCullFace(e.face),r.setFrontFace(e.mode)):r.setFaceCullingEnabled(!1)},setPolygonOffset:function(e){e?(r.setPolygonOffsetFillEnabled(!0),r.setPolygonOffset(e.factor,e.units)):r.setPolygonOffsetFillEnabled(!1)},setDepthTest:function(e){e?(r.setDepthTestEnabled(!0),r.setDepthFunction(e.func)):r.setDepthTestEnabled(!1)},setStencilTest:function(e){if(e){r.setStencilTestEnabled(!0);var t=e.function;r.setStencilFunction(t.func,t.ref,t.mask);var i=e.operation;r.setStencilOp(i.fail,i.zFail,i.zPass)}else r.setStencilTestEnabled(!1)},setDepthWrite:function(e){e?(r.setDepthWriteEnabled(!0),r.setDepthRange(e.zNear,e.zFar)):r.setDepthWriteEnabled(!1)},setColorWrite:function(e){e?r.setColorMask(e.r,e.g,e.b,e.a):r.setColorMask(!1,!1,!1,!1)},setStencilWrite:function(e){e?r.setStencilWriteMask(e.mask):r.setStencilWriteMask(0)}}),this.enforceState(),this.driverTest=new gr(this)}return(0,s.Z)(e,[{key:"contextAttributes",get:function(){return this.gl.getContextAttributes()}},{key:"parameters",get:function(){return this._parameters}},{key:"dispose",value:function(){this.bindVAO(null),this.unbindBuffer(34962),this.unbindBuffer(34963),this._textureUnitMap.length=0,(0,O.hZ)()&&this.instanceCounter.printResourceCount()}},{key:"setPipelineState",value:function(e){this._stateTracker.setPipeline(e)}},{key:"setBlendingEnabled",value:function(e){this._blendEnabled!==e&&(!0===e?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._blendEnabled=e,this._stateTracker.invalidateBlending())}},{key:"externalProgramUpdate",value:function(){var e;null==(e=this._activeShaderProgram)||e.stop(),this._activeShaderProgram=null}},{key:"externalTextureUnitUpdate",value:function(e,t){for(var i=0;i<e.length;++i)this._textureUnitMap[e[i]]=null;t>=0&&(this._activeTextureUnit=t)}},{key:"externalVertexArrayObjectUpdate",value:function(){var e=this.capabilities.vao;e&&(e.bindVertexArray(null),this._activeVertexArrayObject=null),this._activeVertexBuffer=null,this._activeIndexBuffer=null}},{key:"externalVertexBufferUpdate",value:function(){this._activeVertexBuffer=null}},{key:"externalIndexBufferUpdate",value:function(){this._activeIndexBuffer=null}},{key:"setBlendColor",value:function(e,t,i,r){e===this._blendColorState.r&&t===this._blendColorState.g&&i===this._blendColorState.b&&r===this._blendColorState.a||(this.gl.blendColor(e,t,i,r),this._blendColorState.r=e,this._blendColorState.g=t,this._blendColorState.b=i,this._blendColorState.a=r,this._stateTracker.invalidateBlending())}},{key:"setBlendFunction",value:function(e,t){e===this._blendFunctionState.srcRGB&&t===this._blendFunctionState.dstRGB||(this.gl.blendFunc(e,t),this._blendFunctionState.srcRGB=e,this._blendFunctionState.srcAlpha=e,this._blendFunctionState.dstRGB=t,this._blendFunctionState.dstAlpha=t,this._stateTracker.invalidateBlending())}},{key:"setBlendFunctionSeparate",value:function(e,t,i,r){this._blendFunctionState.srcRGB===e&&this._blendFunctionState.srcAlpha===i&&this._blendFunctionState.dstRGB===t&&this._blendFunctionState.dstAlpha===r||(this.gl.blendFuncSeparate(e,t,i,r),this._blendFunctionState.srcRGB=e,this._blendFunctionState.srcAlpha=i,this._blendFunctionState.dstRGB=t,this._blendFunctionState.dstAlpha=r,this._stateTracker.invalidateBlending())}},{key:"setBlendEquation",value:function(e){this._blendEquationState.mode!==e&&(this.gl.blendEquation(e),this._blendEquationState.mode=e,this._blendEquationState.modeAlpha=e,this._stateTracker.invalidateBlending())}},{key:"setBlendEquationSeparate",value:function(e,t){this._blendEquationState.mode===e&&this._blendEquationState.modeAlpha===t||(this.gl.blendEquationSeparate(e,t),this._blendEquationState.mode=e,this._blendEquationState.modeAlpha=t,this._stateTracker.invalidateBlending())}},{key:"setColorMask",value:function(e,t,i,r){this._colorMaskState.r===e&&this._colorMaskState.g===t&&this._colorMaskState.b===i&&this._colorMaskState.a===r||(this.gl.colorMask(e,t,i,r),this._colorMaskState.r=e,this._colorMaskState.g=t,this._colorMaskState.b=i,this._colorMaskState.a=r,this._stateTracker.invalidateColorWrite())}},{key:"setClearColor",value:function(e,t,i,r){this._clearColor.r===e&&this._clearColor.g===t&&this._clearColor.b===i&&this._clearColor.a===r||(this.gl.clearColor(e,t,i,r),this._clearColor.r=e,this._clearColor.g=t,this._clearColor.b=i,this._clearColor.a=r)}},{key:"setFaceCullingEnabled",value:function(e){this._polygonCullingEnabled!==e&&(!0===e?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._polygonCullingEnabled=e,this._stateTracker.invalidateCulling())}},{key:"setPolygonOffsetFillEnabled",value:function(e){this._polygonOffsetFillEnabled!==e&&(!0===e?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._polygonOffsetFillEnabled=e,this._stateTracker.invalidatePolygonOffset())}},{key:"setPolygonOffset",value:function(e,t){this._polygonOffset[0]===e&&this._polygonOffset[1]===t||(this._polygonOffset[0]=e,this._polygonOffset[1]=t,this.gl.polygonOffset(e,t),this._stateTracker.invalidatePolygonOffset())}},{key:"setCullFace",value:function(e){this._cullFace!==e&&(this.gl.cullFace(e),this._cullFace=e,this._stateTracker.invalidateCulling())}},{key:"setFrontFace",value:function(e){this._frontFace!==e&&(this.gl.frontFace(e),this._frontFace=e,this._stateTracker.invalidateCulling())}},{key:"setScissorTestEnabled",value:function(e){this._scissorTestEnabled!==e&&(!0===e?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._scissorTestEnabled=e)}},{key:"setScissorRect",value:function(e,t,i,r){this._scissorRect.x===e&&this._scissorRect.y===t&&this._scissorRect.width===i&&this._scissorRect.height===r||(this.gl.scissor(e,t,i,r),this._scissorRect.x=e,this._scissorRect.y=t,this._scissorRect.width=i,this._scissorRect.height=r)}},{key:"setDepthTestEnabled",value:function(e){this._depthTestEnabled!==e&&(!0===e?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._depthTestEnabled=e,this._stateTracker.invalidateDepthTest())}},{key:"setClearDepth",value:function(e){this._clearDepth!==e&&(this.gl.clearDepth(e),this._clearDepth=e)}},{key:"setDepthFunction",value:function(e){this._depthFunction!==e&&(this.gl.depthFunc(e),this._depthFunction=e,this._stateTracker.invalidateDepthTest())}},{key:"setDepthWriteEnabled",value:function(e){this._depthWriteEnabled!==e&&(this.gl.depthMask(e),this._depthWriteEnabled=e,this._stateTracker.invalidateDepthWrite())}},{key:"setDepthRange",value:function(e,t){this._depthRange.zNear===e&&this._depthRange.zFar===t||(this.gl.depthRange(e,t),this._depthRange.zNear=e,this._depthRange.zFar=t,this._stateTracker.invalidateDepthWrite())}},{key:"setStencilTestEnabled",value:function(e){this._stencilTestEnabled!==e&&(!0===e?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._stencilTestEnabled=e,this._stateTracker.invalidateStencilTest())}},{key:"setClearStencil",value:function(e){e!==this._clearStencil&&(this.gl.clearStencil(e),this._clearStencil=e)}},{key:"setStencilFunction",value:function(e,t,i){this._stencilFunction.func===e&&this._stencilFunction.ref===t&&this._stencilFunction.mask===i||(this.gl.stencilFunc(e,t,i),this._stencilFunction.face=1032,this._stencilFunction.func=e,this._stencilFunction.ref=t,this._stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())}},{key:"setStencilFunctionSeparate",value:function(e,t,i,r){this._stencilFunction.face===e&&this._stencilFunction.func===t&&this._stencilFunction.ref===i&&this._stencilFunction.mask===r||(this.gl.stencilFuncSeparate(e,t,i,r),this._stencilFunction.face=e,this._stencilFunction.func=t,this._stencilFunction.ref=i,this._stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}},{key:"setStencilWriteMask",value:function(e){this._stencilWriteMask!==e&&(this.gl.stencilMask(e),this._stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}},{key:"setStencilOp",value:function(e,t,i){this._stencilOperation.fail===e&&this._stencilOperation.zFail===t&&this._stencilOperation.zPass===i||(this.gl.stencilOp(e,t,i),this._stencilOperation.face=1032,this._stencilOperation.fail=e,this._stencilOperation.zFail=t,this._stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())}},{key:"setStencilOpSeparate",value:function(e,t,i,r){this._stencilOperation.face===e&&this._stencilOperation.fail===t&&this._stencilOperation.zFail===i&&this._stencilOperation.zPass===r||(this.gl.stencilOpSeparate(e,t,i,r),this._stencilOperation.face=e,this._stencilOperation.face=e,this._stencilOperation.fail=t,this._stencilOperation.zFail=i,this._stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}},{key:"setActiveTexture",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this._activeTextureUnit;return e>=0&&(t||e!==this._activeTextureUnit)&&(this.gl.activeTexture(C.Ld+e),this._activeTextureUnit=e),i}},{key:"clear",value:function(e){e&&this.gl.clear(e)}},{key:"clearSafe",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:255;e&&(16384&e&&this.setColorMask(!0,!0,!0,!0),256&e&&this.setDepthWriteEnabled(!0),1024&e&&this.setStencilWriteMask(t),this.gl.clear(e))}},{key:"drawArrays",value:function(e,t,i){(0,O.hZ)()&&(this._numOfDrawCalls++,this._numOfTriangles+=Er(e,i)),this.gl.drawArrays(e,t,i)}},{key:"drawElements",value:function(e,t,i,r){(0,O.hZ)()&&(this._numOfDrawCalls++,this._numOfTriangles+=Er(e,t)),this.gl.drawElements(e,t,i,r)}},{key:"logIno",value:function(){(0,O.hZ)()&&console.log("DrawCalls: ".concat(this._numOfDrawCalls,", Triangles: ").concat(this._numOfTriangles))}},{key:"capabilities",get:function(){return this._capabilities}},{key:"setViewport",value:function(e,t,i,r){i=Math.max(Math.round(i),1),r=Math.max(Math.round(r),1);var n=this._viewport;n.x===e&&n.y===t&&n.width===i&&n.height===r||(n.x=e,n.y=t,n.width=i,n.height=r,this.gl.viewport(e,t,i,r))}},{key:"getViewport",value:function(){return{x:this._viewport.x,y:this._viewport.y,width:this._viewport.width,height:this._viewport.height}}},{key:"useProgram",value:function(e){var t,i;this._activeShaderProgram!==e&&(null==(t=this._activeShaderProgram)||t.stop(),this._activeShaderProgram=e,this.gl.useProgram(null!=(i=null==e?void 0:e.glName)?i:null))}},{key:"bindTexture",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(t>=this.parameters.maxTextureImageUnits||t<0)&&console.error("Input texture unit is out of range of available units!");var r=this._textureUnitMap[t];return(0,m.Wi)(e)||null==e.glName?((0,m.pC)(r)&&(this.setActiveTexture(t,i),this.gl.bindTexture(r.descriptor.target,null)),this._textureUnitMap[t]=null,r):i||r!==e?(this.setActiveTexture(t,i),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._textureUnitMap[t]=e,r):(e.isDirty&&(this.setActiveTexture(t,i),e.applyChanges()),r)}},{key:"unbindTextureAllUnits",value:function(e){for(var t=0;t<this.parameters.maxTextureImageUnits;t++)this._textureUnitMap[t]===e&&(this.bindTexture(null,t),this._textureUnitMap[t]=null)}},{key:"bindFramebuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3553;if((0,m.Wi)(e))return this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),void(this._activeFramebuffer=null);(t||this._activeFramebuffer!==e)&&(e.initializeAndBind(i),this._activeFramebuffer=e)}},{key:"bindBuffer",value:function(e){e&&(34962===e.bufferType?this._activeVertexBuffer=Fr(this.gl,e,e.bufferType,this._activeVertexBuffer):this._activeIndexBuffer=Fr(this.gl,e,e.bufferType,this._activeIndexBuffer))}},{key:"bindRenderbuffer",value:function(e){var t=this.gl;e||(t.bindRenderbuffer(t.RENDERBUFFER,null),this._activeRenderbuffer=null),this._activeRenderbuffer!==e&&(t.bindRenderbuffer(t.RENDERBUFFER,e.glName),this._activeRenderbuffer=e)}},{key:"unbindBuffer",value:function(e){34962===e?this._activeVertexBuffer=Fr(this.gl,null,e,this._activeVertexBuffer):this._activeIndexBuffer=Fr(this.gl,null,e,this._activeIndexBuffer)}},{key:"bindVAO",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;(0,m.Wi)(e)?this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null):this._activeVertexArrayObject!==e&&(e.bind(),this._activeVertexArrayObject=e)}},{key:"getBoundFramebufferObject",value:function(){return this._activeFramebuffer}},{key:"getBoundVAO",value:function(){return this._activeVertexArrayObject}},{key:"resetState",value:function(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null),this.unbindBuffer(34962),this.unbindBuffer(34963);for(var e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(1,0),this.setBlendEquation(32774),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(1029),this.setFrontFace(2305),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(513),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(519,0,0),this.setStencilOp(7680,7680,7680),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}},{key:"enforceState",value:function(){var e,t,i,r,n=this.gl,a=this.capabilities.vao;a&&a.bindVertexArray(null);for(var s=0;s<this.parameters.maxVertexAttributes;s++)n.disableVertexAttribArray(s);if(this._activeVertexBuffer?n.bindBuffer(this._activeVertexBuffer.bufferType,this._activeVertexBuffer.glName):n.bindBuffer(34962,null),this._activeIndexBuffer?n.bindBuffer(this._activeIndexBuffer.bufferType,this._activeIndexBuffer.glName):n.bindBuffer(34963,null),a&&this._activeVertexArrayObject){var o=this._activeVertexArrayObject;this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null),this.bindVAO(o)}n.bindFramebuffer(n.FRAMEBUFFER,null!=(e=null==(t=this._activeFramebuffer)?void 0:t.glName)?e:null),n.useProgram(null!=(i=null==(r=this._activeShaderProgram)?void 0:r.glName)?i:null),n.blendColor(this._blendColorState.r,this._blendColorState.g,this._blendColorState.b,this._blendColorState.a),n.bindRenderbuffer(n.RENDERBUFFER,this._activeRenderbuffer?this._activeRenderbuffer.glName:null),!0===this._blendEnabled?n.enable(this.gl.BLEND):n.disable(this.gl.BLEND),n.blendEquationSeparate(this._blendEquationState.mode,this._blendEquationState.modeAlpha),n.blendFuncSeparate(this._blendFunctionState.srcRGB,this._blendFunctionState.dstRGB,this._blendFunctionState.srcAlpha,this._blendFunctionState.dstAlpha),n.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a),n.clearDepth(this._clearDepth),n.clearStencil(this._clearStencil),n.colorMask(this._colorMaskState.r,this._colorMaskState.g,this._colorMaskState.b,this._colorMaskState.a),n.cullFace(this._cullFace),n.depthFunc(this._depthFunction),n.depthRange(this._depthRange.zNear,this._depthRange.zFar),!0===this._depthTestEnabled?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),n.depthMask(this._depthWriteEnabled),n.frontFace(this._frontFace),n.lineWidth(1),!0===this._polygonCullingEnabled?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),n.polygonOffset(this._polygonOffset[0],this._polygonOffset[1]),!0===this._polygonOffsetFillEnabled?n.enable(n.POLYGON_OFFSET_FILL):n.disable(n.POLYGON_OFFSET_FILL),n.scissor(this._scissorRect.x,this._scissorRect.y,this._scissorRect.width,this._scissorRect.height),!0===this._scissorTestEnabled?n.enable(n.SCISSOR_TEST):n.disable(n.SCISSOR_TEST),n.stencilFunc(this._stencilFunction.func,this._stencilFunction.ref,this._stencilFunction.mask),n.stencilOpSeparate(this._stencilOperation.face,this._stencilOperation.fail,this._stencilOperation.zFail,this._stencilOperation.zPass),!0===this._stencilTestEnabled?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),n.stencilMask(this._stencilWriteMask);for(var u=0;u<this.parameters.maxTextureImageUnits;u++){n.activeTexture(C.Ld+u),n.bindTexture(3553,null),n.bindTexture(34067,null),(0,Yi.Z)(n)&&n.bindTexture(32879,null);var l=this._textureUnitMap[u];(0,m.pC)(l)&&n.bindTexture(l.descriptor.target,l.glName)}n.activeTexture(C.Ld+this._activeTextureUnit),n.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height),(0,O.hZ)()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}},{key:"_loadParameters",value:function(e){var t,i=this.capabilities.textureFilterAnisotropic,r=null!=(t=e.maxAnisotropy)?t:1/0,n={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:i?Math.min(this.gl.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY),r):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE)};return M.Z.TEXTURE_UNIT_FOR_UPDATES=n.maxTextureImageUnits-1,n}}]),e}();function Fr(e,t,i,r){return t?r!==t&&e.bindBuffer(i,t.glName):e.bindBuffer(i,null),t}function Er(e,t){switch(e){case 0:return 2*t;case 4:return t/3;case 5:case 6:return t-2;default:return 0}}function kr(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function Sr(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?kr(Object(i),!0).forEach((function(t){(0,r.Z)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):kr(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function Rr(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"==typeof e)return Or(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Or(e,t)}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==i.return||i.return()}finally{if(o)throw a}}}}function Or(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function Cr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(V){return!1}}();return function(){var i,r=(0,h.Z)(e);if(t){var n=(0,h.Z)(this).constructor;i=Reflect.construct(r,arguments,n)}else i=r.apply(this,arguments);return(0,c.Z)(this,i)}}var Br=function(e){(0,l.Z)(r,e);var t,i=Cr(r);function r(e,t){var n;(0,a.Z)(this,r),(n=i.call(this))._trash=new Set,n._clipData=new Float32Array(8),n._upperLeft=(0,E.a)(),n._upperRight=(0,E.a)(),n._lowerLeft=(0,E.a)(),n._lowerRight=(0,E.a)(),n._mat2=(0,x.c)(),n._clipRendererInitialized=!1,n._renderRemainingTime=0,n._lastFrameRenderTime=0,n.renderRequested=!1,n.stage=(0,o.Z)(n),n._stationary=!0;var s=t.canvas,u=void 0===s?document.createElement("canvas"):s,l=t.alpha,c=void 0===l||l,h=t.stencil,f=void 0===h||h,d=t.contextOptions,y=void 0===d?{}:d;n._canvas=u;var b=(0,P.s)(u,1,{alpha:c,antialias:!1,depth:!0,stencil:f});return n.context=new Tr((0,m.pC)(b)?b:null,y),n.resourceManager=new k.Z,n.painter=new ji(n.context,(0,o.Z)(n),n.resourceManager),(0,v.Z)("esri-2d-profiler")&&(n._debugOutput=document.createElement("div"),n._debugOutput.setAttribute("style","margin: 24px 64px; position: absolute; color: red;"),e.appendChild(n._debugOutput)),n._renderParameters={drawPhase:0,state:n.state,pixelRatio:window.devicePixelRatio,stationary:!1,globalOpacity:1,blendMode:null,deltaTime:-1,time:0,inFadeTransition:!1,effects:null,context:n.context,painter:n.painter,timeline:t.timeline||new rr.T,renderingOptions:t.renderingOptions,requireFBO:!1,profiler:new tr(n.context,n._debugOutput),dataUploadCounter:0},n._taskHandle=(0,g.A)({render:function(e){return n.renderFrame(e)}}),n._taskHandle.pause(),n._lostWebGLContextHandle=(0,_.on)(u,"webglcontextlost",(function(){n.emit("webgl-error",{error:new p.Z("webgl-context-lost")})})),u.setAttribute("style","width: 100%; height:100%; display:block;"),e.appendChild(u),n}return(0,s.Z)(r,[{key:"destroy",value:function(){this.removeAllChildren(),this._emptyTrash(),this._taskHandle.remove(),this._taskHandle=null,this._boundFBO=null,this._clipFBO&&(this._clipFBO.dispose(),this._clipFBO=null),this._clipVAO&&(this._clipVAO.dispose(),this._clipVAO=null,this._clipVBO=null),this._clipStencilProgram&&(this._clipStencilProgram.dispose(),this._clipStencilProgram=null),this._lostWebGLContextHandle&&(this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null),this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas),this._debugOutput&&this._debugOutput.parentNode&&this._debugOutput.parentNode.removeChild(this._debugOutput),this.highlightOptions=null,this.resourceManager.destroy(),this.painter.dispose(),this.context.dispose(),this._canvas=null}},{key:"background",get:function(){return this._background},set:function(e){this._background=e,this.requestRender()}},{key:"highlightOptions",get:function(){return this._highlightOptions},set:function(e){var t=this;this._highlightOptionsHandle&&(this._highlightOptionsHandle.remove(),this._highlightOptionsHandle=null),this._highlightOptions=e,this._highlightOptions&&(this._highlightOptionsHandle=(0,y.S1)(this._highlightOptions,"version",(function(){t.painter.setHighlightOptions(e),t.requestRender()})))}},{key:"renderingOptions",get:function(){return this._renderingOptions},set:function(e){this._renderingOptions=e,this.requestRender()}},{key:"state",get:function(){return this._state},set:function(e){this._state=e,this.requestRender()}},{key:"stationary",get:function(){return this._stationary},set:function(e){this._stationary!==e&&(this._stationary=e,this.requestRender())}},{key:"trashDisplayObject",value:function(e){this._trash.add(e),this.requestRender()}},{key:"untrashDisplayObject",value:function(e){return this._trash.delete(e)}},{key:"requestRender",value:function(){this._renderRemainingTime=2e3,this.renderRequested||(this.renderRequested=!0,this.emit("will-render"),this._taskHandle.resume())}},{key:"renderFrame",value:function(e){var t=this._lastFrameRenderTime?e.time-this._lastFrameRenderTime:0;this._renderRemainingTime-=t,this._renderRemainingTime<=0&&this._taskHandle.pause(),this._lastFrameRenderTime=e.time,this.renderRequested=!1,this._renderParameters.state=this._state,this._renderParameters.stationary=this.stationary,this._renderParameters.pixelRatio=window.devicePixelRatio,this._renderParameters.globalOpacity=1,this._renderParameters.time=e.time,this._renderParameters.deltaTime=e.deltaTime,this._renderParameters.effects=null,this.processRender(this._renderParameters),this._emptyTrash(),this.emit("post-render")}},{key:"_createTransforms",value:function(){return{dvs:(0,T.c)()}}},{key:"renderChildren",value:function(e){var t,i=Rr(this.children);try{for(i.s();!(t=i.n()).done;){t.value.beforeRender(e)}}catch(a){i.e(a)}finally{i.f()}this._renderChildren(this.children,e);var r,n=Rr(this.children);try{for(n.s();!(r=n.n()).done;){r.value.afterRender(e)}}catch(a){n.e(a)}finally{n.f()}}},{key:"_renderChildren",value:function(e,t){var i=this.context;t.profiler.recordStart("drawLayers"),t.dataUploadCounter=0,this._beforeRenderChildren(t),t.drawPhase=Z.jx.MAP,this.painter.beforeRenderLayers(i,this.background);var r,n=Rr(e);try{for(n.s();!(r=n.n()).done;){r.value.processRender(t)}}catch(h){n.e(h)}finally{n.f()}this.painter.renderLayers(i),t.drawPhase=Z.jx.HIGHLIGHT,this.painter.beforeRenderLayers(i);var a,s=Rr(e);try{for(s.s();!(a=s.n()).done;){a.value.processRender(t)}}catch(h){s.e(h)}finally{s.f()}if(this.painter.renderLayers(i),this._isLabelDrawPhaseRequired(e)){t.drawPhase=Z.jx.LABEL,this.painter.beforeRenderLayers(i);var o,u=Rr(e);try{for(u.s();!(o=u.n()).done;){o.value.processRender(t)}}catch(h){u.e(h)}finally{u.f()}this.painter.renderLayers(i)}if((0,v.Z)("esri-tiles-debug")){t.drawPhase=Z.jx.DEBUG,this.painter.beforeRenderLayers(i);var l,c=Rr(e);try{for(c.s();!(l=c.n()).done;){l.value.processRender(t)}}catch(h){c.e(h)}finally{c.f()}this.painter.renderLayers(i)}t.profiler.recordEnd("drawLayers"),this._afterRenderChildren()}},{key:"_beforeRenderChildren",value:function(e){var t=this.context,i=e.state,r=e.pixelRatio;t.enforceState(),t.setClearDepth(1),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT|t.gl.DEPTH_BUFFER_BIT);var n=i.size,a=i.rotation,s=Math.round(n[0]*r),o=Math.round(n[1]*r);if(this._boundFBO=t.getBoundFramebufferObject(),i.spatialReference&&(i.spatialReference._isWrappable?i.spatialReference._isWrappable():i.spatialReference.isWrappable)){var u=(0,b.t)(a),l=Math.abs(Math.cos(u)),c=Math.abs(Math.sin(u)),h=Math.round(s*l+o*c),f=Math.round(i.worldScreenWidth);if(h<=f)this._clipFrame=!1;else{this._clipFBO&&this._clipFBO.width===s&&this._clipFBO.height===o||(this._clipFBO=new R.Z(t,{colorTarget:0,depthStencilTarget:3,width:s,height:o}));var d=(this.state.padding.left-this.state.padding.right)/2,p=(this.state.padding.bottom-this.state.padding.top)/2,_=.5*s,v=.5*o,m=1/s,g=1/o,y=f*r*.5,x=.5*(s*c+o*l),T=this._upperLeft,E=this._upperRight,k=this._lowerLeft,S=this._lowerRight;(0,F.s)(T,-y,-x),(0,F.s)(E,y,-x),(0,F.s)(k,-y,x),(0,F.s)(S,y,x),(0,w.i)(this._mat2),(0,w.t)(this._mat2,this._mat2,[_+d,v-p]),0!==a&&(0,w.r)(this._mat2,this._mat2,u),(0,F.t)(T,T,this._mat2),(0,F.t)(E,E,this._mat2),(0,F.t)(k,k,this._mat2),(0,F.t)(S,S,this._mat2);var O=this._clipData;O.set([2*k[0]*m-1,2*(o-k[1])*g-1,2*S[0]*m-1,2*(o-S[1])*g-1,2*T[0]*m-1,2*(o-T[1])*g-1,2*E[0]*m-1,2*(o-E[1])*g-1]),this._clipRendererInitialized||this._initializeClipRenderer(t),this._clipVBO.setData(O),this._boundFBO=t.getBoundFramebufferObject(),t.bindFramebuffer(this._clipFBO),t.setDepthWriteEnabled(!0),t.setStencilWriteMask(255),t.setClearColor(0,0,0,0),t.setClearDepth(1),t.setClearStencil(0),t.clear(t.gl.COLOR_BUFFER_BIT|t.gl.DEPTH_BUFFER_BIT|t.gl.STENCIL_BUFFER_BIT),t.setDepthWriteEnabled(!1),this._clipFrame=!0}}else this._clipFrame=!1}},{key:"_afterRenderChildren",value:function(){var e=this.context;if(e.logIno(),this._clipFrame&&this._clipRendererInitialized){if(e.bindFramebuffer(this._boundFBO),this._boundFBO=null,e.bindVAO(this._clipVAO),e.useProgram(this._clipStencilProgram),e.setDepthWriteEnabled(!1),e.setDepthTestEnabled(!1),e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.setStencilOp(7680,7680,7681),e.setStencilWriteMask(255),e.setStencilFunction(519,1,255),e.drawElements(4,6,5123,0),e.bindVAO(),e.setColorMask(!0,!0,!0,!0),null!=this.background){var t=this.background.color,i=t.r,r=t.g,n=t.b,a=t.a;e.setClearColor(a*i/255,a*r/255,a*n/255,a)}else e.setClearColor(0,0,0,0);e.clear(e.gl.COLOR_BUFFER_BIT),e.setBlendingEnabled(!0),e.setStencilFunction(514,1,255),this.painter.blitTexture(e,this._clipFBO.colorTexture,9728,1),e.setStencilTestEnabled(!1)}}},{key:"doRender",value:function(e){var t=this.context,i=e.state,n=e.pixelRatio;this._resizeCanvas(e),this.context.enforceState(),t.setViewport(0,0,n*i.size[0],n*i.size[1]),t.setDepthWriteEnabled(!0),t.setStencilWriteMask(255),(0,u.Z)((0,h.Z)(r.prototype),"doRender",this).call(this,e)}},{key:"takeScreenshot",value:(t=(0,n.Z)(d().mark((function e(t){var i,r,n,a,s,o,u,l,c,h,f,p;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={framebufferWidth:Math.round(this._renderParameters.state.size[0]*t.resolutionScale),framebufferHeight:Math.round(this._renderParameters.state.size[1]*t.resolutionScale)},r=i.framebufferWidth,n=i.framebufferHeight,a=this.context,s=this._state.clone(),null!=t.rotation&&(o=s.viewpoint,s.viewpoint.rotation=t.rotation,s.viewpoint=o),u=Sr(Sr({},this._renderParameters),{},{drawPhase:null,globalOpacity:1,stationary:!0,state:s,pixelRatio:1,time:Date.now(),deltaTime:0,blendMode:null,effects:null,inFadeTransition:!1}),l=new R.Z(a,{colorTarget:0,depthStencilTarget:3,width:r,height:n}),c=a.getBoundFramebufferObject(),h=a.getViewport(),a.bindFramebuffer(l),a.setViewport(0,0,r,n),this._renderChildren(t.children,u),f=this._readbackScreenshot(Sr(Sr({},t.cropArea),{},{y:n-(t.cropArea.y+t.cropArea.height)})),a.bindFramebuffer(c),a.setViewport(h.x,h.y,h.width,h.height),this.requestRender(),1===t.outputScale?p=f:(p=new ImageData(Math.round(f.width*t.outputScale),Math.round(f.height*t.outputScale)),(0,nr.TT)(f,p,!0)),e.abrupt("return",(0,nr.gH)(p,{format:t.format,quality:t.quality,rotation:0,disableDecorations:!1},document.createElement("canvas"),{flipY:!0,premultipliedAlpha:!0}));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_readbackScreenshot",value:function(e){var t=this.context.gl,i=(0,nr.r7)(e.width,e.height,document.createElement("canvas"));return t.readPixels(e.x,e.y,e.width,e.height,6408,5121,new Uint8Array(i.data.buffer)),i}},{key:"_resizeCanvas",value:function(e){var t=this._canvas,i=t.style,r=e.state.size,n=e.pixelRatio,a=r[0],s=r[1],o=Math.round(a*n),u=Math.round(s*n);t.width===o&&t.height===u||(t.width=o,t.height=u),i.width=a+"px",i.height=s+"px"}},{key:"_initializeClipRenderer",value:function(e){if(this._clipRendererInitialized)return!0;var t=ir.attributes,i=(0,B.H)(e,ir);if(!i)return!1;var r=S.Z.createVertex(e,35040,32),n=new Uint16Array([0,1,2,2,1,3]),a=S.Z.createIndex(e,35044,n),s=new A.Z(e,t,{geometry:[{name:"a_pos",count:2,type:5126,offset:0,stride:8,normalized:!1,divisor:0}]},{geometry:r},a);return this._clipStencilProgram=i,this._clipVBO=r,this._clipVAO=s,this._clipRendererInitialized=!0,!0}},{key:"_emptyTrash",value:function(){for(;this._trash.size>0;){var e=Array.from(this._trash);this._trash.clear();for(var t=0,i=e;t<i.length;t++){i[t].processDetach()}}}},{key:"_isLabelDrawPhaseRequired",value:function(e){var t,i=!1,r=Rr(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(!(n instanceof D.W)){i=i||!1;break}if(n.hasLabels)return!0;i=i||this._isLabelDrawPhaseRequired(n.children)}}catch(a){r.e(a)}finally{r.f()}return i}}]),r}(D.W),Mr=i(83195),Ar=i(79417),Pr=i(80896),Dr=i(42013),Zr=i(89636),Ir=(i(64003),i(30732)),zr=i(93433),Ur=i(56489),Lr=i(2757),Vr=function(){function e(t,i){(0,a.Z)(this,e),this.width=t,this.height=i;var r=Math.ceil(t/1),n=Math.ceil(i/1);this._cols=r,this._rows=n,this._cells=Lr.p.create(r*n)}return(0,s.Z)(e,[{key:"insertMetrics",value:function(e){var t=this._hasCollision(e);return 0===t&&this._markMetrics(e),t}},{key:"getCellId",value:function(e,t){return e+t*this._cols}},{key:"has",value:function(e){return this._cells.has(e)}},{key:"hasRange",value:function(e,t){return this._cells.hasRange(e,t)}},{key:"set",value:function(e){this._cells.set(e)}},{key:"setRange",value:function(e,t){this._cells.setRange(e,t)}},{key:"_hasCollision",value:function(e){var t=e.id,i=0,r=0;e.save();do{var n=e.boundsCount;i+=n;for(var a=0;a<n;a++){var s=e.boundsComputedAnchorX(a),o=e.boundsComputedAnchorY(a),u=e.boundsWidth(a)+2,l=e.boundsHeight(a)+2;switch(this._collide(s,o,u,l)){case 2:return 2;case 1:r++}}}while(e.peekId()===t&&e.next());return e.restore(),i===r?1:0}},{key:"_collide",value:function(e,t,i,r){var n=e-i/2,a=t-r/2,s=n+i,o=a+r;if(s<0||o<0||n>this.width||a>this.height)return 1;for(var u=(0,Ur.uZ)(Math.floor(n/1),0,this._cols),l=(0,Ur.uZ)(Math.floor(a/1),0,this._rows),c=(0,Ur.uZ)(Math.ceil(s/1),0,this._cols),h=(0,Ur.uZ)(Math.ceil(o/1),0,this._rows),f=l;f<=h;f++)for(var d=u;d<=c;d++){var p=this.getCellId(d,f);if(this.has(p))return 2}return 0}},{key:"_mark",value:function(e,t,i,r){for(var n=e-i/2,a=t-r/2,s=n+i,o=a+r,u=(0,Ur.uZ)(Math.floor(n/1),0,this._cols),l=(0,Ur.uZ)(Math.floor(a/1),0,this._rows),c=(0,Ur.uZ)(Math.ceil(s/1),0,this._cols),h=(0,Ur.uZ)(Math.ceil(o/1),0,this._rows),f=l;f<=h;f++)for(var d=u;d<=c;d++){var p=this.getCellId(d,f);this.set(p)}return!1}},{key:"_markMetrics",value:function(e){var t=e.id;do{for(var i=e.boundsCount,r=0;r<i;r++){var n=e.boundsComputedAnchorX(r),a=e.boundsComputedAnchorY(r),s=e.boundsWidth(r)+2,o=e.boundsHeight(r)+2;this._mark(n,a,s,o)}}while(e.peekId()===t&&e.next())}}]),e}(),Nr=i(35521),Gr=Math.PI;function Wr(e,t){switch(t.transformationType){case"additive":return function(e,t){return e+(jr(t.minSize,e)||t.minDataValue)}(e,t);case"constant":return function(e,t){var i=e.stops,r=i&&i.length&&i[0].size;return null==r&&(r=e.minSize),jr(r,t)}(t,e);case"clamped-linear":return function(e,t){var i=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),r=jr(t.minSize,e),n=jr(t.maxSize,e);return e<=t.minDataValue?r:e>=t.maxDataValue?n:r+i*(n-r)}(e,t);case"proportional":return function(e,t){var i=e/t.minDataValue,r=jr(t.minSize,e),n=jr(t.maxSize,e),a=null;return a=i*r,(0,Ur.uZ)(a,r,n)}(e,t);case"stops":return function(e,t){var i=function(e,t){if(!t)return;var i=0,r=t.length-1;return t.some((function(t,n){return e<t?(r=n,!0):(i=n,!1)})),[i,r,(e-t[i])/(t[r]-t[i])]}(e,t.cache.ipData),r=(0,He.Z)(i,3),n=r[0],a=r[1],s=r[2];if(n===a)return jr(t.stops[n].size,e);var o=jr(t.stops[n].size,e);return o+(jr(t.stops[a].size,e)-o)*s}(e,t);case"real-world-size":return function(e,t){var i=Nr.a[t.valueUnit],r=jr(t.minSize,e),n=jr(t.maxSize,e),a=t.valueRepresentation,s=null;return s="area"===a?2*Math.sqrt(e/Gr)/i:"radius"===a||"distance"===a?2*e/i:e/i,(0,Ur.uZ)(s,r,n)}(e,t);case"identity":return e;case"unknown":return null}}function jr(e,t){return"number"==typeof e?e:Wr(t,e)}function Hr(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"==typeof e)return qr(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return qr(e,t)}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==i.return||i.return()}finally{if(o)throw a}}}}function qr(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}var Xr=255;function Yr(e,t){var i=[];e.forEachTile((function(e){return i.push(e)})),i.sort((function(e,t){return e.instanceId-t.instanceId})),i.forEach((function(e){(0,m.pC)(e.labelMetrics)&&e.isReady&&t(e,e.labelMetrics.getCursor())}))}function Qr(e){return function(t){return(0,Ee.F2)(Wr(t,e))}}function Kr(e,t){if(function(e){return"feature"===e.layer.type||"csv"===e.layer.type||"geojson"===e.layer.type||"ogc-feature"===e.layer.type||"stream"===e.layer.type||"subtype-group"===e.layer.type||"wfs"===e.layer.type}(t)){var i="subtype-group"===t.layer.type?t.layer.sublayers.items:[t.layer],r=t.layer.geometryType,n=!function(e){var t,i=Hr(e);try{for(i.s();!(t=i.n()).done;){var r,n=t.value,a="featureReduction"in n&&"cluster"===(null==(r=n.featureReduction)?void 0:r.type)&&n.featureReduction,s=[].concat((0,zr.Z)(n.labelingInfo||[]),(0,zr.Z)(a.labelingInfo||[]));if(n.labelsVisible&&s.length&&s.some((function(e){return"none"===e.deconflictionStrategy})))return!0}}catch(o){i.e(o)}finally{i.f()}return!1}(i),a={};if("subtype-group"!==t.layer.type){if("heatmap"===t.layer.renderer.type)return;var s=function(e){var t="visualVariables"in e&&e.visualVariables;if(!t)return null;var i,r=Hr(t);try{for(r.s();!(i=r.n()).done;){var n=i.value;if("size"===n.type)return Qr(n)}}catch(a){r.e(a)}finally{r.f()}return null}(t.layer.renderer);a[0]=s}var o=t.tileRenderer;if(!(0,m.Wi)(o)){var u=t.layer.visible&&!t.suspended;e.push({tileRenderer:o,vvEvaluators:a,deconflictionEnabled:n,geometryType:r,visible:u})}}}var $r=function(){function e(){(0,a.Z)(this,e)}return(0,s.Z)(e,[{key:"run",value:function(e,t,i){for(var r=[],n=e.length-1;n>=0;n--)Kr(r,e[n]);this._transformMetrics(r,t),this._runCollision(r,t,i)}},{key:"_runCollision",value:function(e,t,i){var r,n=this,a=(0,He.Z)(t.state.size,2),s=a[0],o=a[1],u=new Vr(s*t.pixelRatio,o*t.pixelRatio),l=Hr(e);try{var c=function(){var e=r.value,t=e.tileRenderer,a=e.deconflictionEnabled,s=e.visible,o=t.featuresView.attributeView;a?s?(n._prepare(t),n._collideVisible(u,t,i),n._collideInvisible(u,t)):Yr(t,(function(e,t){for(;t.nextId();)o.setLabelMinZoom(t.id,Xr)})):Yr(t,(function(e,t){for(;t.nextId();)o.setLabelMinZoom(t.id,0)}))};for(l.s();!(r=l.n()).done;)c()}catch(h){l.e(h)}finally{l.f()}}},{key:"_isFiltered",value:function(e,t,i){var r=t.getFilterFlags(e),n=!i.hasFilter||!!(r&Re.Zd),a=!(0,m.pC)(i.featureEffect)||i.featureEffect.excludedLabelsVisible||!!(r&Re.iV);return!(n&&a)}},{key:"_prepare",value:function(e){var t=this,i=e.featuresView.attributeView,r=new Set;Yr(e,(function(n,a){for(;a.nextId();)r.has(a.id)||(r.add(a.id),t._isFiltered(a.id,i,e.layerView)?i.setLabelMinZoom(a.id,254):0!==i.getLabelMinZoom(a.id)?i.setLabelMinZoom(a.id,Xr):i.setLabelMinZoom(a.id,0))}))}},{key:"_collideVisible",value:function(e,t,i){var r=t.featuresView.attributeView,n=new Set;Yr(t,(function(t,a){for(;a.nextId();)if(!n.has(a.id))if(t.key.level===i){if(0===r.getLabelMinZoom(a.id))switch(e.insertMetrics(a)){case 1:break;case 2:r.setLabelMinZoom(a.id,254),n.add(a.id);break;case 0:r.setLabelMinZoom(a.id,0),n.add(a.id)}}else r.setLabelMinZoom(a.id,254)}))}},{key:"_collideInvisible",value:function(e,t){var i=t.featuresView.attributeView,r=new Set;Yr(t,(function(t,n){for(;n.nextId();)if(!r.has(n.id)&&i.getLabelMinZoom(n.id)===Xr)switch(e.insertMetrics(n)){case 1:break;case 2:i.setLabelMinZoom(n.id,Xr),r.add(n.id);break;case 0:i.setLabelMinZoom(n.id,0),r.add(n.id)}}))}},{key:"_transformMetrics",value:function(e,t){var i,r=Hr(e);try{var n=function(){var e=i.value,r=e.tileRenderer,n=e.geometryType,a=e.vvEvaluators;Yr(r,(function(e,i){var s=r.featuresView.attributeView,o=e.transforms.labelMat2d;o[4]=Math.round(o[4]),o[5]=Math.round(o[5]);for(var u=o[4],l=o[5],c="polyline"===n;i.next();){var h=i.boundsCount,f=i.anchorX,d=i.anchorY,p=i.size,_=a[0];if((0,m.pC)(_)){var v=_(s.getVVSize(i.id));p=isNaN(v)||null==v||v===1/0?p:v}for(var g=i.directionX*(p/2),y=i.directionY*(p/2),b=0;b<h;b++){var w=f,x=i.anchorY;if(c){var T=w+i.boundsX(b)+g,F=x+i.boundsY(b)+y;t.state.rotation?(T=o[0]*T+o[2]*F+o[4],F=o[1]*T+o[3]*F+o[5]):(T+=u,F+=l),i.setBoundsComputedAnchorX(b,Math.floor(T)),i.setBoundsComputedAnchorY(b,Math.floor(F))}else{t.state.rotation?(w=o[0]*f+o[2]*d+o[4],x=o[1]*f+o[3]*d+o[5]):(w+=u,x+=l);var E=w+i.boundsX(b)+g,k=x+i.boundsY(b)+y;i.setBoundsComputedAnchorX(b,E),i.setBoundsComputedAnchorY(b,k)}}}}))};for(r.s();!(i=r.n()).done;)n()}catch(a){r.e(a)}finally{r.f()}}}]),e}();function Jr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(V){return!1}}();return function(){var i,r=(0,h.Z)(e);if(t){var n=(0,h.Z)(this).constructor;i=Reflect.construct(r,arguments,n)}else i=r.apply(this,arguments);return(0,c.Z)(this,i)}}var en=Te.Z.getLogger("esri.views.2d.layers.labels.LabelManager"),tn=function(e){(0,l.Z)(i,e);var t=Jr(i);function i(e){var r;return(0,a.Z)(this,i),(r=t.call(this,e))._applyVisibilityPassThrottled=(0,Dr.P)(r._applyVisibilityPass,32,(0,o.Z)(r)),r.lastUpdateId=-1,r.updateRequested=!1,r.view=null,r}return(0,s.Z)(i,[{key:"initialize",value:function(){this.collisionEngine=new $r}},{key:"destroy",value:function(){this.collisionEngine=null,this._applyVisibilityPassThrottled.remove(),this._applyVisibilityPassThrottled=null}},{key:"updating",get:function(){return this.updateRequested}},{key:"update",value:function(e){this._applyVisibilityPassThrottled(e)}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"requestUpdate",value:function(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())}},{key:"processUpdate",value:function(e){this._set("updateParameters",e),this.updateRequested&&(this.updateRequested=!1,this.update(e))}},{key:"_applyVisibilityPass",value:function(e){try{var t=this.view.featuresTilingScheme.getClosestInfoForScale(e.state.scale).level;this.collisionEngine.run(this.view.allLayerViews.items,e,t)}catch(i){en.error(new p.Z("mapview-labeling","Encountered an error during label decluttering",i))}}}]),i}((0,Pr.p)(Ar.Z));(0,Mr._)([(0,Zr.Cb)()],tn.prototype,"updateRequested",void 0),(0,Mr._)([(0,Zr.Cb)({readOnly:!0})],tn.prototype,"updateParameters",void 0),(0,Mr._)([(0,Zr.Cb)()],tn.prototype,"updating",null),(0,Mr._)([(0,Zr.Cb)()],tn.prototype,"view",void 0);var rn=tn=(0,Mr._)([(0,Ir.j)("esri.views.2d.layers.labels.LabelManager")],tn),nn=i(74649),an=i(75679),sn=i(93373),on=i(5224),un=i(95518),ln=i(94749);function cn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(V){return!1}}();return function(){var i,r=(0,h.Z)(e);if(t){var n=(0,h.Z)(this).constructor;i=Reflect.construct(r,arguments,n)}else i=r.apply(this,arguments);return(0,c.Z)(this,i)}}var hn="esri-zoom-box__container",fn="esri-zoom-box__overlay",dn="esri-zoom-box__overlay-background",pn="esri-zoom-box__outline",_n="Shift",vn="Ctrl",mn=function(e){(0,l.Z)(i,e);var t=cn(i);function i(e){var r;return(0,a.Z)(this,i),(r=t.call(this,e))._container=null,r._overlay=null,r._backgroundShape=null,r._boxShape=null,r._box={x:0,y:0,width:0,height:0},r._redraw=r._redraw.bind((0,o.Z)(r)),r}return(0,s.Z)(i,[{key:"destroy",value:function(){this.view=null}},{key:"view",set:function(e){var t=this;this._handles&&this._handles.forEach((function(e){e.remove()})),this._handles=null,this._destroyOverlay(),this._set("view",e),e&&(e.on("drag",[_n],(function(e){return t._handleDrag(e,1)}),ln.f.INTERNAL),e.on("drag",[_n,vn],(function(e){return t._handleDrag(e,-1)}),ln.f.INTERNAL))}},{key:"_start",value:function(){this._createContainer(),this._createOverlay(),this.navigation.begin()}},{key:"_update",value:function(e,t,i,r){this._box.x=e,this._box.y=t,this._box.width=i,this._box.height=r,this._rafId||(this._rafId=requestAnimationFrame(this._redraw))}},{key:"_end",value:function(e,t,i,r,n){var a=this.view,s=a.toMap((0,Ee.vW)(e+.5*i,t+.5*r)),o=Math.max(i/a.width,r/a.height);-1===n&&(o=1/o),this._destroyOverlay(),this.navigation.end(),a.goTo({center:s,scale:a.scale*o})}},{key:"_updateBox",value:function(e,t,i,r){var n=this._boxShape;n.setAttributeNS(null,"x",""+e),n.setAttributeNS(null,"y",""+t),n.setAttributeNS(null,"width",""+i),n.setAttributeNS(null,"height",""+r),n.setAttributeNS(null,"class",pn)}},{key:"_updateBackground",value:function(e,t,i,r){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(e,t,i,r,this.view.width,this.view.height))}},{key:"_createContainer",value:function(){var e=document.createElement("div");e.className=hn,this.view.root.appendChild(e),this._container=e}},{key:"_createOverlay",value:function(){var e=this.view.width,t=this.view.height,i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttributeNS(null,"d","M 0 0 L "+e+" 0 L "+e+" "+t+" L 0 "+t+" Z"),i.setAttributeNS(null,"class",dn);var r=document.createElementNS("http://www.w3.org/2000/svg","rect"),n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),n.setAttributeNS(null,"class",fn),n.appendChild(i),n.appendChild(r),this._container.appendChild(n),this._backgroundShape=i,this._boxShape=r,this._overlay=n}},{key:"_destroyOverlay",value:function(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._container=this._backgroundShape=this._boxShape=this._overlay=null}},{key:"_toSVGPath",value:function(e,t,i,r,n,a){var s=e+i,o=t+r;return"M 0 0 L "+n+" 0 L "+n+" "+a+" L 0 "+a+" ZM "+e+" "+t+" L "+e+" "+o+" L "+s+" "+o+" L "+s+" "+t+" Z"}},{key:"_handleDrag",value:function(e,t){var i,r,n,a,s=e.x,o=e.y,u=e.origin.x,l=e.origin.y;switch(s>u?(i=u,n=s-u):(i=s,n=u-s),o>l?(r=l,a=o-l):(r=o,a=l-o),e.action){case"start":this._start();break;case"update":this._update(i,r,n,a);break;case"end":this._end(i,r,n,a,t)}e.stopPropagation()}},{key:"_redraw",value:function(){if(this._rafId&&(this._rafId=null,this._overlay)){var e=this._box,t=e.x,i=e.y,r=e.width,n=e.height;this._updateBox(t,i,r,n),this._updateBackground(t,i,r,n),this._rafId=requestAnimationFrame(this._redraw)}}}]),i}(Ar.Z);(0,Mr._)([(0,Zr.Cb)()],mn.prototype,"navigation",void 0),(0,Mr._)([(0,Zr.Cb)()],mn.prototype,"view",null);var gn=mn=(0,Mr._)([(0,Ir.j)("esri.views.2d.navigation.ZoomBox")],mn),yn=(i(58168),i(77880)),bn=function(){function e(t){(0,a.Z)(this,e),this.gain=t}return(0,s.Z)(e,[{key:"update",value:function(e){if(this.hasLastValue){var t=this.computeDelta(e);this.updateDelta(t)}this.lastValue=e}},{key:"reset",value:function(){this.lastValue=void 0,this.filteredDelta=void 0}},{key:"hasLastValue",get:function(){return void 0!==this.lastValue}},{key:"hasFilteredDelta",get:function(){return void 0!==this.filteredDelta}},{key:"computeDelta",value:function(e){return e-this.lastValue}},{key:"updateDelta",value:function(e){this.hasFilteredDelta?this.filteredDelta=(1-this.gain)*this.filteredDelta+this.gain*e:this.filteredDelta=e}}]),e}(),wn=function(){function e(t,i,r){(0,a.Z)(this,e),this._initialVelocity=t,this._stopVelocity=i,this._friction=r,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}return(0,s.Z)(e,[{key:"duration",get:function(){return this._duration}},{key:"isFinished",value:function(e){return e>this.duration}},{key:"friction",get:function(){return this._friction}},{key:"value",value:function(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}},{key:"valueDelta",value:function(e,t){var i=this.value(e);return this.value(e+t)-i}},{key:"valueFromInitialVelocity",value:function(e,t){t=Math.min(t,this.duration);var i=1-this.friction;return e*(Math.pow(i,t)-1)/Math.log(i)}}]),e}();function xn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(V){return!1}}();return function(){var i,r=(0,h.Z)(e);if(t){var n=(0,h.Z)(this).constructor;i=Reflect.construct(r,arguments,n)}else i=r.apply(this,arguments);return(0,c.Z)(this,i)}}var Tn=function(e){(0,l.Z)(i,e);var t=xn(i);function i(e,r,n,s,o){var u;return(0,a.Z)(this,i),(u=t.call(this,e,r,n)).sceneVelocity=s,u.direction=o,u}return(0,s.Z)(i,[{key:"value",value:function(e){return(0,u.Z)((0,h.Z)(i.prototype),"valueFromInitialVelocity",this).call(this,this.sceneVelocity,e)}}]),i}(wn),Fn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:300,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.84;(0,a.Z)(this,e),this.minimumInitialVelocity=t,this.stopVelocity=i,this.friction=r,this.enabled=!0,this.time=new bn(.6),this.screen=[new bn(.4),new bn(.4)],this.scene=[new bn(.6),new bn(.6),new bn(.6)],this.tmpDirection=(0,ur.c)()}return(0,s.Z)(e,[{key:"add",value:function(e,t,i){if(this.enabled){if(this.time.hasLastValue&&this.time.computeDelta(i)<.015)return;this.screen[0].update(e[0]),this.screen[1].update(e[1]),this.scene[0].update(t[0]),this.scene[1].update(t[1]),this.scene[2].update(t[2]),this.time.update(i)}}},{key:"reset",value:function(){this.screen[0].reset(),this.screen[1].reset(),this.scene[0].reset(),this.scene[1].reset(),this.scene[2].reset(),this.time.reset()}},{key:"evaluateMomentum",value:function(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;var e=this.screen[0].filteredDelta,t=this.screen[1].filteredDelta,i=Math.sqrt(e*e+t*t)/this.time.filteredDelta;return Math.abs(i)<this.minimumInitialVelocity?null:this.createMomentum(i,this.stopVelocity,this.friction)}},{key:"createMomentum",value:function(e,t,i){(0,yn.s)(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);var r=(0,yn.l)(this.tmpDirection);r>0&&(0,yn.a)(this.tmpDirection,this.tmpDirection,1/r);var n=r/this.time.filteredDelta;return new Tn(e,t,i,n,this.tmpDirection)}}]),e}();function En(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(V){return!1}}();return function(){var i,r=(0,h.Z)(e);if(t){var n=(0,h.Z)(this).constructor;i=Reflect.construct(r,arguments,n)}else i=r.apply(this,arguments);return(0,c.Z)(this,i)}}var kn=function(e){(0,l.Z)(i,e);var t=En(i);function i(e){var r;return(0,a.Z)(this,i),(r=t.call(this,e)).animationTime=0,r.momentumEstimator=new Fn(500,6,.92),r.momentum=null,r.tmpMomentum=(0,ur.c)(),r.momentumFinished=!1,r.viewpoint=new sn.Z({targetGeometry:new on.Z,scale:0,rotation:0}),r.watch("momentumFinished",(function(e){e&&r.navigation.stop()})),r}return(0,s.Z)(i,[{key:"begin",value:function(e,t){this.navigation.begin(),this.momentumEstimator.reset(),this.addToEstimator(t),this.previousDrag=t}},{key:"update",value:function(e,t){this.addToEstimator(t);var i=t.center.x,r=t.center.y,n=this.previousDrag;i=n?n.center.x-i:-i,r=n?r-n.center.y:r,e.viewpoint=(0,un.Rx)(this.viewpoint,e.viewpoint,[i||0,r||0]),this.previousDrag=t}},{key:"end",value:function(e,t){this.addToEstimator(t);var i=e.navigation.momentumEnabled;this.momentum=i?this.momentumEstimator.evaluateMomentum():null,this.animationTime=0,this.momentum&&this.onAnimationUpdate(e),this.previousDrag=null,this.navigation.end()}},{key:"addToEstimator",value:function(e){var t=e.center.x,i=e.center.y,r=(0,Ee.s1)(-t,i),n=(0,ur.f)(-t,i,0);this.momentumEstimator.add(r,n,.001*e.timestamp)}},{key:"onAnimationUpdate",value:function(e){var t=this;this.navigation.animationManager.animateContinous(e.viewpoint,(function(i,r){t.momentumFinished=!t.momentum||t.momentum.isFinished(t.animationTime);var n=.001*r;if(!t.momentumFinished){var a=t.momentum.valueDelta(t.animationTime,n);(0,yn.a)(t.tmpMomentum,t.momentum.direction,a),(0,un.Rx)(i,i,t.tmpMomentum),e.constraints.constrainByGeometry(i)}t.animationTime+=n}))}},{key:"stopMomentumNavigation",value:function(){this.momentum&&(this.momentumEstimator.reset(),this.momentum=null,this.navigation.stop())}}]),i}(Ar.Z);(0,Mr._)([(0,Zr.Cb)()],kn.prototype,"momentumFinished",void 0),(0,Mr._)([(0,Zr.Cb)()],kn.prototype,"viewpoint",void 0),(0,Mr._)([(0,Zr.Cb)()],kn.prototype,"navigation",void 0);var Sn=kn=(0,Mr._)([(0,Ir.j)("esri.views.2d.navigation.actions.Pan")],kn),Rn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2.5,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.95,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:12;(0,a.Z)(this,e),this.minimumInitialVelocity=t,this.stopVelocity=i,this.friction=r,this.maxVelocity=n,this.enabled=!0,this.value=new bn(.8),this.time=new bn(.3)}return(0,s.Z)(e,[{key:"add",value:function(e,t){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(t)<.01)return;if(this.value.hasFilteredDelta){var i=this.value.computeDelta(e);this.value.filteredDelta*i<0&&this.value.reset()}}this.time.update(t),this.value.update(e)}}},{key:"reset",value:function(){this.value.reset(),this.time.reset()}},{key:"evaluateMomentum",value:function(){if(!this.enabled||!this.value.hasFilteredDelta)return null;var e=this.value.filteredDelta/this.time.filteredDelta;return e=(0,Ur.uZ)(e,-this.maxVelocity,this.maxVelocity),Math.abs(e)<this.minimumInitialVelocity?null:this.createMomentum(e,this.stopVelocity,this.friction)}},{key:"createMomentum",value:function(e,t,i){return new wn(e,t,i)}}]),e}();function On(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(V){return!1}}();return function(){var i,r=(0,h.Z)(e);if(t){var n=(0,h.Z)(this).constructor;i=Reflect.construct(r,arguments,n)}else i=r.apply(this,arguments);return(0,c.Z)(this,i)}}var Cn=function(e){(0,l.Z)(i,e);var t=On(i);function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.95,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:12;return(0,a.Z)(this,i),t.call(this,e,r,n,s)}return(0,s.Z)(i,[{key:"add",value:function(e,t){if(this.value.hasLastValue){for(var r=this.value.lastValue,n=e-r;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;e=r+n}(0,u.Z)((0,h.Z)(i.prototype),"add",this).call(this,e,t)}}]),i}(Rn);function Bn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(V){return!1}}();return function(){var i,r=(0,h.Z)(e);if(t){var n=(0,h.Z)(this).constructor;i=Reflect.construct(r,arguments,n)}else i=r.apply(this,arguments);return(0,c.Z)(this,i)}}var Mn=function(e){(0,l.Z)(i,e);var t=Bn(i);function i(e,r,n){return(0,a.Z)(this,i),t.call(this,e,r,n)}return(0,s.Z)(i,[{key:"value",value:function(e){var t=(0,u.Z)((0,h.Z)(i.prototype),"value",this).call(this,e);return Math.exp(t)}},{key:"valueDelta",value:function(e,t){var r=(0,u.Z)((0,h.Z)(i.prototype),"value",this).call(this,e),n=(0,u.Z)((0,h.Z)(i.prototype),"value",this).call(this,e+t)-r;return Math.exp(n)}}]),i}(wn),An=function(e){(0,l.Z)(i,e);var t=Bn(i);function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2.5,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.95,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:12;return(0,a.Z)(this,i),t.call(this,e,r,n,s)}return(0,s.Z)(i,[{key:"add",value:function(e,t){(0,u.Z)((0,h.Z)(i.prototype),"add",this).call(this,Math.log(e),t)}},{key:"createMomentum",value:function(e,t,i){return new Mn(e,t,i)}}]),i}(Rn);function Pn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(V){return!1}}();return function(){var i,r=(0,h.Z)(e);if(t){var n=(0,h.Z)(this).constructor;i=Reflect.construct(r,arguments,n)}else i=r.apply(this,arguments);return(0,c.Z)(this,i)}}var Dn=function(e){(0,l.Z)(i,e);var t=Pn(i);function i(e){var r;return(0,a.Z)(this,i),(r=t.call(this,e))._animationTime=0,r._momentumFinished=!1,r._rotationMomentumEstimator=new Cn(.6,.15,.95),r._rotationDirection=1,r._zoomDirection=1,r._zoomMomentumEstimator=new An,r._zoomOnly=null,r.zoomMomentum=null,r.rotateMomentum=null,r.viewpoint=new sn.Z({targetGeometry:new on.Z,scale:0,rotation:0}),r.watch("_momentumFinished",(function(e){e&&r.navigation.stop()})),r}return(0,s.Z)(i,[{key:"begin",value:function(e,t){this.navigation.begin(),this._rotationMomentumEstimator.reset(),this._zoomMomentumEstimator.reset(),this._zoomOnly=null,this._previousAngle=this._startAngle=t.angle,this._previousRadius=this._startRadius=t.radius,this._previousCenter=t.center,this._updateTimestamp=null,e.constraints.rotationEnabled&&this.addToRotateEstimator(0,t.timestamp),this.addToZoomEstimator(t,1)}},{key:"update",value:function(e,t){null===this._updateTimestamp&&(this._updateTimestamp=t.timestamp);var i=t.angle,r=t.radius,n=t.center,a=Math.abs(180*(i-this._startAngle)/Math.PI),s=Math.abs(r-this._startRadius),o=this._startRadius/r;if(this._previousRadius){var u=r/this._previousRadius,l=180*(i-this._previousAngle)/Math.PI;this._rotationDirection=l>=0?1:-1,this._zoomDirection=u>=1?1:-1,e.constraints.rotationEnabled?(null===this._zoomOnly&&t.timestamp-this._updateTimestamp>200&&(this._zoomOnly=s-a>0),null===this._zoomOnly||this._zoomOnly?l=0:this.addToRotateEstimator(i-this._startAngle,t.timestamp)):l=0,this.addToZoomEstimator(t,o),this.navigation.setViewpoint([n.x,n.y],1/u,l,[this._previousCenter.x-n.x,n.y-this._previousCenter.y])}this._previousAngle=i,this._previousRadius=r,this._previousCenter=n}},{key:"end",value:function(e){this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum(),this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum(),this._animationTime=0,(this.rotateMomentum||this.zoomMomentum)&&this.onAnimationUpdate(e),this.navigation.end()}},{key:"addToRotateEstimator",value:function(e,t){this._rotationMomentumEstimator.add(e,.001*t)}},{key:"addToZoomEstimator",value:function(e,t){this._zoomMomentumEstimator.add(t,.001*e.timestamp)}},{key:"canZoomIn",value:function(e){var t=e.scale,i=e.constraints.effectiveMaxScale;return 0===i||t>i}},{key:"canZoomOut",value:function(e){var t=e.scale,i=e.constraints.effectiveMinScale;return 0===i||t<i}},{key:"onAnimationUpdate",value:function(e){var t=this;this.navigation.animationManager.animateContinous(e.viewpoint,(function(i,r){var n=!t.canZoomIn(e)&&t._zoomDirection>1||!t.canZoomOut(e)&&t._zoomDirection<1,a=!t.rotateMomentum||t.rotateMomentum.isFinished(t._animationTime),s=n||!t.zoomMomentum||t.zoomMomentum.isFinished(t._animationTime),o=.001*r;if(t._momentumFinished=a&&s,!t._momentumFinished){var u=t.rotateMomentum?Math.abs(t.rotateMomentum.valueDelta(t._animationTime,o))*t._rotationDirection*180/Math.PI:0,l=t.zoomMomentum?Math.abs(t.zoomMomentum.valueDelta(t._animationTime,o)):1,c=(0,E.a)(),h=(0,E.a)();if(t._previousCenter){(0,F.s)(c,t._previousCenter.x,t._previousCenter.y),(0,un.Dq)(h,e.size,e.padding),(0,F.m)(c,c,h);var f=e.constraints,d=e.scale,p=d*l;l<1&&!f.canZoomInTo(p)?(l=d/f.effectiveMaxScale,t.zoomMomentum=null,t.rotateMomentum=null):l>1&&!f.canZoomOutTo(p)&&(l=d/f.effectiveMinScale,t.zoomMomentum=null,t.rotateMomentum=null),(0,un.UZ)(i,e.viewpoint,l,u,c,e.size),e.constraints.constrainByGeometry(i)}}t._animationTime+=o}))}},{key:"stopMomentumNavigation",value:function(){(this.rotateMomentum||this.zoomMomentum)&&(this.rotateMomentum&&(this._rotationMomentumEstimator.reset(),this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop())}}]),i}(Ar.Z);(0,Mr._)([(0,Zr.Cb)()],Dn.prototype,"_momentumFinished",void 0),(0,Mr._)([(0,Zr.Cb)()],Dn.prototype,"viewpoint",void 0),(0,Mr._)([(0,Zr.Cb)()],Dn.prototype,"navigation",void 0);var Zn=Dn=(0,Mr._)([(0,Ir.j)("esri.views.2d.navigation.actions.Pinch")],Dn);function In(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(V){return!1}}();return function(){var i,r=(0,h.Z)(e);if(t){var n=(0,h.Z)(this).constructor;i=Reflect.construct(r,arguments,n)}else i=r.apply(this,arguments);return(0,c.Z)(this,i)}}var zn=(0,E.a)(),Un=(0,E.a)(),Ln=function(e){(0,l.Z)(i,e);var t=In(i);function i(e){var r;return(0,a.Z)(this,i),(r=t.call(this,e))._previousCenter=(0,E.a)(),r.viewpoint=new sn.Z({targetGeometry:new on.Z,scale:0,rotation:0}),r}return(0,s.Z)(i,[{key:"begin",value:function(e,t){this.navigation.begin(),(0,F.s)(this._previousCenter,t.center.x,t.center.y)}},{key:"update",value:function(e,t){var i=e.state,r=i.size,n=i.padding;(0,F.s)(zn,t.center.x,t.center.y),(0,un.ni)(Un,r,n),e.viewpoint=(0,un.$H)(this.viewpoint,e.state.paddedViewState.viewpoint,(0,un.dI)(Un,this._previousCenter,zn)),(0,F.c)(this._previousCenter,zn)}},{key:"end",value:function(){this.navigation.end()}}]),i}(Ar.Z);(0,Mr._)([(0,Zr.Cb)()],Ln.prototype,"viewpoint",void 0),(0,Mr._)([(0,Zr.Cb)()],Ln.prototype,"navigation",void 0);var Vn=Ln=(0,Mr._)([(0,Ir.j)("esri.views.2d.actions.Rotate")],Ln);function Nn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(V){return!1}}();return function(){var i,r=(0,h.Z)(e);if(t){var n=(0,h.Z)(this).constructor;i=Reflect.construct(r,arguments,n)}else i=r.apply(this,arguments);return(0,c.Z)(this,i)}}var Gn=new sn.Z({targetGeometry:new on.Z}),Wn=[0,0],jn=function(e){(0,l.Z)(c,e);var t,i,r,o,u=Nn(c);function c(e){var t;return(0,a.Z)(this,c),(t=u.call(this,e))._endTimer=null,t.animationManager=null,t}return(0,s.Z)(c,[{key:"initialize",value:function(){this.pan=new Sn({navigation:this}),this.rotate=new Vn({navigation:this}),this.pinch=new Zn({navigation:this}),this.zoomBox=new gn({view:this.view,navigation:this})}},{key:"destroy",value:function(){this.zoomBox.destroy(),this.zoomBox=null,this.animationManager=null}},{key:"begin",value:function(){this._set("interacting",!0)}},{key:"end",value:function(){this._lastEventTimestamp=performance.now(),this._startTimer(250)}},{key:"zoom",value:(o=(0,n.Z)(d().mark((function e(t){var i,r=arguments;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r.length>1&&void 0!==r[1]?r[1]:this._getDefaultAnchor(),this.stop(),this.begin(),!this.view.constraints.snapToZoom||!this.view.constraints.effectiveLODs){e.next=3;break}return e.abrupt("return",t<1?this.zoomIn(i):this.zoomOut(i));case 3:this.setViewpoint(i,t,0,[0,0]);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"zoomIn",value:(r=(0,n.Z)(d().mark((function e(t){var i,r;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.view,r=i.constraints.snapToNextScale(i.scale),e.abrupt("return",this._zoomToScale(r,t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"zoomOut",value:(i=(0,n.Z)(d().mark((function e(t){var i,r;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.view,r=i.constraints.snapToPreviousScale(i.scale),e.abrupt("return",this._zoomToScale(r,t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"setViewpoint",value:function(e,t,i,r){this.begin(),this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,e,t,i,r),this.end()}},{key:"setViewpointImmediate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._getDefaultAnchor();this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,r,e,t,i)}},{key:"continousRotateClockwise",value:function(){var e=this.get("view.viewpoint");this.animationManager.animateContinous(e,(function(e){(0,un.$H)(e,e,-1)}))}},{key:"continousRotateCounterclockwise",value:function(){var e=this.get("view.viewpoint");this.animationManager.animateContinous(e,(function(e){(0,un.$H)(e,e,1)}))}},{key:"resetRotation",value:function(){this.view.rotation=0}},{key:"continousPanLeft",value:function(){this._continuousPan([-10,0])}},{key:"continousPanRight",value:function(){this._continuousPan([10,0])}},{key:"continousPanUp",value:function(){this._continuousPan([0,10])}},{key:"continousPanDown",value:function(){this._continuousPan([0,-10])}},{key:"stop",value:function(){this.pan.stopMomentumNavigation(),this.animationManager.stop(),this.end(),null!==this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null,this._set("interacting",!1))}},{key:"_continuousPan",value:function(e){var t=this,i=this.get("view.viewpoint");this.animationManager.animateContinous(i,(function(i){(0,un.Rx)(i,i,e),t.view.constraints.constrainByGeometry(i)}))}},{key:"_startTimer",value:function(e){var t=this;return null!==this._endTimer||(this._endTimer=setTimeout((function(){t._endTimer=null;var e=performance.now()-t._lastEventTimestamp;e<250?t._endTimer=t._startTimer(e):t._set("interacting",!1)}),e)),this._endTimer}},{key:"_getDefaultAnchor",value:function(){var e=this.view,t=e.size,i=e.padding,r=i.left,n=i.right,a=i.top,s=i.bottom;return Wn[0]=.5*(t[0]-n+r),Wn[1]=.5*(t[1]-s+a),Wn}},{key:"_zoomToScale",value:(t=(0,n.Z)(d().mark((function e(t){var i,r,n,a,s,o,u,l,c,h=arguments;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=h.length>1&&void 0!==h[1]?h[1]:this._getDefaultAnchor(),r=this.view,n=r.constraints,a=r.scale,s=r.viewpoint,o=r.size,u=r.padding,l=n.canZoomInTo(t),c=n.canZoomOutTo(t),t<a&&!l||t>a&&!c){e.next=4;break}return e.abrupt("return",((0,un.gG)(Gn,s,t/a,0,i,o,u),n.constrainByGeometry(Gn),r.goTo(Gn,{animate:!0})));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_scaleRotateTranslateViewpoint",value:function(e,t,i,r,n){var a=this.view,s=a.size,o=a.padding,u=a.constraints,l=a.scale,c=a.viewpoint,h=l*i,f=u.canZoomInTo(h),d=u.canZoomOutTo(h);return(i<1&&!f||i>1&&!d)&&(i=1),(0,un.Rx)(c,c,n),(0,un.gG)(e,c,i,r,t,s,o),u.constrainByGeometry(e)}}]),c}(Ar.Z);(0,Mr._)([(0,Zr.Cb)()],jn.prototype,"animationManager",void 0),(0,Mr._)([(0,Zr.Cb)({type:Boolean,readOnly:!0})],jn.prototype,"interacting",void 0),(0,Mr._)([(0,Zr.Cb)()],jn.prototype,"pan",void 0),(0,Mr._)([(0,Zr.Cb)()],jn.prototype,"pinch",void 0),(0,Mr._)([(0,Zr.Cb)()],jn.prototype,"rotate",void 0),(0,Mr._)([(0,Zr.Cb)()],jn.prototype,"view",void 0),(0,Mr._)([(0,Zr.Cb)()],jn.prototype,"zoomBox",void 0);var Hn=jn=(0,Mr._)([(0,Ir.j)("esri.views.2d.navigation.MapViewNavigation")],jn),qn=i(74881),Xn=i(98840),Yn=i(21170),Qn={shaders:{vertexShader:(0,ae.w)("magnifier/magnifier.vert"),fragmentShader:(0,ae.w)("magnifier/magnifier.frag")},attributes:new Map([["a_pos",0]])};var Kn=i(97835);function $n(e){return Jn.apply(this,arguments)}function Jn(){return Jn=(0,n.Z)(d().mark((function e(t){var r,n,a,s,o;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.e(2947).then(i.bind(i,42947)),n=i.e(2571).then(i.bind(i,42571)),e.t0=Kn.t,e.next=5,r;case 5:return e.t1=e.sent.default,e.t2={signal:t},a=(0,e.t0)(e.t1,e.t2),e.t3=Kn.t,e.next=11,n;case 11:return e.t4=e.sent.default,e.t5={signal:t},s=(0,e.t3)(e.t4,e.t5),e.next=16,a;case 16:return e.t6=e.sent,e.next=19,s;case 19:return e.t7=e.sent,o={mask:e.t6,overlay:e.t7},e.abrupt("return",((0,Fe.k_)(t),o));case 22:case"end":return e.stop()}}),e)}))),Jn.apply(this,arguments)}function ea(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(V){return!1}}();return function(){var i,r=(0,h.Z)(e);if(t){var n=(0,h.Z)(this).constructor;i=Reflect.construct(r,arguments,n)}else i=r.apply(this,arguments);return(0,c.Z)(this,i)}}var ta=function(e){(0,l.Z)(i,e);var t=ea(i);function i(){var e;return(0,a.Z)(this,i),(e=t.call(this))._handles=new qn.Z,e._resourcePixelRatio=1,e.visible=!1,e}return(0,s.Z)(i,[{key:"destroy",value:function(){this._handles.destroy(),this._handles=null,this._disposeRenderResources(),this._resourcesTask&&(this._resourcesTask.abort(),this._resourcesTask=null)}},{key:"background",get:function(){return this._background},set:function(e){this._background=e,this.requestRender()}},{key:"magnifier",get:function(){return this._magnifier},set:function(e){var t=this;this._magnifier=e,this._handles.removeAll(),this._handles.add([(0,y.S1)(e,"version",(function(){t.visible=e.visible&&(0,m.pC)(e.position)&&e.size>0,t.requestRender()})),e.watch(["mask","overlay"],(function(){return t._reloadResources()})),e.watch("size",(function(){t._disposeRenderResources(),t.requestRender()}))])}},{key:"_createTransforms",value:function(){return{dvs:(0,T.c)()}}},{key:"doRender",value:function(e){var t,i=e.context;if(this._resourcesTask){if(e.drawPhase===Z.jx.MAP&&this._canRender()){this._updateResources(e);var r=this._magnifier;if(!(0,m.Wi)(r.position)){var n=e.pixelRatio,a=r.size*n,s=1/r.factor,o=Math.ceil(s*a);this._readbackTexture.resize(o,o);var u=e.state.size,l=n*u[0],c=n*u[1],h=.5*o,f=.5*o,d=(0,Ur.uZ)(n*r.position.x,h,l-h-1),p=(0,Ur.uZ)(c-n*r.position.y,f,c-f-1);i.setBlendingEnabled(!0);var _=d-h,v=p-f,g=this._readbackTexture;i.bindTexture(g,0),i.gl.copyTexImage2D(g.descriptor.target,0,g.descriptor.pixelFormat,_,v,o,o,0);var y=null==(t=this.background)?void 0:t.color,b=y?[y.a*y.r/255,y.a*y.g/255,y.a*y.b/255,y.a]:[1,1,1,1],w=(d+r.offset.x*n)/l*2-1,x=(p-r.offset.y*n)/c*2-1,T=a/l*2,F=a/c*2,E=this._program;i.bindVAO(this._vertexArrayObject),i.bindTexture(this._overlayTexture,6),i.bindTexture(this._maskTexture,7),i.useProgram(E),E.setUniform4fv("u_background",b),E.setUniform1i("u_readbackTexture",0),E.setUniform1i("u_overlayTexture",6),E.setUniform1i("u_maskTexture",7),E.setUniform4f("u_drawPos",w,x,T,F),E.setUniform1i("u_maskEnabled",r.maskEnabled?1:0),E.setUniform1i("u_overlayEnabled",r.overlayEnabled?1:0),i.setStencilTestEnabled(!1),i.setColorMask(!0,!0,!0,!0),i.drawArrays(5,0,4),i.bindVAO()}}}else this._reloadResources()}},{key:"_canRender",value:function(){return this.mask&&this.overlay&&null!=this._magnifier}},{key:"_reloadResources",value:function(){var e=this;this._resourcesTask&&this._resourcesTask.abort();var t=(0,m.pC)(this._magnifier)?this._magnifier.maskUrl:null,i=(0,m.pC)(this._magnifier)?this._magnifier.overlayUrl:null;this._resourcesTask=(0,Fe.vr)(function(){var r=(0,n.Z)(d().mark((function r(n){var a,s,o,u,l,c,h;return d().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=(0,m.Wi)(t)||(0,m.Wi)(i)?$n(n):null,s=(0,m.pC)(t)?(0,we.default)(t,{responseType:"image",signal:n}).then((function(e){return e.data})):a.then((function(e){return e.mask})),o=(0,m.pC)(i)?(0,we.default)(i,{responseType:"image",signal:n}).then((function(e){return e.data})):a.then((function(e){return e.overlay})),r.next=5,Promise.all([s,o]);case 5:u=r.sent,l=(0,He.Z)(u,2),c=l[0],h=l[1],e.mask=c,e.overlay=h,e._disposeRenderResources(),e.requestRender();case 10:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())}},{key:"_disposeRenderResources",value:function(){this._readbackTexture=(0,m.O3)(this._readbackTexture),this._overlayTexture=(0,m.O3)(this._overlayTexture),this._maskTexture=(0,m.O3)(this._maskTexture),this._vertexArrayObject=(0,m.O3)(this._vertexArrayObject),this._program=(0,m.O3)(this._program)}},{key:"_updateResources",value:function(e){if(e.pixelRatio!==this._resourcePixelRatio&&this._disposeRenderResources(),!this._readbackTexture){var t=e.context;this._resourcePixelRatio=e.pixelRatio;var i=Math.ceil(this._magnifier.size*e.pixelRatio);this._program=function(e){return(0,B.H)(e,Qn)}(t);var r=new Uint16Array([0,1,0,0,1,1,1,0]),n=Qn.attributes;this._vertexArrayObject=new A.Z(t,n,{geometry:[{name:"a_pos",count:2,type:5123,offset:0,stride:4,normalized:!1,divisor:0}]},{geometry:S.Z.createVertex(t,35044,r)}),this.overlay.width=i,this.overlay.height=i,this._overlayTexture=new M.Z(t,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0,preMultiplyAlpha:!(0,Xn.zd)(this.overlay.src)||!e.context.driverTest.svgAlwaysPremultipliesAlpha},this.overlay),this.mask.width=i,this.mask.height=i,this._maskTexture=new M.Z(t,{target:3553,pixelFormat:6406,internalFormat:6406,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0},this.mask);var a=1/this._magnifier.factor;this._readbackTexture=new M.Z(t,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:Math.ceil(a*i),height:Math.ceil(a*i)})}}}]),i}(Yn.s)}}]);
//# sourceMappingURL=6979-e86b14f5c9a32ab5aa93.js.map