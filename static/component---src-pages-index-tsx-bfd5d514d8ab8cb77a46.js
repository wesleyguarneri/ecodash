(self.webpackChunkenergy_and_water_dashboard=self.webpackChunkenergy_and_water_dashboard||[]).push([[6691],{93373:function(e,t,n){"use strict";n.d(t,{Z:function(){return E}});var r=n(15671),i=n(43144),o=n(60136),a=n(6215),s=n(61120),u=n(83195),l=n(54279),c=n(56489),p=n(89636),f=(n(43079),n(33682),n(36049)),d=n(9634),h=n(30732),v=n(61979),y=n(64003),m=n(5224),g=(n(77880),n(73415));var b=function(){function e(t,n){(0,r.Z)(this,e),this.min=t,this.max=n,this.range=n-t}return(0,i.Z)(e,[{key:"ndiff",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Math.ceil((e-t)/this.range)*this.range+t}},{key:"_normalize",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return(n-=r)<e?n+=this.ndiff(e-n):n>t&&(n-=this.ndiff(n-t)),i&&n===t&&(n=e),n+r}},{key:"normalize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._normalize(this.min,this.max,e,t,n)}},{key:"clamp",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(0,c.uZ)(e-t,this.min,this.max)+t}},{key:"monotonic",value:function(e,t,n){return e<t?t:t+this.ndiff(e-t,n)}},{key:"minimalMonotonic",value:function(e,t,n){return this._normalize(e,e+this.range,t,n)}},{key:"center",value:function(e,t,n){return t=this.monotonic(e,t,n),this.normalize((e+t)/2,n)}},{key:"diff",value:function(e,t,n){return this.monotonic(e,t,n)-e}},{key:"shortestSignedDiff",value:function(e,t){e=this.normalize(e);var n=(t=this.normalize(t))-e,r=t<e?this.minimalMonotonic(e,t)-e:t-this.minimalMonotonic(t,e);return Math.abs(n)<Math.abs(r)?n:r}},{key:"contains",value:function(e,t,n){return t=this.minimalMonotonic(e,t),(n=this.minimalMonotonic(e,n))>e&&n<t}}]),e}();(0,g.c)(),(0,g.c)();function _(e){for(var t in e){var n=e[t];n instanceof Function&&(e[t]=n.bind(e))}return e}_(new b(0,2*Math.PI)),_(new b(-Math.PI,Math.PI));var w,k=_(new b(0,360));(0,g.c)(),(0,g.c)(),(0,g.c)();function C(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,s.Z)(e);if(t){var i=(0,s.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,a.Z)(this,n)}}var x=w=function(e){(0,o.Z)(n,e);var t=C(n);function n(){var e;(0,r.Z)(this,n);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).position=new m.Z([0,0,0]),e.heading=0,e.tilt=0,e.fov=55,e}return(0,i.Z)(n,[{key:"normalizeCtorArgs",value:function(e,t,n,r){if(e&&"object"==typeof e&&("x"in e||Array.isArray(e))){var i={position:e};return null!=t&&(i.heading=t),null!=n&&(i.tilt=n),null!=r&&(i.fov=r),i}return e}},{key:"writePosition",value:function(e,t,n,r){var i=e.clone();i.x=(0,y.q9)(e.x||0),i.y=(0,y.q9)(e.y||0),i.z=e.hasZ?(0,y.q9)(e.z||0):e.z,t[n]=i.write({},r)}},{key:"readPosition",value:function(e,t){var n=new m.Z;return n.read(e,t),n.x=(0,y.q9)(n.x||0),n.y=(0,y.q9)(n.y||0),n.z=n.hasZ?(0,y.q9)(n.z||0):n.z,n}},{key:"equals",value:function(e){return!!e&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}},{key:"clone",value:function(){return new w({position:this.position.clone(),heading:this.heading,tilt:this.tilt,fov:this.fov})}}]),n}(l.wq);(0,u._)([(0,p.Cb)({type:m.Z,json:{write:{isRequired:!0}}})],x.prototype,"position",void 0),(0,u._)([(0,v.c)("position")],x.prototype,"writePosition",null),(0,u._)([(0,d.r)("position")],x.prototype,"readPosition",null),(0,u._)([(0,p.Cb)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,f.p)((function(e){return k.normalize((0,y.q9)(e))}))],x.prototype,"heading",void 0),(0,u._)([(0,p.Cb)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,f.p)((function(e){return(0,c.uZ)((0,y.q9)(e),-180,180)}))],x.prototype,"tilt",void 0),(0,u._)([(0,p.Cb)({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],x.prototype,"fov",void 0);var Z,M=x=w=(0,u._)([(0,h.j)("esri.Camera")],x),I=n(58168),R=n(10173),O=n(73376);function P(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,s.Z)(e);if(t){var i=(0,s.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,a.Z)(this,n)}}var T=Z=function(e){(0,o.Z)(n,e);var t=P(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e)).rotation=0,i.scale=0,i.targetGeometry=null,i.camera=null,i}return(0,i.Z)(n,[{key:"castRotation",value:function(e){return(e%=360)<0&&(e+=360),e}},{key:"clone",value:function(){return new Z({rotation:this.rotation,scale:this.scale,targetGeometry:(0,R.pC)(this.targetGeometry)?this.targetGeometry.clone():null,camera:(0,R.pC)(this.camera)?this.camera.clone():null})}}]),n}(l.wq);function S(){return{enabled:!this.camera}}(0,u._)([(0,p.Cb)({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:S}}}}})],T.prototype,"rotation",void 0),(0,u._)([(0,f.p)("rotation")],T.prototype,"castRotation",null),(0,u._)([(0,p.Cb)({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:S}}}}})],T.prototype,"scale",void 0),(0,u._)([(0,p.Cb)({types:I.qM,json:{read:O.im,write:!0,origins:{"web-scene":{read:O.im,write:{overridePolicy:S}}}}})],T.prototype,"targetGeometry",void 0),(0,u._)([(0,p.Cb)({type:M,json:{write:!0}})],T.prototype,"camera",void 0);var E=T=Z=(0,u._)([(0,h.j)("esri.Viewpoint")],T)},42027:function(e,t,n){"use strict";function r(){return[1,0,0,1,0,0]}n.d(t,{c:function(){return r}});Object.freeze({__proto__:null,create:r,clone:function(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]},fromValues:function(e,t,n,r,i,o){return[e,t,n,r,i,o]},createView:function(e,t){return new Float64Array(e,t,6)}})},75428:function(e,t,n){"use strict";function r(){var e=new Float32Array(9);return e[0]=1,e[4]=1,e[8]=1,e}function i(e){var t=new Float32Array(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}n.d(t,{a:function(){return i},c:function(){return r}});Object.freeze({__proto__:null,create:r,clone:i,fromValues:function(e,t,n,r,i,o,a,s,u){var l=new Float32Array(9);return l[0]=e,l[1]=t,l[2]=n,l[3]=r,l[4]=i,l[5]=o,l[6]=a,l[7]=s,l[8]=u,l},createView:function(e,t){return new Float32Array(e,t,9)}})},42013:function(e,t,n){"use strict";function r(e,t,n,r){var i=null,o=1e3;"number"==typeof t?(o=t,r=n):(i=null!=t?t:null,o=n);var a,s=0,u=function(){s=0,e.apply(r,a)},l=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];i&&i.apply(r,t),a=t,o?s||(s=setTimeout(u,o)):u()};return l.remove=function(){s&&(clearTimeout(s),s=0)},l.forceUpdate=function(){s&&(clearTimeout(s),u())},l.hasPendingUpdates=function(){return!!s},l}n.d(t,{P:function(){return r}})},78637:function(e,t,n){"use strict";n.d(t,{T:function(){return o}});var r=n(15671),i=n(43144),o=function(){function e(){(0,r.Z)(this,e),this._names=new Map}return(0,i.Z)(e,[{key:"begin",value:function(e){this._names.has(e)||(this._names.set(e,!1),-1!==e.indexOf("Brush")&&this.record("Esri.FirstDraw"),performance.mark("Esri.".concat(e,".Start")))}},{key:"end",value:function(e){this._names.has(e)&&!this._names.get(e)&&(this._names.set(e,!0),performance.mark("Esri.".concat(e,".End")))}},{key:"record",value:function(e){this._names.has(e)||(this._names.set(e,!0),performance.mark("Esri.".concat(e)))}}]),e}()},95518:function(e,t,n){"use strict";n.d(t,{H4:function(){return J},dI:function(){return Y},o2:function(){return $},JG:function(){return j},km:function(){return K},EK:function(){return P},ni:function(){return F},bk:function(){return L},Rb:function(){return U},Dq:function(){return V},uG:function(){return N},Ck:function(){return W},Jp:function(){return q},L2:function(){return H},ut:function(){return G},gG:function(){return ie},SI:function(){return Q},$H:function(){return X},YQ:function(){return ee},UZ:function(){return re},Hy:function(){return ne},qf:function(){return D},Rx:function(){return se}});var r=n(15861),i=n(87757),o=n.n(i),a=n(93373),s=n(20410),u=n(10173),l=n(64026),c=n(47032),p=n(87637),f=n(42027),d=n(66657),h=n(76796),v=n(59007),y=n(93776),m=n(5224),g=n(39356),b=n(66870),_=n(50810),w=n(7093);function k(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return C(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return C(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var x=39.37,Z=180/Math.PI;function M(e,t,n,r){return r&&n&&!r.equals(n)&&(0,w.Q8)(r,n)&&r.isWebMercator?r.isWebMercator?function(e,t){var n=t[1];return n>89.99999?n=89.99999:n<-89.99999&&(n=-89.99999),n=Math.sin((0,c.t)(n)),(0,d.s)(e,(0,c.t)(t[0])*b.sv.radius,.5*b.sv.radius*Math.log((1+n)/(1-n)))}(e,t):function(e,t,n){var r=(0,c.a)(t[0]/b.sv.radius);return(0,d.s)(e,n?r:r-360*Math.floor((r+180)/360),(0,c.a)(.5*Math.PI-2*Math.atan(Math.exp(-t[1]/b.sv.radius))))}(e,t):(0,d.c)(e,t)}function I(e){return e.wkid?e:e.spatialReference||g.Z.WGS84}function R(e,t){return t.type?(0,d.s)(e,t.x,t.y):(0,d.c)(e,t)}function O(e){return(0,l.c9)(e)}function P(e,t){return Math.max(e.width/t[0],e.height/t[1])*function(e){return(0,_.JY)(e)?O(e)*x*96:1}(e.spatialReference)}function T(e,t,n,r){return S.apply(this,arguments)}function S(){return(S=(0,r.Z)(o().mark((function e(t,n,r,i){var a,l,c,p,f,d,h,g,b,_,C,x,Z,M,I,R,O,P,S,E,A,j,F,L,D,V,B,N,z;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:if(!Array.isArray(t)||t.length){e.next=4;break}return e.abrupt("return",null);case 4:if(s.Z.isCollection(t)&&(t=t.toArray()),!Array.isArray(t)||!t.length||"object"!=typeof t[0]){e.next=39;break}if(c=t.every((function(e){return"attributes"in e})),p=t.some((function(e){return!e.geometry})),f=t,!(c&&p&&n&&n.allLayerViews)){e.next=20;break}d=new Map,h=k(t);try{for(h.s();!(g=h.n()).done;)b=g.value,_=b.layer,C=d.get(_)||[],null!=(x=b.attributes[_.objectIdField])&&C.push(x),d.set(_,C)}catch(o){h.e(o)}finally{h.f()}return Z=[],d.forEach((function(e,t){var r=n.allLayerViews.find((function(e){return e.layer.id===t.id}));if("queryFeatures"in r){var i=t.createQuery();i.objectIds=e,i.returnGeometry=!0,Z.push(r.queryFeatures(i))}})),e.next=15,Promise.all(Z);case 15:M=e.sent,I=[],R=k(M);try{for(R.s();!(O=R.n()).done;)if((P=O.value)&&P.features&&P.features.length){S=k(P.features);try{for(S.s();!(E=S.n()).done;)A=E.value,(0,u.pC)(A.geometry)&&I.push(A.geometry)}catch(o){S.e(o)}finally{S.f()}}}catch(o){R.e(o)}finally{R.f()}f=I;case 20:j=k(f),e.prev=21,j.s();case 23:if((F=j.n()).done){e.next=30;break}return L=F.value,e.next=27,T(L,n,r,i);case 27:i=e.sent;case 28:e.next=23;break;case 30:e.next=35;break;case 32:e.prev=32,e.t0=e.catch(21),j.e(e.t0);case 35:return e.prev=35,j.f(),e.finish(35);case 38:return e.abrupt("return",i);case 39:if(!Array.isArray(t)||2!==t.length||"number"!=typeof t[0]||"number"!=typeof t[1]){e.next=43;break}a=new m.Z(t),e.next=61;break;case 43:if(!(t instanceof y.Z)){e.next=47;break}a=t,e.next=61;break;case 47:if(!("geometry"in t)){e.next=61;break}if(!t.geometry){e.next=52;break}a=t.geometry,e.next=61;break;case 52:if(!t.layer){e.next=61;break}if(D=t.layer,V=n.allLayerViews.find((function(e){return e.layer.id===D.id})),!("queryFeatures"in V)){e.next=61;break}return(B=D.createQuery()).objectIds=[t.attributes[D.objectIdField]],B.returnGeometry=!0,e.next=59,V.queryFeatures(B);case 59:N=e.sent,a=(0,u.U2)(N,"features",0,"geometry");case 61:if(!(0,u.Wi)(a)){e.next=63;break}return e.abrupt("return",null);case 63:if(l="point"===a.type?new v.Z({xmin:a.x,ymin:a.y,xmax:a.x,ymax:a.y,spatialReference:a.spatialReference}):a.extent){e.next=65;break}return e.abrupt("return",null);case 65:return z=(0,w.iV)(l,r),e.abrupt("return",(0,u.Wi)(z)?null:i=i?i.union(z):z);case 67:case"end":return e.stop()}}),e,null,[[21,32,35,38]])})))).apply(this,arguments)}function E(e){if(e&&(!Array.isArray(e)||"number"!=typeof e[0])&&("object"==typeof e||Array.isArray(e)&&"object"==typeof e[0])){if("layer"in e&&e.layer&&e.layer.minScale&&e.layer.maxScale){var t=e.layer;return{min:t.minScale,max:t.maxScale}}if(Array.isArray(e)&&e.length&&e.every((function(e){return"layer"in e}))){var n,r=0,i=0,o=k(e);try{for(o.s();!(n=o.n()).done;){var a=n.value.layer;a&&a.minScale&&a.maxScale&&(r=a.minScale<r?a.minScale:r,i=a.maxScale>i?a.maxScale:i)}}catch(s){o.e(s)}finally{o.f()}return r&&i?{min:r,max:i}:null}}}function A(){return(A=(0,r.Z)(o().mark((function e(t,n){var r,i,s,l,c,p,f,d,y,g,b,_,k,C,x,Z;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&n){e.next=2;break}return e.abrupt("return",new a.Z({targetGeometry:new m.Z,scale:0,rotation:0}));case 2:if(r=n.spatialReference,i=n.constraints,s=n.padding,l=n.viewpoint,c=n.size,p=[s?c[0]-s.left-s.right:c[0],s?c[1]-s.top-s.bottom:c[1]],f=null,t instanceof a.Z?f=t:t.viewpoint?f=t.viewpoint:t.target&&"esri.Viewpoint"===t.target.declaredClass&&(f=t.target),d=null,!f||!f.targetGeometry){e.next=11;break}d=f.targetGeometry,e.next=35;break;case 11:if(!(t instanceof v.Z)){e.next=15;break}d=t,e.next=35;break;case 15:if(e.t0=t||t&&("center"in t||"extent"in t||"target"in t),!e.t0){e.next=35;break}return e.next=19,T(t.center,n,r);case 19:if(e.t3=e.sent,e.t3){e.next=24;break}return e.next=23,T(t.extent,n,r);case 23:e.t3=e.sent;case 24:if(e.t2=e.t3,e.t2){e.next=29;break}return e.next=28,T(t.target,n,r);case 28:e.t2=e.sent;case 29:if(e.t1=e.t2,e.t1){e.next=34;break}return e.next=33,T(t,n,r);case 33:e.t1=e.sent;case 34:d=e.t1;case 35:if(!d&&l&&l.targetGeometry?d=l.targetGeometry:!d&&n.extent&&(d=n.extent),y=I(d),r||(r=I(n.spatialReference||n.extent||d)),(0,w.Q8)(d,r)||!y||y.equals(r)){e.next=39;break}return e.abrupt("return",null);case 39:return g=R((0,h.a)(),d.center?d.center:d),b=new m.Z(M(g,g,y,r),r),_=null,f&&(0,u.pC)(f.targetGeometry)&&"point"===f.targetGeometry.type?_=f.scale:t.hasOwnProperty("scale")&&t.scale?_=t.scale:t.hasOwnProperty("zoom")&&-1!==t.zoom&&i&&i.effectiveLODs?_=i.zoomToScale(t.zoom):Array.isArray(d)||"point"===d.type||"extent"===d.type&&0===d.width&&0===d.height?(k=(0,w.iV)(n.extent,r),_=(0,u.pC)(k)?P(k,p):n.extent?P(n.extent,p):l.scale):_=(0,w.Q8)(d.extent,r)?P((0,w.iV)(d.extent,r),p):P(d.extent,p),(C=E(t))&&(C.min&&C.min>_?_=C.min:C.max&&C.max<_&&(_=C.max)),x=0,f?x=f.rotation:t.hasOwnProperty("rotation")?x=t.rotation:l&&(x=l.rotation),Z=new a.Z({targetGeometry:b,scale:_,rotation:x}),e.abrupt("return",(i&&(Z=i.fit(Z),i.constrainByGeometry(Z),i.rotationEnabled||(Z.rotation=x)),Z));case 48:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e,t){var n=e.targetGeometry,r=t.targetGeometry;return n.x=r.x,n.y=r.y,n.spatialReference=r.spatialReference,e.scale=t.scale,e.rotation=t.rotation,e}function F(e,t,n){return n?(0,d.s)(e,.5*(t[0]-n.right+n.left),.5*(t[1]-n.bottom+n.top)):(0,d.g)(e,t,.5)}var L=function(){var e=(0,h.a)();return function(t,n,r){var i=n.targetGeometry;R(e,i);var o=.5*N(n);return t.xmin=e[0]-o*r[0],t.ymin=e[1]-o*r[1],t.xmax=e[0]+o*r[0],t.ymax=e[1]+o*r[1],t.spatialReference=i.spatialReference,t}}();function D(e,t,n,r,i){return $(e,t,n.center),e.scale=P(n,r),i&&i.constraints&&i.constraints.constrain(e),e}var V=function(){var e=(0,h.a)();return function(t,n,r){return(0,d.h)(t,function(e,t){return(0,d.g)(e,t,.5)}(t,n),F(e,n,r))}}(),B=function(){var e=(0,f.c)(),t=(0,h.a)();return function(n,r,i,o){var a=N(r),s=z(r);return(0,d.s)(t,a,a),(0,p.f)(e,t),(0,p.r)(e,e,s),(0,p.t)(e,e,V(t,i,o)),(0,p.t)(e,e,[0,o.top-o.bottom]),(0,d.s)(n,e[4],e[5])}}();function N(e){return e.scale*function(e){return(0,u.pC)(e)&&(0,_.JY)(e.spatialReference)?1/(O(e.spatialReference)*x*96):1}(e.targetGeometry)}function z(e){return(0,c.t)(e.rotation)||0}var U=function(){var e=(0,h.a)(),t=(0,h.a)(),n=(0,h.a)();return function(r,i,o,a,s,u){return(0,d.n)(e,i),(0,d.g)(t,o,.5*u),(0,d.s)(n,1/a*u,-1/a*u),(0,p.i)(r),(0,p.t)(r,r,t),s&&(0,p.r)(r,r,s),(0,p.s)(r,r,n),(0,p.t)(r,r,e),r}}(),W=function(){var e=(0,h.a)();return function(t,n,r,i){var o=N(n),a=z(n);return R(e,n.targetGeometry),U(t,e,r,o,a,i)}}(),q=function(){var e=(0,h.a)();return function(t,n,r,i){var o=N(n);return R(e,n.targetGeometry),U(t,e,r,o,0,i)}}();function G(e){if(e.isWrappable){var t=(0,_.C5)(e);return t.valid[1]-t.valid[0]}return 0}function H(e,t){return Math.round(G(e)/t)}function K(e,t){return function(e,t){return A.apply(this,arguments)}(e,t)}var Y=function(){var e=(0,h.a)(),t=(0,h.a)(),n=[0,0,0];return function(r,i,o){(0,d.f)(e,r,i),(0,d.i)(e,e),(0,d.f)(t,r,o),(0,d.i)(t,t),(0,d.j)(n,e,t);var a=Math.acos((0,d.k)(e,t)/((0,d.l)(e)*(0,d.l)(t)))*Z;return n[2]<0&&(a=-a),isNaN(a)&&(a=0),a}}(),J=function(){var e=(0,h.a)();return function(t,n,r,i){var o=t.targetGeometry;return j(t,n),B(e,n,r,i),o.x+=e[0],o.y+=e[1],t}}(),$=(function(){var e=(0,h.a)()}(),function(){var e=(0,h.a)();return function(t,n,r){j(t,n);var i=t.targetGeometry,o=I(r),a=I(i);return R(e,r),M(e,e,o,a),i.x=e[0],i.y=e[1],t}}());var Q=function(){var e=(0,h.a)();return function(t,n,r,i,o){o||(o="center"),(0,d.h)(e,r,i),(0,d.g)(e,e,.5);var a=e[0],s=e[1];switch(o){case"center":(0,d.s)(e,0,0);break;case"left":(0,d.s)(e,-a,0);break;case"top":(0,d.s)(e,0,s);break;case"right":(0,d.s)(e,a,0);break;case"bottom":(0,d.s)(e,0,-s);break;case"top-left":(0,d.s)(e,-a,s);break;case"bottom-left":(0,d.s)(e,-a,-s);break;case"top-right":(0,d.s)(e,a,s);break;case"bottom-right":(0,d.s)(e,a,-s)}return se(t,n,e),t}}();function X(e,t,n){return j(e,t),e.rotation+=n,e}function ee(e,t,n){return j(e,t),e.rotation=n,e}var te=function(){var e=(0,h.a)();return function(t,n,r,i,o){return j(t,n),isNaN(r)||0===r||(oe(e,i,n,o),t.scale=n.scale*r,ae(e,e,t,o),se(t,t,(0,d.s)(e,e[0]-i[0],i[1]-e[1]))),t}}();function ne(e,t,n){return j(e,t),e.scale=n,e}var re=function(){var e=(0,h.a)();return function(t,n,r,i,o,a){return j(t,n),isNaN(r)||0===r||(oe(e,o,n,a),t.scale=n.scale*r,t.rotation+=i,ae(e,e,t,a),se(t,t,(0,d.s)(e,e[0]-o[0],o[1]-e[1]))),t}}(),ie=function(){var e=(0,h.a)(),t=(0,h.a)();return function(n,r,i,o,a,s,u){return V(t,s,u),(0,d.m)(e,a,t),o?re(n,r,i,o,e,s):te(n,r,i,e,s)}}(),oe=function(){var e=(0,f.c)();return function(t,n,r,i){return(0,d.t)(t,n,function(e,t,n,r){return W(e,t,n,r),(0,p.a)(e,e)}(e,r,i,1))}}(),ae=function(){var e=(0,f.c)();return function(t,n,r,i){return(0,d.t)(t,n,W(e,r,i,1))}}(),se=function(){var e=(0,h.a)(),t=(0,f.c)();return function(n,r,i){j(n,r);var o=N(r),a=n.targetGeometry;return(0,p.b)(t,z(r)),(0,p.s)(t,t,(0,h.f)(o,o)),(0,d.t)(e,i,t),a.x+=e[0],a.y+=e[1],n}}()},37593:function(e,t,n){"use strict";n.d(t,{a:function(){return f}});var r=n(15671),i=n(43144),o=n(75571);function a(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var u=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];(0,r.Z)(this,e),this.eventType=t,this.keyModifiers=n}return(0,i.Z)(e,[{key:"matches",value:function(e){if(e.type!==this.eventType)return!1;if(0===this.keyModifiers.length)return!0;var t,n=e.modifiers,r=a(this.keyModifiers);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(!n.has(i))return!1}}catch(o){r.e(o)}finally{r.f()}return!0}}]),e}();function l(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var p=o.Z.getLogger("esri.views.input.InputHandler"),f=function(){function e(t){(0,r.Z)(this,e),this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=t}return(0,i.Z)(e,[{key:"incomingEventMatches",get:function(){if(!this._incomingEventMatches)for(var e in this._incomingEventMatches=[],this._incoming){var t,n=l(this._incoming[e]);try{for(n.s();!(t=n.n()).done;){var r=t.value;this._incomingEventMatches.push(r.match)}}catch(i){n.e(i)}finally{n.f()}}return this._incomingEventMatches}},{key:"incomingEventTypes",get:function(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map((function(e){return e.eventType}))),this._incomingEventTypes}},{key:"outgoingEventTypes",get:function(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}},{key:"hasSideEffects",get:function(){return this._hasSideEffects}},{key:"hasPendingInputs",get:function(){return!1}},{key:"onInstall",value:function(e){var t=this;this._manager?p.error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback((function(e){return t._handleEvent(e)})),e.setUninstallCallback((function(){return t._onUninstall()})),this._manager=e)}},{key:"onUninstall",value:function(){}},{key:"registerIncoming",value:function(e,t,n){var r,i=this;"function"==typeof t?(n=t,r=[]):r=t||[];var o="string"==typeof e?new u(e,r):e,a=function(){i._incomingEventTypes=null,i._incomingEventMatches=null},s=function(e){var t=i._incoming[e.match.eventType];if(t){var n=t.indexOf(e);t.splice(n,1),a(),i._manager&&i._manager.updateDependencies()}},l=new d(o,n,{onPause:s,onRemove:s,onResume:function(e){var t=i._incoming[e.match.eventType];t&&-1===t.indexOf(e)&&(t.push(e),a(),i._manager&&i._manager.updateDependencies())}}),c=this._incoming[o.eventType];return c||(c=[],this._incoming[o.eventType]=c),c.push(l),a(),this._manager&&this._manager.updateDependencies(),l}},{key:"registerOutgoing",value:function(e){var t=this;if(this._outgoing[e])throw Error("There is already a callback registered for this outgoing InputEvent: "+e);var n=new h(e,{onEmit:function(e,n,r,i){t._manager.emit(e.eventType,n,r,i)},onRemove:function(e){delete t._outgoing[e.eventType],t._manager.updateDependencies()}});return this._outgoing[e]=n,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),n}},{key:"startCapturingPointer",value:function(e){this._manager.setPointerCapture(e,!0)}},{key:"stopCapturingPointer",value:function(e){this._manager.setPointerCapture(e,!1)}},{key:"refreshHasPendingInputs",value:function(){this._manager.refreshHasPendingInputs()}},{key:"_onUninstall",value:function(){this._manager?(this.onUninstall(),this._manager=null):p.error("This InputHandler is not registered with an InputManager")}},{key:"_handleEvent",value:function(e){var t=this._incoming[e.type];if(t){var n,r=l(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.match.matches(e)&&(i.callback(e),e.shouldStopPropagation()))break}}catch(o){r.e(o)}finally{r.f()}}}}]),e}(),d=function(){function e(t,n,i){(0,r.Z)(this,e),this.match=t,this._callback=n,this._handler=i}return(0,i.Z)(e,[{key:"pause",value:function(){this._handler.onPause(this)}},{key:"resume",value:function(){this._handler.onResume(this)}},{key:"remove",value:function(){this._handler.onRemove(this)}},{key:"callback",get:function(){return this._callback}}]),e}(),h=function(){function e(t,n){(0,r.Z)(this,e),this.eventType=t,this._removed=!1,this._handler=n}return(0,i.Z)(e,[{key:"emit",value:function(e,t,n){this._removed||this._handler.onEmit(this,e,t,n)}},{key:"remove",value:function(){this._removed=!0,this._handler.onRemove(this)}}]),e}()},94749:function(e,t,n){"use strict";n.d(t,{$:function(){return w},f:function(){return C}});var r=n(15671),i=n(43144),o=n(60136),a=n(6215),s=n(61120),u=n(83195),l=n(79417),c=n(75571),p=n(82035),f=n(89636),d=(n(43079),n(33682),n(64003),n(30732)),h=n(49871);function v(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,s.Z)(e);if(t){var i=(0,s.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,a.Z)(this,n)}}var y=function(e){(0,o.Z)(n,e);var t=v(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,!0))._onChange=e,i._value="mouse",i.registerIncoming("pointer-down",(function(e){var t="touch"===e.data.native.pointerType;i._setValue(t?"touch":"mouse")})),i._moveHandler=i.registerIncoming("pointer-move",(function(e){var t="touch"===e.data.native.pointerType;i._setValue(t?"touch":"mouse")})),i._moveHandler.pause(),i}return(0,i.Z)(n,[{key:"_setValue",value:function(e){e!==this._value&&("touch"===e?this._moveHandler.resume():this._moveHandler.pause(),this._value=e,this._onChange(e))}}]),n}(n(37593).a);function m(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return g(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function b(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,s.Z)(e);if(t){var i=(0,s.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,a.Z)(this,n)}}var _=c.Z.getLogger("esri.views.input.InputManager"),w=function(e){(0,o.Z)(n,e);var t=b(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e))._pointerCaptures=new Map,i._nameToGroup={},i._handlers=[],i._currentPropagation=null,i._updateDependenciesAfterPropagation=!1,i._sourceEvents=new Set,i._keyModifiers=new Set,i._activeKeyModifiers=new Set,i._stoppedPropagationEventIds=new Set,i.primaryKey=h.CK,i.latestPointerType="mouse",i.test={timestamp:void 0,hasCurrentPropagation:function(){return!!i._currentPropagation}},i}return(0,i.Z)(n,[{key:"initialize",value:function(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}},{key:"destroy",value:function(){for(var e=0,t=Object.keys(this._nameToGroup);e<t.length;e++){var n=t[e];this.uninstallHandlers(n)}this.eventSource=null,this._currentPropagation=null}},{key:"hasPendingInputs",get:function(){return this._handlers.some((function(e){return e.handler.hasPendingInputs}))}},{key:"installHandlers",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:C.INTERNAL;if(this._nameToGroup[e])_.error("There is already an InputHandler group registered under the name `"+e+"`");else if(0!==t.length){var i={name:e,handlers:t.map((function(e){return{handler:e,active:!0,removed:!1,priorityIndex:0,groupPriority:r,eventCallback:null,uninstallCallback:null}}))};this._nameToGroup[e]=i;for(var o=function(e){var t=i.handlers[e];n._handlers.push(t),t.handler.onInstall({updateDependencies:function(){n.updateDependencies()},emit:function(e,r,i,o,a){n._emitInputEvent(t.priorityIndex+1,e,r,i,a,o)},setPointerCapture:function(e,r){n._setPointerCapture(i,t,e,r)},setEventCallback:function(e){t.eventCallback=e},setUninstallCallback:function(e){t.uninstallCallback=e},refreshHasPendingInputs:function(){n.notifyChange("hasPendingInputs")}})},a=i.handlers.length-1;a>=0;a--)o(a);this.updateDependencies()}else _.error("Can't register a group of zero handlers")}},{key:"uninstallHandlers",value:function(e){var t=this._nameToGroup[e];t?(t.handlers.forEach((function(e){e.removed=!0,e.uninstallCallback()})),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):_.error("There is no InputHandler group registered under the name `"+e+"`")}},{key:"hasHandlers",value:function(e){return void 0!==this._nameToGroup[e]}},{key:"updateDependencies",value:function(){if(this._currentPropagation)this._updateDependenciesAfterPropagation=!0;else{this._updateDependenciesAfterPropagation=!1;var e=new Set,t=new Set;this._handlersPriority=[];for(var n=this._handlers.length-1;n>=0;n--){var r=this._handlers[n];r.priorityIndex=n,this._handlersPriority.push(r)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(var i=this._handlersPriority.length-1;i>=0;i--){var o=this._handlersPriority[i];o.priorityIndex=i;var a=o.handler.hasSideEffects;if(!a){var s,u=m(o.handler.outgoingEventTypes);try{for(u.s();!(s=u.n()).done;){var l=s.value;if(e.has(l)){a=!0;break}}}catch(g){u.e(g)}finally{u.f()}}if(a){var c,p=m(o.handler.incomingEventMatches);try{for(p.s();!(c=p.n()).done;){var f=c.value;e.add(f.eventType);var d,v=m(f.keyModifiers);try{for(v.s();!(d=v.n()).done;){var y=d.value;(0,h.wj)(y)||t.add(y)}}catch(g){v.e(g)}finally{v.f()}}}catch(g){p.e(g)}finally{p.f()}}o.active=a}this._sourceEvents=e,this._keyModifiers=t,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}}},{key:"_setLatestPointerType",value:function(e){this._set("latestPointerType",e)}},{key:"_onEventReceived",value:function(e,t){if("pointer-capture-lost"===e){var n=t;this._pointerCaptures.delete(n.native.pointerId)}this._updateKeyModifiers(e,t);var r=null!=this.test.timestamp?this.test.timestamp:t.native?t.native.timestamp:void 0,i=t.native?t.native.cancelable:void 0;this._emitInputEventFromSource(e,t,r,i)}},{key:"_updateKeyModifiers",value:function(e,t){var n=this;if(t){var r=!1,i=function(){if(!r){var e=new Set;n._activeKeyModifiers.forEach((function(t){e.add(t)})),n._activeKeyModifiers=e,r=!0}},o=function(e,t){t&&!n._activeKeyModifiers.has(e)?(i(),n._activeKeyModifiers.add(e)):!t&&n._activeKeyModifiers.has(e)&&(i(),n._activeKeyModifiers.delete(e))};if("key-down"===e||"key-up"===e){var a=t.key;this._keyModifiers.has(a)&&o(a,"key-down"===e)}var s=t.native;o("Alt",!(!s||!s.altKey)),o("Ctrl",!(!s||!s.ctrlKey)),o("Shift",!(!s||!s.shiftKey)),o("Meta",!(!s||!s.metaKey)),o("Primary",this._activeKeyModifiers.has(this.primaryKey))}}},{key:"_installRecognizers",value:function(){var e=this;this._latestPointerTypeHandler=new y((function(t){return e._setLatestPointerType(t)})),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,C.INTERNAL),this.installHandlers("input-manager-logic",[this._latestPointerTypeHandler],C.INTERNAL)}},{key:"_setPointerCapture",value:function(e,t,n,r){var i=e.name+"-"+t.priorityIndex,o=this._pointerCaptures.get(n.pointerId)||new Set;this._pointerCaptures.set(n.pointerId,o),r?(o.add(i),1===o.size&&this.eventSource&&this.eventSource.setPointerCapture(n,!0)):o.has(i)&&(o.delete(i),0===o.size&&(this._pointerCaptures.delete(n.pointerId),this.eventSource&&this.eventSource.setPointerCapture(n,!1)))}},{key:"_garbageCollectRemovedHandlers",value:function(){this._handlers=this._handlers.filter((function(e){return!e.removed})),this.updateDependencies()}},{key:"_emitInputEventFromSource",value:function(e,t,n,r){this._emitInputEvent(0,e,t,n,r)}},{key:"_emitInputEvent",value:function(e,t,n,r,i,o){var a=void 0!==r?r:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),s=void 0!==i&&i,u={event:new k(t,n,a,o||this._activeKeyModifiers,s),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(u):this._doNewPropagation(u)}},{key:"_doNewPropagation",value:function(e){this._currentPropagation={events:new p.Z,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}},{key:"_continuePropagation",value:function(){var e=this,t=this._currentPropagation;if(t){for(;this._currentPropagation.events.length>0;){var n=this._currentPropagation.events.pop(),r=n.event,i=n.priorityIndex,o=r.data&&r.data.eventId;if(null==o||!this._stoppedPropagationEventIds.has(o))for(t.currentHandler=this._handlersPriority[i];t.currentHandler;){if(t.currentHandler.removed)t.needsHandlerGarbageCollect=!0;else{if(t.currentHandler.active&&!r.shouldStopPropagation()&&t.currentHandler.eventCallback(r),r.shouldStopPropagation()){null!=o&&this._stoppedPropagationEventIds.add(o);break}if(r.shouldPausePropagation((function(){return e._continuePropagation()})))return void this._pausePropagation({event:r,priorityIndex:t.currentHandler.priorityIndex+1})}t.currentHandler=this._handlersPriority[t.currentHandler.priorityIndex+1]}}t.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}},{key:"_pausePropagation",value:function(e){var t=new p.Z;for(t.push(e);this._currentPropagation.events.length;)t.push(this._currentPropagation.events.pop());this._currentPropagation.events=t,this._currentPropagation.currentHandler=null}},{key:"_compareHandlerPriority",value:function(e,t){if(e.handler.hasSideEffects!==t.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==t.groupPriority)return e.groupPriority>t.groupPriority?-1:1;var n,r=m(e.handler.incomingEventMatches);try{for(r.s();!(n=r.n()).done;){var i,o=n.value,a=m(t.handler.incomingEventMatches);try{var s=function(){var e=i.value;if(o.eventType!==e.eventType)return"continue";var t=o.keyModifiers.filter((function(t){return-1!==e.keyModifiers.indexOf(t)}));return t.length===o.keyModifiers.length!=(t.length===e.keyModifiers.length)?{v:o.keyModifiers.length>e.keyModifiers.length?-1:1}:void 0};for(a.s();!(i=a.n()).done;){var u=s();if("continue"!==u&&"object"==typeof u)return u.v}}catch(l){a.e(l)}finally{a.f()}}}catch(l){r.e(l)}finally{r.f()}return e.priorityIndex>t.priorityIndex?-1:1}},{key:"_sortHandlersPriority",value:function(e){var t,n=[],r=m(e);try{for(r.s();!(t=r.n()).done;){for(var i=t.value,o=0;o<n.length&&this._compareHandlerPriority(i,n[o])>=0;)o++;n.splice(o,0,i)}}catch(a){r.e(a)}finally{r.f()}return n}},{key:"debug",get:function(){var e=this,t=function(t){var n=e._setPointerCapture;e._setPointerCapture=function(){},t(),e._setPointerCapture=n};return{injectEvent:function(n,r){t((function(){e._onEventReceived(n,r)}))},disablePointerCapture:t}}}]),n}(l.Z);(0,u._)([(0,f.Cb)({readOnly:!0})],w.prototype,"hasPendingInputs",null),(0,u._)([(0,f.Cb)()],w.prototype,"eventSource",void 0),(0,u._)([(0,f.Cb)()],w.prototype,"recognizers",void 0),(0,u._)([(0,f.Cb)({readOnly:!0})],w.prototype,"latestPointerType",void 0),w=(0,u._)([(0,d.j)("esri.views.input.InputManager")],w);var k=function(){function e(t,n,i,o,a){(0,r.Z)(this,e),this.type=t,this.data=n,this.timestamp=i,this.modifiers=o,this.cancelable=a,this._propagationState=0,this._resumeCallback=null}return(0,i.Z)(e,[{key:"stopPropagation",value:function(){this._propagationState|=1}},{key:"shouldStopPropagation",value:function(){return 0!=(1&this._propagationState)}},{key:"async",value:function(e){var t=this;this._propagationState|=2;var n=function(e,n){t._propagationState&=-3;var r=t._resumeCallback;if(t._resumeCallback=null,r&&r(),n)throw e;return e};return("function"==typeof e?e():e).then((function(e){return n(e,!1)}),(function(e){return n(e,!0)}))}},{key:"shouldPausePropagation",value:function(e){return!!(2&this._propagationState)&&(this._resumeCallback=e,!0)}},{key:"preventDefault",value:function(){this.data.native.preventDefault()}}]),e}(),C={DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3}},49871:function(e,t,n){"use strict";n.d(t,{kK:function(){return l},wj:function(){return c},CK:function(){return i}});for(var r=n(23178),i=(0,n(33682).Z)("mac")?"Meta":"Ctrl",o={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"},a=48;a<58;a++)o[a]=String.fromCharCode(a);for(var s=1;s<25;s++)o[111+s]="F".concat(s);for(var u=65;u<91;u++)o[u]=[String.fromCharCode(u+32),String.fromCharCode(u)];function l(e){if(void 0!==e.key)return(0,r.kK)(e);var t=o[e.keyCode];return Array.isArray(t)?e.shiftKey?t[1]:t[0]:t}function c(e){switch(e){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}},51223:function(e,t,n){var r=n(5112),i=n(70030),o=n(3070),a=r("unscopables"),s=Array.prototype;null==s[a]&&o.f(s,a,{configurable:!0,value:i(null)}),e.exports=function(e){s[a][e]=!0}},77475:function(e,t,n){var r=n(17854),i=n(43157),o=n(4411),a=n(70111),s=n(5112)("species"),u=r.Array;e.exports=function(e){var t;return i(e)&&(t=e.constructor,(o(t)&&(t===u||i(t.prototype))||a(t)&&null===(t=t[s]))&&(t=void 0)),void 0===t?u:t}},65417:function(e,t,n){var r=n(77475);e.exports=function(e,t){return new(r(e))(0===t?0:t)}},6790:function(e,t,n){"use strict";var r=n(17854),i=n(43157),o=n(26244),a=n(49974),s=r.TypeError,u=function(e,t,n,r,l,c,p,f){for(var d,h,v=l,y=0,m=!!p&&a(p,f);y<r;){if(y in n){if(d=m?m(n[y],y,t):n[y],c>0&&i(d))h=o(d),v=u(e,t,d,h,v,c-1)-1;else{if(v>=9007199254740991)throw s("Exceed the acceptable array length");e[v]=d}v++}y++}return v};e.exports=u},49974:function(e,t,n){var r=n(1702),i=n(19662),o=n(34374),a=r(r.bind);e.exports=function(e,t){return i(e),void 0===t?e:o?a(e,t):function(){return e.apply(t,arguments)}}},60490:function(e,t,n){var r=n(35005);e.exports=r("document","documentElement")},43157:function(e,t,n){var r=n(84326);e.exports=Array.isArray||function(e){return"Array"==r(e)}},70030:function(e,t,n){var r,i=n(19670),o=n(36048),a=n(80748),s=n(3501),u=n(60490),l=n(80317),c=n(6200),p=c("IE_PROTO"),f=function(){},d=function(e){return"<script>"+e+"</"+"script>"},h=function(e){e.write(d("")),e.close();var t=e.parentWindow.Object;return e=null,t},v=function(){try{r=new ActiveXObject("htmlfile")}catch(i){}var e,t;v="undefined"!=typeof document?document.domain&&r?h(r):((t=l("iframe")).style.display="none",u.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(d("document.F=Object")),e.close(),e.F):h(r);for(var n=a.length;n--;)delete v.prototype[a[n]];return v()};s[p]=!0,e.exports=Object.create||function(e,t){var n;return null!==e?(f.prototype=i(e),n=new f,f.prototype=null,n[p]=e):n=v(),void 0===t?n:o.f(n,t)}},36048:function(e,t,n){var r=n(19781),i=n(3353),o=n(3070),a=n(19670),s=n(45656),u=n(81956);t.f=r&&!i?Object.defineProperties:function(e,t){a(e);for(var n,r=s(t),i=u(t),l=i.length,c=0;l>c;)o.f(e,n=i[c++],r[n]);return e}},81956:function(e,t,n){var r=n(16324),i=n(80748);e.exports=Object.keys||function(e){return r(e,i)}},84944:function(e,t,n){"use strict";var r=n(82109),i=n(6790),o=n(47908),a=n(26244),s=n(19303),u=n(65417);r({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,t=o(this),n=a(t),r=u(t,0);return r.length=i(r,t,t,n,0,void 0===e?1:s(e)),r}})},33792:function(e,t,n){n(51223)("flat")},90952:function(e,t,n){"use strict";n.r(t),n.d(t,{SideBarContext:function(){return cb},UNFOCUS:function(){return ub},UPDATE_FOCUSSED_BUILDING:function(){return sb},default:function(){return fb}});var r=n(67294),i="SideBar-module--title--3co0c",o="SideBar-module--spanBoth--OMyLF";function a(e){var t=e.text,n=e.onClick,i=void 0===n?function(){}:n;return r.createElement("button",{className:"Button-module--btn--+vNfy",onClick:i},t)}var s=n(25444),u=n(56100),l=n(67124),c=n(98049),p=function(e){var t=new l.default({url:"https://services.arcgis.com/VXxCfMpXUKuFKFvE/arcgis/rest/services/Originis/FeatureServer"});return(0,c.Z)(t,e||t.createQuery())},f=function(e){var t=e.title,n=e.data,i=e.spanBoth,a=void 0!==i&&i;return r.createElement("div",{className:"SideBar-module--dataPoint--PBwrk "+(a&&o)},r.createElement("p",null,t),n)},d=function(e){var t=e.buildingData||{},n=t.YEARBUILT,l=(t.SHORTNAME,t.LONGNAME),c=t.MANUALGROS,d=t.BUILDINGID,h=0,v=p(function(){var e=new u.Z;return e.outFields=["wathtot","Time"],e.where="BUILDINGID = '"+d+"' AND time >= CURRENT_TIMESTAMP - INTERVAL '72' HOUR AND time <= CURRENT_TIMESTAMP - INTERVAL '48' HOUR",e}());console.log(v),v&&v.map((function(e){h=e.wathtot/1e3}));var y=0,m=p(function(){var e=new u.Z;return e.outFields=["wathtot","Time"],e.where="BUILDINGID = '"+d+"' AND time >= CURRENT_TIMESTAMP - INTERVAL '48' HOUR AND time <= CURRENT_TIMESTAMP - INTERVAL '24' HOUR",e}());console.log(m),m&&m.map((function(e){y=365*(e.wathtot/1e3-h)}));var g=y/365,b=3.41214*y/c;return r.createElement(r.Fragment,null,r.createElement("h2",{className:i},l),r.createElement(f,{title:"Energy Use Intensity",data:b.toLocaleString()+" kBtu/ft²"}),r.createElement(f,{title:"Average Energy Usage",data:g.toLocaleString()+" kWh/day"}),r.createElement(f,{title:"Year Built",data:n}),r.createElement(f,{title:"Square Footage",data:c+" ft²"}),r.createElement(f,{spanBoth:!0,title:"Annual Usage",data:y.toLocaleString()+" kWh/year"}),r.createElement("div",{className:o},r.createElement(s.Link,{to:"/details/"+d},r.createElement(a,{text:"View Details"}))))},h=n(93433),v={academic:"VL_AC_energy_8471",admin:"VL_AD_energy_6679",as:"VL_AS_energy_2724",fraternity:"VL_FR_energy_2520",residential:"VL_RH_energy_9371",sorority:"VL_SO_Energy_2020"},y="Filters-module--btn--vAw7Q",m=function(e){var t=e.text,n=e.active,i=e.onClick;return r.createElement("button",{className:y+" "+(n?"Filters-module--btnActive--0ajJp":"Filters-module--btnInactive--K1L+N"),onClick:i},t)},g=function(){var e=(0,r.useContext)(cb),t=e.state,n=e.dispatch,i=(0,r.useState)(t.filters),o=i[0],a=i[1];return(0,r.useEffect)((function(){n({type:"UPDATE_FILTERS",payload:{filters:o}})}),[o]),r.createElement(r.Fragment,null,Object.keys(v).map((function(e){return r.createElement(m,{text:e,active:o.includes(v[e]),onClick:function(){return a(o.includes(v[e])?(0,h.Z)(o).filter((function(t){return t!=v[e]})):[].concat((0,h.Z)(o),[v[e]]))}})})),r.createElement("button",{className:y+" Filters-module--btnClear--9Evp8",onClick:function(){return a([])}},"Clear Filters"))},b=function(){return r.createElement("div",{className:o},r.createElement("h2",{className:i},"Energy Dashboard"),r.createElement(g,null))},_=function(){var e=(0,r.useContext)(cb).state.buildingData;return r.createElement("div",{className:"SideBar-module--sidebar--hfsnT"},null!=e&&0!=Object.keys(e).length?r.createElement(d,{buildingData:e}):r.createElement(b,null))},w=n(29439),k=n(15671),C=n(43144),x=n(97326),Z=n(11752),M=n(60136),I=n(6215),R=n(61120),O=n(15861),P=n(87757),T=n.n(P),S=(n(84944),n(33792),n(83195)),E=n(9340),A=n(20410),j=n(59823),F=n(33300),L=n(33682),D=n(54860),V=n(75571),B=n(10173),N=n(83241),z=n(16602),U=n(89636),W=n(43079),q=n(64003),G=n(30732),H=n(4942),K=n(61744),Y=n(74881);function J(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function $(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Q={widthBreakpoint:{getValue:function(e){var t=e.viewSize[0],n=e.breakpoints,r=this.values;return t<=n.xsmall?r.xsmall:t<=n.small?r.small:t<=n.medium?r.medium:t<=n.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue:function(e){var t=e.viewSize[1],n=e.breakpoints,r=this.values;return t<=n.xsmall?r.xsmall:t<=n.small?r.small:t<=n.medium?r.medium:t<=n.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue:function(e){var t=e.viewSize,n=t[0],r=t[1],i=this.values;return r>=n?i.portrait:i.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},X={xsmall:544,small:768,medium:992,large:1200};function ee(e,t){return t?Q[e].valueToClassName[t].split(" "):[]}var te=n(76791),ne=n(94029),re=n(79417),ie=(n(61864),n(62226)),oe=n(84669);function ae(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return se(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return se(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function se(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ue(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var le=function(e){(0,M.Z)(n,e);var t=ue(n);function n(){var e;return(0,k.Z)(this,n),(e=t.apply(this,arguments)).items=new A.Z,e._watchUpdatingTracking=new oe.t,e._callbacks=new Map,e._projector=(0,ie.E)(),e._hiddenProjector=(0,ie.E)(),e}return(0,C.Z)(n,[{key:"needsRender",get:function(){return this.items.length>0}},{key:"initialize",value:function(){var e=this,t=document.createElement("div");t.className="esri-overlay-surface",this._set("surface",t),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),t.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(this.items,(function(t){var n,r=ae(t.added);try{var i=function(){var t=n.value,r=function(){return t.render()};e._callbacks.set(t,r),e._projector.append(e.surface,r)};for(r.s();!(n=r.n()).done;)i()}catch(l){r.e(l)}finally{r.f()}var o,a=ae(t.removed);try{for(a.s();!(o=a.n()).done;){var s=o.value,u=e._projector.detach(e._callbacks.get(s));e.surface.removeChild(u.domNode),e._callbacks.delete(s)}}catch(l){a.e(l)}finally{a.f()}}))}},{key:"addItem",value:function(e){this.items.add(e)}},{key:"removeItem",value:function(e){this.items.remove(e)}},{key:"destroy",value:function(){var e=this;this.items.removeAll(),this._callbacks.forEach((function(t){return e._projector.detach(t)})),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}},{key:"render",value:function(){this._projector.renderNow()}},{key:"computeBoundingRect",value:function(e){var t=this._hiddenSurface,n=this._hiddenProjector,r=null,i=function(){return r=e.render()};n.append(t,i),n.renderNow();var o={left:0,top:0,right:0,bottom:0};if(r&&r.domNode){var a=r.domNode.getBoundingClientRect();o.left=a.left,o.top=a.top,o.right=a.right,o.bottom=a.bottom}for(n.detach(i);t.firstChild;)t.removeChild(t.firstChild);return o}},{key:"overlaps",value:function(e,t){var n=this.computeBoundingRect(e),r=this.computeBoundingRect(t);return Math.max(n.left,r.left)<=Math.min(n.right,r.right)&&Math.max(n.top,r.top)<=Math.min(n.bottom,r.bottom)}},{key:"hasVisibleItems",get:function(){return this.items.some((function(e){return e.visible}))}},{key:"renderCanvas",value:function(e){if(this.items.some((function(e){return e.visible}))){var t=e.getContext("2d");t.save(),t.font="10px ".concat(getComputedStyle(this.surface).fontFamily),this.items.forEach((function(e){t.save(),e.renderCanvas(t),t.restore()})),t.restore()}}}]),n}(re.Z);(0,S._)([(0,U.Cb)({readOnly:!0})],le.prototype,"surface",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],le.prototype,"items",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],le.prototype,"needsRender",null),(0,S._)([(0,U.Cb)({readOnly:!0})],le.prototype,"_watchUpdatingTracking",void 0),(0,S._)([(0,U.Cb)({readOnly:!0,aliasOf:"_watchUpdatingTracking.updating"})],le.prototype,"updating",void 0);var ce=le=(0,S._)([(0,G.j)("esri.views.overlay.ViewOverlay")],le),pe=(n(20784),n(23178)),fe=n(42013),de=n(18965),he=n(36049),ve=n(24205),ye=n(56489),me=n(53315),ge=(n(64026),n(56913));var be=["B","kB","MB","GB","TB"];var _e=n(80896),we=n(14771),ke=n(56487),Ce=n(87911),xe=n(43749),Ze=n(40005),Me=n(18767);function Ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Re(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ie(Object(n),!0).forEach((function(t){(0,H.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ie(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Oe=V.Z.getLogger("esri.widgets.Feature.support.featureUtils"),Pe=/href=(""|'')/gi,Te=/(\{([^\{\r\n]+)\})/g,Se=/\'/g,Ee=/^\s*expression\//i,Ae=/(\n)/gi,je=/[\u00A0-\u9999<>\&]/gim,Fe=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,Le=/^(?:mailto:|tel:)/,De="relationships/",Ve=(0,Ce.Ze)("short-date-short-time");function Be(e){if(!(0,B.Wi)(e))return e.get("sourceLayer")||e.get("layer")}function Ne(e,t){return ze.apply(this,arguments)}function ze(){return(ze=(0,O.Z)(T().mark((function e(t,n){return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return","function"==typeof t?t.call(null,n):t);case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ue(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(e)return!Le.test(e.trim().toLowerCase())}function We(e){return!!e&&Ee.test(e)}function qe(e,t){var n=function(e,t){if(!We(t)||!e)return null;var n,r=t.replace(Ee,"").toLowerCase();return e.some((function(e){return e.name.toLowerCase()===r&&(n=e,!0)})),n}(t,null==e?void 0:e.fieldName);return n?n.title||null:e?e.label||e.fieldName:null}function Ge(e,t){var n=He(t,e);return n?n.name:e}function He(e,t){return e&&"function"==typeof e.getField?e.getField(t):null}function Ke(e){return"".concat(e).trim()}function Ye(e){var t=e.attributes,n=e.globalAttributes,r=e.layer,i=e.text,o=e.expressionAttributes,a=e.fieldInfoMap;return i?Je({formattedAttributes:n,template:et(i,Re(Re(Re({},n),o),t),r),fieldInfoMap:a}):""}function Je(e){var t=e.formattedAttributes,n=e.template,r=e.fieldInfoMap;return Ke(function(e){return e.replace(Pe,"")}((0,me.gx)((0,me.gx)(n,(function(e){return function(e,t){var n=t.get(e.toLowerCase());return"{".concat(n&&n.fieldName||e,"}")}(e,r)})),t)))}function $e(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=t[e];if("string"==typeof r){var i="%27",o=(n?encodeURIComponent(r):r).replace(Se,i);t[e]=o}}function Qe(e,t,n){var r=(t=Ke(t))&&"{"!==t[0];return(0,me.gx)(e,function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Re({},e);return Object.keys(n).forEach((function(e){return $e(e,n,t)})),n}(n,r))}function Xe(e,t){return e.replace(Te,(function(e,n,r){var i=He(t,r);return i?"{".concat(i.name,"}"):n}))}function et(e,t,n){var r=Xe(e,n);return r?r.replace(Fe,(function(e,n,r){return Qe(e,n||r,t)})):r}function tt(e,t){var n=t.fieldInfos,r=t.fieldName,i=nt(n,r),o=null==i?void 0:i.clone(),a=t.preventPlacesFormatting,s=t.layer,u=He(s,r);if(o&&"date"===(null==u?void 0:u.type)){var l=o.format||new Ze.Z;l.dateFormat=l.dateFormat||"short-date-short-time",l.dateTimeFormatOptions=function(e){return"feature"===(null==e?void 0:e.type)}(s)&&s.datesInUnknownTimezone||function(e){return!(null==e||!e.layer)}(s)&&function(e){return"map-image"===(null==e?void 0:e.type)}(s.layer)&&s.layer.datesInUnknownTimezone?{timeZone:"UTC"}:null,o.format=l}var c=o&&o.format;return"string"==typeof(e=function(e,t){if("string"==typeof e&&t&&null==t.dateFormat&&(null!=t.places||null!=t.digitSeparator)){var n=Number(e);if(!isNaN(n))return n}return e}(e,c))||null==e||null==c?at(e):a?(0,ge.uf)(e,Re(Re({},(0,ge.sh)(c)),{},{minimumFractionDigits:0,maximumFractionDigits:20})):c.format(e)}function nt(e,t){if(e&&e.length&&t){var n,r=t.toLowerCase();return e.some((function(e){return!(!e.fieldName||e.fieldName.toLowerCase()!==r||(n=e,0))})),n}}function rt(e,t){var n=e.creatorField,r=e.creationDateField,i=e.editorField,o=e.editDateField;if(t){var a=t[o];if("number"==typeof a){var s=t[i];return{type:"edit",date:(0,Ce.p6)(a,Ve),user:s}}var u=t[r];if("number"==typeof u){var l=t[n];return{type:"create",date:(0,Ce.p6)(u,Ve),user:l}}return null}}function it(e){var t=[];if(!e)return t;var n=e.fieldInfos,r=e.content;return n&&t.push.apply(t,(0,h.Z)(n)),r&&Array.isArray(r)?(r.forEach((function(e){if("fields"===e.type){var n=e&&e.fieldInfos;n&&t.push.apply(t,(0,h.Z)(n))}})),t):t}function ot(e){return e.replace(je,(function(e){return"&#".concat(e.charCodeAt(0),";")}))}function at(e){return"string"==typeof e?e.replace(Ae,'<br class="esri-text-new-line" />'):e}function st(e){var t=e.value,n=e.fieldName,r=e.fieldInfos,i=e.fieldInfoMap,o=e.layer,a=e.graphic;if(null==t)return"";var s=function(e){var t=e.fieldName,n=e.value,r=e.graphic,i=e.layer;if(vt(t))return null;if(!i||"function"!=typeof i.getFieldDomain)return null;var o=i.getFieldDomain(t,{feature:r});return o&&"coded-value"===o.type?o.getName(n):null}({fieldName:n,value:t,graphic:a,layer:o});if(s)return s;var u=function(e){var t=e.fieldName,n=e.graphic,r=e.layer;if(vt(t))return null;if(!r||"function"!=typeof r.getFeatureType)return null;var i=r.typeIdField;if(!i||t!==i)return null;var o=r.getFeatureType(n);return o?o.name:null}({fieldName:n,graphic:a,layer:o});if(u)return u;if(i.get(n.toLowerCase()))return tt(t,{fieldInfos:r,fieldName:n,layer:o});var l=o&&o.fieldsIndex;return l&&l.isDateField(n)?(0,Ce.p6)(t,Ve):at(t)}function ut(e){var t=e.fieldInfos,n=e.attributes,r=e.layer,i=e.graphic,o=e.fieldInfoMap,a=e.relatedInfos,s={};return null==a||a.forEach((function(e){return function(e,t){e&&t&&(t.relatedFeatures&&t.relatedFeatures&&t.relatedFeatures.forEach((function(n){return yt({attributes:e,graphic:n,relatedInfo:t})})),t.relatedStatsFeatures&&t.relatedStatsFeatures&&t.relatedStatsFeatures.forEach((function(n){return yt({attributes:e,graphic:n,relatedInfo:t})})))}(s,e)})),Object.keys(n).forEach((function(e){var a=n[e];s[e]=st({fieldName:e,fieldInfos:t,fieldInfoMap:o,layer:r,value:a,graphic:i})})),s}function lt(e,t){return ct.apply(this,arguments)}function ct(){return ct=(0,O.Z)(T().mark((function e(t,n){var r,i,o,a,s,u,l,c,p,f,d,h;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t.layer,a=t.graphic,s=t.outFields,u=t.objectIds,l=t.returnGeometry,c=t.spatialReference,"number"==typeof(p=u[0])||"string"==typeof p){e.next=4;break}return"Could not query required fields for the specified feature. The feature's ID is invalid.",f={layer:o,graphic:a,objectId:p,requiredFields:s},e.abrupt("return",(Oe.warn("Could not query required fields for the specified feature. The feature's ID is invalid.",f),null));case 4:if(null!=(r=o.capabilities)&&null!=(i=r.operations)&&i.supportsQuery){e.next=7;break}return"The specified layer cannot be queried. The following fields will not be available.",d={layer:o,graphic:a,requiredFields:s,returnGeometry:l},e.abrupt("return",(Oe.warn("The specified layer cannot be queried. The following fields will not be available.",d),null));case 7:return(h=o.createQuery()).objectIds=u,h.outFields=null!=s&&s.length?s:[o.objectIdField],h.returnGeometry=!!l,h.returnZ=!!l,h.returnM=!!l,h.outSpatialReference=c,e.next=11,o.queryFeatures(h,n);case 11:return e.abrupt("return",e.sent.features[0]);case 12:case"end":return e.stop()}}),e)}))),ct.apply(this,arguments)}function pt(e){return ft.apply(this,arguments)}function ft(){return(ft=(0,O.Z)(T().mark((function e(t){var n,r,i;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(n=t.expressionInfos)&&n.length){e.next=2;break}return e.abrupt("return",!1);case 2:return e.next=4,(0,Me.LC)();case 4:return r=e.sent,i=r.arcadeUtils.hasGeometryFunctions,e.abrupt("return",i(t));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function dt(e,t){return ht.apply(this,arguments)}function ht(){return ht=(0,O.Z)(T().mark((function e(t,n){var r,i,o,a,s,u,l,c,p,f,d;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.graphic,i=t.popupTemplate,o=t.layer,a=t.spatialReference,o&&i){e.next=3;break}return e.abrupt("return");case 3:if(e.t0="function"==typeof o.load,!e.t0){e.next=7;break}return e.next=7,o.load(n);case 7:if(r.attributes){e.next=9;break}return e.abrupt("return");case 9:if(null!=(s=r.attributes[o.objectIdField])){e.next=12;break}return e.abrupt("return");case 12:return u=[s],e.next=15,i.getRequiredFields(o.fieldsIndex);case 15:if(l=e.sent,c=(0,xe.R9)(l,r),p=c?[]:l,e.t1=i.returnGeometry,e.t1){e.next=23;break}return e.next=22,pt(i);case 22:e.t1=e.sent;case 23:if(f=e.t1,!c||f){e.next=26;break}return e.abrupt("return");case 26:return e.next=28,lt({layer:o,graphic:r,outFields:p,objectIds:u,returnGeometry:f,spatialReference:a},n);case 28:(d=e.sent)&&(d.geometry&&(r.geometry=d.geometry),d.attributes&&(r.attributes=Re(Re({},r.attributes),d.attributes)));case 30:case"end":return e.stop()}}),e)}))),ht.apply(this,arguments)}function vt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return!!e&&-1!==e.indexOf(De)}function yt(e){var t=e.attributes,n=e.graphic,r=e.relatedInfo;t&&n&&r&&Object.keys(n.attributes).forEach((function(e){var i=function(e){return e?"".concat(De).concat(e.layerId,"/").concat(e.fieldName):""}({layerId:r.relation.id.toString(),fieldName:e});t[i]=n.attributes[e]}))}var mt=function(e){if(!e)return!1;var t=e.toUpperCase();return t.indexOf("CURRENT_TIMESTAMP")>-1||t.indexOf("CURRENT_DATE")>-1||t.indexOf("CURRENT_TIME")>-1},gt=function(e){var t,n,r=e.layer,i=e.method,o=e.query,a=e.definitionExpression;if(null!=(t=r.capabilities)&&null!=(n=t.query)&&n.supportsCacheHint&&"attachments"!==i){var s=(0,B.pC)(o.where)&&o.where,u=(0,B.pC)(o.geometry)&&o.geometry;mt(a)||mt(s)||"extent"===(null==u?void 0:u.type)||"tile"===o.resultType||(o.cacheHint=!0)}};function bt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _t(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bt(Object(n),!0).forEach((function(t){(0,H.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function wt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var kt={editing:!1,operations:{add:!0,update:!0,delete:!0}},Ct=A.Z.ofType(we.Z),xt=function(e){(0,M.Z)(s,e);var t,n,r,i,o,a=wt(s);function s(e){var t;return(0,k.Z)(this,s),(t=a.call(this,e))._getAttachmentsPromise=null,t._attachmentLayer=null,t.abilities=_t({},kt),t.activeAttachmentInfo=null,t.attachmentInfos=new Ct,t.graphic=null,t.mode="view",t.handles.add([(0,N.S1)((0,x.Z)(t),"graphic",(function(){return t._graphicChanged()}))]),t}return(0,C.Z)(s,[{key:"destroy",value:function(){this._attachmentLayer=null,this.graphic=null}},{key:"castAbilities",value:function(e){return _t(_t({},kt),e)}},{key:"state",get:function(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}},{key:"supportsResizeAttachments",get:function(){return this.get("graphic.layer.capabilities.operations.supportsResizeAttachments")||!1}},{key:"getAttachments",value:(o=(0,O.Z)(T().mark((function e(){var t,n,r,i,o,a,s;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._attachmentLayer,n=this.attachmentInfos,t&&"function"==typeof t.queryAttachments){e.next=3;break}throw new F.Z("invalid-layer","getAttachments(): A valid layer is required.");case 3:return r=this._getFeatureId(),i=new ke.Z({objectIds:[r],returnMetadata:!0}),o=[],a=t.queryAttachments(i).then((function(e){return e[r]||o})).catch((function(){return o})),this._getAttachmentsPromise=a,this.notifyChange("state"),e.next=7,a;case 7:return s=e.sent,e.abrupt("return",(n.removeAll(),s.length&&n.addMany(s),this._getAttachmentsPromise=null,this.notifyChange("state"),s));case 9:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"addAttachment",value:(i=(0,O.Z)(T().mark((function e(t){var n,r,i,o,a,s,u=this;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this._attachmentLayer,r=this.attachmentInfos,i=this.graphic,o=this.abilities,t){e.next=3;break}throw new F.Z("invalid-attachment","addAttachment(): An attachment is required.",{attachment:t});case 3:if(o.operations.add){e.next=5;break}throw new F.Z("invalid-abilities","addAttachment(): add abilities are required.");case 5:if(n&&"function"==typeof n.addAttachment){e.next=7;break}throw new F.Z("invalid-layer","addAttachment(): A valid layer is required.");case 7:return a=n.addAttachment(i,t).then((function(e){return u._queryAttachment(e.objectId)})),e.next=10,a;case 10:return s=e.sent,e.abrupt("return",(r.add(s),s));case 12:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"deleteAttachment",value:(r=(0,O.Z)(T().mark((function e(t){var n,r,i,o,a,s;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this._attachmentLayer,r=this.attachmentInfos,i=this.graphic,o=this.abilities,t){e.next=3;break}throw new F.Z("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:t});case 3:if(o.operations.delete){e.next=5;break}throw new F.Z("invalid-abilities","deleteAttachment(): delete abilities are required.");case 5:if(n&&"function"==typeof n.deleteAttachments){e.next=7;break}throw new F.Z("invalid-layer","deleteAttachment(): A valid layer is required.");case 7:return a=n.deleteAttachments(i,[t.id]).then((function(){return t})),e.next=10,a;case 10:return s=e.sent,e.abrupt("return",(r.remove(s),s));case 12:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"updateAttachment",value:(n=(0,O.Z)(T().mark((function e(t){var n,r,i,o,a,s,u,l,c=this,p=arguments;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=p.length>1&&void 0!==p[1]?p[1]:this.activeAttachmentInfo,r=this._attachmentLayer,i=this.attachmentInfos,o=this.graphic,a=this.abilities,t){e.next=4;break}throw new F.Z("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:t});case 4:if(n){e.next=6;break}throw new F.Z("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:n});case 6:if(a.operations.update){e.next=8;break}throw new F.Z("invalid-abilities","updateAttachment(): Update abilities are required.");case 8:if(s=i.findIndex((function(e){return e===n})),r&&"function"==typeof r.updateAttachment){e.next=11;break}throw new F.Z("invalid-layer","updateAttachment(): A valid layer is required.");case 11:return u=r.updateAttachment(o,n.id,t).then((function(e){return c._queryAttachment(e.objectId)})),e.next=14,u;case 14:return l=e.sent,e.abrupt("return",(i.splice(s,1,l),l));case 16:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"_queryAttachment",value:(t=(0,O.Z)(T().mark((function e(t){var n,r,i;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new F.Z("invalid-attachment-id","Could not query attachment.");case 2:return n=this._attachmentLayer,r=this._getFeatureId(),i=new ke.Z({objectIds:[r],attachmentsWhere:"AttachmentId=".concat(t),returnMetadata:!0}),e.abrupt("return",n.queryAttachments(i).then((function(e){return e[r][0]})));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_getFeatureId",value:function(){var e=this._attachmentLayer,t=this.graphic;if(!e||!t)return null;var n=e.objectIdField,r=t.attributes;return r&&r[n]}},{key:"_graphicChanged",value:function(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch((function(){})))}},{key:"_setAttachmentLayer",value:function(){var e=Be(this.graphic);this._attachmentLayer=e?"scene"===e.type&&(0,B.pC)(e.associatedLayer)?e.associatedLayer:e:null}}]),s}(_e.r);(0,S._)([(0,U.Cb)()],xt.prototype,"abilities",void 0),(0,S._)([(0,he.p)("abilities")],xt.prototype,"castAbilities",null),(0,S._)([(0,U.Cb)()],xt.prototype,"activeAttachmentInfo",void 0),(0,S._)([(0,U.Cb)({readOnly:!0,type:Ct})],xt.prototype,"attachmentInfos",void 0),(0,S._)([(0,U.Cb)({type:E.Z})],xt.prototype,"graphic",void 0),(0,S._)([(0,U.Cb)()],xt.prototype,"mode",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],xt.prototype,"state",null),(0,S._)([(0,U.Cb)({readOnly:!0})],xt.prototype,"supportsResizeAttachments",null);var Zt=xt=(0,S._)([(0,G.j)("esri.widgets.Attachments.AttachmentsViewModel")],xt),Mt=n(31483);var It=n(11173),Rt=n(59444),Ot=n(78886);function Pt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Tt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Pt(Object(n),!0).forEach((function(t){(0,H.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function St(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Et={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},At="esri-attachments",jt="esri-attachments__loader-container",Ft="esri-attachments__loader",Lt="esri-attachments__container",Dt="esri-attachments__container--list",Vt="esri-attachments__container--preview",Bt="esri-attachments__actions",Nt="esri-attachments__delete-button",zt="esri-attachments__add-attachment-button",Ut="esri-attachments__error-message",Wt="esri-attachments__items",qt="esri-attachments__item",Gt="esri-attachments__item-button",Ht="esri-attachments__item-mask",Kt="esri-attachments__item-mask--icon",Yt="esri-attachments__image",Jt="esri-attachments__image--resizable",$t="esri-attachments__label",Qt="esri-attachments__filename",Xt="esri-attachments__item-chevron-icon",en="esri-attachments__item-link",tn="esri-attachments__item-link-overlay",nn="esri-attachments__item-link-overlay-icon",rn="esri-attachments__item-add-icon",on="esri-attachments__form-node",an="esri-attachments__file-fieldset",sn="esri-attachments__file-label",un="esri-attachments__file-name",ln="esri-attachments__file-input",cn="esri-attachments__metadata",pn="esri-attachments__metadata-fieldset",fn="esri-attachments__progress-bar",dn="esri-widget",hn="esri-button",vn="esri-button--disabled",yn="esri-button--secondary",mn="esri-button--tertiary",gn="esri-button--third",bn="esri-button--small",_n="esri-button--half",wn="esri-widget__content--empty",kn="esri-icon-right",Cn="esri-icon-left",xn="esri-icon-plus",Zn=window.CSS,Mn=function(e){(0,M.Z)(n,e);var t=St(n);function n(e,r){var i;return(0,k.Z)(this,n),(i=t.call(this,e,r)).abilities=null,i.displayType="auto",i.graphic=null,i.label=void 0,i.messages=null,i.messagesUnits=null,i.selectedFile=null,i.submitting=!1,i.viewModel=new Zt,i.visibleElements=Tt({},Et),i._supportsImageOrientation=Zn&&Zn.supports&&Zn.supports("image-orientation","from-image"),i._addAttachmentForm=null,i._updateAttachmentForm=null,i}return(0,C.Z)(n,[{key:"initialize",value:function(){var e=this;this.own((0,N.on)(this,"viewModel.attachmentInfos","change",(function(){return e.scheduleRender()})),(0,N.S1)(this,"viewModel.mode",(function(){return e._modeChanged()})))}},{key:"effectiveDisplayType",get:function(){return"auto"===this.displayType?this.viewModel.supportsResizeAttachments?"preview":"list":this.displayType}},{key:"castVisibleElements",value:function(e){return Tt(Tt({},Et),e)}},{key:"addAttachment",value:function(){var e=this,t=this._addAttachmentForm,n=this.viewModel;return this._set("submitting",!0),this._set("error",null),n.addAttachment(t).then((function(t){return e._set("submitting",!1),e._set("error",null),n.mode="view",t})).catch((function(t){throw e._set("submitting",!1),e._set("error",new F.Z("attachments:add-attachment",e.messages.addErrorMessage,t)),t}))}},{key:"deleteAttachment",value:function(e){var t=this,n=this.viewModel;return this._set("submitting",!0),this._set("error",null),n.deleteAttachment(e).then((function(e){return t._set("submitting",!1),t._set("error",null),n.mode="view",e})).catch((function(e){throw t._set("submitting",!1),t._set("error",new F.Z("attachments:delete-attachment",t.messages.deleteErrorMessage,e)),e}))}},{key:"updateAttachment",value:function(){var e=this,t=this.viewModel,n=this._updateAttachmentForm;return this._set("submitting",!0),this._set("error",null),t.updateAttachment(n).then((function(n){return e._set("submitting",!1),e._set("error",null),t.mode="view",n})).catch((function(t){throw e._set("submitting",!1),e._set("error",new F.Z("attachments:update-attachment",e.messages.updateErrorMessage,t)),t}))}},{key:"render",value:function(){var e=this.submitting,t=this.viewModel.state;return(0,Ot.u)("div",{class:this.classes(At,dn)},e?this.renderProgressBar():null,"loading"===t?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())}},{key:"renderErrorMessage",value:function(){var e=this.error,t=this.visibleElements;return e&&t.errorMessage?(0,Ot.u)("div",{key:"error-message",class:Ut},e.message):null}},{key:"renderAttachments",value:function(){var e=this.viewModel,t=e.mode,n=e.activeAttachmentInfo;return"add"===t?this.renderAddForm():"edit"===t?this.renderDetailsForm(n):this.renderAttachmentContainer()}},{key:"renderLoading",value:function(){return(0,Ot.u)("div",{class:jt,key:"loader"},(0,Ot.u)("div",{class:Ft}))}},{key:"renderProgressBar",value:function(){return this.visibleElements.progressBar?(0,Ot.u)("div",{class:fn,key:"progress-bar"}):null}},{key:"renderAddForm",value:function(){var e=this.submitting,t=this.selectedFile,n=e||!t,r=this.visibleElements.cancelAddButton?(0,Ot.u)("button",{type:"button",bind:this,disabled:e,onclick:this._cancelForm,class:this.classes(hn,mn,bn,_n,e&&vn)},this.messages.cancel):null,i=this.visibleElements.addSubmitButton?(0,Ot.u)("button",{type:"submit",disabled:n,class:this.classes(hn,yn,bn,_n,(0,H.Z)({},vn,n))},this.messages.add):null,o=t?(0,Ot.u)("span",{key:"file-name",class:un},t.name):null,a=(0,Ot.u)("form",{bind:this,afterCreate:It.Se,afterRemoved:It.pV,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},(0,Ot.u)("fieldset",{class:an},o,(0,Ot.u)("label",{class:this.classes(sn,hn,yn)},t?this.messages.changeFile:this.messages.selectFile,(0,Ot.u)("input",{class:ln,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),i,r);return(0,Ot.u)("div",{key:"add-form-container",class:on},a)}},{key:"renderDetailsForm",value:function(e){var t=this,n=this.visibleElements,r=this.viewModel,i=this.selectedFile,o=this.submitting,a=e.contentType,s=e.size,u=e.url,l=r.abilities,c=o||!i,p=l.editing&&l.operations.delete&&n.deleteButton?(0,Ot.u)("button",{key:"delete-button",type:"button",disabled:o,bind:this,onclick:function(n){return t._submitDeleteAttachment(n,e)},class:this.classes(hn,bn,mn,Nt,(0,H.Z)({},vn,o))},this.messages.delete):null,f=l.editing&&l.operations.update&&n.updateButton?(0,Ot.u)("button",{disabled:c,key:"update-button",type:"submit",class:this.classes(hn,bn,gn,(0,H.Z)({},vn,c))},this.messages.update):null,d=this.visibleElements.cancelUpdateButton?(0,Ot.u)("button",{disabled:o,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes(hn,bn,mn,gn,(0,H.Z)({},vn,o))},this.messages.cancel):null,h=i?(0,Ot.u)("span",{key:"file-name",class:un},i.name):null,v=l.editing&&l.operations.update?(0,Ot.u)("fieldset",{key:"file",class:an},h,(0,Ot.u)("label",{class:this.classes(sn,hn,yn)},this.messages.changeFile,(0,Ot.u)("input",{class:ln,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):null,y=(0,Ot.u)("fieldset",{key:"size",class:pn},(0,Ot.u)("label",null,function(e,t){var n=0===t?0:Math.floor(Math.log(t)/Math.log(1024));n=(0,ye.uZ)(n,0,be.length-1);var r=(0,ge.uf)(t/Math.pow(1024,n),{maximumFractionDigits:2});return(0,me.gx)(e.units.bytes[be[n]],{fileSize:r})}(this.messagesUnits,s))),m=(0,Ot.u)("fieldset",{key:"content-type",class:pn},(0,Ot.u)("label",null,a)),g=(0,Ot.u)("form",{bind:this,afterCreate:It.Se,afterRemoved:It.pV,"data-node-ref":"_updateAttachmentForm",onsubmit:this._submitUpdateAttachment},(0,Ot.u)("div",{class:cn},y,m),v,(0,Ot.u)("div",{class:Bt},p,d,f));return(0,Ot.u)("div",{key:"edit-form-container",class:on},(0,Ot.u)("a",{class:en,href:u,rel:"noreferrer",target:"_blank"},this.renderImageMask({attachmentInfo:e,size:400}),(0,Ot.u)("div",{class:tn},(0,Ot.u)("span",{class:nn},(0,Ot.u)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},(0,Ot.u)("path",{d:"M28 13h1v16H3V3h16v1H4v24h24zm-5-9h4.293L15.646 15.638l.707.707L28 4.707V9h1V3h-6z"}),(0,Ot.u)("path",{fill:"none",d:"M0 0h32v32H0z"}))))),g)}},{key:"renderImageMask",value:function(e){var t=e.attachmentInfo,n=e.size,r=this.viewModel.supportsResizeAttachments,i=t.contentType,o=t.name,a=t.url,s=r&&function(e){var t=e.toLowerCase();return"image/bmp"===t||"image/emf"===t||"image/exif"===t||"image/gif"===t||"image/x-icon"===t||"image/jpeg"===t||"image/png"===t||"image/tiff"===t||"image/x-wmf"===t}(i),u=this._getCSSTransform(t,s),l=u?{transform:u,"image-orientation":"none"}:{},c=-1===a.indexOf("?")?"?":"&",p=s?"".concat(a).concat(c,"w=").concat(n):function(e){var t=(0,Mt.V)("esri/themes/base/images/files/");return e?"text/plain"===e?"".concat(t,"text-32.svg"):"application/pdf"===e?"".concat(t,"pdf-32.svg"):"text/csv"===e?"".concat(t,"csv-32.svg"):"application/gpx+xml"===e?"".concat(t,"gpx-32.svg"):"application/x-dwf"===e?"".concat(t,"cad-32.svg"):"application/postscript"===e||"application/json"===e||"text/xml"===e||"model/vrml"===e?"".concat(t,"code-32.svg"):"application/x-zip-compressed"===e||"application/x-7z-compressed"===e||"application/x-gzip"===e||"application/x-tar"===e||"application/x-gtar"===e||"application/x-bzip2"===e||"application/gzip"===e||"application/x-compress"===e||"application/x-apple-diskimage"===e||"application/x-rar-compressed"===e||"application/zip"===e?"".concat(t,"zip-32.svg"):-1!==e.indexOf("image/")?"".concat(t,"image-32.svg"):-1!==e.indexOf("audio/")?"".concat(t,"sound-32.svg"):-1!==e.indexOf("video/")?"".concat(t,"video-32.svg"):-1!==e.indexOf("msexcel")||-1!==e.indexOf("ms-excel")||-1!==e.indexOf("spreadsheetml")?"".concat(t,"excel-32.svg"):-1!==e.indexOf("msword")||-1!==e.indexOf("ms-word")||-1!==e.indexOf("wordprocessingml")?"".concat(t,"word-32.svg"):-1!==e.indexOf("powerpoint")||-1!==e.indexOf("presentationml")?"".concat(t,"report-32.svg"):"".concat(t,"generic-32.svg"):"".concat(t,"generic-32.svg")}(i),f=(0,H.Z)({},Kt,!s),d=(0,H.Z)({},Jt,r);return(0,Ot.u)("div",{class:this.classes(f,Ht)},(0,Ot.u)("img",{styles:l,alt:o,src:p,class:this.classes(d,Yt)}))}},{key:"renderAttachmentInfo",value:function(e){var t=this,n=e.attachmentInfo,r=e.displayType,i=this.viewModel.abilities,o=n.name,a=n.url,s=this.renderImageMask({attachmentInfo:n,size:"list"===r?48:400}),u=i.editing?(0,Ot.u)("span",{"aria-hidden":"true",class:this.classes(Xt,(0,It.dZ)(this.container)?Cn:kn)}):null,l=[s,(0,Ot.u)("label",{class:$t},(0,Ot.u)("span",{class:Qt},o||this.messages.noTitle),u)],c=i.editing?(0,Ot.u)("button",{key:"details-button",bind:this,class:Gt,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":n.id,onclick:function(){return t._startEditAttachment(n)},type:"button"},l):(0,Ot.u)("a",{key:"details-link",class:Gt,href:a,target:"_blank"},l);return(0,Ot.u)("li",{class:qt,key:n},c)}},{key:"renderAttachmentContainer",value:function(){var e,t=this,n=this.effectiveDisplayType,r=this.viewModel,i=this.visibleElements,o=r.attachmentInfos,a=r.abilities,s=o&&o.length,u=(e={},(0,H.Z)(e,Dt,"preview"!==n),(0,H.Z)(e,Vt,"preview"===n),e),l=a.editing&&a.operations.add&&i.addButton?(0,Ot.u)("button",{bind:this,onclick:function(){return t._startAddAttachment()},class:this.classes(hn,mn,zt),type:"button"},(0,Ot.u)("span",{"aria-hidden":"true",class:this.classes(rn,xn)}),this.messages.add):null,c=s?(0,Ot.u)("ul",{class:Wt},o.toArray().map((function(e){return t.renderAttachmentInfo({attachmentInfo:e,displayType:n})}))):(0,Ot.u)("div",{class:wn},this.messages.noAttachments);return(0,Ot.u)("div",{key:"attachments-container",class:this.classes(Lt,u)},c,l)}},{key:"_modeChanged",value:function(){this._set("error",null),this._set("selectedFile",null)}},{key:"_handleFileInputChange",value:function(e){var t=e.target,n=t&&t.files&&t.files.item(0);this._set("selectedFile",n)}},{key:"_submitDeleteAttachment",value:function(e,t){e.preventDefault(),this.deleteAttachment(t)}},{key:"_submitAddAttachment",value:function(e){e.preventDefault(),this.addAttachment()}},{key:"_submitUpdateAttachment",value:function(e){e.preventDefault(),this.updateAttachment()}},{key:"_startEditAttachment",value:function(e){var t=this.viewModel;t.activeAttachmentInfo=e,t.mode="edit"}},{key:"_startAddAttachment",value:function(){this.viewModel.mode="add"}},{key:"_cancelForm",value:function(e){e.preventDefault(),this.viewModel.mode="view"}},{key:"_getCSSTransform",value:function(e,t){var n=e.orientationInfo;return!this._supportsImageOrientation&&t&&n?[n.rotation?"rotate(".concat(n.rotation,"deg)"):"",n.mirrored?"scaleX(-1)":""].join(" "):""}}]),n}(ve.Z);(0,S._)([(0,de.B)("viewModel.abilities")],Mn.prototype,"abilities",void 0),(0,S._)([(0,U.Cb)()],Mn.prototype,"displayType",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],Mn.prototype,"effectiveDisplayType",null),(0,S._)([(0,de.B)("viewModel.graphic")],Mn.prototype,"graphic",void 0),(0,S._)([(0,U.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Mn.prototype,"label",void 0),(0,S._)([(0,U.Cb)(),(0,Rt.H)("esri/widgets/Attachments/t9n/Attachments")],Mn.prototype,"messages",void 0),(0,S._)([(0,U.Cb)(),(0,Rt.H)("esri/core/t9n/Units")],Mn.prototype,"messagesUnits",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],Mn.prototype,"selectedFile",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],Mn.prototype,"submitting",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],Mn.prototype,"error",void 0),(0,S._)([(0,U.Cb)({type:Zt})],Mn.prototype,"viewModel",void 0),(0,S._)([(0,U.Cb)()],Mn.prototype,"visibleElements",void 0),(0,S._)([(0,he.p)("visibleElements")],Mn.prototype,"castVisibleElements",null);var In=Mn=(0,S._)([(0,G.j)("esri.widgets.Attachments")],Mn);function Rn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var On=function(e){(0,M.Z)(n,e);var t=Rn(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).description=null,r.title=null,r}return(0,C.Z)(n)}(Zt);(0,S._)([(0,U.Cb)()],On.prototype,"description",void 0),(0,S._)([(0,U.Cb)()],On.prototype,"title",void 0);var Pn=On=(0,S._)([(0,G.j)("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],On);function Tn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Sn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Tn(Object(n),!0).forEach((function(t){(0,H.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Tn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var En="esri-widget__heading";function An(e,t){var n="h".concat((0,ye.uZ)(Math.ceil(e.level),1,6));return delete e.level,(0,Ot.u)(n,Sn(Sn({},e),{},{class:(0,It.Sh)(En,e.class)}),t)}function jn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Fn="esri-feature-element-info",Ln="esri-feature-element-info__title",Dn="esri-feature-element-info__description",Vn=function(e){(0,M.Z)(n,e);var t=jn(n);function n(e,r){var i;return(0,k.Z)(this,n),(i=t.call(this,e,r)).description=null,i.headingLevel=2,i.title=null,i}return(0,C.Z)(n,[{key:"render",value:function(){return(0,Ot.u)("div",{class:Fn},this.renderTitle(),this.renderDescription())}},{key:"renderTitle",value:function(){var e=this.title;return e?(0,Ot.u)(An,{level:this.headingLevel,class:Ln},e):null}},{key:"renderDescription",value:function(){var e=this.description;return e?(0,Ot.u)("div",{key:"description",class:Dn},e):null}}]),n}(ve.Z);(0,S._)([(0,U.Cb)()],Vn.prototype,"description",void 0),(0,S._)([(0,U.Cb)()],Vn.prototype,"headingLevel",void 0),(0,S._)([(0,U.Cb)()],Vn.prototype,"title",void 0);var Bn=Vn=(0,S._)([(0,G.j)("esri.widgets.Feature.support.FeatureElementInfo")],Vn);function Nn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var zn="esri-feature-attachments",Un=function(e){(0,M.Z)(n,e);var t=Nn(n);function n(e,r){var i;return(0,k.Z)(this,n),(i=t.call(this,e,r))._featureElementInfo=null,i.attachmentsWidget=new In,i.description=null,i.displayType=null,i.graphic=null,i.headingLevel=2,i.title=null,i.viewModel=new Pn,i}return(0,C.Z)(n,[{key:"initialize",value:function(){var e=this;this._featureElementInfo=new Bn,(0,N.S1)(this,["viewModel.description","viewModel.title","headingLevel"],(function(){return e._setupFeatureElementInfo()})),(0,N.S1)(this,"viewModel.graphic",(function(t){return e.attachmentsWidget.graphic=t}))}},{key:"destroy",value:function(){this.attachmentsWidget.destroy(),this._featureElementInfo.destroy()}},{key:"render",value:function(){var e,t=this.attachmentsWidget;return(0,Ot.u)("div",{class:zn},null==(e=this._featureElementInfo)?void 0:e.render(),null==t?void 0:t.render())}},{key:"_setupFeatureElementInfo",value:function(){var e=this.description,t=this.title,n=this.headingLevel;this._featureElementInfo.set({description:e,title:t,headingLevel:n})}}]),n}(ve.Z);(0,S._)([(0,U.Cb)({readOnly:!0})],Un.prototype,"attachmentsWidget",void 0),(0,S._)([(0,de.B)("viewModel.description")],Un.prototype,"description",void 0),(0,S._)([(0,de.B)("attachmentsWidget.displayType")],Un.prototype,"displayType",void 0),(0,S._)([(0,de.B)("viewModel.graphic")],Un.prototype,"graphic",void 0),(0,S._)([(0,U.Cb)()],Un.prototype,"headingLevel",void 0),(0,S._)([(0,de.B)("viewModel.title")],Un.prototype,"title",void 0),(0,S._)([(0,U.Cb)({type:Pn})],Un.prototype,"viewModel",void 0);var Wn=Un=(0,S._)([(0,G.j)("esri.widgets.Feature.FeatureAttachments")],Un);function qn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Gn=function(e){(0,M.Z)(r,e);var t,n=qn(r);function r(e){var t;return(0,k.Z)(this,r),(t=n.call(this,e))._loadingPromise=null,t.created=null,t.creator=null,t.destroyer=null,t.graphic=null,t.handles.add((0,N.S1)((0,x.Z)(t),"creator",(function(e){t._destroyContent(),t._createContent(e)}))),t}return(0,C.Z)(r,[{key:"destroy",value:function(){this._destroyContent()}},{key:"state",get:function(){return this._loadingPromise?"loading":"ready"}},{key:"_destroyContent",value:function(){var e=this.created,t=this.graphic,n=this.destroyer;e&&(Ne(n,{graphic:t}).catch((function(){return null})),this._set("created",null))}},{key:"_createContent",value:(t=(0,O.Z)(T().mark((function e(t){var n,r,i;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.graphic,r=Ne(t,{graphic:n}).catch((function(){return null})),this._loadingPromise=r,this.notifyChange("state"),e.next=4,r;case 4:i=e.sent,r===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",i));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),r}((0,_e.p)(re.Z));(0,S._)([(0,U.Cb)({readOnly:!0})],Gn.prototype,"created",void 0),(0,S._)([(0,U.Cb)()],Gn.prototype,"creator",void 0),(0,S._)([(0,U.Cb)()],Gn.prototype,"destroyer",void 0),(0,S._)([(0,U.Cb)({type:E.Z})],Gn.prototype,"graphic",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],Gn.prototype,"state",null);var Hn=Gn=(0,S._)([(0,G.j)("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],Gn),Kn=n(99120);function Yn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Jn="esri-feature-content",$n="esri-feature-content__loader-container",Qn="esri-feature-content__loader",Xn=function(e){(0,M.Z)(n,e);var t=Yn(n);function n(e,r){var i;return(0,k.Z)(this,n),(i=t.call(this,e,r)).creator=null,i.graphic=null,i.viewModel=null,i._addTargetToAnchors=function(e){Array.from(e.querySelectorAll("a")).forEach((function(e){Ue(e.href)&&!e.hasAttribute("target")&&e.setAttribute("target","_blank")}))},i}return(0,C.Z)(n,[{key:"renderLoading",value:function(){return(0,Ot.u)("div",{class:$n,key:"loader"},(0,Ot.u)("div",{class:Qn}))}},{key:"renderCreated",value:function(){var e,t=null==(e=this.viewModel)?void 0:e.created;return t?t instanceof HTMLElement?(0,Ot.u)("div",{key:t,bind:t,afterCreate:this._attachToNode}):(0,Kn.Qd)(t)?(0,Ot.u)("div",{key:t},!t.destroyed&&t.render()):(0,Ot.u)("div",{key:t,innerHTML:t,afterCreate:this._addTargetToAnchors}):null}},{key:"render",value:function(){var e,t=null==(e=this.viewModel)?void 0:e.state;return(0,Ot.u)("div",{class:Jn},"loading"===t?this.renderLoading():this.renderCreated())}},{key:"_attachToNode",value:function(e){e.appendChild(this)}}]),n}(ve.Z);(0,S._)([(0,de.B)("viewModel.creator")],Xn.prototype,"creator",void 0),(0,S._)([(0,de.B)("viewModel.graphic")],Xn.prototype,"graphic",void 0),(0,S._)([(0,U.Cb)({type:Hn})],Xn.prototype,"viewModel",void 0);var er=Xn=(0,S._)([(0,G.j)("esri.widgets.Feature.FeatureContent")],Xn),tr=n(365),nr=n(51128);function rr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var ir=function(e){(0,M.Z)(n,e);var t=rr(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).attributes=null,r.expressionInfos=null,r.description=null,r.fieldInfos=null,r.title=null,r}return(0,C.Z)(n,[{key:"formattedFieldInfos",get:function(){var e=this.expressionInfos,t=this.fieldInfos,n=[];return null==t||t.forEach((function(t){if(!t.hasOwnProperty("visible")||t.visible){var r=t.clone();r.label=qe(r,e),n.push(r)}})),n}}]),n}(re.Z);(0,S._)([(0,U.Cb)()],ir.prototype,"attributes",void 0),(0,S._)([(0,U.Cb)({type:[tr.Z]})],ir.prototype,"expressionInfos",void 0),(0,S._)([(0,U.Cb)()],ir.prototype,"description",void 0),(0,S._)([(0,U.Cb)({type:[nr.Z]})],ir.prototype,"fieldInfos",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],ir.prototype,"formattedFieldInfos",null),(0,S._)([(0,U.Cb)()],ir.prototype,"title",void 0);var or=ir=(0,S._)([(0,G.j)("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],ir),ar=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function sr(e,t){if("string"!=typeof t||!t)return t;var n=function(e){var t=null;return ar.some((function(n){return n.pattern.test(e)&&(t=n),!!t})),t}(t);if(!n)return t;var r=t.match(n.pattern),i=r&&r[2],o=(0,me.gx)((0,me.gx)(n.label,{messages:e,hierPart:i}),{appName:n.appName}),a=n.target?' target="'.concat(n.target,'"'):"",s="_blank"===n.target?' rel="noreferrer"':"";return t.replace(n.pattern,"<a".concat(a,' href="$1"').concat(s,">").concat(o,"</a>"))}function ur(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var lr="esri-feature-fields",cr="esri-feature-fields__field-header",pr="esri-feature-fields__field-data",fr="esri-feature-fields__field-data--date",dr="esri-widget__table",hr=function(e){(0,M.Z)(n,e);var t=ur(n);function n(e,r){var i;return(0,k.Z)(this,n),(i=t.call(this,e,r))._featureElementInfo=null,i.attributes=null,i.description=null,i.expressionInfos=null,i.fieldInfos=null,i.title=null,i.viewModel=new or,i.messages=null,i.messagesURIUtils=null,i}return(0,C.Z)(n,[{key:"initialize",value:function(){var e=this;this._featureElementInfo=new Bn,(0,N.S1)(this,["viewModel.description","viewModel.title"],(function(){return e._setupFeatureElementInfo()}))}},{key:"destroy",value:function(){this._featureElementInfo.destroy()}},{key:"renderFieldInfo",value:function(e,t){var n=this.viewModel.attributes,r=e.fieldName,i=e.label||r,o=n?null==n[r]?"":n[r]:"",a=!(!e.format||!e.format.dateFormat),s="number"!=typeof o||a?sr(this.messagesURIUtils,o):this._forceLTR(o),u=(0,H.Z)({},fr,a);return(0,Ot.u)("tr",{key:"fields-element-info-row-".concat(r,"-").concat(t)},(0,Ot.u)("th",{key:"fields-element-info-row-header-".concat(r,"-").concat(t),class:cr,innerHTML:i}),(0,Ot.u)("td",{key:"fields-element-info-row-data-".concat(r,"-").concat(t),class:this.classes(pr,u),innerHTML:s}))}},{key:"renderFields",value:function(){var e=this,t=this.viewModel.formattedFieldInfos;return null!=t&&t.length?(0,Ot.u)("table",{class:dr,summary:this.messages.fieldsSummary},(0,Ot.u)("tbody",null,t.map((function(t,n){return e.renderFieldInfo(t,n)})))):null}},{key:"render",value:function(){var e;return(0,Ot.u)("div",{class:lr},null==(e=this._featureElementInfo)?void 0:e.render(),this.renderFields())}},{key:"_setupFeatureElementInfo",value:function(){var e=this.description,t=this.title;this._featureElementInfo.set({description:e,title:t})}},{key:"_forceLTR",value:function(e){return"&lrm;".concat(e)}}]),n}(ve.Z);(0,S._)([(0,de.B)("viewModel.attributes")],hr.prototype,"attributes",void 0),(0,S._)([(0,de.B)("viewModel.description")],hr.prototype,"description",void 0),(0,S._)([(0,de.B)("viewModel.expressionInfos")],hr.prototype,"expressionInfos",void 0),(0,S._)([(0,de.B)("viewModel.fieldInfos")],hr.prototype,"fieldInfos",void 0),(0,S._)([(0,de.B)("viewModel.title")],hr.prototype,"title",void 0),(0,S._)([(0,U.Cb)({type:or})],hr.prototype,"viewModel",void 0),(0,S._)([(0,U.Cb)(),(0,Rt.H)("esri/widgets/Feature/t9n/Feature")],hr.prototype,"messages",void 0),(0,S._)([(0,U.Cb)(),(0,Rt.H)("esri/widgets/support/t9n/uriUtils")],hr.prototype,"messagesURIUtils",void 0);var vr=hr=(0,S._)([(0,G.j)("esri.widgets.Feature.FeatureFields")],hr),yr=n(28600),mr=n(51916),gr=n(37566),br=n(63703),_r=n(92595),wr=n(33155);function kr(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Cr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Cr(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Cr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var xr=V.Z.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),Zr=new Map;function Mr(e){if(!vt(e))return null;var t=e.split("/").slice(1),n=(0,w.Z)(t,2);return{layerId:n[0],fieldName:n[1]}}function Ir(e){var t,n=e.originRelationship,r=e.relationships,i=e.layerId;return r&&r.some((function(e){return"".concat(e.relatedTableId)===i&&e.id===n.id&&(t=e),!!t})),t}function Rr(e,t){var n=t.toLowerCase();for(var r in e)if(r.toLowerCase()===n)return e[r];return null}function Or(e,t){var n=function(e,t){if(!t.relationships)return null;var n=null;return t.relationships.some((function(t){return t.id===parseInt(e,10)&&(n=t,!0)})),n}(e,t);if(n){var r="".concat(t.url,"/").concat(n.relatedTableId);return{url:r,queryTask:new wr.Z({url:r,sourceSpatialReference:t.spatialReference}),relation:n,relatedFields:[],outStatistics:[]}}}function Pr(e,t){if(t&&e){var n=e.features,r=e.statsFeatures,i=n&&n.value;t.relatedFeatures=i?i.features:[];var o=r&&r.value;t.relatedStatsFeatures=o?o.features:[]}}function Tr(e,t,n,r){var i=new br.Z;return i.outFields=["*"],i.relationshipId="number"==typeof t.id?t.id:parseInt(t.id,10),i.objectIds=[e.attributes[n.objectIdField]],n.queryRelatedFeatures(i,r)}function Sr(e,t,n){for(var r=0,i=[];r<t.length;)i.push("".concat(e," IN (").concat(t.slice(r,n+r),")")),r+=n;return i.join(" OR ")}function Er(){return Er=(0,O.Z)(T().mark((function e(t,n,r,i){var o,a,s,l,c,p,f,d,h,v,y,m,g,b,_,w,k,C;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=r.layerId.toString(),a=n.layerInfo,s=n.queryTask,l=n.relation,c=n.relatedFields,p=n.outStatistics,!(f=Ir({originRelationship:l,relationships:a.relationships,layerId:o})).relationshipTableId||!f.keyFieldInRelationshipTable){e.next=14;break}return e.next=4,Tr(t,f,r,i);case 4:if(e.t0=t.attributes[r.objectIdField],d=e.sent[e.t0]){e.next=8;break}return e.abrupt("return",null);case 8:if(h=d.features.map((function(e){return e.attributes[a.objectIdField]})),!((null==p?void 0:p.length)>0&&a.supportsStatistics)){e.next=14;break}return(v=new u.Z).where=Sr(a.objectIdField,h,1e3),v.outFields=c,v.outStatistics=p,y={features:Promise.resolve(d),statsFeatures:s.execute(v)},e.abrupt("return",(0,gr.as)(y));case 14:if(!(m=null==f?void 0:f.keyField)){e.next=18;break}return g=(0,xe.H7)(Fr(a.fields,m)),b=Rr(t.attributes,l.keyField),_=g?"".concat(m,"=").concat(b):"".concat(m,"='").concat(b,"'"),w=s.execute(new u.Z({where:_,outFields:n.relatedFields}),i),k=n.outStatistics&&n.outStatistics.length>0&&a.supportsStatistics?s.execute(new u.Z({where:_,outFields:n.relatedFields,outStatistics:n.outStatistics}),i):null,C={features:w},e.abrupt("return",(k&&(C.statsFeatures=k),(0,gr.as)(C)));case 18:return e.abrupt("return",null);case 19:case"end":return e.stop()}}),e)}))),Er.apply(this,arguments)}function Ar(e,t){var n=e.relatedInfos,r=e.layer,i={};return n.forEach((function(e,n){var o=e.relation;if(!o){var a=new F.Z("relation-required","A relation is required on a layer to retrieve related records.");throw xr.error(a),a}var s=o.relatedTableId;if("number"!=typeof s){var u=new F.Z("A related table ID is required on a layer to retrieve related records.");throw xr.error(u),u}var l="".concat(r.url,"/").concat(s),c=Zr.get(l),p=c||function(e,t){return(0,mr.default)(e,{query:{f:"json"},signal:t&&t.signal})}(l,t);c||Zr.set(l,p),i[n]=p})),(0,gr.as)(i)}function jr(e,t){var n=e.graphic,r=e.relatedInfos,i=e.layer,o={};return r.forEach((function(e,r){e.layerInfo&&(o[r]=function(e,t,n,r){return Er.apply(this,arguments)}(n,e,i,t))})),(0,gr.as)(o)}function Fr(e,t){if(null!=e){t=t.toLowerCase();var n,r=kr(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i&&i.name.toLowerCase()===t)return i}}catch(o){r.e(o)}finally{r.f()}}return null}function Lr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Dr=function(e){(0,M.Z)(n,e);var t=Lr(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).activeMediaInfoIndex=0,r.attributes=null,r.description=null,r.fieldInfoMap=null,r.formattedAttributes=null,r.expressionAttributes=null,r.layer=null,r.mediaInfos=null,r.popupTemplate=null,r.relatedInfos=null,r.title=null,r}return(0,C.Z)(n,[{key:"activeMediaInfo",get:function(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}},{key:"formattedMediaInfos",get:function(){return this._formatMediaInfos()||[]}},{key:"formattedMediaInfoCount",get:function(){return this.formattedMediaInfos.length}},{key:"setActiveMedia",value:function(e){this._setContentElementMedia(e)}},{key:"next",value:function(){this._pageContentElementMedia(1)}},{key:"previous",value:function(){this._pageContentElementMedia(-1)}},{key:"_setContentElementMedia",value:function(e){var t=this.formattedMediaInfoCount,n=(e+t)%t;this.activeMediaInfoIndex=n}},{key:"_pageContentElementMedia",value:function(e){var t=this.activeMediaInfoIndex+e;this._setContentElementMedia(t)}},{key:"_formatMediaInfos",value:function(){var e=this,t=this.attributes,n=this.mediaInfos,r=this.formattedAttributes,i=this.expressionAttributes,o=this.fieldInfoMap,a=this.layer;return null==n?void 0:n.map((function(n){var s=null==n?void 0:n.clone();if(!s)return null;if(s.title=Ye({attributes:t,fieldInfoMap:o,globalAttributes:r,expressionAttributes:i,layer:a,text:s.title}),s.caption=Ye({attributes:t,fieldInfoMap:o,globalAttributes:r,expressionAttributes:i,layer:a,text:s.caption}),s.altText=Ye({attributes:t,fieldInfoMap:o,globalAttributes:r,expressionAttributes:i,layer:a,text:s.altText}),"image"===s.type){var u=s.value;return e._setImageValue({value:u,formattedAttributes:r,layer:a}),s.value.sourceURL?s:void 0}if("pie-chart"===s.type||"line-chart"===s.type||"column-chart"===s.type||"bar-chart"===s.type){var l=s.value;return e._setChartValue({value:l,chartType:s.type,attributes:t,formattedAttributes:r,layer:a}),s}return null})).filter(Boolean)}},{key:"_setImageValue",value:function(e){var t=this.fieldInfoMap,n=e.value,r=e.formattedAttributes,i=e.layer,o=n.linkURL,a=n.sourceURL;if(a){var s=Xe(a,i);n.sourceURL=Je({formattedAttributes:r,template:s,fieldInfoMap:t})}if(o){var u=Xe(o,i);n.linkURL=Je({formattedAttributes:r,template:u,fieldInfoMap:t})}}},{key:"_setChartValue",value:function(e){var t=this,n=e.value,r=e.attributes,i=e.formattedAttributes,o=e.chartType,a=e.layer,s=this.popupTemplate,u=this.relatedInfos,l=n.fields,c=n.normalizeField;if(n.fields=function(e,t){return e&&e.map((function(e){return Ge(e,t)}))}(l,a),c&&(n.normalizeField=Ge(c,a)),l.some((function(e){return!!(null!=i[e]||vt(e)&&u.size)}))){var p=null==s?void 0:s.fieldInfos;l.forEach((function(e){if(vt(e))n.series=[].concat((0,h.Z)(n.series),(0,h.Z)(t._getRelatedChartInfos({fieldInfos:p,fieldName:e,formattedAttributes:i,chartType:o,value:n})));else{var a=t._getChartOption({value:n,attributes:r,chartType:o,formattedAttributes:i,fieldName:e,fieldInfos:p});n.series.push(a)}}))}}},{key:"_getRelatedChartInfos",value:function(e){var t,n=this,r=e.fieldInfos,i=e.fieldName,o=e.formattedAttributes,a=e.chartType,s=e.value,u=[],l=Mr(i),c=l.layerId,p=l.fieldName,f=null==(t=this.relatedInfos)?void 0:t.get(c.toString());if(!f)return u;var d=f.relatedFeatures,h=f.relation;if(!h||!d)return u;var v=h.cardinality;return d.forEach((function(e){var t=e.attributes;t&&Object.keys(t).forEach((function(e){e===p&&u.push(n._getChartOption({value:s,attributes:t,formattedAttributes:o,fieldName:i,chartType:a,relatedFieldName:e,fieldInfos:r}))}))})),"one-to-many"===v||"many-to-many"===v?u:[u[0]]}},{key:"_getTooltip",value:function(e){var t=e.label,n=e.value;return"pie-chart"===e.chartType?t:"".concat(t,": ").concat(n)}},{key:"_getChartOption",value:function(e){var t,n=e.value,r=e.attributes,i=e.formattedAttributes,o=e.fieldName,a=e.relatedFieldName,s=e.fieldInfos,u=e.chartType,l=this.layer,c=n.normalizeField,p=n.tooltipField,f=c?vt(c)?r[Mr(c).fieldName]:r[c]:null,d=a&&void 0!==r[a]?r[a]:void 0!==r[o]?r[o]:i[o],h=void 0===d?null:d&&f?d/f:d,v=new yr.Z({value:h});if(vt(o)){var y=Mr(o),m=Mr(p),g=m?m.fieldName:null,b=tt(h,{fieldInfos:s,fieldName:a,layer:l,preventPlacesFormatting:!!f}),_=y?y.label||y.fieldName:a,w=g&&void 0!==r[g]?r[g]:_;return v.tooltip=this._getTooltip({label:w,value:b,chartType:u}),v}var k=nt(s,o),C=Ge(o,l),x=p&&void 0!==i[p]?i[p]:qe(k||new nr.Z({fieldName:C}),null==(t=this.popupTemplate)?void 0:t.expressionInfos),Z=i[C];return v.tooltip=this._getTooltip({label:x,value:Z,chartType:u}),v}}]),n}(re.Z);(0,S._)([(0,U.Cb)()],Dr.prototype,"activeMediaInfoIndex",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],Dr.prototype,"activeMediaInfo",null),(0,S._)([(0,U.Cb)()],Dr.prototype,"attributes",void 0),(0,S._)([(0,U.Cb)()],Dr.prototype,"description",void 0),(0,S._)([(0,U.Cb)()],Dr.prototype,"fieldInfoMap",void 0),(0,S._)([(0,U.Cb)()],Dr.prototype,"formattedAttributes",void 0),(0,S._)([(0,U.Cb)()],Dr.prototype,"expressionAttributes",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],Dr.prototype,"formattedMediaInfos",null),(0,S._)([(0,U.Cb)()],Dr.prototype,"layer",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],Dr.prototype,"formattedMediaInfoCount",null),(0,S._)([(0,U.Cb)()],Dr.prototype,"mediaInfos",void 0),(0,S._)([(0,U.Cb)()],Dr.prototype,"popupTemplate",void 0),(0,S._)([(0,U.Cb)()],Dr.prototype,"relatedInfos",void 0),(0,S._)([(0,U.Cb)()],Dr.prototype,"title",void 0);var Vr=Dr=(0,S._)([(0,G.j)("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],Dr),Br=["#ffffff","#858585","#ffbebe","#ffebbe","#ffebaf","#ffffbe","#e9ffbe","#d3ffbe","#beffe8","#bee8ff","#bed2ff","#e8beff","#ffbee8","#ebebeb","#707070","#ff7f7f","#ffa77f","#ffd37f","#ffff73","#d1ff73","#a3ff73","#73ffdf","#73dfff","#73b2ff","#df73ff","#ff73df","#d6d6d6","#5c5c5c","#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ffc5","#00c5ff","#0070ff","#c500ff","#ff00c5","#c2c2c2","#474747","#e60000","#e64c00","#e69800","#e6e600","#98e600","#4ce600","#00e6a9","#00a9e6","#005ce6","#a900e6","#e600a9","#adadad","#242424","#a80000","#a83800","#a87000","#a8a800","#70a800","#38a800","#00a884","#0084a8","#004da8","#8400a8","#a80084","#999999","#1a1a1a","#730000","#732600","#734c00","#737300","#4c7300","#267300","#00734c","#004c73","#002673","#4c0073","#73004"],Nr=[].concat(Br.slice(30,39),Br.slice(28,30).reverse()),zr=[{name:"default",colors:Nr},{name:"cat-dark",colors:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"]},{name:"tropical-bliss",colors:["#fce138","#ff9399","#fcd27e","#f1983c","#a553b7","#b1a9d0","#6ecffc","#4c81cd","#fc6f84","#fc3e5a","#6af689","#48885c"]},{name:"desert-blooms",colors:["#102432","#144d59","#ffc730","#ed9310","#a64f1b","#661510","#d9351a","#b31515","#4a0932","#8c213f","#18382e","#2c6954"]},{name:"under-the-sea",colors:["#bf9727","#607100","#00734c","#704489","#01acca","#024e76","#f09100","#ea311f","#c6004b","#7570b3","#666666","#333333"]},{name:"vibrant-rainbow",colors:["#fffb00","#f5cb11","#9fd40c","#46e39c","#32b8a6","#7ff2fa","#ac08cc","#dd33ff","#eb7200","#e8a784","#bf2e2e","#6c7000"]},{name:"ocean-bay",colors:["#191921","#11495c","#78b1c2","#454f4b","#8f8f82","#9be0c0","#87b051","#f7ec88","#ebdcc1","#dbb658","#c43541","#75351e"]},{name:"prairie-summer",colors:["#332424","#751555","#d47013","#d68989","#211173","#82aad6","#7bfaeb","#6ec9a8","#6b6408","#eada40","#ccc54a","#1fc235"]},{name:"pastel-chalk",colors:["#fffd99","#f5e6a4","#c1d48c","#b8e3d0","#a0b8b5","#cbf7fa","#d791f2","#dfc1eb","#f2b983","#e8c4b2","#bf8e8e","#94995c"]},{name:"seq-yellow-orange-red-bright",colors:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"]},{name:"seq-reds-bright",colors:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"]},{name:"seq-purples-bright",colors:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"]},{name:"seq-blues-bright",colors:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"]},{name:"seq-greens-bright",colors:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"]},{name:"seq-browns-bright",colors:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"]}],Ur=n(19563);function Wr(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return qr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return qr(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function qr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Gr,Hr,Kr="en-us",Yr=new Map([["ar",function(){return n.e(7001).then(n.bind(n,27001)).then((function(e){return e.a}))}],["bg-bg",function(){return n.e(1332).then(n.bind(n,41332)).then((function(e){return e.b}))}],["bs-ba",function(){return n.e(804).then(n.bind(n,10804)).then((function(e){return e.b}))}],["ca-es",function(){return n.e(5811).then(n.bind(n,25811)).then((function(e){return e.c}))}],["cs-cz",function(){return n.e(1753).then(n.bind(n,1753)).then((function(e){return e.c}))}],["da-dk",function(){return n.e(1366).then(n.bind(n,61366)).then((function(e){return e.d}))}],["de-de",function(){return n.e(2871).then(n.bind(n,92871)).then((function(e){return e.d}))}],["de-ch",function(){return n.e(1510).then(n.bind(n,51510)).then((function(e){return e.d}))}],["el-gr",function(){return n.e(1894).then(n.bind(n,71894)).then((function(e){return e.e}))}],["en-us",function(){return n.e(5247).then(n.bind(n,5247)).then((function(e){return e.e}))}],["en-ca",function(){return n.e(4757).then(n.bind(n,34757)).then((function(e){return e.e}))}],["es-es",function(){return n.e(3500).then(n.bind(n,33500)).then((function(e){return e.e}))}],["et-ee",function(){return n.e(9902).then(n.bind(n,39902)).then((function(e){return e.e}))}],["fi-fi",function(){return n.e(6418).then(n.bind(n,36418)).then((function(e){return e.f}))}],["fr-fr",function(){return n.e(8529).then(n.bind(n,98529)).then((function(e){return e.f}))}],["he-il",function(){return n.e(455).then(n.bind(n,455)).then((function(e){return e.h}))}],["hr-hr",function(){return n.e(8281).then(n.bind(n,28281)).then((function(e){return e.h}))}],["hu-hu",function(){return n.e(5666).then(n.bind(n,45666)).then((function(e){return e.h}))}],["id-id",function(){return n.e(9154).then(n.bind(n,39154)).then((function(e){return e.i}))}],["it-it",function(){return n.e(8345).then(n.bind(n,18345)).then((function(e){return e.i}))}],["ja-jp",function(){return n.e(4383).then(n.bind(n,84383)).then((function(e){return e.j}))}],["ko-kr",function(){return n.e(271).then(n.bind(n,50271)).then((function(e){return e.k}))}],["lt-lt",function(){return n.e(5337).then(n.bind(n,75337)).then((function(e){return e.l}))}],["lv-lv",function(){return n.e(556).then(n.bind(n,556)).then((function(e){return e.l}))}],["nb-no",function(){return n.e(7817).then(n.bind(n,67817)).then((function(e){return e.n}))}],["nl-nl",function(){return n.e(693).then(n.bind(n,80693)).then((function(e){return e.n}))}],["pl-pl",function(){return n.e(4308).then(n.bind(n,84308)).then((function(e){return e.p}))}],["pt-br",function(){return n.e(2811).then(n.bind(n,42811)).then((function(e){return e.p}))}],["pt-pt",function(){return n.e(6899).then(n.bind(n,56899)).then((function(e){return e.p}))}],["ro-ro",function(){return n.e(2208).then(n.bind(n,2208)).then((function(e){return e.r}))}],["ru-ru",function(){return n.e(2907).then(n.bind(n,22907)).then((function(e){return e.r}))}],["sk-sk",function(){return n.e(901).then(n.bind(n,20901)).then((function(e){return e.s}))}],["sl-sl",function(){return n.e(6458).then(n.bind(n,96458)).then((function(e){return e.s}))}],["sr-rs",function(){return n.e(5735).then(n.bind(n,85735)).then((function(e){return e.s}))}],["sv-se",function(){return n.e(2954).then(n.bind(n,62954)).then((function(e){return e.s}))}],["th-th",function(){return n.e(2097).then(n.bind(n,72097)).then((function(e){return e.t}))}],["tr-tr",function(){return n.e(9610).then(n.bind(n,29610)).then((function(e){return e.t}))}],["uk-ua",function(){return n.e(709).then(n.bind(n,10709)).then((function(e){return e.u}))}],["vi-vn",function(){return n.e(3086).then(n.bind(n,3086)).then((function(e){return e.v}))}],["zh-cn",function(){return n.e(1823).then(n.bind(n,61823)).then((function(e){return e.z}))}],["zh-hk",function(){return n.e(8901).then(n.bind(n,68901)).then((function(e){return e.z}))}],["zh-tw",function(){return n.e(8901).then(n.bind(n,68901)).then((function(e){return e.z}))}]]);function Jr(e){return e?Yr.has(e.toLowerCase())?e.toLowerCase():function(e){var t,n=e.split("-")[0].toLowerCase(),r=null,i=Wr(Yr.keys());try{for(i.s();!(t=i.n()).done;){var o=t.value;if(o.startsWith(n)){r=o;break}}}catch(a){i.e(a)}finally{i.f()}return r}(e)||Kr:Kr}function $r(){return Qr.apply(this,arguments)}function Qr(){return Qr=(0,O.Z)(T().mark((function e(){var t,r,i,o,a,s=arguments;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Jr(t=s.length>0&&void 0!==s[0]?s[0]:(0,Ur.Kd)()),!Gr||t!==Hr){e.next=3;break}return e.abrupt("return",Gr);case 3:return Gr=n.e(4439).then(n.bind(n,31462)).then((function(e){return e.i})),Hr=t,e.prev=4,e.next=7,Promise.all([Gr,Yr.get(Hr)()]);case 7:r=e.sent,i=(0,w.Z)(r,2),o=i[0],a=i[1],Hr===t&&(o.am4core.options.defaultLocale=a.default),o.am4core.options.suppressWarnings=!0,o.am4core.options.autoDispose=!0,e.next=17;break;case 14:return e.prev=14,e.t0=e.catch(4),e.abrupt("return",(Gr=null,Hr=null,null));case 17:return e.abrupt("return",Gr);case 18:case"end":return e.stop()}}),e,null,[[4,14]])}))),Qr.apply(this,arguments)}function Xr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var ei="esri-feature-media",ti="esri-feature-media__container",ni="esri-feature-media__item-container",ri="esri-feature-media__item",ii="esri-feature-media__item-title",oi="esri-feature-media__item-caption",ai="esri-feature-media__previous",si="esri-feature-media__previous-icon",ui="esri-feature-media__previous-icon--rtl",li="esri-feature-media__next",ci="esri-feature-media__next-icon",pi="esri-feature-media__next-icon--rtl",fi="esri-feature-media__chart",di="esri-feature-media__button",hi="esri-feature-media__icon",vi="esri-icon-left-triangle-arrow",yi="esri-icon-right-triangle-arrow",mi=.05,gi=.95,bi=function(e){(0,M.Z)(n,e);var t=Xr(n);function n(e,r){var i;return(0,k.Z)(this,n),(i=t.call(this,e,r))._refreshTimer=null,i._refreshIntervalInfo=null,i._featureElementInfo=null,i.attributes=null,i.activeMediaInfoIndex=null,i.description=null,i.fieldInfoMap=null,i.layer=null,i.mediaInfos=null,i.popupTemplate=null,i.relatedInfos=null,i.title=null,i.viewModel=new Vr,i.messages=null,i._getChartDependencies=function(){var e=(0,O.Z)(T().mark((function e(t){var n,r,o,a;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$r();case 2:if(n=e.sent,r=(0,x.Z)(i),o=r.viewModel){e.next=7;break}return e.abrupt("return");case 7:a=o.activeMediaInfo,i._renderChart({chartDiv:t,mediaInfo:a,chartsModule:n});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),i}return(0,C.Z)(n,[{key:"initialize",value:function(){var e=this;this._featureElementInfo=new Bn,this.own((0,N.S1)(this,["viewModel.activeMediaInfo","viewModel.activeMediaInfoIndex"],(function(){return e._setupMediaRefreshTimer()})),(0,N.S1)(this,["viewModel.description","viewModel.title"],(function(){return e._setupFeatureElementInfo()})))}},{key:"destroy",value:function(){this._clearMediaRefreshTimer(),this._featureElementInfo.destroy()}},{key:"render",value:function(){var e;return(0,Ot.u)("div",{bind:this,class:ei,onkeyup:this._handleMediaKeyup},null==(e=this._featureElementInfo)?void 0:e.render(),this.renderMedia())}},{key:"renderMedia",value:function(){return this.viewModel.formattedMediaInfoCount?(0,Ot.u)("div",{key:"media-element-container",class:ti},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null}},{key:"renderImageMediaInfo",value:function(e){var t=this._refreshIntervalInfo,n=this.viewModel,r=n.activeMediaInfoIndex,i=n.formattedMediaInfoCount,o=e.value,a=e.refreshInterval,s=e.altText,u=e.title,l=e.type,c=o.sourceURL,p=o.linkURL,f=Ue(p)?"_blank":"_self",d="_blank"===f?"noreferrer":"",h=a?t:null,v=h?h.timestamp:0,y=h?h.sourceURL:c,m=(0,Ot.u)("img",{alt:s||u,key:"media-".concat(l,"-").concat(r,"-").concat(i,"-").concat(v),src:y});return(p?(0,Ot.u)("a",{title:u,href:p,rel:d,target:f},m):null)||m}},{key:"renderChartMediaInfo",value:function(e){var t=this.viewModel,n=t.activeMediaInfoIndex,r=t.formattedMediaInfoCount;return(0,Ot.u)("div",{key:"media-".concat(e.type,"-").concat(n,"-").concat(r),bind:this,class:fi,afterCreate:this._getChartDependencies})}},{key:"renderMediaInfoType",value:function(){var e=this.viewModel.activeMediaInfo;return e?"image"===e.type?this.renderImageMediaInfo(e):-1!==e.type.indexOf("chart")?this.renderChartMediaInfo(e):null:null}},{key:"renderMediaInfo",value:function(){var e=this.viewModel.activeMediaInfo;if(!e)return null;var t=e.title?(0,Ot.u)("div",{key:"media-title",class:ii,innerHTML:e.title}):null,n=e.caption?(0,Ot.u)("div",{key:"media-caption",class:oi,innerHTML:e.caption}):null;return(0,Ot.u)("div",{key:"media-container",class:ni},(0,Ot.u)("div",{key:"media-item-container",class:ri},this.renderMediaInfoType()),t,n)}},{key:"renderMediaPageButton",value:function(e){if(this.viewModel.formattedMediaInfoCount<2)return null;var t="previous"===e,n=t?this.messages.previous:this.messages.next,r=t?this.classes(di,ai):this.classes(di,li),i=t?this.classes(hi,si,vi):this.classes(hi,ci,yi),o=t?this.classes(hi,ui,yi):this.classes(hi,pi,vi),a=t?"media-previous":"media-next",s=t?this._previous:this._next;return(0,Ot.u)("button",{type:"button",key:a,title:n,"aria-label":n,tabIndex:0,class:r,bind:this,onclick:s},(0,Ot.u)("span",{"aria-hidden":"true",class:i}),(0,Ot.u)("span",{"aria-hidden":"true",class:o}))}},{key:"_setupFeatureElementInfo",value:function(){var e=this.description,t=this.title;this._featureElementInfo.set({description:e,title:t})}},{key:"_next",value:function(){this.viewModel.next()}},{key:"_previous",value:function(){this.viewModel.previous()}},{key:"_handleMediaKeyup",value:function(e){var t=(0,pe.kK)(e);"ArrowLeft"===t&&(e.stopPropagation(),this.viewModel.previous()),"ArrowRight"===t&&(e.stopPropagation(),this.viewModel.next())}},{key:"_renderChart",value:function(e){var t=e.chartsModule,n=e.chartDiv,r=e.mediaInfo,i=r.value,o=r.type,a=t.am4core,s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",n=zr.find((function(e){return e.name===t}));return n?n.colors.map((function(t){return e.color(t)})):null}(a);(0,It.$o)()&&a.useTheme(t.am4themes_dark),a.useTheme(t.am4themes_animated),a.useTheme((function(e){e instanceof a.ColorSet&&s&&(e.list=s)}));var u="pie-chart"===o?this._createPieChart(e):this._createXYChart(e);n.setAttribute("aria-label",r.altText||r.title),u.data=i.series.map((function(e){return{tooltip:e.tooltip,value:e.value}})).filter((function(e){return"pie-chart"!==o||e.value>0}))}},{key:"_customizeChartTooltip",value:function(e,t){e.label.wrap=!0,e.label.maxWidth=200,e.autoTextColor=!1,e.getFillFromObject=!1,e.label.fill=t.color("#ffffff"),e.background.fill=t.color({r:0,g:0,b:0,a:.7})}},{key:"_createPieChart",value:function(e){var t=e.chartDiv,n=e.chartsModule,r=n.am4core,i=n.am4charts,o=r.create(t,i.PieChart);o.rtl=(0,It.dZ)(this.container);var a=o.series.push(new i.PieSeries);return a.labels.template.disabled=!0,a.ticks.template.disabled=!0,a.dataFields.value="value",a.dataFields.category="tooltip",this._customizeChartTooltip(a.tooltip,r),o}},{key:"_getMinSeriesValue",value:function(e){var t=0;return e.forEach((function(e){return t=Math.min(e.value,t)})),t}},{key:"_createColumnChart",value:function(e,t){var n=t.chartsModule,r=t.mediaInfo.value,i=n.am4core,o=n.am4charts,a=e.xAxes.push(new o.CategoryAxis);a.dataFields.category="tooltip",a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,i),a.tooltip.events.on("sizechanged",(function(){a.tooltip.dy=-a.tooltip.contentHeight}));var s=e.yAxes.push(new o.ValueAxis),u=s.renderer.labels.template;s.renderer.minLabelPosition=mi,s.renderer.maxLabelPosition=gi,s.min=this._getMinSeriesValue(r.series),this._customizeChartTooltip(s.tooltip,i),u.wrap=!0;var l=e.series.push(new o.ColumnSeries);l.dataFields.valueY="value",l.dataFields.categoryX="tooltip",e.cursor=new o.XYCursor,r.series.length>15&&(e.scrollbarX=new i.Scrollbar)}},{key:"_createBarChart",value:function(e,t){var n=t.chartsModule,r=t.mediaInfo.value,i=n.am4core,o=n.am4charts,a=e.yAxes.push(new o.CategoryAxis);a.dataFields.category="tooltip",a.renderer.inversed=!0,a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,i),a.tooltip.events.on("sizechanged",(function(){a.tooltip.dx=a.tooltip.contentWidth}));var s=e.xAxes.push(new o.ValueAxis),u=s.renderer.labels.template;s.renderer.minLabelPosition=mi,s.renderer.maxLabelPosition=gi,s.min=this._getMinSeriesValue(r.series),this._customizeChartTooltip(s.tooltip,i),u.wrap=!0;var l=e.series.push(new o.ColumnSeries);l.dataFields.valueX="value",l.dataFields.categoryY="tooltip",e.cursor=new o.XYCursor,r.series.length>15&&(e.scrollbarY=new i.Scrollbar)}},{key:"_createLineChart",value:function(e,t){var n=t.chartsModule,r=t.mediaInfo.value,i=n.am4core,o=n.am4charts,a=e.xAxes.push(new o.CategoryAxis);a.dataFields.category="tooltip",a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,i),a.tooltip.events.on("sizechanged",(function(){a.tooltip.dy=-a.tooltip.contentHeight}));var s=e.yAxes.push(new o.ValueAxis),u=s.renderer.labels.template;s.renderer.minLabelPosition=mi,s.renderer.maxLabelPosition=gi,s.min=this._getMinSeriesValue(r.series),this._customizeChartTooltip(s.tooltip,i),u.wrap=!0;var l=e.series.push(new o.LineSeries);l.dataFields.categoryX="tooltip",l.dataFields.valueY="value",e.cursor=new o.XYCursor,r.series.length>15&&(e.scrollbarX=new i.Scrollbar)}},{key:"_createXYChart",value:function(e){var t=e.chartDiv,n=e.chartsModule,r=e.mediaInfo.type,i=n.am4core,o=n.am4charts,a=i.create(t,o.XYChart);return a.rtl=(0,It.dZ)(this.container),"column-chart"===r&&this._createColumnChart(a,e),"bar-chart"===r&&this._createBarChart(a,e),"line-chart"===r&&this._createLineChart(a,e),a}},{key:"_clearMediaRefreshTimer",value:function(){var e=this._refreshTimer;e&&(clearTimeout(e),this._refreshTimer=null)}},{key:"_updateMediaInfoTimestamp",value:function(e){var t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:this._getImageSource(e,t)},this.scheduleRender()}},{key:"_setupMediaRefreshTimer",value:function(){this._clearMediaRefreshTimer();var e=this.viewModel.activeMediaInfo;e&&"image"===e.type&&e.refreshInterval&&this._setRefreshTimeout(e)}},{key:"_setRefreshTimeout",value:function(e){var t=this,n=e.refreshInterval,r=e.value;if(n){var i=6e4*n;this._updateMediaInfoTimestamp(r.sourceURL);var o=setInterval((function(){t._updateMediaInfoTimestamp(r.sourceURL)}),i);this._refreshTimer=o}}},{key:"_getImageSource",value:function(e,t){var n=-1!==e.indexOf("?")?"&":"?",r=e.split("#"),i=(0,w.Z)(r,2),o=i[0],a=i[1],s=void 0===a?"":a;return"".concat(o).concat(n,"timestamp=").concat(t).concat(s?"#":"").concat(s)}}]),n}(ve.Z);(0,S._)([(0,de.B)("viewModel.attributes")],bi.prototype,"attributes",void 0),(0,S._)([(0,de.B)("viewModel.activeMediaInfoIndex")],bi.prototype,"activeMediaInfoIndex",void 0),(0,S._)([(0,de.B)("viewModel.description")],bi.prototype,"description",void 0),(0,S._)([(0,de.B)("viewModel.fieldInfoMap")],bi.prototype,"fieldInfoMap",void 0),(0,S._)([(0,de.B)("viewModel.layer")],bi.prototype,"layer",void 0),(0,S._)([(0,de.B)("viewModel.mediaInfos")],bi.prototype,"mediaInfos",void 0),(0,S._)([(0,de.B)("viewModel.popupTemplate")],bi.prototype,"popupTemplate",void 0),(0,S._)([(0,de.B)("viewModel.relatedInfos")],bi.prototype,"relatedInfos",void 0),(0,S._)([(0,de.B)("viewModel.title")],bi.prototype,"title",void 0),(0,S._)([(0,U.Cb)({type:Vr})],bi.prototype,"viewModel",void 0),(0,S._)([(0,U.Cb)(),(0,Rt.H)("esri/widgets/Feature/t9n/Feature")],bi.prototype,"messages",void 0);var _i=bi=(0,S._)([(0,G.j)("esri.widgets.Feature.FeatureMedia")],bi),wi=n(29189),ki=(n(96804),n(67176),n(8304),n(47106),n(22505)),Ci=n(76471),xi=n(82034),Zi=n(41021);function Mi(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Ii(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ii(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Ii(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ri(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Oi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ri(Object(n),!0).forEach((function(t){(0,H.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ri(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Pi=["$datastore","$map","$layer","$aggregatedfeatures"],Ti=V.Z.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");function Si(e){return"string"==typeof e?at(ot(e)):Array.isArray(e)?function(e){return'<ul class="esri-widget__list">'.concat(e.map((function(e){return"<li>".concat("string"==typeof e?at(ot(e)):e,"</li>")})).join(""),"</ul>")}(e):"esri.arcade.Dictionary"===(null==e?void 0:e.declaredClass)?function(e){return'<table class="esri-widget__table">'.concat(e.keys().map((function(t){var n=e.field(t);return"<tr><th>".concat(t,"</th><td>").concat("string"==typeof n?at(ot(n)):n,"</td></tr>")})).join(""),"</table>")}(e):e}function Ei(e){var t=e.aggregatedFeatures,n=e.arcadeUtils,r=e.featureSetVars,i=e.context,o=e.viewInfo,a=e.map,s=e.graphic,u=e.interceptor;r.forEach((function(e){var r=e.toLowerCase(),c={map:a,spatialReference:o.sr,interceptor:u};if("$map"===r&&(i.vars[r]=n.convertMapToFeatureSetCollection(c)),"$layer"===r&&(i.vars[r]=n.convertFeatureLayerToFeatureSet({layer:s.sourceLayer,spatialReference:o.sr,interceptor:u})),"$datastore"===r&&(i.vars[r]=n.convertServiceUrlToWorkspace({url:s.sourceLayer.url,spatialReference:o.sr,interceptor:u})),"$aggregatedfeatures"===r){var p=s.layer,f=p.fields,d=p.objectIdField,h=p.geometryType,v=p.spatialReference,y=p.displayField,m=new l.default(Oi(Oi({fields:f,objectIdField:d,geometryType:h,spatialReference:v,displayField:y},"feature"===p.type?{templates:p.templates,typeIdField:p.typeIdField,types:p.types}:null),{},{source:t}));i.vars[r]=n.convertFeatureLayerToFeatureSet({layer:m,spatialReference:o.sr,interceptor:u})}}))}function Ai(){return Promise.all([n.e(9351),n.e(317)]).then(n.bind(n,93772))}function ji(e){return Fi.apply(this,arguments)}function Fi(){return(Fi=(0,O.Z)(T().mark((function e(t){var n,r,i,o,a,s,u,l;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.graphic,r=t.view,i=n.isAggregate,o=n.layer,i&&o&&"2d"===(null==r?void 0:r.type)){e.next=4;break}return e.abrupt("return",[]);case 4:return e.next=6,r.whenLayerView(o);case 6:if((a=e.sent).createQuery&&a.queryFeatures){e.next=9;break}return e.abrupt("return",[]);case 9:return(s=a.createQuery()).aggregateIds=[n.getObjectId()],e.next=13,a.queryFeatures(s);case 13:return u=e.sent,l=u.features,e.abrupt("return",l);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Li(e){return Di.apply(this,arguments)}function Di(){return Di=(0,O.Z)(T().mark((function e(t){var n,r,i,o,a,s,u,l,c,p,f,d,h,v,y;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.expressionInfo,r=t.arcadeUtils,i=t.interceptor,o=t.spatialReference,a=t.map,s=t.graphic,u=t.view,n&&n.expression){e.next=3;break}return e.abrupt("return",null);case 3:return l=r.createSyntaxTree(n.expression),c=Pi.filter((function(e){return r.hasVariable(l,e)})),e.next=7,(0,gr.$6)([ji({graphic:s,view:u}),r.loadScriptDependencies(l,!0,c)]);case 7:return p=e.sent,f=(0,w.Z)(p,1),d=f[0],h=r.getViewInfo({spatialReference:o}),(v=r.createExecContext(s,h)).interceptor=i,v.useAsync=!0,Ei({aggregatedFeatures:d,arcadeUtils:r,featureSetVars:c,context:v,viewInfo:h,map:a,graphic:s,interceptor:i}),y=r.createFunction(l,v),e.abrupt("return",r.executeAsyncFunction(y,v).catch((function(e){return Ti.error("arcade-execution-error",{error:e,graphic:s,expressionInfo:n})})));case 15:case"end":return e.stop()}}),e)}))),Di.apply(this,arguments)}function Vi(e){return Bi.apply(this,arguments)}function Bi(){return(Bi=(0,O.Z)(T().mark((function e(t){var n,r,i,o,a,s,u,l,c,p,f,d,h,v;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.expressionInfos,r=t.spatialReference,i=t.graphic,o=t.interceptor,a=t.map,s=t.view,n&&n.length){e.next=3;break}return e.abrupt("return",{});case 3:return e.next=5,Ai();case 5:u=e.sent,l={},c=Mi(n);try{for(c.s();!(p=c.n()).done;)f=p.value,l["expression/".concat(f.name)]=Li({expressionInfo:f,arcadeUtils:u,interceptor:o,spatialReference:r,map:a,graphic:i,view:s})}catch(y){c.e(y)}finally{c.f()}return e.next=11,(0,gr.as)(l);case 11:for(v in d=e.sent,h={},d)h[v]=Si(d[v].value);return e.abrupt("return",h);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ni(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var zi=function(e){(0,M.Z)(n,e);var t=Ni(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e))._abortController=null,r.expressionInfo=null,r.graphic=null,r.contentElement=null,r.contentElementViewModel=null,r.interceptor=null,r.view=null,r._cancelQuery=function(){var e=(0,x.Z)(r)._abortController;e&&e.abort(),r._abortController=null},r._createVM=function(){var e,t,n=null==(e=r.contentElement)?void 0:e.type;null==(t=r.contentElementViewModel)||t.destroy();var i="fields"===n?new or:"media"===n?new Vr:"text"===n?new Hn:null;r._set("contentElementViewModel",i)},r._compile=(0,O.Z)(T().mark((function e(){var t;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r._cancelQuery(),t=new AbortController,r._abortController=t,e.next=5,r._compileExpression();case 5:r._abortController===t&&(r._abortController=null);case 6:case"end":return e.stop()}}),e)}))),r._compileThrottled=(0,fe.P)(r._compile,1,(0,x.Z)(r)),r._compileExpression=(0,O.Z)(T().mark((function e(){var t,n,i,o,a,s,u,l,c,p,f,d,h;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(0,x.Z)(r),n=t.expressionInfo,i=t.graphic,o=t.interceptor,a=t.spatialReference,s=t.map,u=t.view,l=t._abortController,n&&i&&a&&s&&u){e.next=3;break}return e.abrupt("return",void r._set("contentElement",null));case 3:return e.next=5,Ai();case 5:if(c=e.sent,l===r._abortController){e.next=8;break}return e.abrupt("return");case 8:return e.next=10,Li({arcadeUtils:c,expressionInfo:n,graphic:i,interceptor:o,map:s,spatialReference:a,view:u});case 10:if((p=e.sent)&&"esri.arcade.Dictionary"===p.declaredClass){e.next=13;break}return e.abrupt("return",void r._set("contentElement",null));case 13:return e.next=15,(0,wi.w)(p,l.signal);case 15:f=e.sent,d=null==f?void 0:f.type,h="media"===d?Ci.Z.fromJSON(f):"text"===d?xi.Z.fromJSON(f):"fields"===d?ki.Z.fromJSON(f):null,r._set("contentElement",h);case 19:case"end":return e.stop()}}),e)}))),r.handles.add([(0,N.S1)((0,x.Z)(r),["expressionInfo","graphic","map","spatialReference","view"],r._compileThrottled),(0,N.S1)((0,x.Z)(r),"contentElement",r._createVM)]),r}return(0,C.Z)(n,[{key:"destroy",value:function(){var e;this._cancelQuery(),null==(e=this.contentElementViewModel)||e.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}},{key:"spatialReference",get:function(){var e;return(null==(e=this.view)?void 0:e.spatialReference)||null},set:function(e){void 0!==e?this._override("spatialReference",e):this._clearOverride("spatialReference")}},{key:"state",get:function(){var e=this._abortController,t=this.contentElement,n=this.contentElementViewModel;return e?"loading":t||n?"ready":"disabled"}},{key:"map",get:function(){var e;return(null==(e=this.view)?void 0:e.map)||null},set:function(e){void 0!==e?this._override("map",e):this._clearOverride("map")}}]),n}((0,_e.p)(re.Z));(0,S._)([(0,U.Cb)()],zi.prototype,"_abortController",void 0),(0,S._)([(0,U.Cb)({type:Zi.Z})],zi.prototype,"expressionInfo",void 0),(0,S._)([(0,U.Cb)({type:E.Z})],zi.prototype,"graphic",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],zi.prototype,"contentElement",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],zi.prototype,"contentElementViewModel",void 0),(0,S._)([(0,U.Cb)()],zi.prototype,"interceptor",void 0),(0,S._)([(0,U.Cb)()],zi.prototype,"spatialReference",null),(0,S._)([(0,U.Cb)({readOnly:!0})],zi.prototype,"state",null),(0,S._)([(0,U.Cb)()],zi.prototype,"map",null),(0,S._)([(0,U.Cb)()],zi.prototype,"view",void 0);var Ui=zi=(0,S._)([(0,G.j)("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],zi);function Wi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var qi="esri-icon-loading-indicator esri-rotating",Gi="esri-feature-expression",Hi="esri-feature__loading-container",Ki="esri-feature__loading-spinner",Yi=function(e){(0,M.Z)(n,e);var t=Wi(n);function n(e,r){var i;return(0,k.Z)(this,n),(i=t.call(this,e,r)).viewModel=new Ui,i}return(0,C.Z)(n,[{key:"initialize",value:function(){var e=this;(0,N.S1)(this,"viewModel.contentElementViewModel",(function(){return e._setupExpressionWidget()}))}},{key:"destroy",value:function(){var e;null==(e=this._contentWidget)||e.destroy(),this._contentWidget=null}},{key:"renderLoading",value:function(){return(0,Ot.u)("div",{key:"loading-container",class:Hi},(0,Ot.u)("span",{class:this.classes(qi,Ki)}))}},{key:"render",value:function(){var e,t=this.viewModel.state;return(0,Ot.u)("div",{class:Gi},"loading"===t?this.renderLoading():"disabled"===t?null:null==(e=this._contentWidget)?void 0:e.render())}},{key:"_setupExpressionWidget",value:function(){var e,t=this.viewModel,n=t.contentElementViewModel,r=t.contentElement,i=null==r?void 0:r.type;null==(e=this._contentWidget)||e.destroy(),this._contentWidget=null;var o=n?"fields"===i?new vr({viewModel:n}):"media"===i?new _i({viewModel:n}):"text"===i?new er({viewModel:n}):null:null;this._contentWidget=o,this.scheduleRender()}}]),n}(ve.Z);(0,S._)([(0,U.Cb)({type:Ui})],Yi.prototype,"viewModel",void 0);var Ji,$i=Yi=(0,S._)([(0,G.j)("esri.widgets.Feature.FeatureExpression")],Yi),Qi=(0,C.Z)((function e(t,n){(0,k.Z)(this,e),this.preLayerQueryCallback=t,this.preRequestCallback=n,this.preLayerQueryCallback||(this.preLayerQueryCallback=function(e){}),this.preRequestCallback||(this.preLayerQueryCallback=function(e){})}));function Xi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function eo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Xi(Object(n),!0).forEach((function(t){(0,H.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function to(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var no="content-view-models",ro="esri.widgets.FeatureViewModel",io=V.Z.getLogger(ro),oo={attachmentsContent:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0},ao=Ji=function(e){(0,M.Z)(s,e);var t,n,r,i,o,a=to(s);function s(e){var t;return(0,k.Z)(this,s),(t=a.call(this,e))._handles=new Y.Z,t._error=null,t._featureAbortController=null,t.graphicChangedThrottled=(0,fe.P)(t.graphicChanged,1,(0,x.Z)(t)),t._expressionAttributes=null,t._graphicExpressionAttributes=null,t.abilities=eo({},oo),t.content=null,t.contentViewModels=[],t.defaultPopupTemplateEnabled=!1,t.formattedAttributes=null,t.lastEditInfo=null,t.relatedInfos=new Map,t.title="",t.view=null,t._isAllowedContentType=function(e){var n=(0,x.Z)(t).abilities;return"attachments"===e.type&&n.attachmentsContent||"custom"===e.type&&n.customContent||"fields"===e.type&&n.fieldsContent||"media"===e.type&&n.mediaContent||"text"===e.type&&n.textContent||"expression"===e.type&&n.expressionContent},t._handles.add((0,N.S1)((0,x.Z)(t),["graphic","_effectivePopupTemplate","abilities"],(function(){return t.graphicChangedThrottled()}))),t}return(0,C.Z)(s,[{key:"destroy",value:function(){this._clear(),this._cancelFeatureQuery(),this._error=null,this._handles.destroy(),this._handles=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}},{key:"_effectivePopupTemplate",get:function(){return(0,B.pC)(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}},{key:"_fieldInfoMap",get:function(){return function(e,t){var n=new Map;return e&&e.forEach((function(e){var r=Ge(e.fieldName,t);e.fieldName=r,n.set(r.toLowerCase(),e)})),n}(it(this._effectivePopupTemplate),this._sourceLayer)}},{key:"_sourceLayer",get:function(){return Be(this.graphic)}},{key:"castAbilities",value:function(e){return eo(eo({},oo),e)}},{key:"state",get:function(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}},{key:"graphic",set:function(e){this._set("graphic",e?e.clone():null)}},{key:"spatialReference",get:function(){return this.get("view.spatialReference")||null},set:function(e){void 0!==e?this._override("spatialReference",e):this._clearOverride("spatialReference")}},{key:"map",get:function(){return this.get("view.map")||null},set:function(e){void 0!==e?this._override("map",e):this._clearOverride("map")}},{key:"waitingForContent",get:function(){return!!this._featureAbortController}},{key:"setActiveMedia",value:function(e,t){var n=this.contentViewModels[e];n instanceof Vr&&n.setActiveMedia(t)}},{key:"nextMedia",value:function(e){var t=this.contentViewModels[e];t instanceof Vr&&t.next()}},{key:"previousMedia",value:function(e){var t=this.contentViewModels[e];t instanceof Vr&&t.previous()}},{key:"_clear",value:function(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}},{key:"graphicChanged",value:(o=(0,O.Z)(T().mark((function e(){var t,n;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._cancelFeatureQuery(),this._error=null,this._clear(),t=this.graphic){e.next=4;break}return e.abrupt("return");case 4:return n=new AbortController,this._featureAbortController=n,e.prev=6,e.next=9,this._queryFeature({signal:n.signal});case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(6),(0,gr.D_)(e.t0)||(this._error=e.t0,io.error("error","The popupTemplate could not be displayed for this feature.",{error:e.t0,graphic:t,popupTemplate:this._effectivePopupTemplate}));case 14:this._featureAbortController===n&&(this._featureAbortController=null);case 15:case"end":return e.stop()}}),e,this,[[6,11]])}))),function(){return o.apply(this,arguments)})},{key:"_cancelFeatureQuery",value:function(){var e=this._featureAbortController;e&&e.abort(),this._featureAbortController=null}},{key:"_compileContentElement",value:function(e,t){return"attachments"===e.type?this._compileAttachments(e,t):"custom"===e.type?this._compileCustom(e,t):"fields"===e.type?this._compileFields(e,t):"media"===e.type?this._compileMedia(e,t):"text"===e.type?this._compileText(e,t):"expression"===e.type?this._compileExpression(e,t):void 0}},{key:"_compileContent",value:function(e){var t=this;if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.filter(this._isAllowedContentType).map((function(e,n){return t._compileContentElement(e,n)})):"string"==typeof e?this._compileText(new xi.Z({text:e}),0).text:e}},{key:"_destroyContentViewModels",value:function(){var e;null==(e=this._handles)||e.remove(no),this.contentViewModels.forEach((function(e){return e&&!e.destroyed&&e.destroy()})),this._set("contentViewModels",[])}},{key:"_setExpressionContentVM",value:function(e,t){var n=this.formattedAttributes,r=e.contentElement,i=e.contentElementViewModel,o=null==r?void 0:r.type;i&&o&&("fields"===o&&(this._createFieldsFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:n}),i.set(this._createFieldsVMParams(r,t))),"media"===o&&(this._createMediaFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:n}),i.set(this._createMediaVMParams(r,t))),"text"===o&&i.set(this._createTextVMParams(r)))}},{key:"_compileExpression",value:function(e,t){var n=this,r=e.expressionInfo,i=this.graphic,o=this.map,a=this.spatialReference,s=this.view,u=new Ui({expressionInfo:r,graphic:i,interceptor:Ji.interceptor,map:o,spatialReference:a,view:s});return this.contentViewModels[t]=u,this._handles.add((0,N.S1)(u,"contentElementViewModel",(function(){return n._setExpressionContentVM(u,t)})),no),e}},{key:"_compileAttachments",value:function(e,t){var n=this.graphic,r=e.description,i=e.title;return this.contentViewModels[t]=new Pn(eo({graphic:n},this._compileTitleAndDesc({title:i,description:r}))),e}},{key:"_compileCustom",value:function(e,t){var n=this.graphic,r=e.creator,i=e.destroyer;return this.contentViewModels[t]=new Hn({graphic:n,creator:r,destroyer:i}),e}},{key:"_compileTitleAndDesc",value:function(e){var t=e.title,n=e.description,r=this._fieldInfoMap,i=this._sourceLayer,o=this.graphic,a=this.formattedAttributes,s=this._expressionAttributes,u=o.attributes,l=a.global;return{title:Ye({attributes:u,fieldInfoMap:r,globalAttributes:l,expressionAttributes:s,layer:i,text:t}),description:Ye({attributes:u,fieldInfoMap:r,globalAttributes:l,expressionAttributes:s,layer:i,text:n})}}},{key:"_createFieldsVMParams",value:function(e,t){var n=this._effectivePopupTemplate,r=this.formattedAttributes,i=eo(eo({},r.global),r.content[t]),o=(null==e?void 0:e.fieldInfos)||(null==n?void 0:n.fieldInfos),a=null==o?void 0:o.filter((function(e){var t=e.fieldName;return We(t)||vt(t)||i.hasOwnProperty(t)})),s=null==n?void 0:n.expressionInfos,u=e.description,l=e.title;return eo({attributes:i,expressionInfos:s,fieldInfos:a},this._compileTitleAndDesc({title:l,description:u}))}},{key:"_compileFields",value:function(e,t){var n=e.clone(),r=new or(this._createFieldsVMParams(e,t));return this.contentViewModels[t]=r,n.fieldInfos=r.formattedFieldInfos.slice(0),n}},{key:"_createMediaVMParams",value:function(e,t){var n=this.graphic,r=this._fieldInfoMap,i=this.formattedAttributes,o=this._effectivePopupTemplate,a=this.relatedInfos,s=this._sourceLayer,u=this._expressionAttributes,l=n.attributes,c=e.description,p=e.mediaInfos,f=e.title;return eo({activeMediaInfoIndex:e.activeMediaInfoIndex||0,attributes:l,layer:s,fieldInfoMap:r,formattedAttributes:eo(eo({},i.global),i.content[t]),expressionAttributes:u,mediaInfos:p,popupTemplate:o,relatedInfos:a},this._compileTitleAndDesc({title:f,description:c}))}},{key:"_compileMedia",value:function(e,t){var n=e.clone(),r=new Vr(this._createMediaVMParams(e,t));return n.mediaInfos=r.formattedMediaInfos.slice(0),this.contentViewModels[t]=r,n}},{key:"_createTextVMParams",value:function(e){var t=this.graphic,n=this._fieldInfoMap,r=this._sourceLayer,i=this._expressionAttributes;if(e&&e.text){var o=t.attributes,a=this.formattedAttributes.global;e.text=Ye({attributes:o,fieldInfoMap:n,globalAttributes:a,expressionAttributes:i,layer:r,text:e.text})}return{graphic:t,creator:e.text}}},{key:"_compileText",value:function(e,t){var n=e.clone();return this.contentViewModels[t]=new Hn(this._createTextVMParams(n)),n}},{key:"_compileLastEditInfo",value:function(){var e=this._effectivePopupTemplate,t=this._sourceLayer,n=this.graphic;if(e){var r=e.lastEditInfoEnabled,i=null==t?void 0:t.editFieldsInfo;return r&&i?rt(i,n.attributes):void 0}}},{key:"_compileTitle",value:function(e){var t=this._fieldInfoMap,n=this._sourceLayer,r=this.graphic,i=this._expressionAttributes;return Ye({attributes:r.attributes,fieldInfoMap:t,globalAttributes:this.formattedAttributes.global,expressionAttributes:i,layer:n,text:e})}},{key:"_getTitle",value:(i=(0,O.Z)(T().mark((function e(){var t,n,r;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._effectivePopupTemplate,n=this.graphic,r=null==t?void 0:t.title,e.abrupt("return",Ne(r,{graphic:n}));case 2:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"_getContent",value:(r=(0,O.Z)(T().mark((function e(){var t,n,r;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._effectivePopupTemplate,n=this.graphic,r=null==t?void 0:t.content,e.abrupt("return",Ne(r,{graphic:n}));case 2:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"_queryFeature",value:(n=(0,O.Z)(T().mark((function e(t){var n,r,i,o,a,s,u,l,c,p,f,d;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._featureAbortController,r=this._sourceLayer,i=this.graphic,o=this._effectivePopupTemplate,a=this.spatialReference,s=this.map,u=this.view,e.next=9,(0,gr.as)({content:this._getContent(),title:this._getTitle()});case 9:if(l=e.sent,c=l.content.value,p=l.title.value,n===this._featureAbortController&&i){e.next=14;break}return e.abrupt("return");case 14:return e.next=16,dt({graphic:i,popupTemplate:o,layer:r,spatialReference:a},t);case 16:return e.next=18,(0,gr.as)({checkForRelatedFeatures:this._checkForRelatedFeatures(t),expressionAttributes:Vi({expressionInfos:null==o?void 0:o.expressionInfos,spatialReference:a,graphic:i,map:s,interceptor:Ji.interceptor,view:u})});case 18:f=e.sent,d=f.expressionAttributes.value,n===this._featureAbortController&&i&&(this._expressionAttributes=d,this._graphicExpressionAttributes=eo(eo({},i.attributes),d),this._set("formattedAttributes",this._createFormattedAttributes(c)),this._set("title",this._compileTitle(p)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(c)||null));case 21:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"_createMediaFormattedAttributes",value:function(e){var t=e.contentElement,n=e.contentElementIndex,r=e.formattedAttributes,i=this._effectivePopupTemplate,o=this.graphic,a=this.relatedInfos,s=this._sourceLayer,u=this._fieldInfoMap,l=this._graphicExpressionAttributes;r.content[n]=ut({fieldInfos:null==i?void 0:i.fieldInfos,graphic:o,attributes:eo(eo({},l),t.attributes),layer:s,fieldInfoMap:u,relatedInfos:a})}},{key:"_createFieldsFormattedAttributes",value:function(e){var t=e.contentElement,n=e.contentElementIndex,r=e.formattedAttributes;if(t.fieldInfos){var i=this.graphic,o=this.relatedInfos,a=this._sourceLayer,s=this._fieldInfoMap,u=this._graphicExpressionAttributes;r.content[n]=ut({fieldInfos:t.fieldInfos,graphic:i,attributes:eo(eo({},u),t.attributes),layer:a,fieldInfoMap:s,relatedInfos:o})}}},{key:"_createFormattedAttributes",value:function(e){var t=this,n=this._effectivePopupTemplate,r=this.graphic,i=this.relatedInfos,o=this._sourceLayer,a=this._fieldInfoMap,s=this._graphicExpressionAttributes,u={global:ut({fieldInfos:null==n?void 0:n.fieldInfos,graphic:r,attributes:s,layer:o,fieldInfoMap:a,relatedInfos:i}),content:[]};return Array.isArray(e)&&e.forEach((function(e,n){"fields"===e.type&&t._createFieldsFormattedAttributes({contentElement:e,contentElementIndex:n,formattedAttributes:u}),"media"===e.type&&t._createMediaFormattedAttributes({contentElement:e,contentElementIndex:n,formattedAttributes:u})})),u}},{key:"_checkForRelatedFeatures",value:function(e){var t=this.graphic,n=this._effectivePopupTemplate;return this._queryRelatedInfos(t,it(n),e)}},{key:"_queryRelatedInfos",value:(t=(0,O.Z)(T().mark((function e(t,n,r){var i,o,a,s,u,l,c=this;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.relatedInfos,o=this._sourceLayer,i.clear(),!(0,B.pC)(o.associatedLayer)){e.next=8;break}return e.next=5,o.associatedLayer.load(r);case 5:e.t0=e.sent,e.next=9;break;case 8:e.t0=o;case 9:if(a=e.t0){e.next=12;break}return e.abrupt("return");case 12:if(s=n.filter((function(e){return e&&vt(e.fieldName)})),s&&s.length){e.next=15;break}return e.abrupt("return");case 15:return n.forEach((function(e){return c._configureRelatedInfo(e,a)})),e.next=18,Ar({relatedInfos:i,layer:a},r);case 18:return u=e.sent,Object.keys(u).forEach((function(e){var t,n=i.get(e.toString()),r=null==(t=u[e])?void 0:t.value;n&&r&&(n.layerInfo=r.data)})),e.next=22,jr({graphic:t,relatedInfos:i,layer:a},r);case 22:l=e.sent,Object.keys(l).forEach((function(e){var t;Pr(null==(t=l[e])?void 0:t.value,i.get(e.toString()))}));case 24:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})},{key:"_configureRelatedInfo",value:function(e,t){var n=this.relatedInfos,r=Mr(e.fieldName);if(r){var i=r.layerId,o=r.fieldName;if(i){var a=n.get(i.toString())||Or(i,t);a&&(function(e){var t=e.relatedInfo,n=e.fieldName,r=e.fieldInfo;if(t.relatedFields.push(n),r.statisticType){var i=new _r.Z({statisticType:r.statisticType,onStatisticField:n,outStatisticFieldName:n});t.outStatistics.push(i)}}({relatedInfo:a,fieldName:o,fieldInfo:e}),this.relatedInfos.set(i,a))}}}}]),s}(re.Z);ao.interceptor=new Qi((function(e){var t=e.query,n=e.layer,r=e.method;gt({layer:n,method:r,query:t,definitionExpression:"".concat(n.definitionExpression," ").concat(n.serviceDefinitionExpression)})}),(function(e){var t=e.queryPayload,n=e.layer,r=e.method;gt({layer:n,method:r,query:t,definitionExpression:"".concat(n.definitionExpression," ").concat(n.serviceDefinitionExpression)})})),(0,S._)([(0,U.Cb)()],ao.prototype,"_error",void 0),(0,S._)([(0,U.Cb)()],ao.prototype,"_featureAbortController",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],ao.prototype,"_effectivePopupTemplate",null),(0,S._)([(0,U.Cb)({readOnly:!0})],ao.prototype,"_fieldInfoMap",null),(0,S._)([(0,U.Cb)({readOnly:!0})],ao.prototype,"_sourceLayer",null),(0,S._)([(0,U.Cb)()],ao.prototype,"abilities",void 0),(0,S._)([(0,he.p)("abilities")],ao.prototype,"castAbilities",null),(0,S._)([(0,U.Cb)({readOnly:!0})],ao.prototype,"content",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],ao.prototype,"contentViewModels",void 0),(0,S._)([(0,U.Cb)({type:Boolean})],ao.prototype,"defaultPopupTemplateEnabled",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],ao.prototype,"state",null),(0,S._)([(0,U.Cb)({readOnly:!0})],ao.prototype,"formattedAttributes",void 0),(0,S._)([(0,U.Cb)({type:E.Z,value:null})],ao.prototype,"graphic",null),(0,S._)([(0,U.Cb)({readOnly:!0})],ao.prototype,"lastEditInfo",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],ao.prototype,"relatedInfos",void 0),(0,S._)([(0,U.Cb)()],ao.prototype,"spatialReference",null),(0,S._)([(0,U.Cb)({readOnly:!0})],ao.prototype,"title",void 0),(0,S._)([(0,U.Cb)()],ao.prototype,"map",null),(0,S._)([(0,U.Cb)({readOnly:!0})],ao.prototype,"waitingForContent",null),(0,S._)([(0,U.Cb)()],ao.prototype,"view",void 0);var so=ao=Ji=(0,S._)([(0,G.j)(ro)],ao);n(97182);function uo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var lo=function(e){var t=function(e){(0,M.Z)(n,e);var t=uo(n);function n(){var e;return(0,k.Z)(this,n),(e=t.apply(this,arguments)).renderNodeContent=function(t){return(0,Kn.Qd)(t)&&!t.destroyed?(0,Ot.u)("div",{key:t},t.render()):t instanceof HTMLElement?(0,Ot.u)("div",{key:t,bind:t,afterCreate:e._attachToNode}):(0,Kn.o)(t)?(0,Ot.u)("div",{key:t,bind:t.domNode,afterCreate:e._attachToNode}):null},e}return(0,C.Z)(n,[{key:"_attachToNode",value:function(e){e.appendChild(this)}}]),n}(e);return t=(0,S._)([(0,G.j)("esri.widgets.Feature.ContentMixin")],t)},co=n(70134);function po(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function fo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?po(Object(n),!0).forEach((function(t){(0,H.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):po(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ho(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var vo="esri-icon-loading-indicator esri-rotating",yo="esri-widget",mo="esri-feature",go="esri-feature__size-container",bo="esri-feature__title",_o="esri-feature__main-container",wo="esri-feature__content-element",ko="esri-feature__text",Co="esri-feature__last-edited-info",xo="esri-feature__loading-container",Zo="esri-feature__loading-spinner",Mo={title:!0,content:!0,lastEditedInfo:!0},Io=function(e){(0,M.Z)(r,e);var t=ho(r);function r(e,n){var i;return(0,k.Z)(this,r),(i=t.call(this,e,n))._contentWidgets=[],i.graphic=null,i.defaultPopupTemplateEnabled=!1,i.headingLevel=2,i.label=void 0,i.messages=null,i.messagesCommon=null,i.messagesURIUtils=null,i.spatialReference=null,i.title=null,i.visibleElements=fo({},Mo),i.map=null,i.view=null,i.viewModel=new so,i}return(0,C.Z)(r,[{key:"initialize",value:function(){var e=this;this.own((0,N.S1)(this,"viewModel.contentViewModels",(function(){return e._setupContentWidgets()})))}},{key:"loadDependencies",value:function(){return n.e(7337).then(n.bind(n,27337))}},{key:"destroy",value:function(){this._destroyContentWidgets()}},{key:"castVisibleElements",value:function(e){return fo(fo({},Mo),e)}},{key:"render",value:function(){var e=this.viewModel.state,t=(0,Ot.u)("div",{class:go,key:"container"},this.renderTitle(),"error"===e?this.renderError():"loading"===e?this.renderLoading():this.renderContentContainer());return(0,Ot.u)("div",{class:this.classes(mo,yo)},t)}},{key:"setActiveMedia",value:function(e,t){this.viewModel.setActiveMedia(e,t)}},{key:"nextMedia",value:function(e){this.viewModel.nextMedia(e)}},{key:"previousMedia",value:function(e){this.viewModel.previousMedia(e)}},{key:"renderError",value:function(){var e=this.messagesCommon,t=this.messages,n=this.visibleElements;return(0,Ot.u)("calcite-notice",{active:!0,color:"red",icon:"exclamation-mark-circle",scale:"s"},n.title?(0,Ot.u)("div",{key:"error-title",slot:"title"},e.errorMessage):null,(0,Ot.u)("div",{key:"error-message",slot:"message"},t.loadingError))}},{key:"renderLoading",value:function(){return(0,Ot.u)("div",{key:"loading-container",class:xo},(0,Ot.u)("span",{class:this.classes(vo,Zo)}))}},{key:"renderContentContainer",value:function(){return this.visibleElements.content?(0,Ot.u)("div",{class:_o},[this.renderContent(),this.renderLastEditInfo()]):null}},{key:"renderTitle",value:function(){var e=this.visibleElements,t=this.title;return e.title?(0,Ot.u)(An,{level:this.headingLevel,class:bo,innerHTML:t}):null}},{key:"renderContent",value:function(){var e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?(0,Ot.u)("div",{key:"".concat(t,"-content-elements")},e.map(this.renderContentElement,this)):null;if("string"==typeof e){var n=this._contentWidgets[0];return!n||n.destroyed?null:(0,Ot.u)("div",{key:"".concat(t,"-content")},n.render())}return this.renderNodeContent(e)}},{key:"renderContentElement",value:function(e,t){var n=this.visibleElements;if("boolean"!=typeof n.content&&!n.content[e.type])return null;switch(e.type){case"attachments":return this.renderAttachments(t);case"custom":return this.renderCustom(e,t);case"fields":return this.renderFields(t);case"media":return this.renderMedia(t);case"text":return this.renderText(e,t);case"expression":return this.renderExpression(t);default:return null}}},{key:"renderAttachments",value:function(e){var t=this._contentWidgets[e];if(!t||t.destroyed)return null;var n=t.viewModel,r=n.state,i=n.attachmentInfos;return"loading"===r||i.length>0?(0,Ot.u)("div",{key:this._buildKey("attachments-element",e),class:this.classes(wo)},t.render()):null}},{key:"renderExpression",value:function(e){var t=this._contentWidgets[e];return!t||t.destroyed?null:(0,Ot.u)("div",{key:this._buildKey("expression-element",e),class:wo},t.render())}},{key:"renderCustom",value:function(e,t){var n=e.creator,r=this._contentWidgets[t];return!r||r.destroyed?null:n?(0,Ot.u)("div",{key:this._buildKey("custom-element",t),class:wo},r.render()):null}},{key:"renderFields",value:function(e){var t=this._contentWidgets[e];return!t||t.destroyed?null:(0,Ot.u)("div",{key:this._buildKey("fields-element",e),class:wo},t.render())}},{key:"renderMedia",value:function(e){var t=this._contentWidgets[e];return!t||t.destroyed?null:(0,Ot.u)("div",{key:this._buildKey("media-element",e),class:wo},t.render())}},{key:"renderLastEditInfo",value:function(){var e=this.visibleElements,t=this.messages,n=this.viewModel.lastEditInfo;if(!n||!e.lastEditedInfo)return null;var r=n.date,i=n.user,o="edit"===n.type?i?t.lastEditedByUser:t.lastEdited:i?t.lastCreatedByUser:t.lastCreated,a=(0,co.n)(o,{date:r,user:i});return(0,Ot.u)("div",{key:"edit-info-element",class:this.classes(Co,wo)},a)}},{key:"renderText",value:function(e,t){var n=e.text,r=this._contentWidgets[t];return!r||r.destroyed?null:n?(0,Ot.u)("div",{key:this._buildKey("text-element",t),class:this.classes(wo,ko)},r.render()):null}},{key:"_buildKey",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return"".concat(e,"__").concat(this.get("viewModel.graphic.uid")||"0","-").concat(n.join("-"))}},{key:"_destroyContentWidget",value:function(e){e&&(e.viewModel=null,!e.destroyed&&e.destroy())}},{key:"_destroyContentWidgets",value:function(){var e=this;this._contentWidgets.forEach((function(t){return e._destroyContentWidget(t)})),this._contentWidgets=[]}},{key:"_setupContentWidgets",value:function(){var e=this;this._destroyContentWidgets();var t=this.headingLevel,n=this.visibleElements,r=this.get("viewModel.content"),i=this.viewModel.contentViewModels;if(Array.isArray(r))r.forEach((function(r,o){"attachments"===r.type&&(e._contentWidgets[o]=new Wn({displayType:r.displayType,headingLevel:n.title?t+1:t,viewModel:i[o]})),"fields"===r.type&&(e._contentWidgets[o]=new vr({viewModel:i[o]})),"media"===r.type&&(e._contentWidgets[o]=new _i({viewModel:i[o]})),"text"===r.type&&(e._contentWidgets[o]=new er({viewModel:i[o]})),"custom"===r.type&&(e._contentWidgets[o]=new er({viewModel:i[o]})),"expression"===r.type&&(e._contentWidgets[o]=new $i({viewModel:i[o]}))}),this);else{var o=i[0];o&&!o.destroyed&&(this._contentWidgets[0]=new er({viewModel:o}))}this.scheduleRender()}}]),r}(lo(ve.Z));(0,S._)([(0,de.B)("viewModel.graphic")],Io.prototype,"graphic",void 0),(0,S._)([(0,de.B)("viewModel.defaultPopupTemplateEnabled")],Io.prototype,"defaultPopupTemplateEnabled",void 0),(0,S._)([(0,U.Cb)()],Io.prototype,"headingLevel",void 0),(0,S._)([(0,U.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Io.prototype,"label",void 0),(0,S._)([(0,U.Cb)(),(0,Rt.H)("esri/widgets/Feature/t9n/Feature")],Io.prototype,"messages",void 0),(0,S._)([(0,U.Cb)(),(0,Rt.H)("esri/t9n/common")],Io.prototype,"messagesCommon",void 0),(0,S._)([(0,U.Cb)(),(0,Rt.H)("esri/widgets/support/t9n/uriUtils")],Io.prototype,"messagesURIUtils",void 0),(0,S._)([(0,de.B)("viewModel.spatialReference")],Io.prototype,"spatialReference",void 0),(0,S._)([(0,de.B)("viewModel.title")],Io.prototype,"title",void 0),(0,S._)([(0,U.Cb)()],Io.prototype,"visibleElements",void 0),(0,S._)([(0,he.p)("visibleElements")],Io.prototype,"castVisibleElements",null),(0,S._)([(0,de.B)("viewModel.map")],Io.prototype,"map",void 0),(0,S._)([(0,de.B)("viewModel.view")],Io.prototype,"view",void 0),(0,S._)([(0,U.Cb)({type:so})],Io.prototype,"viewModel",void 0);var Ro=Io=(0,S._)([(0,G.j)("esri.widgets.Feature")],Io),Oo=n(92332);function Po(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var To=function(e){(0,M.Z)(n,e);var t=Po(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e))._anchorHandles=new Y.Z,r.location=null,r.screenLocation=null,r.screenLocationEnabled=!1,r.view=null,r._anchorHandles.add([(0,N.YP)((0,x.Z)(r),["screenLocationEnabled","location","view.size","view.stationary"],(function(){return r._updateScreenPointAndHandle()})),(0,N.YP)((0,x.Z)(r),["view","view.ready"],(function(){return r._wireUpView()}))]),r}return(0,C.Z)(n,[{key:"destroy",value:function(){this.view=null,this._anchorHandles&&this._anchorHandles.destroy(),this._anchorHandles=null,this._viewpointHandle=null}},{key:"_wireUpView",value:function(){var e=this,t="view";if(this._anchorHandles.remove(t),this._viewpointHandle=null,this.get("view.ready")){this._setScreenLocation();var n=this.view,r="3d"===n.type?"camera":"viewpoint",i=(0,N.Wy)(n,r,(function(){return e._viewpointChange()}));this._anchorHandles.add(i,t),this._viewpointHandle=i,this._toggleWatchingViewpoint()}}},{key:"_viewpointChange",value:function(){this._setScreenLocation(),this.emit("view-change")}},{key:"_updateScreenPointAndHandle",value:function(){this._setScreenLocation(),this._toggleWatchingViewpoint()}},{key:"_toggleWatchingViewpoint",value:function(){var e=this._viewpointHandle,t=this.location,n=this.screenLocationEnabled;e&&(t&&n?e.resume():e.pause())}},{key:"_setScreenLocation",value:function(){var e=this.location,t=this.view,n=this.screenLocationEnabled,r=this.get("view.ready"),i=n&&r&&(0,B.pC)(e)?t.toScreen(e):null;this._set("screenLocation",i)}}]),n}(Oo.Z.EventedAccessor);(0,S._)([(0,U.Cb)()],To.prototype,"location",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],To.prototype,"screenLocation",void 0),(0,S._)([(0,U.Cb)()],To.prototype,"screenLocationEnabled",void 0),(0,S._)([(0,U.Cb)()],To.prototype,"view",void 0);var So=To=(0,S._)([(0,G.j)("esri.widgets.support.AnchorElementViewModel")],To);function Eo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Ao=function(e){(0,M.Z)(n,e);var t=Eo(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).visible=!1,r}return(0,C.Z)(n)}(So);(0,S._)([(0,U.Cb)()],Ao.prototype,"visible",void 0);var jo=Ao=(0,S._)([(0,G.j)("esri.widgets.CompassViewModel")],Ao);function Fo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Lo="esri-spinner",Do="esri-spinner--start",Vo="esri-spinner--finish",Bo=function(e){(0,M.Z)(n,e);var t=Fo(n);function n(e,r){var i;return(0,k.Z)(this,n),(i=t.call(this,e,r))._animationDelay=500,i._animationPromise=null,i.location=null,i.view=null,i.viewModel=new jo,i.visible=!1,i}return(0,C.Z)(n,[{key:"initialize",value:function(){var e=this;this.own([(0,N.YP)(this,"visible",(function(t){return e._visibleChange(t)}))])}},{key:"destroy",value:function(){this._animationPromise=null}},{key:"show",value:function(e){var t=this,n=e.location,r=e.promise;n&&(this.viewModel.location=n),this.visible=!0;r&&r.catch((function(){})).then((function(){return t.hide()}))}},{key:"hide",value:function(){this.visible=!1}},{key:"render",value:function(){var e,t=this.visible,n=!!this.viewModel.screenLocation,r=t&&n,i=!t&&n,o=(e={},(0,H.Z)(e,Do,r),(0,H.Z)(e,Vo,i),e),a=this._getPositionStyles();return(0,Ot.u)("div",{class:this.classes(Lo,o),styles:a})}},{key:"_visibleChange",value:function(e){var t=this;if(e)this.viewModel.screenLocationEnabled=!0;else{var n=(0,gr.e4)(this._animationDelay);this._animationPromise=n,n.catch((function(){})).then((function(){t._animationPromise===n&&(t.viewModel.screenLocationEnabled=!1,t._animationPromise=null)}))}}},{key:"_getPositionStyles",value:function(){var e=this.viewModel,t=e.screenLocation,n=e.view;if(!n||(0,B.Wi)(t))return{};var r=n.padding;return{left:t.x-r.left+"px",top:t.y-r.top+"px"}}}]),n}(ve.Z);(0,S._)([(0,de.B)("viewModel.location")],Bo.prototype,"location",void 0),(0,S._)([(0,de.B)("viewModel.view")],Bo.prototype,"view",void 0),(0,S._)([(0,U.Cb)({type:jo})],Bo.prototype,"viewModel",void 0),(0,S._)([(0,de.B)("viewModel.visible")],Bo.prototype,"visible",void 0);var No=Bo=(0,S._)([(0,G.j)("esri.widgets.Spinner")],Bo),zo=(n(58168),n(80240),n(7093)),Uo=n(65673),Wo=n(90207),qo=n(86790),Go=n(26680),Ho=n(57589);function Ko(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Yo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ko(Object(n),!0).forEach((function(t){(0,H.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ko(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Jo(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return $o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return $o(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function $o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Qo(e){return e&&"opacity"in e?e.opacity*Qo(e.parent):1}function Xo(e,t){return ea.apply(this,arguments)}function ea(){return ea=(0,O.Z)(T().mark((function e(t,r){var i,o,a,s,u,l,c,p,f,d,h,v,y,m,g,b,_,w,k,C,x,Z,M,I,R;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:if(a=t.sourceLayer,s=null!=(i=(0,B.pC)(r)&&null!=(o=r.useSourceLayer)&&o?a:t.layer)?i:a,u=Qo(s),!(0,B.pC)(t.symbol)||(0,B.pC)(r)&&!0===r.ignoreGraphicSymbol){e.next=13;break}if("web-style"!==t.symbol.type){e.next=10;break}return e.next=7,t.symbol.fetchSymbol((0,B.pC)(r)?r.abortOptions:null);case 7:e.t0=e.sent,e.next=11;break;case 10:e.t0=t.symbol.clone();case 11:return l=e.t0,e.abrupt("return",((0,Ho.tb)(l,null,u),l));case 13:if(!(c=(0,B.pC)(r)&&r.renderer||s&&"renderer"in s&&s.renderer)||!("getSymbolAsync"in c)){e.next=20;break}return e.next=17,c.getSymbolAsync(t,r);case 17:e.t1=e.sent,e.next=21;break;case 20:e.t1=null;case 21:if(p=e.t1){e.next=24;break}return e.abrupt("return");case 24:if("web-style"!==p.type){e.next=30;break}return e.next=27,p.fetchSymbol((0,B.pC)(r)?r.abortOptions:null);case 27:e.t2=e.sent,e.next=31;break;case 30:e.t2=p.clone();case 31:if(p=e.t2,"visualVariables"in c&&c.visualVariables&&c.visualVariables.length){e.next=34;break}return e.abrupt("return",((0,Ho.tb)(p,null,u),p));case 34:if(!("arcadeRequiredForVisualVariables"in c)||!c.arcadeRequiredForVisualVariables||!(0,B.Wi)(r)&&!(0,B.Wi)(r.arcade)){e.next=40;break}return f=Yo({},(0,B.Wg)(r)),e.next=38,(0,Me.LC)();case 38:f.arcade=e.sent,r=f;case 40:return e.next=42,Promise.resolve().then(n.bind(n,20414));case 42:d=e.sent,h=[],v=[],y=[],m=[],g=Jo(c.visualVariables),e.prev=48,g.s();case 50:if((b=g.n()).done){e.next=64;break}_=b.value,e.t3=_.type,e.next="color"===e.t3?55:"opacity"===e.t3?57:"rotation"===e.t3?59:"size"===e.t3?61:62;break;case 55:return h.push(_),e.abrupt("break",62);case 57:return v.push(_),e.abrupt("break",62);case 59:return m.push(_),e.abrupt("break",62);case 61:_.target||y.push(_);case 62:e.next=50;break;case 64:e.next=69;break;case 66:e.prev=66,e.t4=e.catch(48),g.e(e.t4);case 69:return e.prev=69,g.f(),e.finish(69);case 72:if(w=!!h.length&&h[h.length-1],k=w?d.getColor(w,t,r):null,C=!!v.length&&v[v.length-1],x=C?d.getOpacity(C,t,r):null,null!=u&&(x=null!=x?x*u:u),(0,Ho.tb)(p,k,x),!y.length){e.next=78;break}return Z=d.getAllSizes(y,t,r),e.next=78,(0,Ho.e3)(p,Z);case 78:for(M=0,I=m;M<I.length;M++)R=I[M],(0,Ho.BR)(p,d.getRotationAngle(R,t,r),R.axis);return e.abrupt("return",p);case 80:case"end":return e.stop()}}),e,null,[[48,66,69,72]])}))),ea.apply(this,arguments)}var ta=n(94749);function na(e){return e&&"function"==typeof e.highlight}var ra="esri-icon-zoom-in-magnifying-glass",ia="esri-icon-trash",oa="esri-icon-table",aa=new qo.Z({id:"zoom-to-feature",title:"{messages.zoom}",className:ra}),sa=new qo.Z({id:"remove-selected-feature",title:"{messages.remove}",className:ia}),ua=new qo.Z({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:ra}),la=new qo.Z({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:oa}),ca=V.Z.getLogger("esri.widgets.Popup.PopupViewModel"),pa=function(e){var t=e.event,n=e.view,r=t.action,i=n&&n.popup;if(!r)return Promise.reject(new F.Z("trigger-action:missing-arguments","Event has no action"));if(!i)return Promise.reject(new F.Z("trigger-action:missing-arguments","view.popup is missing"));var o=r.disabled,a=r.id;if(!a)return Promise.reject(new F.Z("trigger-action:invalid-action","action.id is missing"));if(o)return Promise.reject(new F.Z("trigger-action:invalid-action","Action is disabled"));if(a===aa.id)return function(e){return ha.apply(this,arguments)}(i.viewModel).catch(gr.H9);if(a===ua.id)return function(e){return va.apply(this,arguments)}(i.viewModel);if(a===la.id)return i.featureMenuOpen=!i.featureMenuOpen,i.viewModel.browseClusterEnabled=!i.viewModel.browseClusterEnabled,Promise.resolve();if(i.viewModel.browseClusterEnabled=!1,a===sa.id){i.close();var s=i.selectedFeature;if(!s)return Promise.reject(new F.Z("trigger-action:".concat(sa.id),"selectedFeature is required",{selectedFeature:s}));var u=s.sourceLayer;return u?u.remove(s):n.graphics.remove(s),Promise.resolve()}return Promise.resolve()};function fa(e){var t=e.selectedFeature,n=e.location,r=e.view;return r?"3d"===r.type?t||n:e.get("selectedFeature.geometry")||n:null}function da(e,t){if("3d"!==(null==t?void 0:t.type)||!e||"esri.Graphic"!==e.declaredClass)return!0;var n=t.getViewForGraphic(e);if(n&&"whenGraphicBounds"in n){var r=!1;return n.whenGraphicBounds(e,{useViewElevation:!0}).then((function(e){r=!e||!e.boundingBox||e.boundingBox[0]===e.boundingBox[3]&&e.boundingBox[1]===e.boundingBox[4]&&e.boundingBox[2]===e.boundingBox[5]})).catch((function(){var t=new F.Z("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:e});ca.error(t)})),r}return!0}function ha(){return ha=(0,O.Z)(T().mark((function e(t){var n,r,i,o,a,s,u,l,c;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.location,r=t.selectedFeature,i=t.view,o=t.zoomFactor,a=fa(t)){e.next=4;break}return s=new F.Z("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:a,view:i}),e.abrupt("return",(ca.error(s),Promise.reject(s)));case 4:return u=i.scale/o,l=t.get("selectedFeature.geometry")||n,c=l&&"point"===l.type&&da(r,i),aa.active=!0,aa.disabled=!0,e.prev=6,e.next=9,t.view.goTo({target:a,scale:c?u:void 0});case 9:return e.prev=9,aa.active=!1,aa.disabled=!1,t.zoomToLocation=null,c&&(t.location=l),e.finish(9);case 12:case"end":return e.stop()}}),e,null,[[6,,9,12]])}))),ha.apply(this,arguments)}function va(){return(va=(0,O.Z)(T().mark((function e(t){var n,r,i,o,a,s,u,l,c;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.selectedFeature,"2d"===(null==(r=t.view)?void 0:r.type)){e.next=4;break}throw i=new F.Z("zoomToCluster:invalid-view","View must be 2d MapView.",{view:r}),ca.error(i),i;case 4:if(n.isAggregate){e.next=7;break}throw o=new F.Z("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:n}),ca.error(o),o;case 7:return a=n.sourceLayer,e.next=10,r.whenLayerView(a);case 10:return s=e.sent,(u=s.createQuery()).aggregateIds=[n.getObjectId()],ua.active=!0,ua.disabled=!0,e.next=15,s.queryExtent(u);case 15:return l=e.sent,c=l.extent,e.next=19,r.goTo({target:c});case 19:ua.active=!1,ua.disabled=!1;case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ya(e){return ma.apply(this,arguments)}function ma(){return(ma=(0,O.Z)(T().mark((function e(t){var n,r,i,o,a,s,u,l,c;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.selectedFeature,"2d"===(null==(r=t.view)?void 0:r.type)){e.next=4;break}throw i=new F.Z("displayClusterExtent:invalid-view","View must be 2d MapView.",{view:r}),ca.error(i),i;case 4:if(n.isAggregate){e.next=7;break}throw o=new F.Z("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:n}),ca.error(o),o;case 7:return a=n.sourceLayer,e.next=10,r.whenLayerView(a);case 10:return s=e.sent,(u=s.createQuery()).aggregateIds=[n.getObjectId()],e.next=15,s.queryExtent(u);case 15:l=e.sent,c=l.extent,t.selectedClusterBoundaryFeature.geometry=c,r.graphics.add(t.selectedClusterBoundaryFeature);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ga(e){return ba.apply(this,arguments)}function ba(){return(ba=(0,O.Z)(T().mark((function e(t){var n,r,i,o,a,s,u,l,c;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.selectedFeature,"2d"===(null==(r=t.view)?void 0:r.type)){e.next=4;break}throw i=new F.Z("browseAggregateFeatures:invalid-view","View must be 2d MapView.",{view:r}),ca.error(i),i;case 4:if(n.isAggregate){e.next=7;break}throw o=new F.Z("browseAggregateFeatures:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:n}),ca.error(o),o;case 7:return a=n.sourceLayer,e.next=10,r.whenLayerView(a);case 10:return s=e.sent,(u=s.createQuery()).aggregateIds=[n.getObjectId()],la.active=!0,la.disabled=!0,e.next=15,s.queryFeatures(u);case 15:l=e.sent,c=l.features,la.active=!1,la.disabled=!1,r.popup.open({features:[n].concat(c),featureMenuOpen:!0});case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _a(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var wa=function(e){var t=function(e){(0,M.Z)(n,e);var t=_a(n);function n(){var e;(0,k.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).goToOverride=null,e.view=null,e}return(0,C.Z)(n,[{key:"callGoTo",value:function(e){var t=this.view;return this.goToOverride?this.goToOverride(t,e):t.goTo(e.target,e.options)}}]),n}(e);return(0,S._)([(0,U.Cb)()],t.prototype,"goToOverride",void 0),(0,S._)([(0,U.Cb)()],t.prototype,"view",void 0),t=(0,S._)([(0,G.j)("esri.widgets.support.GoTo")],t)},ka=n(81672),Ca=n(5224);function xa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Za(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xa(Object(n),!0).forEach((function(t){(0,H.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xa(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ma(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Ia=A.Z.ofType({key:"type",defaultKeyValue:"button",base:Wo.Z,typeMap:{button:qo.Z,toggle:Go.Z}}),Ra="esri.widgets.Popup.PopupViewModel",Oa=V.Z.getLogger(Ra),Pa=function(e){(0,M.Z)(a,e);var t,n,r,i,o=Ma(a);function a(e){var t;return(0,k.Z)(this,a),(t=o.call(this,e))._handles=new Y.Z,t._pendingPromises=new Set,t._fetchFeaturesController=null,t._selectedClusterFeature=null,t.featurePage=null,t.actions=new Ia,t.defaultPopupTemplateEnabled=!1,t.autoCloseEnabled=!1,t.autoOpenEnabled=!0,t.browseClusterEnabled=!1,t.content=null,t.featuresPerPage=20,t.featureViewModelAbilities=null,t.featureViewModels=[],t.highlightEnabled=!0,t.includeDefaultActions=!0,t.selectedClusterBoundaryFeature=new E.Z({symbol:new ka.Z({outline:{width:1.5,color:"cyan"},style:"none"})}),t.title=null,t.updateLocationEnabled=!1,t.view=null,t.visible=!1,t.zoomFactor=4,t.zoomToLocation=null,t}return(0,C.Z)(a,[{key:"isLoadingFeature",get:function(){return this.featureViewModels.some((function(e){return e.waitingForContent}))}},{key:"initialize",value:function(){var e=this;this._handles.add([(0,N.S1)(this,["autoOpenEnabled","view"],(function(){return e._autoOpenEnabledChange()})),this.on("view-change",(function(){return e._autoClose()})),(0,N.YP)(this,["highlightEnabled","selectedFeature","visible","view"],(function(){return e._highlightFeature()})),(0,N.YP)(this,"view.animation.state",(function(t){return e._animationStateChange(t)})),(0,N.YP)(this,"location",(function(t){return e._locationChange(t)})),(0,N.YP)(this,"selectedFeature",(function(t){return e._selectedFeatureChange(t)})),(0,N.YP)(this,["selectedFeatureIndex","featureCount","featuresPerPage"],(function(){return e._selectedFeatureIndexChange()})),(0,N.YP)(this,["featurePage","selectedFeatureIndex","featureCount","featuresPerPage, featureViewModels"],(function(){return e._setGraphicOnFeatureViewModels()})),(0,N.YP)(this,"featureViewModels",(function(){return e._featureViewModelsChange()})),this.on("trigger-action",(function(t){return pa({event:t,view:e.view})})),(0,N.Nj)(this,"waitingForResult",(function(){return e._waitingForResultChange()}),!0),(0,N.YP)(this,["features","view","view.map","view.spatialReference"],(function(){return e._updateFeatureVMs()})),(0,N.YP)(this,["view.scale"],this._viewScaleChange),(0,N.Nj)(this,"visible",(function(){return e.browseClusterEnabled=!1})),(0,N.YP)(this,"browseClusterEnabled",(function(t){return t?e.enableClusterBrowsing():e.disableClusterBrowsing()}))])}},{key:"destroy",value:function(){this._cancelFetchingFeatures(),this._handles.destroy(),this._handles=null,this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}},{key:"active",get:function(){return!(!this.visible||this.waitingForResult)}},{key:"allActions",get:function(){var e=this._get("allActions")||new Ia;e.removeAll();var t=this.actions,n=this.defaultActions,r=this.defaultPopupTemplateEnabled,i=this.includeDefaultActions,o=this.selectedFeature,a=i?n.concat(t):t,s=o&&("function"==typeof o.getEffectivePopupTemplate&&o.getEffectivePopupTemplate(r)||o.popupTemplate),u=s&&s.actions,l=s&&s.overwriteActions?u:u?u.concat(a):a;return l&&l.filter(Boolean).forEach((function(t){return e.add(t)})),e}},{key:"defaultActions",get:function(){var e,t=this._get("defaultActions")||new Ia;return t.removeAll(),t.addMany(null!=(e=this.selectedFeature)&&e.isAggregate?[ua.clone(),la.clone()]:[aa.clone()]),t}},{key:"featureCount",get:function(){return this.features.length}},{key:"features",get:function(){return this._get("features")||[]},set:function(e){var t=e||[];this._set("features",t);var n=this.pendingPromisesCount,r=this.promiseCount,i=this.selectedFeatureIndex,o=r&&t.length;o&&n&&-1===i?this.selectedFeatureIndex=0:o&&-1!==i||(this.selectedFeatureIndex=t.length?0:-1)}},{key:"location",get:function(){return this._get("location")||null},set:function(e){var t=this.get("view.spatialReference.isWebMercator");e&&e.get("spatialReference.isWGS84")&&t&&(e=(0,zo.$)(e)),this._set("location",e)}},{key:"pendingPromisesCount",get:function(){return this._pendingPromises.size}},{key:"waitingForResult",get:function(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||0!==this.featureCount)}},{key:"promiseCount",get:function(){return this.promises.length}},{key:"promises",get:function(){return this._get("promises")||[]},set:function(e){var t=this;if(this._pendingPromises.clear(),this.features=[],!Array.isArray(e)||!e.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",e),(e=e.slice(0)).forEach((function(e){t._pendingPromises.add(e);e.then((function(n){t._pendingPromises.has(e)&&t._updateFeatures(n),t._updatePendingPromises(e)}),(function(){return t._updatePendingPromises(e)}))})),this.notifyChange("pendingPromisesCount")}},{key:"selectedFeature",get:function(){var e=this.features,t=this.selectedFeatureIndex;return-1===t?null:e[t]||null}},{key:"selectedFeatureIndex",get:function(){var e=this._get("selectedFeatureIndex");return"number"==typeof e?e:-1},set:function(e){var t=this.featureCount;e=isNaN(e)||e<-1||!t?-1:(e+t)%t,this._set("selectedFeatureIndex",e)}},{key:"selectedFeatureViewModel",get:function(){return this.featureViewModels[this.selectedFeatureIndex]||null}},{key:"state",get:function(){return this.get("view.ready")?"ready":"disabled"}},{key:"centerAtLocation",value:function(){var e=this.view,t=fa(this);if(!t){var n=new F.Z("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e});return Oa.error(n),Promise.reject(n)}return this.callGoTo({target:{target:t,scale:e.scale}})}},{key:"clear",value:function(){this.set({promises:[],features:[],content:null,title:null,location:null})}},{key:"fetchFeatures",value:function(e,t){var n=this.view;if(!n||!e){var r=new F.Z("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:n});return Oa.error(r),Promise.reject(r)}return n.fetchPopupFeatures(e,{event:t&&t.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:t&&t.signal})}},{key:"open",value:function(e){var t=Za(Za({updateLocationEnabled:!1,promises:[],fetchFeatures:!1},e),{},{visible:!0}),n=t.fetchFeatures;delete t.fetchFeatures,n&&this._setFetchFeaturesPromises(t.location),this.set(t)}},{key:"triggerAction",value:function(e){var t=this.allActions.getItemAt(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}},{key:"next",value:function(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}},{key:"previous",value:function(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}},{key:"disableClusterBrowsing",value:function(){(function(e){e.features=e.features.filter((function(e){return e.isAggregate}))})(this),this._clearBrowsedClusterGraphics()}},{key:"enableClusterBrowsing",value:(i=(0,O.Z)(T().mark((function e(){return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ya(this);case 2:return e.next=4,ga(this);case 4:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"_animationStateChange",value:function(e){this.zoomToLocation||(aa.disabled="waiting-for-target"===e)}},{key:"_clearBrowsedClusterGraphics",value:function(){var e,t=null==(e=this.view)?void 0:e.graphics;t&&(t.remove(this.selectedClusterBoundaryFeature),t.remove(this._selectedClusterFeature)),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}},{key:"_viewScaleChange",value:function(){var e;(null!=(e=this.selectedFeature)&&e.isAggregate||this.browseClusterEnabled)&&(this.browseClusterEnabled=!1,this.visible=!1)}},{key:"_locationChange",value:function(e){var t=this.selectedFeature;this.updateLocationEnabled&&e&&(!t||t.geometry)&&this.centerAtLocation()}},{key:"_selectedFeatureIndexChange",value:function(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}},{key:"_featureViewModelsChange",value:function(){this.featurePage=this.featureCount>1?1:null}},{key:"_setGraphicOnFeatureViewModels",value:function(){var e=this.features,t=this.featureCount,n=this.featurePage,r=this.featuresPerPage,i=this.featureViewModels;if(null!==n){var o=((n-1)*r+t)%t,a=o+r;i.slice(o,a).forEach((function(t,n){t&&!t.graphic&&(t.graphic=e[o+n])}))}}},{key:"_selectedFeatureChange",value:(r=(0,O.Z)(T().mark((function e(t){var n,r,i,o=this;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:if(n=this.location,r=this.updateLocationEnabled,i=this.view,!this.browseClusterEnabled){e.next=11;break}if(this._selectedClusterFeature&&(i.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),!t.isAggregate){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,Xo(t);case 8:return t.symbol=e.sent,this._selectedClusterFeature=t,e.abrupt("return",void i.graphics.add(this._selectedClusterFeature));case 11:!r&&n||!t.geometry?r&&!t.geometry&&this.centerAtLocation().then((function(){o.location=i.center.clone()})):this.location=(0,B.Wg)(this._getPointFromGeometry(t.geometry));case 12:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_waitingForResultChange",value:function(){!this.featureCount&&this.promises&&(this.visible=!1)}},{key:"_setFetchFeaturesPromises",value:function(e){var t=this;return this._fetchFeaturesWithController(this._getScreenPoint(e||this.location)).then((function(e){var n=e.clientOnlyGraphics,r=e.promisesPerLayerView,i=Promise.resolve(n),o=r.map((function(e){return e.promise}));t.promises=[i].concat((0,h.Z)(o))}))}},{key:"_destroyFeatureVMs",value:function(){this.featureViewModels.forEach((function(e){return e&&!e.destroyed&&e.destroy()})),this._set("featureViewModels",[])}},{key:"_updateFeatureVMs",value:function(){var e=this,t=this.selectedFeature,n=this.features,r=this.featureViewModels;if(null!=t&&t.isAggregate||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),n&&n.length){var i=r.slice(0),o=[];n.forEach((function(n,r){if(n){var a=null;if(i.some((function(e,t){return e&&e.graphic===n&&(a=e,i.splice(t,1)),!!a})),a)o[r]=a;else{var s,u,l=new so({abilities:e.featureViewModelAbilities,defaultPopupTemplateEnabled:e.defaultPopupTemplateEnabled,spatialReference:null==(s=e.view)?void 0:s.spatialReference,graphic:n===t?n:null,map:null==(u=e.view)?void 0:u.map,view:e.view});o[r]=l}}})),i.forEach((function(e){return e&&!e.destroyed&&e.destroy()})),this._set("featureViewModels",o)}}},{key:"_getScreenPoint",value:function(e){var t=this.view;return t&&e&&"function"==typeof t.toScreen?t.toScreen(e):null}},{key:"_autoOpenEnabledChange",value:function(){var e=this,t="auto-fetch-features",n=this._handles,r=this.autoOpenEnabled;if(n.remove(t),r&&this.view){var i=this.view.on("click",(function(t){"mouse"===t.pointerType&&0!==t.button||e._fetchFeaturesAndOpen(t)}),ta.f.WIDGET);n.add(i,t)}}},{key:"_cancelFetchingFeatures",value:function(){var e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}},{key:"_fetchFeaturesWithController",value:function(e,t){var n=this;this._cancelFetchingFeatures();var r=new AbortController,i=r.signal;this._fetchFeaturesController=r,this.notifyChange("waitingForResult");var o=this.fetchFeatures(e,{signal:i,event:t});return o.catch((function(){})).then((function(){n._fetchFeaturesController=null,n.notifyChange("waitingForResult")})),o}},{key:"_fetchFeaturesAndOpen",value:function(e){var t=e.screenPoint,n=e.mapPoint,r=this.view;this._fetchFeaturesWithController(t,e).then((function(e){var t=e.clientOnlyGraphics,i=e.promisesPerLayerView,o=e.location,a=[Promise.resolve(t)].concat((0,h.Z)(i.map((function(e){return e.promise}))));return r.popup.open({location:o||n,promises:a}),e}))}},{key:"_updatePendingPromises",value:function(e){e&&this._pendingPromises.has(e)&&(this._pendingPromises.delete(e),this.notifyChange("pendingPromisesCount"))}},{key:"_autoClose",value:function(){this.autoCloseEnabled&&(this.visible=!1)}},{key:"_getPointFromGeometry",value:function(e){return(0,B.Wi)(e)?null:"point"===e.type?e:"extent"===e.type?e.center:"polygon"===e.type?e.centroid:"multipoint"===e.type||"polyline"===e.type?e.extent.center:null}},{key:"_getLayerView",value:(n=(0,O.Z)(T().mark((function e(t,n){return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.when();case 2:return e.abrupt("return",t.whenLayerView(n));case 3:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"_highlightFeature",value:(t=(0,O.Z)(T().mark((function e(){var t,n,r,i,o,a,s,u,l,c,p,f,d;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t="highlight",this._handles.remove(t),n=this.selectedFeature,r=this.highlightEnabled,i=this.view,o=this.visible,n&&i&&r&&o){e.next=5;break}return e.abrupt("return");case 5:if(a=n.layer,"map-notes"!==(null==(s=n.sourceLayer)?void 0:s.type)&&"subtype-group"!==(null==s?void 0:s.type)||(a=s),a&&a instanceof Uo.Z){e.next=8;break}return e.abrupt("return");case 8:return u=this._getLayerView(i,a),this._highlightPromise=u,e.next=12,u;case 12:if((l=e.sent)&&na(l)&&this._highlightPromise===u&&this.selectedFeature&&this.highlightEnabled&&this.visible){e.next=15;break}return e.abrupt("return");case 15:c="objectIdField"in a&&a.objectIdField,p=n.attributes,f=p&&c&&p[c],d=l.highlight(f||n),this._handles.add(d,t);case 17:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_updateFeatures",value:function(e){var t=this.features;if(e&&e.length)if(t.length){var n=e.filter((function(e){return-1===t.indexOf(e)}));this.features=t.concat(n)}else this.features=e}}]),a}(wa(So));(0,S._)([(0,U.Cb)()],Pa.prototype,"featurePage",void 0),(0,S._)([(0,U.Cb)()],Pa.prototype,"isLoadingFeature",null),(0,S._)([(0,U.Cb)({type:Ia})],Pa.prototype,"actions",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],Pa.prototype,"active",null),(0,S._)([(0,U.Cb)({readOnly:!0})],Pa.prototype,"allActions",null),(0,S._)([(0,U.Cb)({type:Boolean})],Pa.prototype,"defaultPopupTemplateEnabled",void 0),(0,S._)([(0,U.Cb)()],Pa.prototype,"autoCloseEnabled",void 0),(0,S._)([(0,U.Cb)()],Pa.prototype,"autoOpenEnabled",void 0),(0,S._)([(0,U.Cb)()],Pa.prototype,"browseClusterEnabled",void 0),(0,S._)([(0,U.Cb)()],Pa.prototype,"content",void 0),(0,S._)([(0,U.Cb)({type:Ia,readOnly:!0})],Pa.prototype,"defaultActions",null),(0,S._)([(0,U.Cb)({readOnly:!0})],Pa.prototype,"featureCount",null),(0,S._)([(0,U.Cb)()],Pa.prototype,"features",null),(0,S._)([(0,U.Cb)()],Pa.prototype,"featuresPerPage",void 0),(0,S._)([(0,U.Cb)()],Pa.prototype,"featureViewModelAbilities",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],Pa.prototype,"featureViewModels",void 0),(0,S._)([(0,U.Cb)()],Pa.prototype,"highlightEnabled",void 0),(0,S._)([(0,U.Cb)()],Pa.prototype,"includeDefaultActions",void 0),(0,S._)([(0,U.Cb)({type:Ca.Z})],Pa.prototype,"location",null),(0,S._)([(0,U.Cb)({readOnly:!0})],Pa.prototype,"pendingPromisesCount",null),(0,S._)([(0,U.Cb)({readOnly:!0})],Pa.prototype,"selectedClusterBoundaryFeature",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],Pa.prototype,"waitingForResult",null),(0,S._)([(0,U.Cb)({readOnly:!0})],Pa.prototype,"promiseCount",null),(0,S._)([(0,U.Cb)()],Pa.prototype,"promises",null),(0,S._)([(0,U.Cb)({value:null,readOnly:!0})],Pa.prototype,"selectedFeature",null),(0,S._)([(0,U.Cb)({value:-1})],Pa.prototype,"selectedFeatureIndex",null),(0,S._)([(0,U.Cb)({readOnly:!0})],Pa.prototype,"selectedFeatureViewModel",null),(0,S._)([(0,U.Cb)({readOnly:!0})],Pa.prototype,"state",null),(0,S._)([(0,U.Cb)()],Pa.prototype,"title",void 0),(0,S._)([(0,U.Cb)()],Pa.prototype,"updateLocationEnabled",void 0),(0,S._)([(0,U.Cb)()],Pa.prototype,"view",void 0),(0,S._)([(0,U.Cb)()],Pa.prototype,"visible",void 0),(0,S._)([(0,U.Cb)()],Pa.prototype,"zoomFactor",void 0),(0,S._)([(0,U.Cb)()],Pa.prototype,"zoomToLocation",void 0),(0,S._)([(0,U.Cb)()],Pa.prototype,"centerAtLocation",null);var Ta=Pa=(0,S._)([(0,G.j)(Ra)],Pa),Sa=n(64092);function Ea(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Aa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ea(Object(n),!0).forEach((function(t){(0,H.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ea(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ja(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Fa="selected-index",La="popup-spinner",Da="esri-icon-left-triangle-arrow",Va="esri-icon-right-triangle-arrow",Ba="esri-icon-maximize",Na="esri-icon-dock-bottom",za="esri-icon-dock-left",Ua="esri-icon-dock-right",Wa="esri-icon-close",qa="esri-icon-minimize",Ga="esri-icon-check-mark",Ha="esri-icon-loading-indicator",Ka="esri-icon-default-action",Ya="esri-icon-handle-horizontal",Ja="esri-rotating",$a="esri-popup",Qa="esri-widget",Xa="esri-popup__main-container",es="esri-popup__loading-container",ts="esri-popup--is-collapsible",ns="esri-popup--is-collapsed",rs="esri-popup--shadow",is="esri-popup--is-docked",os="esri-popup--is-docked-top-left",as="esri-popup--is-docked-top-center",ss="esri-popup--is-docked-top-right",us="esri-popup--is-docked-bottom-left",ls="esri-popup--is-docked-bottom-center",cs="esri-popup--is-docked-bottom-right",ps="esri-popup--aligned-top-center",fs="esri-popup--aligned-bottom-center",ds="esri-popup--aligned-top-left",hs="esri-popup--aligned-bottom-left",vs="esri-popup--aligned-top-right",ys="esri-popup--aligned-bottom-right",ms="esri-popup--feature-menu-open",gs="esri-popup--actions-menu-open",bs="esri-popup--feature-updated",_s="esri-popup__header",ws="esri-popup__header-buttons",ks="esri-popup__header-container",Cs="esri-popup__header-container--button",xs="esri-popup__header-title",Zs="esri-popup__content",Ms="esri-popup__footer",Is="esri-popup__footer--has-pagination",Rs="esri-popup__footer--has-actions",Os="esri-popup__footer--has-actions-menu",Ps="esri-popup__button",Ts="esri-popup__button--disabled",Ss="esri-popup__button--dock",Es="esri-popup__icon",As="esri-popup__icon--dock-icon",js="esri-popup__inline-actions-container",Fs="esri-popup__actions-menu-button",Ls="esri-popup__actions",Ds="esri-popup__action",Vs="esri-popup__action-image",Bs="esri-popup__action-text",Ns="esri-popup__action-toggle",zs="esri-popup__action-toggle--on",Us="esri-popup__pointer",Ws="esri-popup__pointer-direction",qs="esri-popup__navigation",Gs="esri-popup__pagination-previous",Hs="esri-popup__pagination-next",Ks="esri-popup__pagination-previous-icon",Ys="esri-popup__pagination-previous-icon--rtl",Js="esri-popup__pagination-next-icon",$s="esri-popup__pagination-next-icon--rtl",Qs="esri-popup__feature-menu",Xs="esri-popup__feature-menu-list",eu="esri-popup__feature-menu-item",tu="esri-popup__feature-menu-viewport",nu="esri-popup__feature-menu-header",ru="esri-popup__feature-menu-item--selected",iu="esri-popup__feature-menu-button",ou="esri-popup__feature-menu-title",au="esri-popup__feature-menu-observer",su="esri-popup__feature-menu-loader",uu={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},lu="esri-popup";function cu(e,t){return void 0===t?"".concat(lu,"__").concat(e):"".concat(lu,"__").concat(e,"-").concat(t)}var pu="esri.widgets.Popup",fu=V.Z.getLogger(pu),du={closeButton:!0,featureNavigation:!0},hu=function(e){(0,M.Z)(n,e);var t=ja(n);function n(e,r){var i;return(0,k.Z)(this,n),(i=t.call(this,e,r))._blurClose=!1,i._blurContainer=!1,i._containerNode=null,i._mainContainerNode=null,i._featureMenuNode=null,i._actionsMenuNode=null,i._focusClose=!1,i._focusContainer=!1,i._focusDockButton=!1,i._focusFeatureMenuButton=!1,i._focusActionsMenuButton=!1,i._focusFirstFeature=!1,i._focusFirstAction=!1,i._handles=new Y.Z,i._pointerOffsetInPx=16,i._spinner=null,i._feature=null,i._featureMenuIntersectionObserverCallback=function(e){var t=(0,w.Z)(e,1)[0];null!=t&&t.isIntersecting&&i.viewModel.featurePage++},i._featureMenuIntersectionObserver=new IntersectionObserver(i._featureMenuIntersectionObserverCallback,{root:window.document}),i._displaySpinnerThrottled=(0,fe.P)((function(){return i._displaySpinner()}),0),i.actions=null,i.alignment="auto",i.autoCloseEnabled=null,i.autoOpenEnabled=null,i.defaultPopupTemplateEnabled=null,i.content=null,i.collapsed=!1,i.collapseEnabled=!0,i.dockEnabled=!1,i.featureCount=null,i.featureMenuOpen=!1,i.features=null,i.goToOverride=null,i.headingLevel=2,i.highlightEnabled=null,i.location=null,i.label=void 0,i.maxInlineActions=3,i.messages=null,i.messagesCommon=null,i.promises=null,i.selectedFeature=null,i.selectedFeatureIndex=null,i.spinnerEnabled=!0,i.title=null,i.updateLocationEnabled=null,i.view=null,i.viewModel=new Ta,i.visible=null,i.visibleElements=Aa({},du),i._addSelectedFeatureIndexHandle(),i.own([(0,N.YP)((0,x.Z)(i),"viewModel.screenLocation",(function(){return i._positionContainer()})),(0,N.YP)((0,x.Z)(i),["viewModel.active","dockEnabled"],(function(){return i._toggleScreenLocationEnabled()})),(0,N.YP)((0,x.Z)(i),"viewModel.screenLocation",(function(e,t){!!e!=!!t&&i.reposition()})),(0,N.YP)((0,x.Z)(i),["viewModel.view.padding","viewModel.view.size","viewModel.active","viewModel.location","alignment"],(function(){return i.reposition()})),(0,N.YP)((0,x.Z)(i),"spinnerEnabled",(function(e){return i._spinnerEnabledChange(e)})),(0,N.YP)((0,x.Z)(i),"viewModel.view.size",(function(e,t){return i._updateDockEnabledForViewSize(e,t)})),(0,N.YP)((0,x.Z)(i),"viewModel.view",(function(e,t){return i._viewChange(e,t)})),(0,N.YP)((0,x.Z)(i),"viewModel.view.ready",(function(e,t){return i._viewReadyChange(e,t)})),(0,N.YP)((0,x.Z)(i),["viewModel.waitingForResult","viewModel.location"],(function(){i._hideSpinner(),i._displaySpinnerThrottled()})),(0,N.YP)((0,x.Z)(i),["selectedFeatureWidget.viewModel.title","selectedFeatureWidget.viewModel.state"],(function(){return i._setTitleFromFeatureWidget()})),(0,N.YP)((0,x.Z)(i),["selectedFeatureWidget.viewModel.content","selectedFeatureWidget.viewModel.state"],(function(){return i._setContentFromFeatureWidget()})),(0,N.Nj)((0,x.Z)(i),"collapsed",(function(){var e,t;"xsmall"===(null==(e=i.viewModel)||null==(t=e.view)?void 0:t.widthBreakpoint)&&i.viewModel.active&&i.collapseEnabled&&i.viewModel.centerAtLocation()})),(0,N.on)((0,x.Z)(i),"viewModel.allActions","change",(function(){return i._watchActions()})),(0,N.S1)((0,x.Z)(i),"viewModel.allActions",(function(){return i._watchActions()})),(0,N.YP)((0,x.Z)(i),"viewModel.featureViewModels",(function(){return i._featureMenuViewportScrollTop()}))]),i}return(0,C.Z)(n,[{key:"destroy",value:function(){var e,t;this._destroySelectedFeatureWidget(),this._destroySpinner(),null==(e=this._handles)||e.destroy(),this._unobserveFeatureMenuObserver(),null==(t=this._featureMenuIntersectionObserver)||t.disconnect(),this._handles=null}},{key:"actionsMenuId",get:function(){return"".concat(this.id,"-actions-menu")}},{key:"actionsMenuButtonId",get:function(){return"".concat(this.id,"-actions-menu-button")}},{key:"featureMenuId",get:function(){return"".concat(this.id,"-feature-menu")}},{key:"titleId",get:function(){return"".concat(this.id,"-popup-title")}},{key:"contentId",get:function(){return"".concat(this.id,"-popup-content")}},{key:"hasContent",get:function(){var e,t,n,r,i,o,a;return!!(this.selectedFeatureWidget?(null==(e=this.selectedFeatureWidget)||null==(t=e.viewModel)?void 0:t.waitingForContent)||"error"===(null==(n=this.selectedFeatureWidget)||null==(r=n.viewModel)?void 0:r.state)||(null==(i=this.selectedFeatureWidget)||null==(o=i.viewModel)?void 0:o.content):null==(a=this.viewModel)?void 0:a.content)}},{key:"featureNavigationVisible",get:function(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}},{key:"collapsible",get:function(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}},{key:"featureMenuVisible",get:function(){return this.featureNavigationVisible&&this.featureMenuOpen}},{key:"contentCollapsed",get:function(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}},{key:"dividedActions",get:function(){return this._divideActions()}},{key:"actionsMenuOpen",get:function(){return!!this.viewModel.active&&this._get("actionsMenuOpen")},set:function(e){this._set("actionsMenuOpen",!!e)}},{key:"currentAlignment",get:function(){return this._getCurrentAlignment()}},{key:"currentDockPosition",get:function(){return this._getCurrentDockPosition()}},{key:"dockOptions",get:function(){return this._get("dockOptions")||uu},set:function(e){var t=Aa({},uu),n=this.get("viewModel.view.breakpoints"),r={};n&&(r.width=n.xsmall,r.height=n.xsmall);var i=Aa(Aa({},t),e),o=Aa(Aa({},t.breakpoint),r),a=i.breakpoint;!0===a?i.breakpoint=o:"object"==typeof a&&(i.breakpoint=Aa(Aa({},o),a)),this._set("dockOptions",i),this._setCurrentDockPosition(),this.reposition()}},{key:"selectedFeatureWidget",get:function(){var e=this._feature,t=this.visibleElements,n=this.headingLevel,r=this.viewModel.selectedFeatureViewModel,i=Aa(Aa({},t),{},{title:!1});return r?(e?(e.viewModel=r,e.visibleElements=i):this._feature=new Ro({headingLevel:n+1,viewModel:r,visibleElements:i}),this._feature):null}},{key:"castVisibleElements",value:function(e){return Aa(Aa({},du),e)}},{key:"blur",value:function(){this.viewModel.active||fu.warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}},{key:"clear",value:function(){this.viewModel.clear()}},{key:"close",value:function(){this.visible=!1}},{key:"fetchFeatures",value:function(e,t){return this.viewModel.fetchFeatures(e,t)}},{key:"focus",value:function(){this.viewModel.active||fu.warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}},{key:"next",value:function(){return this.viewModel.next()}},{key:"open",value:function(e){var t,n;this._handles.remove(Fa);var r=!!e&&!!e.featureMenuOpen,i=!!e&&!!e.actionsMenuOpen,o={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:i,featureMenuOpen:r};"xsmall"===(null==(t=this.viewModel)||null==(n=t.view)?void 0:n.widthBreakpoint)&&(o.collapsed=!0),this.set(o),this.viewModel.open(e),this._addSelectedFeatureIndexHandle()}},{key:"previous",value:function(){return this.viewModel.previous()}},{key:"reposition",value:function(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}},{key:"triggerAction",value:function(e){this.viewModel.triggerAction(e)}},{key:"render",value:function(){var e,t,n,r,i,o=this.actionsMenuOpen,a=this.dockEnabled,s=this.featureMenuVisible,u=this.dividedActions,l=this.currentAlignment,c=this.currentDockPosition,p=this.viewModel.active,f=u.menuActions,d=p&&f.length>1&&o,h=p&&a,v=p&&!a,y=null==(t=this.selectedFeature)||null==(n=t.layer)?void 0:n.title,m=null==(r=this.selectedFeature)||null==(i=r.layer)?void 0:i.id,g=(e={},(0,H.Z)(e,ps,"top-center"===l),(0,H.Z)(e,fs,"bottom-center"===l),(0,H.Z)(e,ds,"top-left"===l),(0,H.Z)(e,hs,"bottom-left"===l),(0,H.Z)(e,vs,"top-right"===l),(0,H.Z)(e,ys,"bottom-right"===l),(0,H.Z)(e,is,h),(0,H.Z)(e,rs,v),(0,H.Z)(e,os,"top-left"===c),(0,H.Z)(e,as,"top-center"===c),(0,H.Z)(e,ss,"top-right"===c),(0,H.Z)(e,us,"bottom-left"===c),(0,H.Z)(e,ls,"bottom-center"===c),(0,H.Z)(e,cs,"bottom-right"===c),(0,H.Z)(e,ms,s),(0,H.Z)(e,gs,d),e);return(0,Ot.u)("div",{class:this.classes($a,g),role:"presentation","data-layer-title":y,"data-layer-id":m,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},p?[this.renderMainContainer(),this.renderPointer()]:null)}},{key:"renderLoadingIcon",value:function(){return(0,Ot.u)("span",{"aria-hidden":"true",class:this.classes(Es,Ha,Ja)})}},{key:"renderNavigationLoading",value:function(){var e=this.messagesCommon;return this.viewModel.pendingPromisesCount?(0,Ot.u)("div",{key:cu("loading-container"),role:"presentation",class:es,"aria-label":e.loading,title:e.loading},this.renderLoadingIcon()):null}},{key:"renderPreviousIcon",value:function(){var e,t=(0,It.dZ)(this.container),n=(e={},(0,H.Z)(e,Va,t),(0,H.Z)(e,Ys,t),(0,H.Z)(e,Da,!t),(0,H.Z)(e,Ks,!t),e);return(0,Ot.u)("span",{"aria-hidden":"true",class:this.classes(Es,n)})}},{key:"renderPreviousButton",value:function(){var e=this.messages;return(0,Ot.u)("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(Ps,Gs),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())}},{key:"renderNextIcon",value:function(){var e,t=(0,It.dZ)(this.container),n=(e={},(0,H.Z)(e,Da,t),(0,H.Z)(e,$s,t),(0,H.Z)(e,Va,!t),(0,H.Z)(e,Js,!t),e);return(0,Ot.u)("span",{"aria-hidden":"true",class:this.classes(Es,n)})}},{key:"renderNextButton",value:function(){var e=this.messages;return(0,Ot.u)("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(Ps,Hs),"aria-label":e.next,title:e.next},this.renderNextIcon())}},{key:"renderFeatureMenuButton",value:function(){var e=this.featureMenuOpen,t=this.featureMenuId,n=this.messagesCommon,r=this.viewModel,i=r.featureCount,o=r.selectedFeatureIndex;return(0,Ot.u)("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(Ps,iu),"aria-haspopup":"true","aria-controls":t,"aria-expanded":e.toString(),"aria-label":n.menu,title:n.menu},this._getPageText(i,o))}},{key:"renderNavigationButtons",value:function(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:null}},{key:"renderDockIcon",value:function(){var e,t=this.dockEnabled,n=this._wouldDockTo(),r=(e={},(0,H.Z)(e,qa,t),(0,H.Z)(e,As,!t),(0,H.Z)(e,Ua,!t&&("top-right"===n||"bottom-right"===n)),(0,H.Z)(e,za,!t&&("top-left"===n||"bottom-left"===n)),(0,H.Z)(e,Ba,!t&&"top-center"===n),(0,H.Z)(e,Na,!t&&"bottom-center"===n),e);return(0,Ot.u)("span",{"aria-hidden":"true",class:this.classes(r,Es)})}},{key:"renderDockButton",value:function(){var e,t,n,r=this.dockEnabled,i=this.messages,o=null==(e=this.viewModel)||null==(t=e.view)?void 0:t.widthBreakpoint,a=r?i.undock:i.dock;return"xsmall"!==o&&null!=(n=this.dockOptions)&&n.buttonEnabled?(0,Ot.u)("div",{role:"button","aria-label":a,title:a,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(Ps,Ss)},this.renderDockIcon()):null}},{key:"renderTitle",value:function(){var e=this.viewModel.title,t=this.titleId,n=this.collapsible,r=this.contentCollapsed,i=this.messagesCommon,o=(0,H.Z)({},Cs,n),a=(0,Ot.u)(An,{level:this.headingLevel,class:xs,innerHTML:e}),s=n?(0,Ot.u)("button",{key:"".concat(e,"--collapsible"),id:t,title:r?i.expand:i.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(ks,o),"aria-expanded":r?"false":"true",onclick:this._toggleCollapsed},a):(0,Ot.u)("div",{key:e,id:t,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(ks,o)},a);return e?s:null}},{key:"renderCloseIcon",value:function(){return(0,Ot.u)("span",{"aria-hidden":"true",class:this.classes(Es,Wa)})}},{key:"renderCloseButton",value:function(){var e=this.visibleElements,t=this.messagesCommon;return e.closeButton?(0,Ot.u)("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:Ps,"aria-label":t.close,title:t.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}},{key:"renderHeader",value:function(){return(0,Ot.u)("header",{class:_s},this.renderTitle(),(0,Ot.u)("div",{class:ws},this.renderDockButton(),this.renderCloseButton()))}},{key:"renderContentContainer",value:function(){var e=this.contentId,t=this.hasContent,n=this.contentCollapsed,r=this.viewModel.content;return t&&!n?(0,Ot.u)("article",{key:r,enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:Zs},this.renderContent()):null}},{key:"renderActionsMenuButton",value:function(){var e=this.actionsMenuId,t=this.actionsMenuButtonId,n=this.actionsMenuOpen,r=this.dividedActions,i=this.messagesCommon,o=n?i.close:i.open;return r.menuActions.length?(0,Ot.u)("div",{key:cu("actions-menu-button"),class:this.classes(Ps,Fs),role:"button",id:t,"aria-haspopup":"true","aria-controls":n?e:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":o,title:o},(0,Ot.u)("span",{"aria-hidden":"true",class:Ya})):null}},{key:"renderMenuActions",value:function(){var e=this,t=this.actionsMenuId,n=this.actionsMenuButtonId,r=this.actionsMenuOpen,i=this.dividedActions.menuActions;return i.length&&r?(0,Ot.u)("ul",{id:t,role:"menu","aria-labelledby":n,key:cu("actions"),class:Ls,bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},i.toArray().map((function(t){return e.renderAction({action:t,type:"menu-item"})}))):null}},{key:"renderInlineActions",value:function(){var e=this,t=this.dividedActions.inlineActions;return!!t.length&&t.toArray().map((function(t){return e.renderAction({action:t,type:"inline"})}))}},{key:"renderInlineActionsContainer",value:function(){var e=this.dividedActions,t=e.inlineActions,n=e.menuActions,r=!!t.length,i=!!n.length;return r||i?(0,Ot.u)("div",{key:"inline-actions-container","data-inline-actions":r.toString(),"data-menu-actions":i.toString(),class:js},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}},{key:"renderNavigation",value:function(){return this.featureNavigationVisible?(0,Ot.u)("section",{key:cu("navigation"),class:this.classes(qs)},this.renderNavigationButtons()):null}},{key:"renderFooter",value:function(){var e,t=this.featureNavigationVisible,n=this.dividedActions,r=n.inlineActions,i=n.menuActions,o=!!r.length,a=!!i.length,s=(e={},(0,H.Z)(e,Is,t),(0,H.Z)(e,Rs,o),(0,H.Z)(e,Os,a),e);return t||o?(0,Ot.u)("div",{key:cu("feature-buttons"),class:this.classes(Ms,s)},this.renderInlineActionsContainer(),this.renderNavigation()):null}},{key:"renderFeatureMenuContainer",value:function(){var e=this.messages,t=this.viewModel,n=t.featureViewModels,r=t.isLoadingFeature,i=(0,co.n)(e.selectedFeatures,{total:n.length});return(0,Ot.u)("section",{key:cu("menu"),class:Qs},(0,Ot.u)("strong",{class:nu},i),(0,Ot.u)("nav",{bind:this,class:tu,"data-node-ref":"_featureMenuViewportNode",afterCreate:It.Se},this.renderFeatureMenu(),(0,Ot.u)("div",{class:au,bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),r?(0,Ot.u)("div",{class:su},this.renderLoadingIcon()):null))}},{key:"renderPointer",value:function(){return this.dockEnabled?null:(0,Ot.u)("div",{key:cu("pointer"),class:Us,role:"presentation"},(0,Ot.u)("div",{class:this.classes(Ws,rs)}))}},{key:"renderMainContainer",value:function(){var e,t=this.dockEnabled,n=this.currentAlignment,r=this.currentDockPosition,i=this.titleId,o=this.contentId,a=this.collapsible,s=this.hasContent,u=this.contentCollapsed,l=this.visibleElements,c=this.viewModel.title,p="bottom-left"===n||"bottom-center"===n||"bottom-right"===n||"top-left"===r||"top-center"===r||"top-right"===r,f="top-left"===n||"top-center"===n||"top-right"===n||"bottom-left"===r||"bottom-center"===r||"bottom-right"===r,d=(e={},(0,H.Z)(e,rs,t),(0,H.Z)(e,ts,a),(0,H.Z)(e,ns,u),e);return(0,Ot.u)("div",{class:this.classes(Xa,Qa,d),tabIndex:l.closeButton?null:-1,role:"dialog","aria-labelledby":c?i:"","aria-describedby":s&&!u?o:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},p?this.renderFooter():null,p?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),f?this.renderFooter():null,f?this.renderFeatureMenuContainer():null)}},{key:"renderContent",value:function(){var e,t=null==(e=this.viewModel)?void 0:e.content;return t?"string"==typeof t?(0,Ot.u)("div",{key:t,innerHTML:t}):this.renderNodeContent(t):null}},{key:"renderActionText",value:function(e){return(0,Ot.u)("span",{key:"text",class:Bs},e)}},{key:"renderActionIcon",value:function(e){var t,n=this._getActionClass(e),r=this._getActionImage(e),i=(t={},(0,H.Z)(t,Ha,e.active),(0,H.Z)(t,Ja,e.active),(0,H.Z)(t,Es,!!n),(0,H.Z)(t,Vs,!e.active&&!!r),t);return n&&(i[n]=!e.active),(0,Ot.u)("span",{key:"icon","aria-hidden":"true",class:this.classes(Es,i),styles:this._getIconStyles(r)})}},{key:"renderAction",value:function(e){var t,n=e.action,r=e.type,i=this._getActionTitle(n),o=(t={},(0,H.Z)(t,Ds,"toggle"!==n.type),(0,H.Z)(t,Ns,"toggle"===n.type),(0,H.Z)(t,zs,"toggle"===n.type&&n.value),(0,H.Z)(t,Ts,n.disabled),t),a=[this.renderActionIcon(n),this.renderActionText(i)],s="menu-item"===r?(0,Ot.u)("li",{key:n.uid,role:"menuitem",tabIndex:0,title:i,"aria-label":i,class:this.classes(Ps,o),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":n.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},a):(0,Ot.u)("div",{key:n.uid,role:"button",tabIndex:0,title:i,"aria-label":i,class:this.classes(Ps,o),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":n.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},a);return n.visible?s:null}},{key:"renderFeatureMenuItem",value:function(e,t){var n=this.messages,r=this.messagesCommon,i=this.viewModel,o=i.selectedFeatureIndex,a=e===i.selectedFeatureViewModel,s=(0,H.Z)({},ru,a),u=a?(0,Ot.u)("span",{key:cu("feature-menu-selected-feature-".concat(o)),title:n.selectedFeature,"aria-label":n.selectedFeature,class:Ga}):null,l=(0,Ot.u)("span",{innerHTML:e.title||r.untitled});return(0,Ot.u)("li",{role:"menuitem",tabIndex:-1,key:cu("feature-menu-feature-".concat(o)),class:this.classes(s,eu),bind:this,"data-feature-index":t,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature},(0,Ot.u)("span",{class:ou},l,u))}},{key:"renderFeatureMenu",value:function(){var e=this,t=this.featureMenuId,n=this.viewModel.featureViewModels;return n.length>1?(0,Ot.u)("ol",{class:Xs,id:t,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},n.filter((function(e){return!!e.graphic})).map((function(t,n){return e.renderFeatureMenuItem(t,n)}))):null}},{key:"_getActionTitle",value:function(e){var t=this.messages,n=this.selectedFeature,r=this.messagesCommon,i=e.id,o=null==n?void 0:n.attributes,a="zoom-to-feature"===i?(0,co.n)(e.title,{messages:t}):"remove-selected-feature"===i?(0,co.n)(e.title,{messages:r}):"zoom-to-clustered-features"===i||"browse-clustered-features"===i?(0,co.n)(e.title,{messages:t}):e.title;return a&&o?(0,co.n)(a,o):a}},{key:"_getActionClass",value:function(e){var t=this.selectedFeature,n=null==t?void 0:t.attributes,r=e.className,i=e.image||r?r:Ka;return i&&n?(0,co.n)(i,n):i}},{key:"_getActionImage",value:function(e){var t=this.selectedFeature,n=null==t?void 0:t.attributes,r=e.image;return r&&n?(0,co.n)(r,n):r}},{key:"_createFeatureUpdatedAnimation",value:function(){return(0,It.vU)("enter",bs)}},{key:"_getInlineActionCount",value:function(){var e=this.maxInlineActions,t=this.featureNavigationVisible;if("number"!=typeof e)return null;var n=Math.round(e);return Math.max(t?n-1:n,0)}},{key:"_watchActions",value:function(){var e=this,t=this.viewModel.allActions;this.notifyChange("dividedActions");var n="actions";this._handles.remove(n),t&&t.forEach((function(t){e._handles.add((0,N.YP)(t,["uid","active","className","disabled","id","title","image","visible"],(function(){return e.scheduleRender()})),n)}))}},{key:"_divideActions",value:function(){var e=this.viewModel.allActions.filter((function(e){return e.visible})),t=this._getInlineActionCount(),n=null===t,r=0===t;return{inlineActions:n?e.slice(0):r?new A.Z:e.slice(0,t),menuActions:n?new A.Z:r?e.slice(0):e.slice(t)}}},{key:"_featureMenuOpenChanged",value:function(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}},{key:"_actionsMenuOpenChanged",value:function(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}},{key:"_setTitleFromFeatureWidget",value:function(){var e,t,n=this.selectedFeatureWidget,r=this.messagesCommon;n&&(this.viewModel.title="error"===(null==(e=n.viewModel)?void 0:e.state)?r.errorMessage:(null==(t=n.viewModel)?void 0:t.title)||"")}},{key:"_setContentFromFeatureWidget",value:function(){var e=this.selectedFeatureWidget;e&&(this.viewModel.content=e)}},{key:"_unobserveFeatureMenuObserver",value:function(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}},{key:"_featureMenuIntersectionObserverCreated",value:function(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}},{key:"_handleFeatureMenuKeyup",value:function(e){"Escape"===(0,pe.kK)(e)&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}},{key:"_handleActionMenuKeyup",value:function(e){"Escape"===(0,pe.kK)(e)&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}},{key:"_handleFeatureMenuItemKeyup",value:function(e){var t=(0,pe.kK)(e),n=this._featureMenuNode,r=e.currentTarget["data-feature-index"];if(n){var i=n.querySelectorAll("li"),o=i.length;"ArrowUp"!==t?"ArrowDown"!==t?"Home"!==t?"End"!==t||(e.stopPropagation(),i[i.length-1].focus()):(e.stopPropagation(),i[0].focus()):(e.stopPropagation(),i[(r+1+o)%o].focus()):(e.stopPropagation(),i[(r-1+o)%o].focus())}}},{key:"_handleActionMenuItemKeyup",value:function(e){var t=(0,pe.kK)(e),n=this._actionsMenuNode,r=e.currentTarget.dataset.actionUid,i=this.dividedActions.menuActions.findIndex((function(e){return e.uid===r}));if(n){var o=n.querySelectorAll("li"),a=o.length;"ArrowUp"!==t?"ArrowDown"!==t?"Home"!==t?"End"!==t||(e.stopPropagation(),o[o.length-1].focus()):(e.stopPropagation(),o[0].focus()):(e.stopPropagation(),o[(i+1+a)%a].focus()):(e.stopPropagation(),o[(i-1+a)%a].focus())}}},{key:"_handleMainKeyup",value:function(e){var t=(0,pe.kK)(e);"ArrowLeft"===t&&(e.stopPropagation(),this.previous()),"ArrowRight"===t&&(e.stopPropagation(),this.next())}},{key:"_spinnerEnabledChange",value:function(e){if(this._destroySpinner(),e){var t=this.get("viewModel.view");this._createSpinner(t)}}},{key:"_hideSpinner",value:function(){var e=this._spinner;e&&(e.location=null,e.hide())}},{key:"_displaySpinner",value:function(){var e=this._spinner;if(e){var t=this.viewModel,n=t.location;t.waitingForResult?e.show({location:n}):e.hide()}}},{key:"_getIconStyles",value:function(e){return{"background-image":e?"url(".concat(e,")"):""}}},{key:"_addSelectedFeatureIndexHandle",value:function(){var e=this,t=(0,N.YP)(this,"viewModel.selectedFeatureIndex",(function(t,n){return e._selectedFeatureIndexUpdated(t,n)}));this._handles.add(t,Fa)}},{key:"_selectedFeatureIndexUpdated",value:function(e,t){this.featureCount&&e!==t&&-1!==e&&(this.actionsMenuOpen=!1,this.featureMenuOpen=!1)}},{key:"_destroySelectedFeatureWidget",value:function(){var e=this._feature;e&&(e.viewModel=null,e&&!e.destroyed&&e.destroy()),this._feature=null}},{key:"_isScreenLocationWithinView",value:function(e,t){return e.x>-1&&e.y>-1&&e.x<=t.width&&e.y<=t.height}},{key:"_isOutsideView",value:function(e){var t=e.popupHeight,n=e.popupWidth,r=e.screenLocation,i=e.side,o=e.view;if(isNaN(n)||isNaN(t)||!o||!r)return!1;var a=o.padding;return"right"===i&&r.x+n/2>o.width-a.right||"left"===i&&r.x-n/2<a.left||"top"===i&&r.y-t<a.top||"bottom"===i&&r.y+t>o.height-a.bottom}},{key:"_calculateAutoAlignment",value:function(e){if("auto"!==e)return e;var t=this._pointerOffsetInPx,n=this._containerNode,r=this._mainContainerNode,i=this.viewModel,o=i.screenLocation,a=i.view;if((0,B.Wi)(o)||!a||!n)return"top-center";if(!this._isScreenLocationWithinView(o,a))return this._get("currentAlignment")||"top-center";function s(e){return parseInt(e.replace(/[^-\d\.]/g,""),10)}var u=r?window.getComputedStyle(r,null):null,l=u?s(u.getPropertyValue("max-height")):0,c=u?s(u.getPropertyValue("height")):0,p=n.getBoundingClientRect(),f=p.height,d=p.width+t,h=Math.max(f,l,c)+t,v=this._isOutsideView({popupHeight:h,popupWidth:d,screenLocation:o,side:"right",view:a}),y=this._isOutsideView({popupHeight:h,popupWidth:d,screenLocation:o,side:"left",view:a}),m=this._isOutsideView({popupHeight:h,popupWidth:d,screenLocation:o,side:"top",view:a}),g=this._isOutsideView({popupHeight:h,popupWidth:d,screenLocation:o,side:"bottom",view:a});return y?m?"bottom-right":"top-right":v?m?"bottom-left":"top-left":m?g?"top-center":"bottom-center":"top-center"}},{key:"_callCurrentAlignment",value:function(e){return"function"==typeof e?e.call(this):e}},{key:"_getCurrentAlignment",value:function(){var e=this.alignment;return this.dockEnabled||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}},{key:"_setCurrentAlignment",value:function(){this._set("currentAlignment",this._getCurrentAlignment())}},{key:"_setCurrentDockPosition",value:function(){this._set("currentDockPosition",this._getCurrentDockPosition())}},{key:"_calculatePositionResult",value:function(e){var t=["left","right"];return(0,It.dZ)(this.container)&&t.reverse(),e.replace(/leading/gi,t[0]).replace(/trailing/gi,t[1])}},{key:"_callDockPosition",value:function(e){return"function"==typeof e?e.call(this):e}},{key:"_getDockPosition",value:function(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(null==(e=this.dockOptions)?void 0:e.position)))}},{key:"_getCurrentDockPosition",value:function(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}},{key:"_wouldDockTo",value:function(){return this.dockEnabled?null:this._getDockPosition()}},{key:"_calculateAutoDockPosition",value:function(e){var t;if("auto"!==e)return e;var n=null==(t=this.viewModel)?void 0:t.view,r=(0,It.dZ)(this.container)?"top-left":"top-right";if(!n)return r;var i=n.padding||{left:0,right:0,top:0,bottom:0},o=n.width-i.left-i.right,a=n.breakpoints;return a&&o<=a.xsmall?"bottom-center":r}},{key:"_positionContainer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._containerNode;if(e&&(this._containerNode=e),e){var t=this.viewModel.screenLocation,n=e.getBoundingClientRect(),r=n.width,i=this._calculatePositionStyle(t,r);i&&(e.style.top=i.top,e.style.left=i.left,e.style.bottom=i.bottom,e.style.right=i.right)}}},{key:"_calculateFullWidth",value:function(e){var t=this.currentAlignment,n=this._pointerOffsetInPx;return"top-left"===t||"bottom-left"===t||"top-right"===t||"bottom-right"===t?e+n:e}},{key:"_calculateAlignmentPosition",value:function(e,t,n,r){var i=this.currentAlignment,o=this._pointerOffsetInPx,a=r/2,s=n.height-t,u=n.width-e,l=this.view.padding;return"bottom-center"===i?{top:t+o-l.top,left:e-a-l.left}:"top-left"===i?{bottom:s+o-l.bottom,right:u+o-l.right}:"bottom-left"===i?{top:t+o-l.top,right:u+o-l.right}:"top-right"===i?{bottom:s+o-l.bottom,left:e+o-l.left}:"bottom-right"===i?{top:t+o-l.top,left:e+o-l.left}:"top-center"===i?{bottom:s+o-l.bottom,left:e-a-l.left}:void 0}},{key:"_calculatePositionStyle",value:function(e,t){var n=this.dockEnabled,r=this.view;if(r){if(n)return{left:"",top:"",right:"",bottom:""};if(!(0,B.Wi)(e)&&t){var i=this._calculateFullWidth(t),o=this._calculateAlignmentPosition(e.x,e.y,r,i);return o?{top:void 0!==o.top?"".concat(o.top,"px"):"auto",left:void 0!==o.left?"".concat(o.left,"px"):"auto",bottom:void 0!==o.bottom?"".concat(o.bottom,"px"):"auto",right:void 0!==o.right?"".concat(o.right,"px"):"auto"}:void 0}}}},{key:"_viewChange",value:function(e,t){e&&t&&(this.close(),this.clear())}},{key:"_viewReadyChange",value:function(e,t){if(e){var n=this.get("viewModel.view");this._wireUpView(n)}else t&&(this.close(),this.clear())}},{key:"_wireUpView",value:function(e){(this._destroySpinner(),e)&&(this.spinnerEnabled&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions))}},{key:"_dockingThresholdCrossed",value:function(e,t,n){var r=(0,w.Z)(e,2),i=r[0],o=r[1],a=(0,w.Z)(t,2),s=a[0],u=a[1],l=n.width,c=n.height;return i<=l&&s>l||i>l&&s<=l||o<=c&&u>c||o>c&&u<=c}},{key:"_updateDockEnabledForViewSize",value:function(e,t){if(e&&t){var n=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},r=n.left+n.right,i=n.top+n.bottom,o=[],a=[];o[0]=e[0]-r,o[1]=e[1]-i,a[0]=t[0]-r,a[1]=t[1]-i;var s=this.dockOptions,u=s.breakpoint;this._dockingThresholdCrossed(o,a,u)&&this._setDockEnabledForViewSize(s),this._setCurrentDockPosition()}}},{key:"_focusDockButtonNode",value:function(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())}},{key:"_closeButtonNodeUpdated",value:function(e){return this._focusClose?(this._focusClose=!1,void e.focus()):this._blurClose?(this._blurClose=!1,void e.blur()):void 0}},{key:"_mainContainerNodeUpdated",value:function(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0}},{key:"_featureMenuNodeUpdated",value:function(e){if(this._featureMenuNode=e,e&&this._focusFirstFeature){this._focusFirstFeature=!1;var t=e.querySelectorAll("li");t.length&&t[0].focus()}}},{key:"_actionsMenuNodeUpdated",value:function(e){if(this._actionsMenuNode=e,e&&this._focusFirstAction){this._focusFirstAction=!1;var t=e.querySelectorAll("li");t.length&&t[0].focus()}}},{key:"_focusFeatureMenuButtonNode",value:function(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())}},{key:"_focusActionsMenuButtonNode",value:function(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())}},{key:"_featureMenuViewportScrollTop",value:function(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)}},{key:"_toggleScreenLocationEnabled",value:function(){var e=this.dockEnabled,t=this.viewModel;if(t){var n=t.active&&!e;t.screenLocationEnabled=n}}},{key:"_shouldDockAtCurrentViewSize",value:function(e){var t,n,r=e.breakpoint,i=null==(t=this.viewModel)||null==(n=t.view)?void 0:n.ui;if(!i)return!1;var o=i.width,a=i.height;if(isNaN(o)||isNaN(a))return!1;var s=r.hasOwnProperty("width")&&o<=r.width,u=r.hasOwnProperty("height")&&a<=r.height;return s||u}},{key:"_setDockEnabledForViewSize",value:function(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}},{key:"_getPageText",value:function(e,t){return this.featureNavigationVisible?(0,co.n)(this.messages.pageText,{index:t+1,total:e}):null}},{key:"_destroySpinner",value:function(){var e=this._spinner,t=this.view;e&&(t&&t.ui&&t.ui.remove(this._spinner,La),e.destroy(),this._spinner=null)}},{key:"_createSpinner",value:function(e){e&&(this._spinner=new No({view:e}),e.ui.add(this._spinner,{key:La,position:"manual"}))}},{key:"_toggleCollapsed",value:function(){this.collapsed=!this.collapsed}},{key:"_close",value:function(){this.close(),this.view&&this.view.focus()}},{key:"_toggleDockEnabled",value:function(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}},{key:"_toggleFeatureMenu",value:function(){var e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e}},{key:"_toggleActionsMenu",value:function(){var e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e}},{key:"_triggerAction",value:function(e){var t=e.currentTarget.dataset.actionUid,n=this.viewModel.allActions,r=n.findIndex((function(e){return e.uid===t})),i=n.getItemAt(r);i&&"toggle"===i.type&&(i.value=!i.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(r)}},{key:"_selectFeature",value:function(e){var t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}},{key:"_next",value:function(){this.next()}},{key:"_previous",value:function(){this.previous()}}]),n}(lo(ve.Z));(0,S._)([(0,U.Cb)({readOnly:!0})],hu.prototype,"actionsMenuId",null),(0,S._)([(0,U.Cb)({readOnly:!0})],hu.prototype,"actionsMenuButtonId",null),(0,S._)([(0,U.Cb)({readOnly:!0})],hu.prototype,"featureMenuId",null),(0,S._)([(0,U.Cb)({readOnly:!0})],hu.prototype,"titleId",null),(0,S._)([(0,U.Cb)({readOnly:!0})],hu.prototype,"contentId",null),(0,S._)([(0,U.Cb)({readOnly:!0})],hu.prototype,"hasContent",null),(0,S._)([(0,U.Cb)({readOnly:!0})],hu.prototype,"featureNavigationVisible",null),(0,S._)([(0,U.Cb)({readOnly:!0})],hu.prototype,"collapsible",null),(0,S._)([(0,U.Cb)({readOnly:!0})],hu.prototype,"featureMenuVisible",null),(0,S._)([(0,U.Cb)({readOnly:!0})],hu.prototype,"contentCollapsed",null),(0,S._)([(0,U.Cb)({readOnly:!0})],hu.prototype,"dividedActions",null),(0,S._)([(0,de.B)("viewModel.actions")],hu.prototype,"actions",void 0),(0,S._)([(0,U.Cb)()],hu.prototype,"actionsMenuOpen",null),(0,S._)([(0,U.Cb)()],hu.prototype,"alignment",void 0),(0,S._)([(0,de.B)("viewModel.autoCloseEnabled")],hu.prototype,"autoCloseEnabled",void 0),(0,S._)([(0,de.B)("viewModel.autoOpenEnabled")],hu.prototype,"autoOpenEnabled",void 0),(0,S._)([(0,de.B)("viewModel.defaultPopupTemplateEnabled")],hu.prototype,"defaultPopupTemplateEnabled",void 0),(0,S._)([(0,de.B)("viewModel.content")],hu.prototype,"content",void 0),(0,S._)([(0,U.Cb)()],hu.prototype,"collapsed",void 0),(0,S._)([(0,U.Cb)()],hu.prototype,"collapseEnabled",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],hu.prototype,"currentAlignment",null),(0,S._)([(0,U.Cb)({readOnly:!0})],hu.prototype,"currentDockPosition",null),(0,S._)([(0,U.Cb)()],hu.prototype,"dockOptions",null),(0,S._)([(0,U.Cb)()],hu.prototype,"dockEnabled",void 0),(0,S._)([(0,de.B)("viewModel.featureCount")],hu.prototype,"featureCount",void 0),(0,S._)([(0,U.Cb)()],hu.prototype,"featureMenuOpen",void 0),(0,S._)([(0,de.B)("viewModel.features")],hu.prototype,"features",void 0),(0,S._)([(0,de.B)("viewModel.goToOverride")],hu.prototype,"goToOverride",void 0),(0,S._)([(0,U.Cb)()],hu.prototype,"headingLevel",void 0),(0,S._)([(0,de.B)("viewModel.highlightEnabled")],hu.prototype,"highlightEnabled",void 0),(0,S._)([(0,de.B)("viewModel.location")],hu.prototype,"location",void 0),(0,S._)([(0,U.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],hu.prototype,"label",void 0),(0,S._)([(0,U.Cb)()],hu.prototype,"maxInlineActions",void 0),(0,S._)([(0,U.Cb)(),(0,Rt.H)("esri/widgets/Popup/t9n/Popup")],hu.prototype,"messages",void 0),(0,S._)([(0,U.Cb)(),(0,Rt.H)("esri/t9n/common")],hu.prototype,"messagesCommon",void 0),(0,S._)([(0,de.B)("viewModel.promises")],hu.prototype,"promises",void 0),(0,S._)([(0,de.B)("viewModel.selectedFeature")],hu.prototype,"selectedFeature",void 0),(0,S._)([(0,de.B)("viewModel.selectedFeatureIndex")],hu.prototype,"selectedFeatureIndex",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],hu.prototype,"selectedFeatureWidget",null),(0,S._)([(0,U.Cb)()],hu.prototype,"spinnerEnabled",void 0),(0,S._)([(0,de.B)("viewModel.title")],hu.prototype,"title",void 0),(0,S._)([(0,de.B)("viewModel.updateLocationEnabled")],hu.prototype,"updateLocationEnabled",void 0),(0,S._)([(0,de.B)("viewModel.view")],hu.prototype,"view",void 0),(0,S._)([(0,U.Cb)({type:Ta}),function(e){return function(t){t.hasOwnProperty("_delegatedEventNames")||(t._delegatedEventNames=t._delegatedEventNames?t._delegatedEventNames.slice():[]);var n=t._delegatedEventNames,r=Array.isArray(e)?e:function(e){return e.split(",").map((function(e){return e.trim()}))}(e);n.push.apply(n,(0,h.Z)(r))}}(["triggerAction","trigger-action"])],hu.prototype,"viewModel",void 0),(0,S._)([(0,de.B)("viewModel.visible")],hu.prototype,"visible",void 0),(0,S._)([(0,U.Cb)()],hu.prototype,"visibleElements",void 0),(0,S._)([(0,he.p)("visibleElements")],hu.prototype,"castVisibleElements",null),(0,S._)([(0,Sa.h)()],hu.prototype,"_close",null),(0,S._)([(0,Sa.h)()],hu.prototype,"_toggleDockEnabled",null),(0,S._)([(0,Sa.h)()],hu.prototype,"_toggleFeatureMenu",null),(0,S._)([(0,Sa.h)()],hu.prototype,"_toggleActionsMenu",null),(0,S._)([(0,Sa.h)()],hu.prototype,"_triggerAction",null),(0,S._)([(0,Sa.h)()],hu.prototype,"_selectFeature",null),(0,S._)([(0,Sa.h)()],hu.prototype,"_next",null),(0,S._)([(0,Sa.h)()],hu.prototype,"_previous",null);var vu=hu=(0,S._)([(0,G.j)(pu)],hu);function yu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var mu=[0,0];function gu(e){e&&((0,te.cS)(e),e.parentNode&&e.parentNode.removeChild(e))}var bu=16,_u=750;var wu=n(93373),ku=n(8792),Cu=n(22176);function xu(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Zu(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Zu(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Zu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Mu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Iu,Ru=n(68833),Ou=n(30004),Pu=n(24978),Tu=n(87869),Su=n(54279),Eu=n(82703),Au=n(86523),ju=n(45452),Fu=n(61979),Lu=n(17418);function Du(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Vu=Iu=function(e){(0,M.Z)(n,e);var t=Du(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).type="none",r}return(0,C.Z)(n,[{key:"clone",value:function(){return new Iu({type:this.type})}}]),n}(Su.wq);(0,S._)([(0,Lu.J)({none:"none",stayAbove:"stay-above"})],Vu.prototype,"type",void 0),Vu=Iu=(0,S._)([(0,G.j)("esri.ground.NavigationConstraint")],Vu);var Bu,Nu=n(50868);function zu(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Uu(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?zu(Object(n),!0).forEach((function(t){(0,H.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zu(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Wu(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return qu(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return qu(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function qu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Gu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Hu=V.Z.getLogger("esri.Ground"),Ku=Bu=function(e){(0,M.Z)(o,e);var t,r,i=Gu(o);function o(e){var t;(0,k.Z)(this,o),(t=i.call(this,e)).opacity=1,t.surfaceColor=null,t.navigationConstraint=null,t.layers=new A.Z;return t.layers.on("after-add",(function(e){return function(e){e.parent&&e.parent!==(0,x.Z)(t)&&"remove"in e.parent&&e.parent.remove(e),e.parent=(0,x.Z)(t),"elevation"!==e.type&&"base-elevation"!==e.type&&Hu.error("Layer '".concat(e.title,", id:").concat(e.id,"' of type '").concat(e.type,"' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported."))}(e.item)})),t.layers.on("after-remove",(function(e){return function(e){e.parent=null}(e.item)})),t}return(0,C.Z)(o,[{key:"initialize",value:function(){this.when().catch((function(e){Hu.error("#load()","Failed to load ground",e)})),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}},{key:"destroy",value:function(){var e,t=Wu(this.layers.removeAll());try{for(t.s();!(e=t.n()).done;){e.value.destroy()}}catch(n){t.e(n)}finally{t.f()}this.layers.destroy()}},{key:"normalizeCtorArgs",value:function(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e=Uu({},e)).resourceInfo),e}},{key:"layers",set:function(e){this._set("layers",(0,Pu.Z)(e,this._get("layers")))}},{key:"writeLayers",value:function(e,t,n,r){var i=[];e?(r=Uu(Uu({},r),{},{layerContainerType:"ground"}),e.forEach((function(e){if("write"in e){var t={};(0,Tu.sM)(e)().write(t,r)&&i.push(t)}else r&&r.messages&&r.messages.push(new F.Z("layer:unsupported","Layers (".concat(e.title,", ").concat(e.id,") of type '").concat(e.declaredClass,"' cannot be persisted in the ground"),{layer:e}))})),t.layers=i):t.layers=i}},{key:"load",value:function(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}},{key:"loadAll",value:function(){var e=this;return(0,ju.GZ)(this,(function(t){t(e.layers)}))}},{key:"queryElevation",value:(r=(0,O.Z)(T().mark((function e(t,r){var i,o,a,s;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load({signal:null==r?void 0:r.signal});case 2:return e.next=4,n.e(317).then(n.bind(n,36273));case 4:return i=e.sent,o=i.ElevationQuery,(0,gr.k_)(r),a=new o,s=this.layers.filter(Yu).toArray(),e.abrupt("return",a.queryAll(s,t,r));case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"createElevationSampler",value:(t=(0,O.Z)(T().mark((function e(t,r){var i,o,a,s;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load({signal:null==r?void 0:r.signal});case 2:return e.next=4,n.e(317).then(n.bind(n,36273));case 4:return i=e.sent,o=i.ElevationQuery,(0,gr.k_)(r),a=new o,s=this.layers.filter(Yu).toArray(),e.abrupt("return",a.createSamplerAll(s,t,r));case 9:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"clone",value:function(){var e={opacity:this.opacity,surfaceColor:(0,Eu.d9)(this.surfaceColor),navigationConstraint:(0,Eu.d9)(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new Bu({resourceInfo:this.resourceInfo}).set(e)}},{key:"read",value:function(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),(0,Z.Z)((0,R.Z)(o.prototype),"read",this).call(this,e,t)}},{key:"_loadFromSource",value:function(e){var t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve(null)}},{key:"_loadLayersFromJSON",value:function(e,t,r){var i=this,o=t&&t.origin||"web-scene",a=t&&t.portal||null,s=t&&t.url||null;return Promise.all([n.e(9351),n.e(317)]).then(n.bind(n,16886)).then((function(t){var n=t.populateOperationalLayers;(0,gr.k_)(r);var u=[];if(e.layers&&Array.isArray(e.layers)){var l={context:{origin:o,url:s,portal:a,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};u.push(n(i.layers,e.layers,l))}return(0,gr.as)(u)})).then((function(){}))}}]),o}((0,Su.eC)(Au.Z));function Yu(e){return"elevation"===e.type||function(e){return e&&"createElevationSampler"in e}(e)}(0,S._)([(0,U.Cb)({json:{read:!1}})],Ku.prototype,"layers",null),(0,S._)([(0,Fu.c)("layers")],Ku.prototype,"writeLayers",null),(0,S._)([(0,U.Cb)({readOnly:!0})],Ku.prototype,"resourceInfo",void 0),(0,S._)([(0,U.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:q.z8,read:{reader:Nu.b,source:"transparency"},write:{writer:function(e,t){t.transparency=(0,Nu.a)(e)},target:"transparency"}}})],Ku.prototype,"opacity",void 0),(0,S._)([(0,U.Cb)({type:Ou.Z,json:{type:[q.z8],write:function(e,t){t.surfaceColor=e.toJSON().slice(0,3)}}})],Ku.prototype,"surfaceColor",void 0),(0,S._)([(0,U.Cb)({type:Vu,json:{write:!0}})],Ku.prototype,"navigationConstraint",void 0);var Ju=Ku=Bu=(0,S._)([(0,G.j)("esri.Ground")],Ku);function $u(e){var t;return!(!(e&&e.loaded&&"capabilities"in e&&null!=e&&null!=(t=e.capabilities)&&t.operations&&"supportsEditing"in e.capabilities.operations&&!0===e.capabilities.operations.supportsEditing)||"editingEnabled"in e&&!e.editingEnabled)}var Qu=n(59965),Xu=n(98840),el=n(36912),tl=V.Z.getLogger("esri.support.basemapUtils");function nl(e,t){var n,r;if("string"==typeof e){if(!(e in el.s)){var i=Object.entries(el.s).filter((function(e){var t=(0,w.Z)(e,2),n=(t[0],t[1]);return Qu.Z.apiKey&&!n.classic||!Qu.Z.apiKey&&n.classic&&!n.deprecated})).map((function(e){var t=(0,w.Z)(e,1)[0];return'"'.concat(t,'"')})).join(", ");return tl.warn("Unable to find basemap definition for: ".concat(e,". Try one of these: ").concat(i)),null}t&&(r=t[e]),r||(r=Ru.default.fromId(e),t&&(t[e]=r))}else r=(0,q.se)(Ru.default,e);return null!=(n=r)&&n.destroyed&&(tl.warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}function rl(e){if(ol(e.url))return!0;if("vector-tile"===e.type)for(var t in e.sourceNameToSource){var n=e.sourceNameToSource[t];if(ol(null==n?void 0:n.sourceUrl))return!0}return!1}var il=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function ol(e){if(!e)return!1;var t=new Xu.R9((0,Xu.hF)(e));return il.test(t.authority)}var al=V.Z.getLogger("esri.support.groundUtils"),sl={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};var ul=n(34273);function ll(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var cl=function(e){(0,M.Z)(n,e);var t=ll(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).allLayers=new j.Z({getCollections:function(){var e,t,n;return[null==(e=r.basemap)?void 0:e.baseLayers,null==(t=r.ground)?void 0:t.layers,r.layers,null==(n=r.basemap)?void 0:n.referenceLayers]},getChildrenFunction:function(e){return"layers"in e?e.layers:null}}),r.allTables=new j.Z({getCollections:function(){return[r.tables,r.layers]},getChildrenFunction:function(e){var t=[];return"tables"in e&&t.push(e.tables),"layers"in e&&t.push(e.layers),t},itemFilterFunction:function(e){var t=e.parent;return t&&"tables"in t&&t.tables.includes(e)}}),r.basemap=null,r.editableLayers=new j.Z({getCollections:function(){return[r.allLayers]},itemFilterFunction:$u}),r.ground=new Ju,r._basemapCache={},r}return(0,C.Z)(n,[{key:"destroy",value:function(){var e,t;this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),null==(e=this.ground)||e.destroy(),null==(t=this.basemap)||t.destroy(),function(e){for(var t in e){var n=e[t];!1===(null==n?void 0:n.destroyed)&&n.destroy(),delete e[t]}}(this._basemapCache),this._basemapCache=null}},{key:"castBasemap",value:function(e){return nl(e,this._basemapCache)}},{key:"castGround",value:function(e){var t=function(e){var t=null;return"string"==typeof e?e in sl?t=new Ju({resourceInfo:{data:{layers:[sl[e]]}}}):al.warn("Unable to find ground definition for: ".concat(e,'. Try "world-elevation"')):t=(0,q.se)(Ju,e),t}(e);return(0,B.Wi)(t)?this._get("ground"):t}},{key:"findLayerById",value:function(e){return this.allLayers.find((function(t){return t.id===e}))}},{key:"findTableById",value:function(e){return this.allTables.find((function(t){return t.id===e}))}}]),n}((0,n(83114).Q)((0,ul.K)(Oo.Z.EventedMixin(re.Z))));(0,S._)([(0,U.Cb)({readOnly:!0,dependsOn:[]})],cl.prototype,"allLayers",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],cl.prototype,"allTables",void 0),(0,S._)([(0,U.Cb)({type:Ru.default})],cl.prototype,"basemap",void 0),(0,S._)([(0,he.p)("basemap")],cl.prototype,"castBasemap",null),(0,S._)([(0,U.Cb)({readOnly:!0})],cl.prototype,"editableLayers",void 0),(0,S._)([(0,U.Cb)({type:Ju,nonNullable:!0})],cl.prototype,"ground",void 0),(0,S._)([(0,he.p)("ground")],cl.prototype,"castGround",null);var pl=cl=(0,S._)([(0,G.j)("esri.Map")],cl),fl=n(27615),dl=n(70420),hl=n(85001),vl=n(51996),yl=n(846),ml=n(59007),gl=n(30387),bl=n(39356);function _l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var wl=function(e){(0,M.Z)(n,e);var t=_l(n);function n(){return(0,k.Z)(this,n),t.apply(this,arguments)}return(0,C.Z)(n,[{key:"_own",value:function(e){e.parent=this.owner}},{key:"_release",value:function(e){e.parent=null}}]),n}(yl.a);wl=(0,S._)([(0,G.j)("esri.support.AnalysesCollection")],wl);var kl=n(74023);function Cl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var xl=function(e){(0,M.Z)(n,e);var t=Cl(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).view=null,r.baseLayerViews=new A.Z,r.referenceLayerViews=new A.Z,r._loadingHandle=(0,N.S1)((0,x.Z)(r),"view.map.basemap",(function(e){e&&e.load().catch((function(){}))})),r}return(0,C.Z)(n,[{key:"destroy",value:function(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null)}},{key:"suspended",get:function(){return!this.view||this.view.suspended}},{key:"updating",get:function(){return!(this.view&&this.view.suspended||!(this.view&&this.view.map&&this.view.map.basemap)||this.view.map.basemap.loaded)}}]),n}(re.Z);(0,S._)([(0,U.Cb)({constructOnly:!0})],xl.prototype,"view",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],xl.prototype,"baseLayerViews",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],xl.prototype,"referenceLayerViews",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],xl.prototype,"suspended",null),(0,S._)([(0,U.Cb)({type:Boolean,readOnly:!0})],xl.prototype,"updating",null),xl=(0,S._)([(0,G.j)("esri.views.BasemapView")],xl);var Zl=n(81660);function Ml(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Il(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Il(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Il(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Rl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Ol=V.Z.getLogger("esri.views.LayerViewManager"),Pl=function(){function e(t,n,r){var i=this;(0,k.Z)(this,e),this.layer=t,this.view=n,this.layerViewImporter=r,this._controller=new AbortController,this._deferred=(0,gr.dD)(),this._started=!1,this.done=!1,(0,gr.fu)(this._controller.signal,(function(){var e=new F.Z("cancelled:layerview-create","layerview creation cancelled",{layer:t});i._deferred.reject(e)}))}var t;return(0,C.Z)(e,[{key:"promise",get:function(){return this._deferred.promise}},{key:"destroy",value:function(){this._controller.abort();var e=this.layerView;if(e){var t=this.layer,n=this.view;t.emit("layerview-destroy",{view:n,layerView:e}),n.emit("layerview-destroy",{layer:t,layerView:e}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}}},{key:"start",value:(t=(0,O.Z)(T().mark((function e(){var t,n,r,i,o,a,s,u,l,c=this;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._started){e.next=2;break}return e.abrupt("return");case 2:return this._started=!0,t=this._controller.signal,n=this.layer,r=this.view,this._map=r.map,e.prev=5,e.next=8,n.load({signal:t});case 8:if(e.t0="prefetchResources"in n,!e.t0){e.next=12;break}return e.next=12,n.prefetchResources({signal:t});case 12:if(!n.createLayerView){e.next=18;break}return e.next=15,n.createLayerView(r,{signal:t});case 15:a=e.sent,e.next=24;break;case 18:if(this.layerViewImporter.hasLayerViewModule(n)){e.next=20;break}throw new F.Z("layer:view-not-supported","No layerview implementation was found");case 20:return e.next=22,this.layerViewImporter.importLayerView(n);case 22:u=e.sent,(0,gr.k_)(t),a="default"in u?new u.default({layer:n,view:r}):new u({layer:n,view:r});case 24:return l=function(){s=(0,B.hw)(s),a.destroyed||a.destroy(),a.layer=null,a.parent=null,a.view=null,c.done=!0},s=(0,gr.fu)(t,l),(0,gr.k_)(t),e.prev=26,e.next=29,a.when();case 29:e.next=34;break;case 31:throw e.prev=31,e.t1=e.catch(26),l(),e.t1;case 34:if(null==(i=this._map)||null==(o=i.allLayers)?void 0:o.includes(n)){e.next=36;break}return e.abrupt("return",(l(),void this._deferred.reject(new F.Z("view:no-layerview-for-layer","The layer has been removed from the map",{layer:n}))));case 36:this.layerView=a,n.emit("layerview-create",{view:r,layerView:a}),r.emit("layerview-create",{layer:n,layerView:a}),this.done=!0,this._deferred.resolve(a),e.next=42;break;case 39:e.prev=39,e.t2=e.catch(5),n.emit("layerview-create-error",{view:r,error:e.t2}),r.emit("layerview-create-error",{layer:n,error:e.t2}),this.done=!0,this._deferred.reject(new F.Z("layerview:create-error","layerview creation failed",{layer:n,error:e.t2}));case 42:case"end":return e.stop()}}),e,this,[[5,39],[26,31]])}))),function(){return t.apply(this,arguments)})}]),e}(),Tl=function(e){(0,M.Z)(r,e);var t,n=Rl(r);function r(e){var t;return(0,k.Z)(this,r),(t=n.call(this,e))._layerLayerViewInfoMap=new Map,t._watchUpdatingTracking=new oe.t,t.supportsGround=!0,t._preloadLayerViewModules=function(){var e,n=null==(e=t.view.map)?void 0:e.allLayers;if(n){var r,i=Ml(n);try{for(i.s();!(r=i.n()).done;){var o=r.value;t.layerViewImporter.hasLayerViewModule(o)&&t.layerViewImporter.importLayerView(o)}}catch(a){i.e(a)}finally{i.f()}}},t._reschedule=function(){return(0,B.Wi)(t._workPromise)&&(t._workPromise=(0,gr.dD)()),t.handles.remove("reschedule"),t.handles.add((0,ne.Os)(t._doWork),"reschedule"),t._workPromise.promise},t._doWork=function(){var e,n,r,i=t.view.map;if(t._map!==i&&(t.clear(),t._map=i),(0,B.Wi)(t._workPromise))t.notifyChange("updating");else{t.handles.remove("reschedule"),t.handles.remove("collection-change");var o=new j.Z({getCollections:function(){return t._rootCollectionNames.map((function(e){return t.get(e)}))},getChildrenFunction:function(e){return e&&"layers"in e?e.layers:null}});if(!o)return t._workPromise.resolve(),void(t._workPromise=null);var a,s=Ml(o);try{for(s.s();!(a=s.n()).done;){var u=a.value;t._createLayerView(u)}}catch(m){s.e(m)}finally{s.f()}t._refreshCollections();var l,c=Ml(t._layerLayerViewInfoMap);try{for(c.s();!(l=c.n()).done;){var p=(0,w.Z)(l.value,2),f=p[0],d=p[1];o.includes(f)||(t._layerLayerViewInfoMap.delete(d.layer),d.destroy())}}catch(m){c.e(m)}finally{c.f()}var v=o.filter((function(e){return"group"===e.type})).map((function(e){return e.layers})),y=[null==i||null==(e=i.ground)?void 0:e.layers,null==i||null==(n=i.basemap)?void 0:n.baseLayers,null==i||null==(r=i.basemap)?void 0:r.referenceLayers,null==i?void 0:i.layers].concat((0,h.Z)(v)).filter((function(e){return!!e}));t.handles.add(y.map((function(e){return t._watchUpdatingTracking.addOnCollectionChange(e,t._reschedule)})),"collection-change"),t._workPromise.resolve(),t._workPromise=null}},t}return(0,C.Z)(r,[{key:"initialize",value:function(){this.handles.add([(0,N.on)(this,"view.map.allLayers","change",this._preloadLayerViewModules,this._preloadLayerViewModules),(0,N.S1)(this.view,["map.basemap","map.ground","map.layers","ready"],this._reschedule,!0)]),this._preloadLayerViewModules(),this._reschedule()}},{key:"destroy",value:function(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null}},{key:"_layersToLayerViews",get:function(){var e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}},{key:"_rootCollectionNames",get:function(){return Array.from(this._layersToLayerViews.keys())}},{key:"updating",get:function(){return(0,B.pC)(this._workPromise)||this._watchUpdatingTracking.updating||(0,Zl.oE)(this._layerLayerViewInfoMap,(function(e){return!e.done}))}},{key:"updatingRemaining",get:function(){var e,t=0,n=Ml(this._layerLayerViewInfoMap.values());try{for(n.s();!(e=n.n()).done;){e.value.done||++t}}catch(r){n.e(r)}finally{n.f()}return t}},{key:"clear",value:function(){if(!this.destroyed){var e,t=Ml(this._layerLayerViewInfoMap.values());try{for(t.s();!(e=t.n()).done;){e.value.destroy()}}catch(n){t.e(n)}finally{t.f()}this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}},{key:"whenLayerView",value:(t=(0,O.Z)(T().mark((function e(t){return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._reschedule();case 2:if(this._layerLayerViewInfoMap.has(t)){e.next=4;break}throw new F.Z("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:t});case 4:return e.abrupt("return",this._layerLayerViewInfoMap.get(t).promise);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_refreshCollections",value:function(){var e,t=Ml(this._layersToLayerViews);try{for(t.s();!(e=t.n()).done;){var n=(0,w.Z)(e.value,2),r=n[0],i=n[1];this._populateLayerViewsOwners(this.get(r),this.get(i),this.view)}}catch(o){t.e(o)}finally{t.f()}this.notifyChange("updating"),this.notifyChange("updatingRemaining")}},{key:"_populateLayerViewsOwners",value:function(e,t,n){if(e&&t){var r,i=0,o=Ml(e);try{for(o.s();!(r=o.n()).done;){var a=r.value,s=this._layerLayerViewInfoMap.get(a);if(s&&s.layerView){var u=s.layerView;u.layer=a,u.parent=n,t.getItemAt(i)!==u&&t.splice(i,0,u),a.layers&&this._populateLayerViewsOwners(a.layers,u.layerViews,u),i+=1}}}catch(l){o.e(l)}finally{o.f()}i<t.length&&t.splice(i,t.length)}else t&&t.removeAll()}},{key:"_createLayerView",value:function(e){var t=this;if(this._layerLayerViewInfoMap.has(e))return this.view.ready&&this._layerLayerViewInfoMap.get(e).start(),this.notifyChange("updating"),void this.notifyChange("updatingRemaining");e.load().catch((function(){})),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);var n=new Pl(e,this.view,this.layerViewImporter);n.promise.then((function(){return t._refreshCollections()}),(function(n){var r,i;n&&((0,gr.D_)(n)||"cancelled:layerview-create"===n.name)||Ol.error("Failed to create layerview for layer title:'".concat(null!=(r=e.title)?r:"no title","', id:'").concat(null!=(i=e.id)?i:"no id","' of type '").concat(e.type,"'."),{layer:e,error:n}),t._refreshCollections()})),this._layerLayerViewInfoMap.set(e,n),this.view.ready&&n.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}}]),r}(_e.r);(0,S._)([(0,U.Cb)()],Tl.prototype,"_workPromise",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],Tl.prototype,"_watchUpdatingTracking",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],Tl.prototype,"_layersToLayerViews",null),(0,S._)([(0,U.Cb)({readOnly:!0})],Tl.prototype,"_rootCollectionNames",null),(0,S._)([(0,U.Cb)()],Tl.prototype,"layerViewImporter",void 0),(0,S._)([(0,U.Cb)()],Tl.prototype,"supportsGround",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],Tl.prototype,"updating",null),(0,S._)([(0,U.Cb)({readOnly:!0})],Tl.prototype,"updatingRemaining",null),(0,S._)([(0,U.Cb)({constructOnly:!0})],Tl.prototype,"view",void 0);var Sl=Tl=(0,S._)([(0,G.j)("esri.views.LayerViewManager")],Tl);function El(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Al=function(e){(0,M.Z)(n,e);var t=El(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).factor=1.5,r.offset=(0,ku.vW)(0,0),r.position=null,r.size=120,r.maskUrl=null,r.maskEnabled=!0,r.overlayUrl=null,r.overlayEnabled=!0,r.visible=!0,r}return(0,C.Z)(n,[{key:"version",get:function(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}}]),n}(re.Z);(0,S._)([(0,U.Cb)({type:Number})],Al.prototype,"factor",void 0),(0,S._)([(0,U.Cb)({nonNullable:!0})],Al.prototype,"offset",void 0),(0,S._)([(0,U.Cb)()],Al.prototype,"position",void 0),(0,S._)([(0,U.Cb)({type:Number,range:{min:0}})],Al.prototype,"size",void 0),(0,S._)([(0,U.Cb)()],Al.prototype,"maskUrl",void 0),(0,S._)([(0,U.Cb)()],Al.prototype,"maskEnabled",void 0),(0,S._)([(0,U.Cb)()],Al.prototype,"overlayUrl",void 0),(0,S._)([(0,U.Cb)()],Al.prototype,"overlayEnabled",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],Al.prototype,"version",null),(0,S._)([(0,U.Cb)({type:Boolean})],Al.prototype,"visible",void 0);var jl=Al=(0,S._)([(0,G.j)("esri.views.Magnifier")],Al),Fl=n(77921),Ll=function(){function e(t,n){(0,k.Z)(this,e),this._stage=t,this._textureRequests=new Map,this._frameTask=(0,B.pC)(n)?n.registerTask(Fl.T8.TEXTURE_UNLOAD):Fl.sq}return(0,C.Z)(e,[{key:"destroy",value:function(){var e=this;this._frameTask.remove(),this._textureRequests.forEach((function(t){return e._releaseTextureRequest(t)})),this._textureRequests.clear()}},{key:"fromData",value:function(e,t){var n=this,r=this.makeUid(e),i=this._textureRequests.get(r);return i||(i={referenceCount:0,texture:t(),textureAsync:null,abortController:null},this._stage&&(this._stage.add(i.texture),this._stage.loadSynchronous(i.texture)),this._textureRequests.set(r,i)),i.referenceCount++,{uid:r,texture:i.texture,release:function(){return n._release(r)}}}},{key:"_release",value:function(e){var t=this;if(this._textureRequests){var n=this._textureRequests.get(e);n?(n.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),n.referenceCount--,n.referenceCount<1&&this._frameTask.schedule((function(){return t._releaseNow(e)}))):console.warn("TextureCollection: texture doesn't exist: '".concat(e,"'"))}}},{key:"test",get:function(){return{textureRequests:this._textureRequests}}},{key:"_releaseNow",value:function(e){if(this._textureRequests){var t=this._textureRequests.get(e);!t||t.referenceCount>0||(this._releaseTextureRequest(t),this._textureRequests.delete(e))}}},{key:"_releaseTextureRequest",value:function(e){var t;e.texture?null==(t=this._stage)||t.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}},{key:"makeUid",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(0,B.pC)(t)?"".concat(e,".").concat(t,"px"):e}}]),e}(),Dl=n(37593);function Vl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}function Bl(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Nl(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Nl(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Nl(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var zl=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],Ul={};function Wl(e){return!!Ul[e]}zl.forEach((function(e){Ul[e]=!0}));var ql=function(){function e(t){(0,k.Z)(this,e),this.handlers=new Map,this.counter=0,this.handlerCounts=new Map,this.view=t,this.inputManager=null}return(0,C.Z)(e,[{key:"connect",value:function(e){var t=this;e&&this.disconnect(),this.inputManager=e,this.handlers.forEach((function(e,n){var r=e.handler,i=e.priority;return t.inputManager.installHandlers(n,[r],i)}))}},{key:"disconnect",value:function(){var e=this;this.inputManager&&this.handlers.forEach((function(t,n){return e.inputManager.uninstallHandlers(n)})),this.inputManager=null}},{key:"destroy",value:function(){this.disconnect(),this.handlers.clear(),this.view=null}},{key:"on",value:function(e,t,n,r){var i,o,a=this,s=Array.isArray(e)?e:e.split(",");if(!function(e){var t,n=Bl(e);try{for(n.s();!(t=n.n()).done;)if(!Wl(t.value))return!1}catch(r){n.e(r)}finally{n.f()}return!0}(s))return s.some(Wl)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;Array.isArray(t)?o=t:(i=t,o=[]),"function"==typeof n?i=n:r=n,r=null!=r?r:ta.f.DEFAULT;var u=this.createUniqueGroupName(),l=new Gl(this.view,s,o,i);this.handlers.set(u,{handler:l,priority:r});var c,p=Bl(s);try{for(p.s();!(c=p.n()).done;){var f=c.value,d=this.handlerCounts.get(f)||0;this.handlerCounts.set(f,d+1)}}catch(h){p.e(h)}finally{p.f()}return this.inputManager&&this.inputManager.installHandlers(u,[l],r),{remove:function(){return a.removeHandler(u,s)}}}},{key:"hasHandler",value:function(e){return!!this.handlerCounts.get(e)}},{key:"removeHandler",value:function(e,t){if(this.handlers.has(e)){this.handlers.delete(e);var n,r=Bl(t);try{for(r.s();!(n=r.n()).done;){var i=n.value,o=this.handlerCounts.get(i);void 0===o?console.error("Trying to remove handler for event that has no handlers registered: ",i):1===o?this.handlerCounts.delete(i):this.handlerCounts.set(i,o-1)}}catch(a){r.e(a)}finally{r.f()}}this.inputManager&&this.inputManager.uninstallHandlers(e)}},{key:"createUniqueGroupName",value:function(){return this.counter+=1,"viewEvents_".concat(this.counter)}}]),e}(),Gl=function(e){(0,M.Z)(n,e);var t=Vl(n);function n(e,r,i,o){var a;(0,k.Z)(this,n),(a=t.call(this,!0)).view=e;var s,u=Bl(r);try{for(u.s();!(s=u.n()).done;){switch(s.value){case"click":a.registerIncoming("click",i,(function(e){return o(a.wrapClick(e))}));break;case"double-click":a.registerIncoming("double-click",i,(function(e){return o(a.wrapDoubleClick(e))}));break;case"immediate-click":a.registerIncoming("immediate-click",i,(function(e){return o(a.wrapImmediateClick(e))}));break;case"immediate-double-click":a.registerIncoming("immediate-double-click",i,(function(e){return o(a.wrapImmediateDoubleClick(e))}));break;case"hold":a.registerIncoming("hold",i,(function(e){return o(a.wrapHold(e))}));break;case"drag":a.registerIncoming("drag",i,(function(e){var t=a.wrapDrag(e);t&&o(t)}));break;case"key-down":a.registerIncoming("key-down",i,(function(e){return o(a.wrapKeyDown(e))}));break;case"key-up":a.registerIncoming("key-up",i,(function(e){return o(a.wrapKeyUp(e))}));break;case"pointer-down":a.registerIncoming("pointer-down",i,(function(e){return o(a.wrapPointer(e,"pointer-down"))}));break;case"pointer-move":a.registerIncoming("pointer-move",i,(function(e){return o(a.wrapPointer(e,"pointer-move"))}));break;case"pointer-up":a.registerIncoming("pointer-up",i,(function(e){return o(a.wrapPointer(e,"pointer-up"))}));break;case"pointer-drag":a.registerIncoming("pointer-drag",i,(function(e){return o(a.wrapPointerDrag(e))}));break;case"mouse-wheel":a.registerIncoming("mouse-wheel",i,(function(e){return o(a.wrapMouseWheel(e))}));break;case"pointer-enter":a.registerIncoming("pointer-enter",i,(function(e){return o(a.wrapPointer(e,"pointer-enter"))}));break;case"pointer-leave":a.registerIncoming("pointer-leave",i,(function(e){return o(a.wrapPointer(e,"pointer-leave"))}));break;case"gamepad":a.registerIncoming("gamepad",i,(function(e){o(a.wrapGamepad(e))}));break;case"focus":a.registerIncoming("focus",i,(function(e){o(a.wrapFocus(e))}));break;case"blur":a.registerIncoming("blur",i,(function(e){o(a.wrapBlur(e))}))}}}catch(l){u.e(l)}finally{u.f()}return a}return(0,C.Z)(n,[{key:"wrapFocus",value:function(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"wrapBlur",value:function(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"wrapClick",value:function(e){var t=e.data,n=t.pointerType,r=t.button,i=t.buttons,o=t.x,a=t.y,s=t.native,u=t.eventId,l=e.cancelable;return{type:"click",pointerType:n,button:r,buttons:i,x:o,y:a,native:s,timestamp:e.timestamp,screenPoint:(0,ku.vW)(o,a),mapPoint:this.getMapPoint(o,a),eventId:u,cancelable:l,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"wrapDoubleClick",value:function(e){var t=e.data,n=t.pointerType,r=t.button,i=t.buttons,o=t.x,a=t.y,s=t.native,u=t.eventId,l=e.cancelable;return{type:"double-click",pointerType:n,button:r,buttons:i,x:o,y:a,native:s,timestamp:e.timestamp,mapPoint:this.getMapPoint(o,a),eventId:u,cancelable:l,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"wrapImmediateClick",value:function(e){var t=e.data,n=t.pointerType,r=t.button,i=t.buttons,o=t.x,a=t.y,s=t.native,u=t.eventId,l=s.pointerId,c=e.cancelable;return{type:"immediate-click",pointerId:l,pointerType:n,button:r,buttons:i,x:o,y:a,native:s,timestamp:e.timestamp,mapPoint:this.getMapPoint(o,a),eventId:u,cancelable:c,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"wrapImmediateDoubleClick",value:function(e){var t=e.data,n=t.pointerType,r=t.button,i=t.buttons,o=t.x,a=t.y,s=t.native,u=t.eventId,l=s.pointerId,c=e.cancelable;return{type:"immediate-double-click",pointerId:l,pointerType:n,button:r,buttons:i,x:o,y:a,native:s,timestamp:e.timestamp,mapPoint:this.getMapPoint(o,a),eventId:u,cancelable:c,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"wrapHold",value:function(e){var t=e.data,n=t.pointerType,r=t.button,i=t.buttons,o=t.x,a=t.y,s=t.native,u=e.cancelable;return{type:"hold",pointerType:n,button:r,buttons:i,x:o,y:a,native:s,timestamp:e.timestamp,mapPoint:this.getMapPoint(o,a),cancelable:u,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"getMapPoint",value:function(e,t){return this.view.toMap((0,ku.vW)(e,t),{exclude:[]})}},{key:"wrapDrag",value:function(e){var t=e.data,n=t.center,r=n.x,i=n.y,o=t.action,a=t.pointerType,s=t.button;if("start"===o&&(this.latestDragStart=t),this.latestDragStart){var u=t.pointer.native,l=t.buttons,c=e.cancelable,p=e.timestamp,f={x:this.latestDragStart.center.x,y:this.latestDragStart.center.y};return"end"===o&&(this.latestDragStart=void 0),{type:"drag",action:o,x:r,y:i,origin:f,pointerType:a,button:s,buttons:l,radius:t.radius,angle:(0,ye.BV)(t.angle),native:u,timestamp:p,cancelable:c,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}}},{key:"wrapKeyDown",value:function(e){var t=e.data,n=t.key,r=t.repeat,i=t.native,o=e.cancelable;return{type:"key-down",key:n,repeat:r,native:i,timestamp:e.timestamp,cancelable:o,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"wrapKeyUp",value:function(e){var t=e.data,n=t.key,r=t.native,i=e.cancelable;return{type:"key-up",key:n,native:r,timestamp:e.timestamp,cancelable:i,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"wrapPointer",value:function(e,t){var n=e.data,r=n.x,i=n.y,o=n.button,a=n.buttons,s=n.native,u=n.eventId,l=s.pointerId,c=s.pointerType,p=e.cancelable;return{type:t,x:r,y:i,pointerId:l,pointerType:c,button:o,buttons:a,native:s,timestamp:e.timestamp,eventId:u,cancelable:p,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"wrapPointerDrag",value:function(e){var t=e.data.currentEvent,n=t.x,r=t.y,i=t.buttons,o=t.native,a=t.eventId,s=e.data.startEvent.button,u=e.data.startEvent.native.pointerId,l=e.data.startEvent.native.pointerType,c=e.data.action,p={x:e.data.startEvent.x,y:e.data.startEvent.y},f=e.cancelable;return{type:"pointer-drag",x:n,y:r,pointerId:u,pointerType:l,button:s,buttons:i,action:c,origin:p,native:o,timestamp:e.timestamp,eventId:a,cancelable:f,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"wrapMouseWheel",value:function(e){var t=e.cancelable,n=e.data,r=e.timestamp;return{type:"mouse-wheel",x:n.x,y:n.y,deltaY:n.deltaY,native:n.native,timestamp:r,cancelable:t,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"wrapGamepad",value:function(e){var t=e.data,n=t.action,r=t.state,i=t.device,o=e.cancelable;return{type:"gamepad",device:i,timestamp:e.timestamp,action:n,buttons:r.buttons,axes:r.axes,cancelable:o,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}}]),n}(Dl.a);function Hl(e){return e.visible&&e.getEditableFlag(0)&&e.getEditableFlag(1)}function Kl(e){return(0,ku.vW)(e.x,e.y)}function Yl(e,t){var n=(e instanceof HTMLElement?e:e.surface).getBoundingClientRect();return(0,ku.vW)(t.clientX-n.left,t.clientY-n.top)}function Jl(e,t){return t instanceof Event?Yl(e,t):Kl(t)}function $l(e){if(e instanceof Event)return!0;if("object"==typeof e&&"type"in e)switch(e.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}var Ql=function(){function e(){(0,k.Z)(this,e),this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._currentlyActiveTool=null,this._revertToActiveTool=!1,this._cursor=null}return(0,C.Z)(e,[{key:"cursor",get:function(){return this._cursor}},{key:"handleInputEvent",value:function(e,t){var n=function(){return e.stopPropagation()};switch(e.type){case"pointer-move":Xl(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(n(),"end"===e.action&&(this._stopDrag=!1));break;case"pointer-down":if(!ec(e))break;var r=Kl(e),i=this._intersect(r,e.pointerType,t.forEachTool);if((0,B.Wi)(i))break;var o=this._findToolAndManipulatorByKey(i,t.forEachTool,tc),a=(0,B.yw)(o,(function(e){return e.manipulator})),s=(0,B.yw)(o,(function(e){return e.tool}));!((0,B.pC)(a)&&(0,B.pC)(s)&&a.interactive)||a.grabbable&&a.grabbableForEvent(e)||!a.grabbing||a.dragging||this._ungrabManipulatorBeforeDragging(a,s,e),(0,B.pC)(a)&&a.interactive&&a.grabbable&&a.grabbableForEvent(e)&&!a.grabbing&&(this._grabbedManipulators.set(e.pointerId,{key:i,start:r,pointerType:e.pointerType}),1===this._grabbedManipulators.size&&t.activeTool!==i.tool&&(this._currentlyActiveTool=t.activeTool,this._revertToActiveTool=!0,t.setActiveTool(i.tool)),a.grabbing=!0,a.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:r}),n());break;case"pointer-up":this._handlePointerEnd(e,t);break;case"pointer-drag":if(!ec(e))break;var u=this._grabbedManipulators.get(e.pointerId),l=this._draggedManipulators.get(e.pointerId),c=(0,B.yw)(u||l,(function(e){return e.key})),p=this._findManipulatorByKey(c,t.forEachTool);if((0,B.Wi)(p))break;var f=Kl(e);f.x=(0,ye.uZ)(f.x,0,t.view.width),f.y=(0,ye.uZ)(f.y,0,t.view.height);var d=(0,B.Wg)(u||l).start;switch(e.action){case"start":case"update":"update"!==e.action&&1!==this._grabbedManipulators.size||(p.dragging=!0,l?p.events.emit("drag",{action:"update",start:d,screenPoint:f}):p.events.emit("drag",{action:"start",start:d,screenPoint:f,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{key:(0,B.Wg)(c),start:d}));break;case"end":p.dragging=!1,l&&p.events.emit("drag",{action:"end",start:d,screenPoint:f}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,t)}n();break;case"immediate-click":var h=Kl(e),v=this._intersect(h,e.pointerType,t.forEachTool),y=this._findToolAndManipulatorByKey(v,t.forEachTool,tc);if(function(e){return!!e.native.shiftKey}(e)||t.forEachTool((function(e){if((!(0,B.pC)(y)||y.tool!==e||e.automaticManipulatorSelection)&&e.manipulators){var t=!1;e.manipulators.forEach((function(e){var n=e.manipulator;n.selected&&(n.selected=!1,t=!0)})),t&&e.manipulatorSelectionChanged&&e.manipulatorSelectionChanged()}})),(0,B.Wi)(y))break;var m=y.manipulator,g=y.tool;if(!m.interactive)break;m.selectable&&g.automaticManipulatorSelection&&(m.selected=!m.selected,g.manipulatorSelectionChanged&&g.manipulatorSelectionChanged());var b=e.native.shiftKey;m.events.emit("immediate-click",{screenPoint:h,button:e.button,pointerType:e.pointerType,shiftKey:b,stopPropagation:n});break;case"click":var _=Kl(e),w=this._intersect(_,e.pointerType,t.forEachTool),k=this._findManipulatorByKey(w,t.forEachTool);if((0,B.Wi)(k)||!k.interactive)break;var C=e.native.shiftKey;k.events.emit(e.type,{screenPoint:_,button:e.button,pointerType:e.pointerType,shiftKey:C}),n();break;case"double-click":var x=Kl(e),Z=this._intersect(x,e.pointerType,t.forEachTool),M=this._findManipulatorByKey(Z,t.forEachTool);if((0,B.Wi)(M)||!M.interactive)break;var I=e.native.shiftKey;M.events.emit("double-click",{screenPoint:x,button:e.button,pointerType:e.pointerType,shiftKey:I,stopPropagation:n});break;case"immediate-double-click":var R=Kl(e),O=this._intersect(R,e.pointerType,t.forEachTool),P=this._findManipulatorByKey(O,t.forEachTool);if((0,B.Wi)(P)||!P.interactive)break;var T=e.native.shiftKey;P.events.emit("immediate-double-click",{screenPoint:R,button:e.button,pointerType:e.pointerType,shiftKey:T,stopPropagation:n})}this._updateCursor(t.forEachTool)}},{key:"_ungrabManipulatorBeforeDragging",value:function(e,t,n){var r=this;e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:n.pointerType,screenPoint:Kl(n)}),this._grabbedManipulators.forEach((function(n,i){var o=n.key;o.tool===t&&t.manipulators.findById(o.manipulatorId)===e&&r._grabbedManipulators.delete(i)}))}},{key:"_handlePointerEnd",value:function(e,t){var n=(0,B.yw)(this._grabbedManipulators.get(e.pointerId),(function(e){return e.key})),r=this._findManipulatorByKey(n,t.forEachTool);(0,B.pC)(r)&&!r.dragging&&(1===this._grabbedManipulators.size&&0===this._draggedManipulators.size&&this._revertToActiveTool&&(t.setActiveTool(this._currentlyActiveTool),this._revertToActiveTool=!1,this._currentlyActiveTool=null),r.grabbing&&(r.grabbing=!1,r.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:Kl(e)})),this._grabbedManipulators.delete(e.pointerId))}},{key:"_cursorFromMap",value:function(e,t){var n=this,r=null;return(0,Zl.oE)(e,(function(e){var i=e.key,o=n._findManipulatorByKey(i,t);return!!((0,B.pC)(o)&&o.interactive&&"cursor"in o&&o.cursor)&&(r=o.cursor,!0)})),r}},{key:"_updateCursor",value:function(e){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators,e)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators,e)||"pointer":this._cursor=null}},{key:"clearPointers",value:function(e,t){var n=this,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3?arguments[3]:void 0,o=function(t){return t.tool===e&&((0,B.Wi)(i)||t.manipulatorId===i)};this._grabbedManipulators.forEach((function(e,r){var i=e.key,a=e.pointerType;if(o(i)){n._grabbedManipulators.delete(r);var s=n._findManipulatorByKey(i,t);(0,B.pC)(s)&&(s.grabbing=!1,s.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:a}))}})),this._draggedManipulators.forEach((function(e,r){var i=e.key;if(o(i)){n._draggedManipulators.delete(r);var a=n._findManipulatorByKey(i,t);(0,B.pC)(a)&&(a.dragging=!1,a.events.emit("drag",{action:"cancel"}))}})),r&&this._hoveredManipulators.forEach((function(e,r){var i=e.key;if(o(i)){n._hoveredManipulators.delete(r);var a=n._findManipulatorByKey(i,t);(0,B.pC)(a)&&(a.hovering=!1)}})),this._updateCursor(t)}},{key:"_intersect",value:function(e,t,n){var r=null;return n((function(n){if(null==n.manipulators||!Hl(n))return!1;var i=n.manipulators.intersect(e,t);return!(0,B.Wi)(i)&&(r={manipulatorId:i.id,tool:n},!0)})),r}},{key:"updateHoveredStateFromKnownPointers",value:function(e){var t=this;this._pointerLocations.forEach((function(n,r){t._updateHoveredStateForPointerAtScreenPosition((0,ku.vW)(n.x,n.y),r,n.pointerType,e)}))}},{key:"handleHoverEvent",value:function(e,t){"pointer-up"!==e.type&&"immediate-click"!==e.type&&"pointer-move"!==e.type||!Xl(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(Kl(e),e.pointerId,e.pointerType,t)}},{key:"_updateHoveredStateForPointerAtScreenPosition",value:function(e,t,n,r){var i=this._intersect(e,n,r),o=this._findManipulatorByKey(i,r),a=(0,B.yw)(this._hoveredManipulators.get(t),(function(e){return e.key})),s=this._findManipulatorByKey(a,r);(0,B.pC)(o)&&!o.interactive&&(o=null),s!==o&&((0,B.pC)(s)&&(s.hovering=!1),(0,B.pC)(o)?(o.hovering=!0,this._hoveredManipulators.set(t,{key:(0,B.Wg)(i)})):this._hoveredManipulators.delete(t),this._updateCursor(r))}},{key:"_findManipulatorByKey",value:function(e,t){return this._findToolAndManipulatorByKey(e,t,tc)?tc.manipulator:null}},{key:"_findToolAndManipulatorByKey",value:function(e,t,n){return(0,B.Wi)(e)?null:(n.tool=null,n.manipulator=null,t((function(t){if(t!==e.tool||null==t.manipulators||!Hl(t))return!1;var r=t.manipulators.findById(e.manipulatorId);return!!(0,B.pC)(r)&&(n.manipulator=r,n.tool=t,!0)})),n.manipulator?n:null)}}]),e}();function Xl(e){return"mouse"===e}function ec(e){return"mouse"!==e.pointerType||0===e.button}var tc={manipulator:null,tool:null};function nc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function rc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nc(Object(n),!0).forEach((function(t){(0,H.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nc(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ic(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return oc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return oc(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function oc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ac(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var sc=V.Z.getLogger("esri.views.ToolViewManager"),uc="attached",lc="tools",cc=function(e){(0,M.Z)(n,e);var t=ac(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e))._manipulatorState=new Ql,r.tools=new A.Z,r.cursor=null,r._forEachTool=function(e){var t,n=ic(r.tools.items);try{for(n.s();!(t=n.n()).done;){if(e(t.value))return}}catch(i){n.e(i)}finally{n.f()}},r}return(0,C.Z)(n,[{key:"initialize",value:function(){var e=this;this.handles.add([this.view.on(zl,(function(t){e._handleInputEvent(t)}),ta.f.TOOL)].concat((0,h.Z)(function(e){return[e.on("after-add",(function(e){var t=e.item;t.view&&t.view.ready&&!t.attached&&t.attach()})),e.on("after-remove",(function(e){var t=e.item;t.active&&(t.view.activeTool=null),t.attached&&t.detach()}))]}(this.tools)),[this.tools.on("before-add",(function(t){var n=t.item;if(null==n||e.tools.includes(n))return sc.warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void t.preventDefault()})),this.tools.on("before-remove",(function(t){var n=t.item;e._manipulatorState.clearPointers(n,e._forEachTool)})),this.tools.on("change",(function(){e._refreshToolWatchers()}))]))}},{key:"destroy",value:function(){this._forEachTool((function(e){return e.destroy()}))}},{key:"activeTool",set:function(e){if(!(0,B.pC)(e)||this.view.ready)if(e!==this.activeTool){(0,B.pC)(this.activeTool)&&this.activeTool.deactivate(),(0,B.pC)(e)&&e.activate(),this._set("activeTool",e),this._removeIncompleteTools(e);var t,n=(0,B.Wi)(this.activeTool),r=ic(this.tools);try{for(r.s();!(t=r.n()).done;){var i=t.value;i.setEditableFlag(1,n||i===this.activeTool);var o=Hl(i);!n&&o||this._manipulatorState.clearPointers(i,this._forEachTool,!o)}}catch(a){r.e(a)}finally{r.f()}this._updateCursor()}else(0,B.pC)(e)&&sc.warn("Tool is already active - ignoring activation request.");else sc.error("Cannot set active tool while view is not ready.")}},{key:"updating",get:function(){return this.updatingHandles.updating||this.tools.some((function(e){return e.updating}))}},{key:"attach",value:function(){var e=this;this._forEachTool((function(e){return e.attach()})),"3d"===this.view.type?(this._set("textures",new Ll(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([this.view.state.watch("camera",(function(){e._forEachManipulator((function(e){null!=e.onViewChange&&e.onViewChange()}))})),this.view.elevationProvider.on("elevation-change",(function(t){e._forEachManipulator((function(e){null!=e.onElevationChange&&e.onElevationChange(t)}))})),(0,dl.kB)((function(){return e._set("textures",(0,B.SC)(e.textures))}))],uc)):this.handles.add(this.view.watch("extent",(function(){e._forEachManipulator((function(e){null!=e.onViewChange&&e.onViewChange()}))})))}},{key:"detach",value:function(){(0,B.pC)(this.activeTool)&&(this.activeTool=null),this._forEachTool((function(e){e.detach(),e.destroy()})),this.tools.removeAll(),this.handles.remove(uc)}},{key:"_forEachManipulator",value:function(e){this._forEachTool((function(t){t.manipulators&&t.manipulators.forEach((function(n){var r=n.manipulator;return e(r,t)}))}))}},{key:"_handleInputEvent",value:function(e){var t=this,n=!1,r=rc(rc({},e),{},{stopPropagation:function(){n=!0,e.stopPropagation()}});(0,B.pC)(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(r):this._forEachTool((function(e){!n&&e.attached&&e.visible&&e.handleInputEvent(r)})),!n&&"key-down"===e.type&&"Escape"===e.key&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(r,{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:function(e){t.activeTool=e},view:this.view}),!n&&(0,B.pC)(this.activeTool)&&this.activeTool.handleInputEventAfter(r),this._manipulatorState.handleHoverEvent(r,this._forEachTool),this._updateCursor()}},{key:"_refreshToolWatchers",value:function(){var e=this;this.handles.remove(lc),this._forEachTool((function(t){if(t instanceof re.Z){var n=(0,N.YP)(t,["cursor","visible","editable"],(function(){Hl(t)||e._manipulatorState.clearPointers(t,e._forEachTool),e._updateCursor()}));e.handles.add(n,lc)}t.manipulators&&e.handles.add(t.manipulators.on("change",(function(n){n.removed.forEach((function(n){var r=n.id;e._manipulatorState.clearPointers(t,e._forEachTool,!0,r)})),e._manipulatorState.updateHoveredStateFromKnownPointers(e._forEachTool),e._updateCursor()})),lc)})),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}},{key:"_updateCursor",value:function(){var e=this._manipulatorState.cursor;this._forEachTool((function(t){return!(!(0,B.pC)(t.cursor)||!t.visible||(e=t.cursor,0))})),this._get("cursor")!==e&&this._set("cursor",e)}},{key:"_removeIncompleteTools",value:function(e){var t=this;this.tools.filter((function(t){return((0,B.Wi)(e)||t!==e)&&!t.completed})).forEach((function(e){t.tools.remove(e),e.destroy()}))}}]),n}(_e.r);(0,S._)([(0,U.Cb)({constructOnly:!0,nonNullable:!0})],cc.prototype,"view",void 0),(0,S._)([(0,U.Cb)({readOnly:!0,nonNullable:!0})],cc.prototype,"textures",void 0),(0,S._)([(0,U.Cb)({value:null})],cc.prototype,"activeTool",null),(0,S._)([(0,U.Cb)({readOnly:!0,type:A.Z})],cc.prototype,"tools",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],cc.prototype,"cursor",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],cc.prototype,"updating",null);var pc=cc=(0,S._)([(0,G.j)("esri.views.ToolViewManager")],cc);function fc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var dc=function(e){(0,M.Z)(n,e);var t=fc(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this)).nativeIndex=null,r._detectedDeviceType="unknown","standard"===e.mapping?r._detectedDeviceType="standard":hc.test(e.id)?r._detectedDeviceType="spacemouse":r._detectedDeviceType="unknown",r.nativeIndex=e.index,r}return(0,C.Z)(n,[{key:"native",get:function(){return(navigator.getGamepads?navigator.getGamepads():[])[this.nativeIndex]}},{key:"deviceType",get:function(){return this._detectedDeviceType}},{key:"axisThreshold",get:function(){return vc[this.deviceType]}}]),n}(re.Z);(0,S._)([(0,U.Cb)({nonNullable:!0,readOnly:!0})],dc.prototype,"nativeIndex",void 0),(0,S._)([(0,U.Cb)({type:String,readOnly:!0})],dc.prototype,"deviceType",null),(0,S._)([(0,U.Cb)({type:Number,readOnly:!0})],dc.prototype,"axisThreshold",null),dc=(0,S._)([(0,G.j)("esri.views.input.gamepad.GamepadInputDevice")],dc);var hc=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),vc={standard:.15,spacemouse:.025,unknown:0},yc=dc;function mc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var gc=function(e){(0,M.Z)(n,e);var t=mc(n);function n(){var e;(0,k.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).devices=new A.Z,e.enabledFocusMode="document",e}return(0,C.Z)(n)}(re.Z);(0,S._)([(0,U.Cb)({type:A.Z.ofType(yc),readOnly:!0})],gc.prototype,"devices",void 0),(0,S._)([(0,U.Cb)({type:["document","view","none"]})],gc.prototype,"enabledFocusMode",void 0);var bc=gc=(0,S._)([(0,G.j)("esri.views.input.gamepad.GamepadSettings")],gc);function _c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var wc=function(e){(0,M.Z)(n,e);var t=_c(n);function n(){var e;return(0,k.Z)(this,n),(e=t.apply(this,arguments)).gamepad=new bc,e}return(0,C.Z)(n)}(re.Z);(0,S._)([(0,U.Cb)({readOnly:!0})],wc.prototype,"gamepad",void 0);var kc=wc=(0,S._)([(0,G.j)("esri.views.input.Input")],wc);function Cc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var xc=function(e){(0,M.Z)(n,e);var t=Cc(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).enabled=!0,r.device=null,r.mode="pan",r.tiltDirection="forward-down",r.velocityFactor=1,r}return(0,C.Z)(n)}(re.Z);(0,S._)([(0,U.Cb)({type:Boolean,nonNullable:!0})],xc.prototype,"enabled",void 0),(0,S._)([(0,U.Cb)({type:yc})],xc.prototype,"device",void 0),(0,S._)([(0,U.Cb)({type:["pan","zoom"],nonNullable:!0})],xc.prototype,"mode",void 0),(0,S._)([(0,U.Cb)({type:["forward-down","forward-up"],nonNullable:!0})],xc.prototype,"tiltDirection",void 0),(0,S._)([(0,U.Cb)({type:Number,nonNullable:!0})],xc.prototype,"velocityFactor",void 0);var Zc=xc=(0,S._)([(0,G.j)("esri.views.navigation.gamepad.GamepadSettings")],xc);function Mc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Ic=function(e){(0,M.Z)(n,e);var t=Mc(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).browserTouchPanEnabled=!0,r.gamepad=new Zc,r.momentumEnabled=!0,r.mouseWheelZoomEnabled=!0,r}return(0,C.Z)(n)}(re.Z);(0,S._)([(0,U.Cb)({type:Boolean})],Ic.prototype,"browserTouchPanEnabled",void 0),(0,S._)([(0,U.Cb)({type:Zc,nonNullable:!0})],Ic.prototype,"gamepad",void 0),(0,S._)([(0,U.Cb)({type:Boolean})],Ic.prototype,"momentumEnabled",void 0),(0,S._)([(0,U.Cb)({type:Boolean})],Ic.prototype,"mouseWheelZoomEnabled",void 0);var Rc=Ic=(0,S._)([(0,G.j)("esri.views.navigation.Navigation")],Ic),Oc=n(93269),Pc=n(90697);function Tc(e){var t=e.url&&(0,Pc.Qc)(e.url);return null==(e.spatialReference&&e.spatialReference.vcsWkid)&&(0,B.pC)(t)&&"ImageServer"===t.serverType||!Sc(e)||!e.heightModelInfo?Ac(e)?gl.Z.deriveUnitFromSR(Lc,e.spatialReference):null:e.heightModelInfo}function Sc(e){return"heightModelInfo"in e}function Ec(e){if("unknown"===e.type||!("capabilities"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"wfs":return!0;default:return!1}}function Ac(e){return Ec(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):Fc(e)}function jc(e){return null!=e.layers||Fc(e)||Ec(e)||Sc(e)}function Fc(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"analysis":case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"map-image":case"map-notes":case"ogc-feature":case"open-street-map":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}var Lc=new gl.Z({heightModel:"gravity-related-height"});function Dc(e){return 1===e?"global":"local"}function Vc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Bc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Vc(Object(n),!0).forEach((function(t){(0,H.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Vc(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Nc(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return zc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return zc(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function zc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Uc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Wc=V.Z.getLogger("esri.views.support.DefaultsFromMap");Wc.level="info";var qc=function(e){(0,M.Z)(r,e);var t=Uc(r);function r(e){var n;return(0,k.Z)(this,r),(n=t.call(this,e))._handles=new Y.Z,n.required={tileInfo:!1,heightModelInfo:!1,extent:!1},n.defaultSpatialReference=null,n.userSpatialReference=null,n.priorityCollection=null,n.logDebugInformation=!1,n.suspended=!1,n._projectExtentTask={task:null,input:null,output:null,spatialReference:null},n}return(0,C.Z)(r,[{key:"destroy",value:function(){this._handles=(0,B.SC)(this._handles),this._projectExtentTask.task&&(this._debug("Aborting project extent task"),this._projectExtentTask.task=(0,B.IM)(this._projectExtentTask.task)),this._set("map",null)}},{key:"ready",get:function(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}},{key:"heightModelInfoReady",get:function(){return!this._heightModelInfoTask.updating}},{key:"spatialReference",get:function(){return(0,B.pC)(this.userSpatialReference)?this.userSpatialReference:(0,B.Wg)(this._spatialReferenceTask.spatialReference)}},{key:"extent",get:function(){return(0,B.Wg)(this._extentTask.extent)}},{key:"heightModelInfo",get:function(){return(0,B.Wg)(this._heightModelInfoTask.heightModelInfo)}},{key:"vcsWkid",get:function(){return(0,B.Wg)(this._heightModelInfoTask.vcsWkid)}},{key:"latestVcsWkid",get:function(){return(0,B.Wg)(this._heightModelInfoTask.latestVcsWkid)}},{key:"viewingMode",get:function(){return(0,B.Wi)(this.userSpatialReference)||this.userSpatialReference.equals((0,B.Wg)(this._spatialReferenceTask.spatialReference))?(0,B.Wg)(this._spatialReferenceTask.viewingMode):null}},{key:"tileInfo",get:function(){return(0,B.Wg)(this._tileInfoTask.tileInfo)}},{key:"mapCollections",get:function(){var e,t,n,r,i=null==(e=this.map)?void 0:e.call(this),o=[];return(0,B.pC)(this.priorityCollection)&&o.push(this.priorityCollection),o.push({parent:null==i?void 0:i.basemap,layers:null==i||null==(t=i.basemap)?void 0:t.baseLayers},{layers:null==i?void 0:i.layers},{parent:null==i?void 0:i.ground,layers:null==i||null==(n=i.ground)?void 0:n.layers},{parent:null==i?void 0:i.basemap,layers:null==i||null==(r=i.basemap)?void 0:r.referenceLayers}),o}},{key:"_allLayers",get:function(){var e,t,n=this._collectLayers(this.mapCollections);return this._debug("Collected",null!=(e=null==(t=n.layers)?void 0:t.length)?e:0,"layers, updating",n.updating),n}},{key:"_spatialReferenceTask",get:function(){var e,t;if(this.suspended)return null!=(t=this._get("_spatialReferenceTask"))?t:{updating:!1};var n,r=this._allLayers,i=r.layers,o=r.updating,a={candidates:null},s=Nc(i);try{for(s.s();!(n=s.n()).done;){var u=n.value;if(this._processSpatialReferenceCandidates(u,a),a.candidates&&1===a.candidates.length)break}}catch(c){s.e(c)}finally{s.f()}if(1!==(null==(e=a.candidates)?void 0:e.length)&&o)return{updating:!0};var l=this._pickSpatialReferenceCandidate(a.candidates);return this._debug("Finished spatial reference",(0,B.pC)(l)?"".concat(l.spatialReference.wkid,":").concat((0,B.pC)(l.viewingMode)?Dc(l.viewingMode):"global/local"):"none available"),{spatialReference:(0,B.pC)(l)?l.spatialReference:null,viewingMode:(0,B.pC)(l)?l.viewingMode:null,updating:!1}}},{key:"_tileInfoTask",get:function(){var e,t,n,r,i,o,a,s;if(!this.required.tileInfo)return null!=(s=this._get("_tileInfoTask"))?s:{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};var u=this._collectLayers([{parent:null==(e=this.map)||null==(t=e.call(this))?void 0:t.basemap,layers:null==(n=this.map)||null==(r=n.call(this))||null==(i=r.basemap)?void 0:i.baseLayers},{layers:null==(o=this.map)||null==(a=o.call(this))?void 0:a.layers}]),l=u.layers,c=u.updating;if(l&&l.length>0&&"tileInfo"in l[0]){var p=l[0].tileInfo;return{tileInfo:p&&p.spatialReference.equals(this.spatialReference)?p:null,updating:!1}}return{updating:c}}},{key:"_heightModelInfoTask",get:function(){var e,t;if(!this.required.heightModelInfo||this.suspended&&null!=(e=this._get("_heightModelInfoTask"))&&e.heightModelInfo)return null!=(t=this._get("_heightModelInfoTask"))?t:{updating:!1};var n,r=this._allLayers,i=r.layers,o=r.updating,a=Nc(i);try{for(a.s();!(n=a.n()).done;){var s,u,l=n.value;if(this._debug("Considering",null!=(s=null!=(u=l.title)?u:l.id)?s:l.declaredClass,"for height model info"),jc(l)){var c,p,f=Tc(l);if(f)return this._debug("Derived height model info",f),{heightModelInfo:f,vcsWkid:null==(c=l.spatialReference)?void 0:c.vcsWkid,latestVcsWkid:null==(p=l.spatialReference)?void 0:p.latestVcsWkid,updating:!1}}this._debug("Layer does not support height models")}}catch(d){a.e(d)}finally{a.f()}return this._debug("No height model info found,","updating",o),{updating:o}}},{key:"_extentCandidatesTask",get:function(){var e,t=this;if(this.suspended||!this.required.extent)return null!=(e=this._get("_extentCandidatesTask"))?e:{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};var n,r=this._allLayers,i=r.updating,o=[],a=Nc(r.layers);try{for(a.s();!(n=a.n()).done;){var s=n.value,u="fullExtents"in s&&s.fullExtents||((0,B.pC)(s.fullExtent)?[s.fullExtent]:[]),l=u.find((function(e){return e.spatialReference.equals(t.spatialReference)}));if(l)return{candidates:[{extent:l,layer:s}],updating:!1};if(this._getSupportedSpatialReferences(s).length>0){var c,p=Nc(u);try{for(p.s();!(c=p.n()).done;){var f=c.value;o.push({extent:f,layer:s})}}catch(d){p.e(d)}finally{p.f()}}}}catch(d){a.e(d)}finally{a.f()}return{candidates:o,updating:i}}},{key:"_extentTask",get:function(){var e=this,t=this._extentCandidatesTask,r=t.candidates,i=t.updating;if(i)return{updating:i};if((0,B.Wi)(r)||0===r.length)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};var o=this._pickExtentCandidate(r),a=o.candidate,s=o.requiresGeometryService,u=this.spatialReference;if(a.extent.equals(this._projectExtentTask.input)&&u.equals(this._projectExtentTask.spatialReference))return{extent:this._projectExtentTask.output,updating:(0,B.pC)(this._projectExtentTask.task)&&!this._projectExtentTask.task.finished};if((0,B.pC)(this._projectExtentTask.task)&&(this._debug("Aborting project extent task"),this._projectExtentTask.task=(0,B.IM)(this._projectExtentTask.task)),!s){this._projectExtentTask={input:null,output:null,task:null,spatialReference:null};try{return{extent:(0,Oc.iV)(a.extent,u),updating:!1}}catch(l){return{updating:!1}}}return this._debug("Starting project extent task for",a.extent),this._projectExtentTask={input:a.extent.clone(),output:null,spatialReference:u.clone(),task:(0,gr.vr)(function(){var t=(0,O.Z)(T().mark((function t(r){var i,o;return T().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,gr.Hl)(n.e(1747).then(n.bind(n,41747)),r);case 3:return i=t.sent,t.next=6,i.projectGeometry(a.extent,u,a.layer.portalItem,r);case 6:o=t.sent,e._debug("Project extent task finished",o),e._projectExtentTask=Bc(Bc({},e._projectExtentTask),{},{task:null,output:o}),t.next=15;break;case 10:if(t.prev=10,t.t0=t.catch(0),!(0,gr.Hc)(r)){t.next=14;break}return t.abrupt("return");case 14:e._projectExtentTask=Bc(Bc({},e._projectExtentTask),{},{task:null});case 15:case"end":return t.stop()}}),t,null,[[0,10]])})));return function(e){return t.apply(this,arguments)}}())},{updating:!0}}},{key:"_processSpatialReferenceCandidates",value:function(e,t){var n,r=this._getSupportedSpatialReferences(e);if(0!==r.length)if(this._debug("Spatial reference candidates from",null!=(n=e.title)?n:e.id,":",r.map((function(e){return"".concat(e.spatialReference.wkid,":").concat((0,B.pC)(e.viewingMode)?Dc(e.viewingMode):"global/local")})).join(", ")),t.candidates){var i,o=[],a=function(e,t){return(0,B.Wi)(e.viewingMode)?t.viewingMode:((0,B.Wi)(t.viewingMode)||e.viewingMode===t.viewingMode)&&e.viewingMode},s=Nc(t.candidates);try{for(s.s();!(i=s.n()).done;){var u,l=i.value,c=Nc(r);try{for(c.s();!(u=c.n()).done;){var p=u.value;if(l.spatialReference.equals(p.spatialReference)){var f=a(l,p);if(!1!==f){o.push({spatialReference:l.spatialReference,viewingMode:f});break}}}}catch(d){c.e(d)}finally{c.f()}}}catch(d){s.e(d)}finally{s.f()}o.length>0&&(t.candidates=o)}else t.candidates=r}},{key:"_pickSpatialReferenceCandidate",value:function(e){var t=this.defaultSpatialReference;return!e||e.length<1?(0,B.pC)(t)?{spatialReference:t,viewingMode:null}:null:(0,B.pC)(t)&&e.length>1&&e.some((function(e){return e.spatialReference.equals(t)}))?{spatialReference:t,viewingMode:null}:e[0]}},{key:"_getSupportedSpatialReferences",value:function(e){var t="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(0===t.length)return[];var n,r=[],i=Nc(t);try{for(i.s();!(n=i.n()).done;){var o=n.value,a=this.getSpatialReferenceSupport({spatialReference:o,layer:e});if((0,B.pC)(a)){var s,u=Nc((0,B.pC)(a.constraints)?a.constraints:[{spatialReference:o}]);try{for(u.s();!(s=u.n()).done;){var l=s.value,c=l.spatialReference,p=l.viewingMode;((0,B.Wi)(this.userSpatialReference)||c.equals(this.userSpatialReference))&&r.push({spatialReference:c,viewingMode:p})}}catch(f){u.e(f)}finally{u.f()}}}}catch(f){i.e(f)}finally{i.f()}return r}},{key:"_pickExtentCandidate",value:function(e){var t=this.spatialReference,n=e.find((function(e){var n=e.extent;return(0,Oc.Up)(n.spatialReference,t)||(0,Oc.kR)()}));return(0,B.pC)(n)?{candidate:n,requiresGeometryService:!1}:{candidate:e[0],requiresGeometryService:!0}}},{key:"_collectLayers",value:function(e){var t;if("loaded"!==this._loadMaybe(null==(t=this.map)?void 0:t.call(this)))return{layers:[],updating:!0};var n,r={layers:[],preloading:-1,updating:!1},i=Nc(e);try{for(i.s();!(n=i.n()).done;){var o=n.value;if(this._collectCollection(o,r),10===r.preloading)break}}catch(a){i.e(a)}finally{i.f()}return{layers:r.layers,updating:r.updating}}},{key:"_collectCollection",value:function(e,t){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return t.updating=!0,void++t.preloading;case"failed":return}var n,r=Nc(e.layers);try{for(r.s();!(n=r.n()).done;){var i=n.value;switch(this._loadMaybe(i)){case"failed":continue;case"loading":t.updating=!0,++t.preloading;break;case"loaded":var o,a;t.updating||(this._debug("Considering layer",null!=(o=null!=(a=i.title)?a:i.id)?o:i.declaredClass),t.layers.push(i)),"layers"in i&&this._collectCollection({layers:i.layers},t)}if(10===t.preloading)break}}catch(s){r.e(s)}finally{r.f()}}}},{key:"_loadMaybe",value:function(e){return e&&"loadStatus"in e?"not-loaded"===e.loadStatus?(this._debug("Triggering load",null!=(t=null!=(n=e.title)?n:e.id)?t:e.declaredClass),e.load(),"loading"):e.loadStatus:"loaded";var t,n}},{key:"_debug",value:function(){this.logDebugInformation&&Wc.info.apply(Wc,arguments)}}]),r}(re.Z);(0,S._)([(0,U.Cb)()],qc.prototype,"required",void 0),(0,S._)([(0,U.Cb)({constructOnly:!0})],qc.prototype,"map",void 0),(0,S._)([(0,U.Cb)({constructOnly:!0})],qc.prototype,"getSpatialReferenceSupport",void 0),(0,S._)([(0,U.Cb)()],qc.prototype,"defaultSpatialReference",void 0),(0,S._)([(0,U.Cb)()],qc.prototype,"userSpatialReference",void 0),(0,S._)([(0,U.Cb)()],qc.prototype,"priorityCollection",void 0),(0,S._)([(0,U.Cb)()],qc.prototype,"logDebugInformation",void 0),(0,S._)([(0,U.Cb)()],qc.prototype,"suspended",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],qc.prototype,"ready",null),(0,S._)([(0,U.Cb)({readOnly:!0})],qc.prototype,"heightModelInfoReady",null),(0,S._)([(0,U.Cb)({readOnly:!0})],qc.prototype,"spatialReference",null),(0,S._)([(0,U.Cb)({readOnly:!0})],qc.prototype,"extent",null),(0,S._)([(0,U.Cb)({readOnly:!0})],qc.prototype,"heightModelInfo",null),(0,S._)([(0,U.Cb)({readOnly:!0})],qc.prototype,"vcsWkid",null),(0,S._)([(0,U.Cb)({readOnly:!0})],qc.prototype,"latestVcsWkid",null),(0,S._)([(0,U.Cb)({readOnly:!0})],qc.prototype,"viewingMode",null),(0,S._)([(0,U.Cb)({readOnly:!0})],qc.prototype,"tileInfo",null),(0,S._)([(0,U.Cb)({readOnly:!0})],qc.prototype,"mapCollections",null),(0,S._)([(0,U.Cb)({readOnly:!0})],qc.prototype,"_allLayers",null),(0,S._)([(0,U.Cb)({readOnly:!0})],qc.prototype,"_spatialReferenceTask",null),(0,S._)([(0,U.Cb)({readOnly:!0})],qc.prototype,"_tileInfoTask",null),(0,S._)([(0,U.Cb)({readOnly:!0})],qc.prototype,"_heightModelInfoTask",null),(0,S._)([(0,U.Cb)({readOnly:!0})],qc.prototype,"_extentCandidatesTask",null),(0,S._)([(0,U.Cb)()],qc.prototype,"_extentTask",null),(0,S._)([(0,U.Cb)()],qc.prototype,"_projectExtentTask",void 0);var Gc,Hc=qc=(0,S._)([(0,G.j)("esri.views.support.DefaultsFromMap")],qc);function Kc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Yc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Kc(Object(n),!0).forEach((function(t){(0,H.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Kc(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Jc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var $c=V.Z.getLogger("esri.views.View"),Qc=Gc=function(e){(0,M.Z)(r,e);var t,n=Jc(r);function r(e){var t;return(0,k.Z)(this,r),(t=n.call(this,e))._userSpatialReference=null,t._cursor=null,t.allLayerViews=new j.Z({getCollections:function(){var e,n,r;return[null==(e=t.basemapView)?void 0:e.baseLayerViews,null==(n=t.groundView)?void 0:n.layerViews,t.layerViews,null==(r=t.basemapView)?void 0:r.referenceLayerViews]},getChildrenFunction:function(e){return e.layerViews}}),t.groundView=null,t.animation=null,t.basemapView=null,t.fatalError=null,t.extent=null,t.graphics=new kl.J,t.analyses=new wl,t.navigating=!1,t.typeSpecificPreconditionsReady=!0,t.layerViews=new A.Z,t.magnifier=new jl,t.padding={left:0,top:0,right:0,bottom:0},t.ready=!1,t.spatialReferenceWarningDelay=1e3,t.supportsGround=!0,t.timeExtent=null,t.type=null,t.scale=null,t.updating=!1,t.initialExtentRequired=!0,t.input=new kc,t.navigation=new Rc,t.layerViewManager=null,t.analysisViewManager=null,t.isHeightModelInfoRequired=!1,t.width=null,t.height=null,t.resizing=!1,t.suspended=!1,t.viewEvents=new ql((0,x.Z)(t)),t.persistableViewModels=new A.Z,t._isValid=!1,t._readyCycleForced=!1,t.handles.add(t.watch("preconditionsReady",(function(e){var n,r;e?(t._currentSpatialReference=t.spatialReference,Gc.views.add((0,x.Z)(t))):(t._currentSpatialReference=null,Gc.views.remove((0,x.Z)(t))),t.notifyChange("spatialReference"),!e&&t.ready?(null==(n=t.layerViewManager)||n.clear(),null==(r=t.toolViewManager)||r.detach(),(0,B.pC)(t.analysisViewManager)&&t.analysisViewManager.detach(),t._teardown()):e&&!t.ready&&((0,B.pC)(t.analysisViewManager)&&t.analysisViewManager.attach(),t._startup(),t.toolViewManager.attach())}),!0)),t}return(0,C.Z)(r,[{key:"initialize",value:function(){var e=this;this.addResolvingPromise(this.validate().then((function(){return e._isValid=!0,(0,N.N1)(e,"ready")}))),this.basemapView=new xl({view:this}),this.layerViewManager=new Sl({view:this,layerViewImporter:{importLayerView:function(t){return e.importLayerView(t)},hasLayerViewModule:function(t){return e.hasLayerViewModule(t)}},supportsGround:this.supportsGround}),this.toolViewManager=new pc({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([(0,vl.Ym)((function(){return e.initialExtentRequired}),(function(t){return e.defaultsFromMap.required=Yc(Yc({},e.defaultsFromMap.required),{},{extent:t})}),{sync:!0,initial:!0}),(0,vl.Ym)((function(){return e.ready}),(function(t){e.defaultsFromMap&&(e.defaultsFromMap.suspended=t,e.defaultsFromMap.userSpatialReference=t?e.spatialReference:e._userSpatialReference)}),{sync:!0}),(0,vl.Ym)((function(){return e._userSpatialReference}),(function(t){e.defaultsFromMap&&(e.defaultsFromMap.userSpatialReference=t)}),{sync:!0,initial:!0})])}},{key:"_setupSpatialReferenceLogger",value:function(){var e=this,t=null;this.handles.add([(0,vl.Ym)((function(){var t;return null==(t=e.defaultsFromMap)?void 0:t.ready}),(function(n){var r,i=(null==(r=e.map)?void 0:r.allLayers.length)>0;if(n&&!e.spatialReference&&i){if((0,B.pC)(t))return;var o=(0,dl.kB)((function(){return t=(0,B.IM)(t)}));t=(0,gr.vr)(function(){var n=(0,O.Z)(T().mark((function n(r){return T().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,(0,gr.e4)(e.spatialReferenceWarningDelay,null,r);case 3:n.next=8;break;case 5:return n.prev=5,n.t0=n.catch(0),n.abrupt("return");case 8:return n.prev=8,t=null,n.finish(8);case 11:$c.warn("#spatialReference","no spatial reference could be derived from the currently added map layers");case 12:case"end":return n.stop()}}),n,null,[[0,5,8,11]])})));return function(e){return n.apply(this,arguments)}}()),e.handles.add(o,"spatial-reference-logger-task")}else e.handles.remove("spatial-reference-logger-task")}),{sync:!0})])}},{key:"destroy",value:function(){if(!this.destroyed){this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=(0,B.SC)(this.graphics),this.analyses=(0,B.SC)(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),this.toolViewManager=(0,B.SC)(this.toolViewManager),this.layerViewManager=(0,B.SC)(this.layerViewManager),this.basemapView=(0,B.SC)(this.basemapView),this.invalidate(),this._emitter.clear(),this.handles.removeAll();var e=this.map;this.map=null,null==e||e.destroy()}}},{key:"_startup",value:function(){this._set("ready",!0)}},{key:"_teardown",value:function(){this._set("ready",!1)}},{key:"whenReady",value:function(){return Promise.resolve(this)}},{key:"toMap",value:function(){return $c.error("#toMap()","Not implemented on this instance of View"),null}},{key:"_defaultsFromMapSettings",get:function(){return{}}},{key:"defaultsFromMap",get:function(){var e=this;return new Hc(Yc({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:function(){return e.map},getSpatialReferenceSupport:function(t){return e.getSpatialReferenceSupport(t)}},this._defaultsFromMapSettings))}},{key:"heightModelInfo",get:function(){return this.getDefaultHeightModelInfo()}},{key:"interacting",get:function(){return this.navigating}},{key:"preconditionsReady",get:function(){var e;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||Au.Z.isLoadable(this.map)&&!this.map.loaded||0===this.width||0===this.height||!this.spatialReference||!this.typeSpecificPreconditionsReady||!this._validateSpatialReference(this.spatialReference)||!(this._currentSpatialReference||null!=(e=this.defaultsFromMap)&&e.ready))}},{key:"map",set:function(e){var t;e!==this._get("map")&&(null!=(t=e)&&t.destroyed&&($c.warn("#map","The provided map is already destroyed",{map:e}),e=null),Au.Z.isLoadable(e)&&e.load().catch((function(){})),this.initialized&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",e))}},{key:"spatialReference",get:function(){var e,t,n=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return n&&null!=(e=this.defaultsFromMap)&&null!=(t=e.required)&&t.heightModelInfo&&((n=n.clone()).vcsWkid=this.defaultsFromMap.vcsWkid,n.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),n},set:function(e){this._userSpatialReference=e,this._set("spatialReference",e)}},{key:"stationary",get:function(){return!this.animation&&!this.navigating&&!this.resizing}},{key:"initialExtent",get:function(){var e;return null==(e=this.defaultsFromMap)?void 0:e.extent}},{key:"cursor",get:function(){var e=this.toolViewManager?this.toolViewManager.cursor:null;return(0,B.pC)(e)?e:this._cursor||"default"},set:function(e){this._cursor=e,this.notifyChange("cursor")}},{key:"size",get:function(){return[this.width,this.height]}},{key:"whenLayerView",value:function(e){return this.layerViewManager.whenLayerView(e)}},{key:"getDefaultSpatialReference",value:function(){var e;return null==(e=this.defaultsFromMap)?void 0:e.spatialReference}},{key:"getDefaultHeightModelInfo",value:function(){var e,t,n;return null!=(e=null!=(t=this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)?t:null==(n=this.defaultsFromMap)?void 0:n.heightModelInfo)?e:null}},{key:"importLayerView",value:function(e){throw new F.Z("importLayerView() not implemented")}},{key:"hasLayerViewModule",value:function(e){return!1}},{key:"validate",value:(t=(0,O.Z)(T().mark((function e(){return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})},{key:"invalidate",value:function(){this._isValid=!1}},{key:"getSpatialReferenceSupport",value:function(){return{}}},{key:"_validateSpatialReference",value:function(e){return(0,B.pC)(this.getSpatialReferenceSupport({spatialReference:e}))}},{key:"when",value:function(e,t){return this.isResolved()&&!this.ready&&$c.warn("#when()",'Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use watchUtils.whenOnce(view, "ready").then(...) instead.'),(0,Z.Z)((0,R.Z)(r.prototype),"when",this).call(this,e,t)}},{key:"forceReadyCycle",value:function(){var e=this;this.ready&&((0,N.OY)(this,"preconditionsReady",(function(){return e._readyCycleForced=!1})),this._readyCycleForced=!0)}},{key:"addAndActivateTool",value:function(e){this.toolViewManager.tools.add(e),this.activeTool=e}},{key:"tryFatalErrorRecovery",value:function(){this.fatalError=null}}]),r}((0,_e.p)(Oo.Z.EventedMixin((0,hl.v)(re.Z))));Qc.views=new A.Z,(0,S._)([(0,U.Cb)()],Qc.prototype,"_userSpatialReference",void 0),(0,S._)([(0,de.B)("toolViewManager.activeTool")],Qc.prototype,"activeTool",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],Qc.prototype,"allLayerViews",void 0),(0,S._)([(0,U.Cb)()],Qc.prototype,"groundView",void 0),(0,S._)([(0,U.Cb)()],Qc.prototype,"animation",void 0),(0,S._)([(0,U.Cb)()],Qc.prototype,"basemapView",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],Qc.prototype,"_defaultsFromMapSettings",null),(0,S._)([(0,U.Cb)()],Qc.prototype,"defaultsFromMap",null),(0,S._)([(0,U.Cb)()],Qc.prototype,"fatalError",void 0),(0,S._)([(0,U.Cb)({type:ml.Z})],Qc.prototype,"extent",void 0),(0,S._)([(0,U.Cb)((0,yl.z)(kl.J,"graphics"))],Qc.prototype,"graphics",void 0),(0,S._)([(0,U.Cb)((0,yl.z)(wl,"analyses"))],Qc.prototype,"analyses",void 0),(0,S._)([(0,U.Cb)({readOnly:!0,type:gl.Z})],Qc.prototype,"heightModelInfo",null),(0,S._)([(0,U.Cb)({readOnly:!0})],Qc.prototype,"interacting",null),(0,S._)([(0,U.Cb)({readOnly:!0})],Qc.prototype,"navigating",void 0),(0,S._)([(0,U.Cb)({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],Qc.prototype,"preconditionsReady",null),(0,S._)([(0,U.Cb)({readOnly:!0})],Qc.prototype,"typeSpecificPreconditionsReady",void 0),(0,S._)([(0,U.Cb)({type:A.Z,readOnly:!0})],Qc.prototype,"layerViews",void 0),(0,S._)([(0,U.Cb)({type:jl})],Qc.prototype,"magnifier",void 0),(0,S._)([(0,U.Cb)({value:null,type:pl})],Qc.prototype,"map",null),(0,S._)([(0,U.Cb)()],Qc.prototype,"padding",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],Qc.prototype,"ready",void 0),(0,S._)([(0,U.Cb)({type:bl.Z})],Qc.prototype,"spatialReference",null),(0,S._)([(0,U.Cb)()],Qc.prototype,"spatialReferenceWarningDelay",void 0),(0,S._)([(0,U.Cb)()],Qc.prototype,"stationary",null),(0,S._)([(0,U.Cb)({readOnly:!0})],Qc.prototype,"supportsGround",void 0),(0,S._)([(0,U.Cb)({type:fl.Z})],Qc.prototype,"timeExtent",void 0),(0,S._)([(0,de.B)("toolViewManager.tools")],Qc.prototype,"tools",void 0),(0,S._)([(0,U.Cb)()],Qc.prototype,"toolViewManager",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],Qc.prototype,"type",void 0),(0,S._)([(0,U.Cb)({type:Number})],Qc.prototype,"scale",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],Qc.prototype,"updating",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],Qc.prototype,"initialExtentRequired",void 0),(0,S._)([(0,U.Cb)({readOnly:!0,type:ml.Z})],Qc.prototype,"initialExtent",null),(0,S._)([(0,U.Cb)()],Qc.prototype,"cursor",null),(0,S._)([(0,U.Cb)({readOnly:!0})],Qc.prototype,"input",void 0),(0,S._)([(0,U.Cb)({type:Rc,nonNullable:!0})],Qc.prototype,"navigation",void 0),(0,S._)([(0,U.Cb)()],Qc.prototype,"layerViewManager",void 0),(0,S._)([(0,U.Cb)()],Qc.prototype,"analysisViewManager",void 0),(0,S._)([(0,U.Cb)()],Qc.prototype,"width",void 0),(0,S._)([(0,U.Cb)()],Qc.prototype,"height",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],Qc.prototype,"resizing",void 0),(0,S._)([(0,U.Cb)({value:null,readOnly:!0})],Qc.prototype,"size",null),(0,S._)([(0,U.Cb)({readOnly:!0})],Qc.prototype,"suspended",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],Qc.prototype,"viewEvents",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],Qc.prototype,"persistableViewModels",void 0),(0,S._)([(0,U.Cb)()],Qc.prototype,"_isValid",void 0),(0,S._)([(0,U.Cb)()],Qc.prototype,"_readyCycleForced",void 0),(0,S._)([(0,U.Cb)()],Qc.prototype,"_currentSpatialReference",void 0);var Xc=Qc=Gc=(0,S._)([(0,G.j)("esri.views.View")],Qc);function ep(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var tp=function(e){(0,M.Z)(n,e);var t=ep(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).state="running",r.target=null,r}return(0,C.Z)(n,[{key:"initialize",value:function(){var e=this;this.addResolvingPromise(new Promise((function(t,n){return e._dfd={resolve:t,reject:n}})))}},{key:"done",get:function(){return"finished"===this.state||"stopped"===this.state}},{key:"stop",value:function(){"stopped"!==this.state&&"finished"!==this.state&&(this._set("state","stopped"),this._dfd.reject(new F.Z("ViewAnimation stopped")))}},{key:"finish",value:function(){"stopped"!==this.state&&"finished"!==this.state&&(this._set("state","finished"),this._dfd.resolve())}},{key:"update",value:function(e,t){t||(t=(0,gr.y8)(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",t)}}]),n}(hl.D);(0,S._)([(0,U.Cb)({readOnly:!0})],tp.prototype,"done",null),(0,S._)([(0,U.Cb)({readOnly:!0,type:String})],tp.prototype,"state",void 0),(0,S._)([(0,U.Cb)()],tp.prototype,"target",void 0),function(e){e.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}((tp=(0,S._)([(0,G.j)("esri.views.ViewAnimation")],tp))||(tp={}));var np=tp,rp=n(63905),ip=n(95518);function op(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var ap=function(){function e(t,n,r,i){(0,k.Z)(this,e);var o=t.targetGeometry,a=n.targetGeometry;i?"string"==typeof i&&(i=(0,rp.Qc)(i)||rp.LI.ease):i=rp.LI.ease,this.easing=i,this.duration=r,this.sCenterX=o.x,this.sCenterY=o.y,this.sScale=t.scale,this.sRotation=t.rotation,this.tCenterX=a.x,this.tCenterY=a.y,this.tScale=n.scale,this.tRotation=n.rotation,this.dCenterX=this.tCenterX-this.sCenterX,this.dCenterY=this.tCenterY-this.sCenterY,this.dScale=this.tScale-this.sScale,this.dRotation=this.tRotation-this.sRotation,this.dRotation>180?this.dRotation-=360:this.dRotation<-180&&(this.dRotation+=360)}return(0,C.Z)(e,[{key:"applyRatio",value:function(e,t){var n,r,i,o,a=this.easing(t);t>=1?(n=this.tCenterX,r=this.tCenterY,i=this.tRotation,o=this.tScale):(n=this.sCenterX+a*this.dCenterX,r=this.sCenterY+a*this.dCenterY,i=this.sRotation+a*this.dRotation,o=this.sScale+a*this.dScale),e.targetGeometry.x=n,e.targetGeometry.y=r,e.scale=o,e.rotation=i}}]),e}(),sp=function(e){(0,M.Z)(n,e);var t=op(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).duration=200,r.transition=null,r.easing=rp.LI.ease,r.view=null,r.viewpoint=null,r.viewpoint=new wu.Z({targetGeometry:new Ca.Z,scale:0,rotation:0}),r._updateTask=(0,ne.A)({postRender:r._postRender.bind((0,x.Z)(r))}),r._updateTask.pause(),r}return(0,C.Z)(n,[{key:"destroy",value:function(){this._updateTask.remove(),this._updateTask=null}},{key:"animate",value:function(e,t,n){var r=this;this.stop();var i=this.viewpoint;(0,ip.JG)(i,t),this.transition=new ap(this.viewpoint,e.target,n&&n.duration||this.duration,n&&n.easing||this.easing);var o=function(){r.animation===e&&r._updateTask&&("finished"===e.state&&(r.transition.applyRatio(r.viewpoint,1),r.view.state&&(r.view.state.viewpoint=r.viewpoint.clone())),r.animation=null,r.updateFunction=null)};return e.when(o,o),this._startTime=performance.now(),this._updateTask.resume(),this.animation=e,e}},{key:"animateContinous",value:function(e,t){var n=this;this.stop(),this.updateFunction=t,this.viewpoint=e;var r=new np({target:e.clone()}),i=function(){n.animation===r&&n._updateTask&&(n.animation=null,n.updateFunction=null)};return r.when(i,i),this._startTime=performance.now(),this._updateTask.resume(),this.animation=r,r}},{key:"stop",value:function(){this.animation&&(this.animation.stop(),this.animation=null,this.updateFunction=null)}},{key:"_postRender",value:function(e){var t=this.animation;if(t&&t.state!==np.State.STOPPED){if(this.updateFunction)this.updateFunction(this.viewpoint,e.deltaTime);else{var n=(performance.now()-this._startTime)/this.transition.duration,r=n>=1;this.transition.applyRatio(this.viewpoint,n),r&&this.animation.finish()}this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())}else this._updateTask.pause()}}]),n}(re.Z);(0,S._)([(0,U.Cb)()],sp.prototype,"animation",void 0),(0,S._)([(0,U.Cb)()],sp.prototype,"duration",void 0),(0,S._)([(0,U.Cb)()],sp.prototype,"transition",void 0),(0,S._)([(0,U.Cb)()],sp.prototype,"easing",void 0),(0,S._)([(0,U.Cb)()],sp.prototype,"view",void 0),(0,S._)([(0,U.Cb)()],sp.prototype,"viewpoint",void 0);var up=sp=(0,S._)([(0,G.j)("esri.views.2d.AnimationManager")],sp),lp=function(){function e(t){var n=this;(0,k.Z)(this,e),this.view=t,this._frameTaskHandle=null,this._updateRequested=!1,this.stationary=!0,this.updateEnabled=!0,this.animationInProgress=!1,this.prepare=function(){n._updateParameters.state=n.view.state,n._updateParameters.stationary=n.view.stationary,n._updateParameters.pixelRatio=window.devicePixelRatio,n._updateParameters.renderingOptions=n.view.renderingOptions},this.update=function(){if(n._updateRequested=!1,n.updateEnabled){var e=n.view,t=e.basemapView,r=e.graphicsView,i=e.labelManager,o=e.layerViews,a=e.state.id;t.baseLayerViews.forEach(n._updateLayerView,n),o.forEach(n._updateLayerView,n),t.referenceLayerViews.forEach(n._updateLayerView,n),(0,B.pC)(i)&&(i.lastUpdateId!==a&&(i.viewChange(),i.lastUpdateId=a),i.updateRequested&&i.processUpdate(n._updateParameters)),(0,B.pC)(r)&&(r.lastUpdateId!==a&&(r.viewChange(),r.lastUpdateId=a),r.updateRequested&&r.processUpdate(n._updateParameters)),n.view.graphicsTileStore.setViewState(n._updateParameters.state),n.animationInProgress||n._updateRequested||n._frameTaskHandle.pause()}}}return(0,C.Z)(e,[{key:"destroy",value:function(){this.stop()}},{key:"start",value:function(){var e=this;this.stationary=this.view.stationary,this._updateParameters={state:this.view.state,pixelRatio:window.devicePixelRatio,stationary:this.stationary,renderingOptions:this.view.renderingOptions},this._stationaryHandle=this.view.watch("stationary",(function(t){e.stationary=t,e.requestFrame()})),this._frameTaskHandle=(0,ne.A)(this)}},{key:"stop",value:function(){this._frameTaskHandle&&(this._stationaryHandle.remove(),this._frameTaskHandle.remove(),this._updateParameters=this._stationaryHandle=this._frameTaskHandle=null,this.stationary=!0,this.animationInProgress=!1)}},{key:"requestUpdate",value:function(){this._updateRequested||(this._updateRequested=!0,this.requestFrame())}},{key:"requestFrame",value:function(){this._frameTaskHandle&&this._frameTaskHandle.resume()}},{key:"_updateLayerView",value:function(e){var t=this.view.state,n=e.lastUpdateId;null!=n&&(this.stationary||e.moving)||(e.moving=!0,e.moveStart()),n!==t.id&&e.viewChange(),this.stationary&&e.moving&&(e.moving=!1,e.moveEnd()),e.lastUpdateId=t.id,e.updateRequested&&e.processUpdate(this._updateParameters),"layerViews"in e&&e.layerViews.forEach(this._updateLayerView,this)}}]),e}();function cp(){return Promise.all([Promise.all([n.e(9351),n.e(317),n.e(7278)]).then(n.bind(n,77278)),Promise.all([n.e(9351),n.e(317),n.e(6979)]).then(n.bind(n,96979))])}var pp=function(){return cp().then((function(){return Promise.all([n.e(9351),n.e(317),n.e(545)]).then(n.bind(n,30545))}))},fp=function(){return cp().then((function(){return n.e(9351).then(n.bind(n,67275))}))},dp={"base-dynamic":function(){return cp().then((function(){return Promise.all([n.e(9351),n.e(989)]).then(n.bind(n,989))}))},"base-tile":pp,"bing-maps":pp,csv:fp,"geo-rss":function(){return cp().then((function(){return Promise.all([n.e(9351),n.e(3095)]).then(n.bind(n,23095))}))},feature:fp,geojson:fp,graphics:function(){return cp().then((function(){return Promise.all([n.e(9351),n.e(7880)]).then(n.bind(n,7880))}))},group:function(){return cp().then((function(){return Promise.all([n.e(9351),n.e(5542)]).then(n.bind(n,5542))}))},imagery:function(){return cp().then((function(){return Promise.all([n.e(9351),n.e(317),n.e(192)]).then(n.bind(n,192))}))},"imagery-tile":function(){return cp().then((function(){return Promise.all([n.e(9351),n.e(317),n.e(2840)]).then(n.bind(n,62840))}))},kml:function(){return cp().then((function(){return Promise.all([n.e(9351),n.e(317),n.e(3280)]).then(n.bind(n,73280))}))},"map-image":function(){return cp().then((function(){return Promise.all([n.e(9351),n.e(3337)]).then(n.bind(n,93337))}))},"map-notes":function(){return cp().then((function(){return Promise.all([n.e(9351),n.e(4269)]).then(n.bind(n,14269))}))},"ogc-feature":function(){return cp().then((function(){return Promise.all([n.e(9351),n.e(897)]).then(n.bind(n,40897))}))},"open-street-map":pp,route:function(){return cp().then((function(){return Promise.all([n.e(9351),n.e(2193)]).then(n.bind(n,2193))}))},stream:function(){return cp().then((function(){return Promise.all([n.e(9351),n.e(2844)]).then(n.bind(n,82844))}))},"subtype-group":function(){return cp().then((function(){return Promise.all([n.e(9351),n.e(7767)]).then(n.bind(n,77767))}))},tile:pp,"vector-tile":function(){return cp().then((function(){return Promise.all([n.e(9351),n.e(5777)]).then(n.bind(n,25777))}))},wcs:function(){return cp().then((function(){return Promise.all([n.e(9351),n.e(317),n.e(2840)]).then(n.bind(n,62840))}))},"web-tile":pp,wfs:fp,wms:function(){return cp().then((function(){return Promise.all([n.e(9351),n.e(317),n.e(7803)]).then(n.bind(n,17803))}))},wmts:function(){return cp().then((function(){return Promise.all([n.e(9351),n.e(317),n.e(6246)]).then(n.bind(n,36246))}))},analysis:null,"base-elevation":null,"building-scene":null,elevation:null,"integrated-mesh":null,"point-cloud":null,voxel:null,scene:null,unknown:null,unsupported:null};var hp,vp=function(e){return(0,B.pC)(dp[e.type])},yp=function(e){var t=dp[e.type];if(!(0,B.pC)(t))throw function(e){var t=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",n=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new F.Z("".concat(n,":view-not-supported"),"".concat(t," is not supported in 2D"))}(e);return t(e)},mp=n(40657),gp=n(97080),bp=n(66657),_p=n(82456);function wp(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return kp(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return kp(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function kp(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Cp(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var xp,Zp=V.Z.getLogger("esri.views.MapView"),Mp=hp=function(e){(0,M.Z)(n,e);var t=Cp(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).geometry=null,r.spatialReference=null,r}return(0,C.Z)(n,[{key:"normalizedGeometry",get:function(){return(0,B.Wi)(this.geometry)||!this.spatialReference?null:this.spatialReference.equals(this.geometry.spatialReference)?this.geometry:(0,zo.Q8)(this.geometry,this.spatialReference)?(0,zo.iV)(this.geometry,this.spatialReference):(0,Oc.kR)()?(0,Oc.iV)(this.geometry,this.spatialReference):(Zp.error("#constraints.geometry","unsupported coordinate system. The source geometry cannot be projected to the view's coordinate system. The projection engine cannot be loaded.",{geometry:this.geometry}),null)}},{key:"constrain",value:function(e,t){if((0,B.Wi)(this.normalizedGeometry))return e;var n=e.targetGeometry;if("extent"===this.normalizedGeometry.type?(0,gp.aV)(this.normalizedGeometry,n):(0,gp.CI)(this.normalizedGeometry,n))return e;var r=function(e,t){var n,r=t.spatialReference,i=[t.x,t.y],o=Number.POSITIVE_INFINITY,a=0,s=0,u=[0,0],l=wp("extent"===e.type?[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]:e.rings);try{for(l.s();!(n=l.n()).done;)for(var c=n.value,p=0;p<c.length-1;p++){(0,_p.Tx)(u,i,c,p);var f=(0,bp.b)(i,u);f<o&&(o=f,a=u[0],s=u[1])}}catch(d){l.e(d)}finally{l.f()}return{coordinate:new Ca.Z({x:a,y:s,spatialReference:r}),distance:o}}(this.normalizedGeometry,n),i=r.coordinate;return i?(e.targetGeometry=i,e):e}},{key:"clone",value:function(){var e,t;return new hp({geometry:null==(e=this.geometry)?void 0:e.clone(),spatialReference:null==(t=this.spatialReference)?void 0:t.clone()})}}]),n}(re.Z);function Ip(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}(0,S._)([(0,U.Cb)({constructOnly:!0})],Mp.prototype,"geometry",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],Mp.prototype,"normalizedGeometry",null),(0,S._)([(0,U.Cb)({constructOnly:!0})],Mp.prototype,"spatialReference",void 0),Mp=hp=(0,S._)([(0,G.j)("esri.views.2d.constraints.GeometryConstraint")],Mp);var Rp=xp=function(e){(0,M.Z)(n,e);var t=Ip(n);function n(){var e;return(0,k.Z)(this,n),(e=t.apply(this,arguments)).enabled=!0,e.rotationEnabled=!0,e}return(0,C.Z)(n,[{key:"constrain",value:function(e,t){return this.enabled&&t?(this.rotationEnabled||(e.rotation=t.rotation),e):e}},{key:"clone",value:function(){return new xp({enabled:this.enabled,rotationEnabled:this.rotationEnabled})}}]),n}(re.Z);(0,S._)([(0,U.Cb)()],Rp.prototype,"enabled",void 0),(0,S._)([(0,U.Cb)()],Rp.prototype,"rotationEnabled",void 0);var Op,Pp=Rp=xp=(0,S._)([(0,G.j)("esri.views.2d.constraints.RotationConstraint")],Rp);function Tp(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Sp(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Sp(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Sp(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ep(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Ap=Op=function(e){(0,M.Z)(n,e);var t=Ep(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e))._lodByScale={},r._scales=[],r.effectiveLODs=null,r.effectiveMinZoom=-1,r.effectiveMaxZoom=-1,r.effectiveMinScale=0,r.effectiveMaxScale=0,r.lods=null,r.minZoom=-1,r.maxZoom=-1,r.minScale=0,r.maxScale=0,r.snapToZoom=!0,r}return(0,C.Z)(n,[{key:"initialize",value:function(){var e,t,n,r=this,i=this.lods,o=this.minScale,a=this.maxScale,s=this.minZoom,u=this.maxZoom,l=-1,c=-1,p=!1,f=!1;if(0!==o&&0!==a&&o<a&&(o=(e=[a,o])[0],a=e[1]),!i||!i.length)return this._set("effectiveMinScale",o),void this._set("effectiveMaxScale",a);i=i.map((function(e){return e.clone()})),i.sort((function(e,t){return t.scale-e.scale})),i.forEach((function(e,t){return e.level=t}));var d,h=Tp(i);try{for(h.s();!(d=h.n()).done;){var v=d.value;!p&&o>0&&o>=v.scale&&(l=v.level,p=!0),!f&&a>0&&a>=v.scale&&(c=n?n.level:-1,f=!0),n=v}}catch(y){h.e(y)}finally{h.f()}-1===s&&(s=0===o?0:l),-1===u&&(u=0===a?i.length-1:c),s=Math.max(s,0),s=Math.min(s,i.length-1),u=Math.max(u,0),s>(u=Math.min(u,i.length-1))&&(s=(t=[u,s])[0],u=t[1]),o=i[s].scale,a=i[u].scale,i.splice(0,s),i.splice(u-s+1,i.length),i.forEach((function(e,t){r._lodByScale[e.scale]=e,r._scales[t]=e.scale})),this._set("effectiveLODs",i),this._set("effectiveMinZoom",s),this._set("effectiveMaxZoom",u),this._set("effectiveMinScale",o),this._set("effectiveMaxScale",a)}},{key:"constrain",value:function(e,t){if(t&&e.scale===t.scale)return e;var n=this.effectiveMinScale,r=this.effectiveMaxScale,i=e.targetGeometry,o=t&&t.targetGeometry,a=0!==r&&e.scale<r,s=0!==n&&e.scale>n;if(a||s){var u=s?n:r;if(o){var l=(u-t.scale)/(e.scale-t.scale);i.x=o.x+(i.x-o.x)*l,i.y=o.y+(i.y-o.y)*l}e.scale=u}return this.snapToZoom&&this.effectiveLODs&&(e.scale=this._getClosestScale(e.scale)),e}},{key:"fit",value:function(e){if(!this.effectiveLODs||!this.snapToZoom)return this.constrain(e,null);var t=this.scaleToZoom(e.scale),n=Math.abs(t-Math.floor(t));return e.scale=this.zoomToScale(n>.99?Math.round(t):Math.floor(t)),e}},{key:"zoomToScale",value:function(e){if(!this.effectiveLODs)return 0;e-=this.effectiveMinZoom,e=Math.max(0,e);var t=this._scales;if(e<=0)return t[0];if(e>=t.length)return t[t.length-1];var n=Math.round(e-.5),r=Math.round(e);return t[r]+(r-e)*(t[n]-t[r])}},{key:"scaleToZoom",value:function(e){if(!this.effectiveLODs)return-1;var t,n,r=this._scales;if(e>=r[0])return this.effectiveMinZoom;if(e<=r[r.length-1])return this.effectiveMaxZoom;for(var i=0;i<r.length-1;i++){if(t=r[i],(n=r[i+1])===e)return i+this.effectiveMinZoom+1;if(t>e&&n<e)return i+this.effectiveMinZoom+1-(e-n)/(t-n)}}},{key:"snapToClosestScale",value:function(e){if(!this.effectiveLODs)return e;var t=this.scaleToZoom(e);return this.zoomToScale(Math.round(t))}},{key:"snapToNextScale",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;if(!this.effectiveLODs)return e*t;var n=Math.round(this.scaleToZoom(e));return this.zoomToScale(n+1)}},{key:"snapToPreviousScale",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(!this.effectiveLODs)return e*t;var n=Math.round(this.scaleToZoom(e));return this.zoomToScale(n-1)}},{key:"clone",value:function(){return new Op({lods:this.lods,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale})}},{key:"_getClosestScale",value:function(e){return this._lodByScale[e]||(e=this._scales.reduce((function(t,n){return Math.abs(n-e)<=Math.abs(t-e)?n:t}),this._scales[0])),this._lodByScale[e].scale}}]),n}(re.Z);(0,S._)([(0,U.Cb)({readOnly:!0})],Ap.prototype,"effectiveLODs",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],Ap.prototype,"effectiveMinZoom",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],Ap.prototype,"effectiveMaxZoom",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],Ap.prototype,"effectiveMinScale",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],Ap.prototype,"effectiveMaxScale",void 0),(0,S._)([(0,U.Cb)()],Ap.prototype,"lods",void 0),(0,S._)([(0,U.Cb)()],Ap.prototype,"minZoom",void 0),(0,S._)([(0,U.Cb)()],Ap.prototype,"maxZoom",void 0),(0,S._)([(0,U.Cb)()],Ap.prototype,"minScale",void 0),(0,S._)([(0,U.Cb)()],Ap.prototype,"maxScale",void 0),(0,S._)([(0,U.Cb)()],Ap.prototype,"snapToZoom",void 0);var jp=Ap=Op=(0,S._)([(0,G.j)("esri.views.2d.constraints.ZoomConstraint")],Ap),Fp=n(16985);function Lp(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Dp={base:null,key:"type",typeMap:{extent:ml.Z,polygon:Fp.Z}},Vp=function(e){(0,M.Z)(n,e);var t=Lp(n);function n(){var e;return(0,k.Z)(this,n),(e=t.apply(this,arguments)).lods=null,e.minScale=0,e.maxScale=0,e.minZoom=-1,e.maxZoom=-1,e.rotationEnabled=!0,e.snapToZoom=!0,e}return(0,C.Z)(n,[{key:"initialize",value:function(){this.watch(["_zoom","_rotation"],this.emit.bind(this,"update"),!0)}},{key:"destroy",value:function(){this.view=null,this._set("_zoom",null),this._set("_rotation",null)}},{key:"geometry",set:function(e){e?this._set("geometry",e):this._set("geometry",null)}},{key:"_defaultLODs",get:function(){var e,t,n,r=null==(e=this.view)||null==(t=e.defaultsFromMap)?void 0:t.tileInfo,i=null==(n=this.view)?void 0:n.spatialReference;return r&&i&&r.spatialReference.equals(i)?r.lods:null}},{key:"_geometry",get:function(){return new Mp({geometry:this.geometry,spatialReference:this.view.spatialReference})}},{key:"_rotation",get:function(){return new Pp({rotationEnabled:this.rotationEnabled})}},{key:"_zoom",get:function(){var e=this._get("_zoom"),t=this.lods||this._defaultLODs,n=this.minZoom,r=this.maxZoom,i=this.minScale,o=this.maxScale,a=this.snapToZoom;return e&&e.lods===t&&e.minZoom===n&&e.maxZoom===r&&e.minScale===i&&e.maxScale===o&&e.snapToZoom===a?e:new jp({lods:t,minZoom:n,maxZoom:r,minScale:i,maxScale:o,snapToZoom:a})}},{key:"canZoomInTo",value:function(e){var t=this.effectiveMaxScale;return 0===t||e>=t}},{key:"canZoomOutTo",value:function(e){var t=this.effectiveMinScale;return 0===t||e<=t}},{key:"constrain",value:function(e,t){return this._zoom.constrain(e,t),this._rotation.constrain(e,t),this._geometry.constrain(e,t),e}},{key:"constrainByGeometry",value:function(e){return this._geometry.constrain(e)}},{key:"fit",value:function(e){return this._zoom.fit(e)}},{key:"zoomToScale",value:function(e){return this._zoom.zoomToScale(e)}},{key:"scaleToZoom",value:function(e){return this._zoom.scaleToZoom(e)}},{key:"snapScale",value:function(e){return this._zoom.snapToClosestScale(e)}},{key:"snapToNextScale",value:function(e){return this._zoom.snapToNextScale(e)}},{key:"snapToPreviousScale",value:function(e){return this._zoom.snapToPreviousScale(e)}}]),n}(Oo.Z.EventedAccessor);(0,S._)([(0,U.Cb)({readOnly:!0,aliasOf:"_zoom.effectiveLODs"})],Vp.prototype,"effectiveLODs",void 0),(0,S._)([(0,U.Cb)({readOnly:!0,aliasOf:"_zoom.effectiveMinScale"})],Vp.prototype,"effectiveMinScale",void 0),(0,S._)([(0,U.Cb)({readOnly:!0,aliasOf:"_zoom.effectiveMaxScale"})],Vp.prototype,"effectiveMaxScale",void 0),(0,S._)([(0,U.Cb)({readOnly:!0,aliasOf:"_zoom.effectiveMinZoom"})],Vp.prototype,"effectiveMinZoom",void 0),(0,S._)([(0,U.Cb)({readOnly:!0,aliasOf:"_zoom.effectiveMaxZoom"})],Vp.prototype,"effectiveMaxZoom",void 0),(0,S._)([(0,U.Cb)({types:Dp,value:null})],Vp.prototype,"geometry",null),(0,S._)([(0,U.Cb)({type:[mp.Z]})],Vp.prototype,"lods",void 0),(0,S._)([(0,U.Cb)()],Vp.prototype,"minScale",void 0),(0,S._)([(0,U.Cb)()],Vp.prototype,"maxScale",void 0),(0,S._)([(0,U.Cb)()],Vp.prototype,"minZoom",void 0),(0,S._)([(0,U.Cb)()],Vp.prototype,"maxZoom",void 0),(0,S._)([(0,U.Cb)()],Vp.prototype,"rotationEnabled",void 0),(0,S._)([(0,U.Cb)()],Vp.prototype,"snapToZoom",void 0),(0,S._)([(0,U.Cb)()],Vp.prototype,"view",void 0),(0,S._)([(0,U.Cb)()],Vp.prototype,"_defaultLODs",null),(0,S._)([(0,U.Cb)({type:Mp})],Vp.prototype,"_geometry",null),(0,S._)([(0,U.Cb)({type:Pp})],Vp.prototype,"_rotation",null),(0,S._)([(0,U.Cb)({readOnly:!0,type:jp})],Vp.prototype,"_zoom",null);var Bp,Np=Vp=(0,S._)([(0,G.j)("esri.views.2d.MapViewConstraints")],Vp),zp=n(76796),Up=n(47032),Wp=n(87637),qp=n(24566),Gp=n(42027),Hp=n(2834),Kp=n(75428),Yp=n(70916);function Jp(e){return function(e){return e instanceof Float32Array&&e.length>=2}(e)||function(e){return Array.isArray(e)&&e.length>=2}(e)}function $p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Qp=[0,0],Xp=Bp=function(e){(0,M.Z)(n,e);var t=$p(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e))._viewpoint2D={center:(0,zp.a)(),rotation:0,scale:0,spatialReference:null},r.center=[0,0],r.extent=new ml.Z,r.id=0,r.inverseTransform=(0,Gp.c)(),r.resolution=0,r.rotation=0,r.scale=0,r.transform=(0,Gp.c)(),r.transformNoRotation=(0,Gp.c)(),r.displayMat3=(0,Kp.c)(),r.displayViewMat3=(0,Kp.c)(),r.viewMat3=(0,Kp.c)(),r.viewMat2d=(0,qp.c)(),r.worldScreenWidth=0,r.size=[0,0],r}return(0,C.Z)(n,[{key:"pixelRatio",set:function(e){this._set("pixelRatio",e),this._update()}},{key:"size",set:function(e){this._set("size",e),this._update()}},{key:"viewpoint",set:function(e){if(e){var t=this._viewpoint2D,n=e.targetGeometry;t.center[0]=n.x,t.center[1]=n.y,t.rotation=e.rotation,t.scale=e.scale,t.spatialReference=n.spatialReference}this._update()}},{key:"copy",value:function(e){var t=this.size,n=this.viewpoint;return n&&t?(this.viewpoint=(0,ip.JG)(n,e.viewpoint),this._set("size",(0,bp.c)(t,e.size))):(this.viewpoint=e.viewpoint.clone(),this._set("size",[e.size[0],e.size[1]])),this._set("pixelRatio",e.pixelRatio),this}},{key:"clone",value:function(){return new Bp({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}},{key:"toMap",value:function(e,t,n){return Jp(t)?(0,bp.t)(e,t,this.inverseTransform):(Qp[0]=t,Qp[1]=n,(0,bp.t)(e,Qp,this.inverseTransform))}},{key:"toScreen",value:function(e,t,n){return Jp(t)?(0,bp.t)(e,t,this.transform):(Qp[0]=t,Qp[1]=n,(0,bp.t)(e,Qp,this.transform))}},{key:"toScreenNoRotation",value:function(e,t,n){return Jp(t)?(0,bp.t)(e,t,this.transformNoRotation):(Qp[0]=t,Qp[1]=n,(0,bp.t)(e,Qp,this.transformNoRotation))}},{key:"getScreenTransform",value:function(e,t){var n=this._viewpoint2D.center,r=this._get("pixelRatio")||1,i=this._get("size");return(0,ip.Rb)(e,n,i,t,0,r),e}},{key:"_update",value:function(){var e=this._viewpoint2D,t=e.center,n=e.spatialReference,r=e.scale,i=e.rotation,o=this._get("pixelRatio")||1,a=this._get("size"),s=new wu.Z({targetGeometry:new Ca.Z(t[0],t[1],n),scale:r,rotation:i});if(this._set("viewpoint",s),a&&n&&r){this.resolution=(0,ip.uG)(s),this.rotation=i,this.scale=r,this.spatialReference=n,(0,bp.c)(this.center,t);var u=0!==a[0]?2/a[0]:0,l=0!==a[1]?-2/a[1]:0;(0,Hp.s)(this.displayMat3,u,0,0,0,l,0,-1,1,1);var c=(0,Hp.b)(this.viewMat3),p=(0,Yp.f)(a[0]/2,a[1]/2),f=(0,Yp.f)(-a[0]/2,-a[1]/2),d=(0,Up.t)(i);(0,Hp.c)(c,c,p),(0,Hp.r)(c,c,d),(0,Hp.c)(c,c,f),(0,Hp.m)(this.displayViewMat3,this.displayMat3,c);var h=(0,Wp.i)(this.viewMat2d);return(0,Wp.t)(h,h,p),(0,Wp.r)(h,h,d),(0,Wp.t)(h,h,f),(0,ip.bk)(this.extent,s,a),(0,ip.Ck)(this.transform,s,a,o),(0,Wp.a)(this.inverseTransform,this.transform),(0,ip.Jp)(this.transformNoRotation,s,a,o),this.worldScreenWidth=(0,ip.L2)(this.spatialReference,this.resolution),this._set("id",this.id+1),this}}}]),n}(Su.wq);(0,S._)([(0,U.Cb)({readOnly:!0})],Xp.prototype,"id",void 0),(0,S._)([(0,U.Cb)({value:1,json:{write:!0}})],Xp.prototype,"pixelRatio",null),(0,S._)([(0,U.Cb)({json:{write:!0}})],Xp.prototype,"size",null),(0,S._)([(0,U.Cb)({type:wu.Z,json:{write:!0}})],Xp.prototype,"viewpoint",null);var ef=Xp=Bp=(0,S._)([(0,G.j)("esri.views.2d.ViewState")],Xp);function tf(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var nf=function(e){(0,M.Z)(n,e);var t=tf(n);function n(){var e;return(0,k.Z)(this,n),(e=t.apply(this,arguments)).left=0,e.top=0,e.right=0,e.bottom=0,e}return(0,C.Z)(n)}(re.Z);(0,S._)([(0,U.Cb)()],nf.prototype,"left",void 0),(0,S._)([(0,U.Cb)()],nf.prototype,"top",void 0),(0,S._)([(0,U.Cb)()],nf.prototype,"right",void 0),(0,S._)([(0,U.Cb)()],nf.prototype,"bottom",void 0),nf=(0,S._)([(0,G.j)("esri.views.2d.PaddedViewState.Padding")],nf);var rf=function(e){(0,M.Z)(n,e);var t=tf(n);function n(){var e;(0,k.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).paddedViewState=new ef,e._updateContent=function(){var t=(0,zp.a)();return function(){var n=e._get("size"),r=e._get("padding");if(n&&r){var i=e.paddedViewState;(0,bp.s)(t,r.left+r.right,r.top+r.bottom),(0,bp.f)(t,n,t),(0,bp.c)(i.size,t);var o=i.viewpoint;o&&(e.viewpoint=o)}}}(),e.watch(["size","padding"],e._updateContent,!0),e.padding=new nf,e.size=[0,0],e}return(0,C.Z)(n,[{key:"padding",set:function(e){this._set("padding",e||new nf)}},{key:"viewpoint",set:function(e){if(e){var t=e.clone();this.paddedViewState.viewpoint=e,(0,ip.H4)(t,e,this._get("size"),this._get("padding"));var n=this._viewpoint2D,r=t.targetGeometry;n.center[0]=r.x,n.center[1]=r.y,n.rotation=t.rotation,n.scale=t.scale,n.spatialReference=r.spatialReference,this._update()}}}]),n}(ef);(0,S._)([(0,U.Cb)()],rf.prototype,"paddedViewState",void 0),(0,S._)([(0,U.Cb)({type:nf})],rf.prototype,"padding",null),(0,S._)([(0,U.Cb)()],rf.prototype,"viewpoint",null);var of=rf=(0,S._)([(0,G.j)("esri.views.2d.PaddedViewState")],rf),af=(n(62387),n(99675)),sf=(n(90832),n(75998),n(64621),n(84121)),uf=n(78637);function lf(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function cf(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lf(Object(n),!0).forEach((function(t){(0,H.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lf(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function pf(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var ff=V.Z.getLogger("esri.views.MapView");function df(e){return e&&"esri.Viewpoint"===e.declaredClass}var hf=function(e){(0,M.Z)(n,e);var t=pf(n);function n(e){var r;(0,k.Z)(this,n),(r=t.call(this,e))._stationaryTimer=null,r.frameTask=new lp((0,x.Z)(r)),r.featuresTilingScheme=null,r.fullOpacity=1,r.graphicsView=null,r.initialExtent=null,r.map=null,r.labelManager=null,r.renderingOptions={samplingMode:"dynamic",edgeLabelsVisible:!0,labelsAnimationTime:125,labelCollisionsEnabled:!0},r.resizeAlign="center",r.supportsGround=!1,r.timeline=new uf.T,r.type="2d",r.constraints=new Np,r.padding={top:0,right:0,bottom:0,left:0};var i=r.handles,o=function(){return r.notifyChange("updating")};return i.add([r.watch("viewpoint",(function(){r._lastStationaryEventTimestamp=performance.now(),r._flipStationary(160)}),!0),r.on("resize",(function(e){return r._resizeHandler(e)})),r.watch("animationManager.animation",(function(e){r.animation=e})),r.allLayerViews.on("change",(function(){o(),i.remove("map-view-base-layerViewsUpdating"),i.add(r.allLayerViews.map((function(e){return e.watch("updating",o)})),"map-view-base-layerViewsUpdating")}))],"map-view-base"),r}return(0,C.Z)(n,[{key:"destroy",value:function(){this.destroyed||(this._set("preconditionsReady",!1),this._gotoTask=this.frameTask=null)}},{key:"_defaultsFromMapSettings",get:function(){return{required:{tileInfo:!0,heightModelInfo:!1,extent:!1}}}},{key:"animation",set:function(e){var t=this,n=this._get("animation");if(e!==n)if(n&&n.stop(),e&&!e.isFulfilled()){this._set("animation",e),this.frameTask.animationInProgress=!0;var r=function(){e===t._get("animation")&&(t._set("animation",null),t.frameTask.requestFrame()),t.frameTask.animationInProgress=!1};e.when(r,r)}else this._set("animation",null)}},{key:"center",get:function(){if(!this.ready)return this._get("center");var e=this.state.paddedViewState,t=e.center,n=e.spatialReference;return new Ca.Z({x:t[0],y:t[1],spatialReference:n})},set:function(e){if(null!=e)if(this._normalizeInput(e)){if(!this.ready)return this._set("center",e),void this.notifyChange("initialExtentRequired");var t=this.viewpoint;(0,ip.o2)(t,t,e),this.viewpoint=t}else ff.error("#center","incompatible spatialReference ".concat(JSON.stringify(e.spatialReference)," with view's spatialReference ").concat(JSON.stringify(this.spatialReference)))}},{key:"constraints",set:function(e){var t=this,n=this._get("constraints");n&&(this.handles.remove("map-view-base-constraints"),n.destroy()),this._set("constraints",e),e&&(e.view=this,this.ready&&(this.state.viewpoint=e.fit(this.state.paddedViewState.viewpoint)),this.handles.add(e.on("update",(function(){t.ready&&t.state&&(t.state.viewpoint=e.fit(t.state.paddedViewState.viewpoint))})),"map-view-base-constraints"))}},{key:"extent",get:function(){return this.ready?this.state.paddedViewState.extent.clone():this._get("extent")},set:function(e){if(null!=e){var t=this._normalizeInput(e);if(t)if(t.width&&t.height){if(!this.ready)return this._set("extent",t),this._set("center",null),this._set("viewpoint",null),this._set("scale",0),this._set("zoom",-1),void this.notifyChange("initialExtentRequired");var n=this.viewpoint;(0,ip.qf)(n,n,t,this.size,{constraints:this.constraints}),this.viewpoint=n}else ff.error("#extent","invalid extent size");else ff.error("#center","incompatible spatialReference ".concat(JSON.stringify(e.spatialReference)," with view's spatialReference ").concat(JSON.stringify(this.spatialReference)))}}},{key:"graphicsTileStore",get:function(){return new sf.Z(this.featuresTilingScheme)}},{key:"initialExtentRequired",get:function(){var e=this._normalizeInput(this.center),t=this._normalizeInput(this.viewpoint),n=this._normalizeInput(this.extent),r=this.scale,i=this.constraints,o=this.zoom;return!(this.get("map.initialViewProperties.viewpoint")||n||(i.effectiveLODs||(o=-1),e&&(0!==r||-1!==o)||t&&(0,B.pC)(t.targetGeometry)&&("extent"===t.targetGeometry.type||t.scale)))}},{key:"padding",get:function(){return this.ready?this.state.padding:this._get("padding")},set:function(e){this.ready?(this.state.padding=e,this._set("padding",this.state.padding)):this._set("padding",e)}},{key:"resolution",get:function(){return this.state?this.state.resolution:0}},{key:"rotation",get:function(){return this.ready?this.state.rotation:this._get("rotation")},set:function(e){if(!isNaN(e))if(this.ready){var t=this.viewpoint;(0,ip.YQ)(t,t,e),this.viewpoint=t}else this._set("rotation",e)}},{key:"scale",get:function(){return this.ready?this.state.scale:this._get("scale")},set:function(e){if(e&&!isNaN(e)){if(!this.ready){this._set("scale",e),this._set("zoom",-1);var t=this._get("extent");return t&&(this._set("extent",null),this._set("center",t.center)),void this.notifyChange("initialExtentRequired")}var n=this.viewpoint;(0,ip.Hy)(n,n,e),this.viewpoint=n}}},{key:"stationary",get:function(){return!(this.animation||this.navigating||this._get("resizing")||this._stationaryTimer)}},{key:"updating",get:function(){return!this.destroyed&&(!0===this.get("layerViewManager.updating")||!0===this.get("labelManager.updating")||!0===this.get("graphicsView.updating")||this.allLayerViews.some((function(e){return!e.destroyed&&!("layerViews"in e)&&!0===e.updating})))}},{key:"viewpoint",get:function(){if(!this.ready)return this._get("viewpoint");var e=this.state.paddedViewState;return e&&e.viewpoint.clone()},set:function(e){if(null!=e){var t=this._normalizeInput(e);if(t){if(!this.ready)return this._set("viewpoint",t),this._set("extent",null),this._set("center",null),this._set("zoom",-1),this._set("scale",0),void this.notifyChange("initialExtentRequired");var n=new wu.Z({targetGeometry:new Ca.Z,scale:0,rotation:0});(0,ip.JG)(n,t),this.constraints.constrain(n,this.state.paddedViewState.viewpoint),this.state.viewpoint=n,this.frameTask.requestFrame(),this._set("viewpoint",n)}else!e.scale||isNaN(e.scale)?ff.error("#viewpoint","invalid scale value of ".concat(e.scale)):(0,B.Wi)(e.targetGeometry)?ff.error("#viewpoint","geometry not defined"):ff.error("#viewpoint","incompatible spatialReference ".concat(JSON.stringify(e.targetGeometry.spatialReference)," with view's spatialReference ").concat(JSON.stringify(this.spatialReference)))}}},{key:"zoom",get:function(){return this.ready?this.constraints.scaleToZoom(this.scale):this._get("zoom")},set:function(e){if(null!=e){if(!this.ready){this.notifyChange("initialExtentRequired"),this._set("zoom",e),this._set("scale",0);var t=this._get("extent");t&&(this._set("extent",null),this._set("center",t.center))}if(this.constraints.effectiveLODs){var n=this.viewpoint;(0,ip.Hy)(n,n,this.constraints.zoomToScale(e)),this.viewpoint=n,this._set("zoom",this.constraints.scaleToZoom(this.scale))}}}},{key:"goTo",value:function(e,t){var n=this;if(e)return this.animation&&(this.animation=null),this._createAnimation(),(0,N.LR)(this,"ready",t&&t.signal).then((function(){var r=cf({animate:!0},t),i=(0,ip.km)(e,n);return n.animation.update(i),n._gotoTask={},r.animate?n._gotoAnimated(i,r):n._gotoImmediate(i,r)}));ff.error("#goTo()","target cannot be null or undefined")}},{key:"hitTest",value:function(e){return Promise.reject("Should be implemented by subclasses")}},{key:"popupHitTest",value:function(e){var t=this;return this.hitTest(e).then((function(n){return cf(cf({},n),{},{mapPoint:t.toMap(e)})}))}},{key:"toMap",value:function(e){if(!this.ready)return null;var t=this.state.toMap([0,0],[e.x,e.y]),n=(0,w.Z)(t,2),r=n[0],i=n[1],o=this.spatialReference;return new Ca.Z({x:r,y:i,spatialReference:o})}},{key:"toScreen",value:function(e){if(!this.ready)return null;var t=this._normalizeInput(e),n=[t.x,t.y];return this.state.toScreen(n,n),(0,ku.vW)(n[0],n[1])}},{key:"pixelSizeAt",value:function(){return this.ready?this.state.resolution:(ff.error("#pixelSizeAt()","Map view cannot be used before it is ready"),null)}},{key:"requestUpdate",value:function(){this.ready&&this.frameTask.requestUpdate()}},{key:"getDefaultSpatialReference",value:function(){var e,t,n;return this.map&&"initialViewProperties"in this.map&&(null==(e=this.map)||null==(t=e.initialViewProperties)?void 0:t.spatialReference)||(null==(n=this.defaultsFromMap)?void 0:n.spatialReference)||null}},{key:"getSpatialReferenceSupport",value:function(e){return e.layer||this._get("ready")||null!==this._getDefaultViewpoint()?{}:null}},{key:"importLayerView",value:function(e){return yp(e)}},{key:"hasLayerViewModule",value:function(e){return vp(e)}},{key:"_createAnimation",value:function(){return this.animation&&!this.animation.done||(this.animation=new np),this.animation}},{key:"_cancellableGoTo",value:function(e,t,n){var r=this,i=function(){return e===r._gotoTask},o=n.then((function(){i()&&(r.animation=null)})).catch((function(e){throw i()&&(r.animation=null,t.done||(t.stop(),r.frameTask.animationInProgress=!1)),e})),a=new Promise((function(e){return e(o)}));return t.when().catch((function(){i()&&a.cancel&&a.cancel()})),a}},{key:"_gotoImmediate",value:function(e,t){var n=this,r=this._gotoTask,i=this.animation,o=e.then((function(e){if((0,gr.k_)(t),r!==n._gotoTask)throw new F.Z("view:goto-interrupted","Goto was interrupted");n.viewpoint=i.target=e,i.finish()}));return this._cancellableGoTo(r,i,o)}},{key:"_gotoAnimated",value:function(e,t){var n=this,r=this._gotoTask,i=this.animation,o=e.then((function(e){if((0,gr.k_)(t),r!==n._gotoTask)throw new F.Z("view:goto-interrupted","Goto was interrupted");return i.update(e),n.animationManager.animate(i,n.viewpoint,t),i.when().then((function(){}),(function(){}))}));return this._cancellableGoTo(r,i,o)}},{key:"_resizeHandler",value:function(e){var t=this.state;if(t){var n=this.state.paddedViewState.viewpoint,r=this.state.paddedViewState.size.concat();t.size=[e.width,e.height],(0,ip.SI)(n,n,r,this.state.paddedViewState.size,this.resizeAlign),n=this.constraints.constrain(n,null),this.state.viewpoint=n}}},{key:"_startup",value:function(){var e=this._getDefaultViewpoint();this.constraints.view=this,this.constraints.fit(e),this._set("animationManager",new up({view:this})),this._set("state",new of({padding:this._get("padding"),size:this.size,viewpoint:e})),this._set("featuresTilingScheme",new af.Z(Cu.Z.create({spatialReference:this.spatialReference,size:512,numLODs:36}))),this._set("ready",!0),this.frameTask&&this.frameTask.start()}},{key:"_teardown",value:function(){this.frameTask&&this.frameTask.stop(),this._set("ready",!1),this._stationaryTimer&&(clearTimeout(this._stationaryTimer),this._stationaryTimer=null);var e=this.state.paddedViewState,t=(0,w.Z)(e.center,2),n=t[0],r=t[1],i=e.spatialReference,o=e.rotation,a=e.scale,s=new Ca.Z({x:n,y:r,spatialReference:i});this._set("viewpoint",null),this._set("extent",null),this._set("center",s),this._set("zoom",-1),this._set("rotation",o),this._set("scale",a),this._set("spatialReference",i),this.constraints.view=null,this.animationManager.destroy(),this._set("animationManager",null),this._set("state",null),this.animation=null}},{key:"_flipStationary",value:function(e){var t=this;return null!==this._stationaryTimer||(this._stationaryTimer=setTimeout((function(){t._stationaryTimer=null;var e=performance.now()-t._lastStationaryEventTimestamp;e<160&&(t._stationaryTimer=t._flipStationary(e))}),e)),this._stationaryTimer}},{key:"_normalizeInput",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.spatialReference,n=e&&e.targetGeometry||e;return t?n?t.equals(n.spatialReference)?e:(0,zo.Q8)(n,t)?df(e)?(e.targetGeometry=(0,zo.iV)(n,t),e):(0,zo.iV)(n,t):null:null:e}},{key:"_getDefaultViewpoint",value:function(){var e=this.constraints,t={zoom:this._get("zoom"),scale:this._get("scale"),center:this._normalizeInput(this._get("center")),extent:this._normalizeInput(this._get("extent")),rotation:this._get("rotation"),viewpoint:this._normalizeInput(this._get("viewpoint")),spatialReference:this._userSpatialReference};e.effectiveLODs?-1!==t.zoom&&(t.scale=e.zoomToScale(t.zoom)):t.zoom=-1;var n=null,r=null,i=0,o=t.viewpoint&&t.viewpoint.rotation,a=t.viewpoint&&t.viewpoint.targetGeometry;(0,B.pC)(a)&&("extent"===a.type?n=a:"point"===a.type&&(r=a,i=t.viewpoint.scale));var s=this._normalizeInput(this.get("map.initialViewProperties.viewpoint.targetGeometry.extent")),u=this._normalizeInput(this.initialExtent),l=t.extent||n||s||u,c=t.center||r||l&&l.center,p=this.get("map.initialViewProperties.viewpoint.scale"),f=t.scale||i||p||l&&(0,ip.EK)(l,this.size),d=this.get("map.initialViewProperties.viewpoint.rotation"),h=t.rotation||o||d||0;return c&&f?new wu.Z({targetGeometry:c,scale:f,rotation:h}):null}}]),n}(function(e){var t=function(e){(0,M.Z)(o,e);var t,n,r,i=Mu(o);function o(){return(0,k.Z)(this,o),i.apply(this,arguments)}return(0,C.Z)(o,[{key:"fetchPopupFeatures",value:(r=(0,O.Z)(T().mark((function e(t,n){var r,i,o,a,s,u,l,c;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.when();case 2:return e.next=4,this._prepareFetchPopupFeatures(t,n);case 4:return r=e.sent,i=r.location,o=r.queryArea,a=r.layerViewsAndGraphics,s=r.clientOnlyGraphics,u=Promise.resolve(s),l=this._queryLayerPopupFeatures(o,a,n),c=l.map((function(e){return e.promise})),e.abrupt("return",{location:i,clientOnlyGraphics:s,allGraphicsPromise:(0,gr.WW)([u].concat((0,h.Z)(c))).then(W.xH),promisesPerLayerView:l});case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"_queryLayerPopupFeatures",value:function(e,t,n){return t.map((function(t){var r=t.layerView,i={clientGraphics:t.graphics,event:(0,B.pC)(n)?n.event:null,signal:(0,B.pC)(n)?n.signal:null,defaultPopupTemplateEnabled:!!(0,B.pC)(n)&&!!n.defaultPopupTemplateEnabled},o=r.fetchPopupFeatures(e,i);return{layerView:r,promise:o}}))}},{key:"_isValidPopupGraphic",value:function(e,t){return e&&!!e.getEffectivePopupTemplate((0,B.pC)(t)&&t.defaultPopupTemplateEnabled)}},{key:"_prepareFetchPopupFeatures",value:(n=(0,O.Z)(T().mark((function e(t,n){var r,i,o,a,s,u,l,c;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._popupHitTestGraphics(t,n);case 2:return r=e.sent,i=r.clientGraphics,o=r.queryArea,a=r.location,s=this._getFetchPopupLayerViews(),u=this._graphicsPerFetchPopupLayerView(i,s),l=u.layerViewsAndGraphics,c=u.clientOnlyGraphics,e.abrupt("return",{clientOnlyGraphics:c,layerViewsAndGraphics:l,queryArea:o,location:a});case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"_popupHitTestGraphics",value:(t=(0,O.Z)(T().mark((function e(t,n){var r,i,o,a,s,u=this;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.popupHitTest(t);case 2:return r=e.sent,i=r.results,o=r.mapPoint,a=i.filter((function(e){return u._isValidPopupGraphic(e.graphic,n)})),s=a.length?a[0].mapPoint:null,e.abrupt("return",{clientGraphics:a.map((function(e){return e.graphic})),queryArea:o,location:o||s});case 8:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"_getFetchPopupLayerViews",value:function(){var e=this,t=[];return this.allLayerViews.forEach((function(n){e._isValidPopupLayerView(n)&&t.push(n)})),(0,B.pC)(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&t.push(this.graphicsView),t.reverse()}},{key:"_isValidPopupLayerView",value:function(e){return(0,B.pC)(e)&&(!("layer"in e)||!e.suspended)&&"fetchPopupFeatures"in e}},{key:"_graphicsPerFetchPopupLayerView",value:function(e,t){var n,r=[],i=new Map,o=t.map((function(e){var t=[];return"layer"in e?i.set(e.layer,t):i.set(e.graphics,t),{layerView:e,graphics:t}})),a=xu(e);try{for(a.s();!(n=a.n()).done;){var s=n.value,u=i.get(s.layer)||i.get(s.sourceLayer)||null;u?u.push(s):r.push(s)}}catch(l){a.e(l)}finally{a.f()}return{layerViewsAndGraphics:o,clientOnlyGraphics:r}}}]),o}(e);return t=(0,S._)([(0,G.j)("esri.views.PopupView")],t)}(Xc));(0,S._)([(0,U.Cb)()],hf.prototype,"_stationaryTimer",void 0),(0,S._)([(0,U.Cb)()],hf.prototype,"_defaultsFromMapSettings",null),(0,S._)([(0,U.Cb)()],hf.prototype,"animation",null),(0,S._)([(0,U.Cb)({readOnly:!0})],hf.prototype,"animationManager",void 0),(0,S._)([(0,U.Cb)({value:null,type:Ca.Z,dependsOn:["state.id","ready"]})],hf.prototype,"center",null),(0,S._)([(0,U.Cb)({type:Np})],hf.prototype,"constraints",null),(0,S._)([(0,U.Cb)({value:null,type:ml.Z,dependsOn:["state.id","ready"]})],hf.prototype,"extent",null),(0,S._)([(0,U.Cb)({readOnly:!0})],hf.prototype,"featuresTilingScheme",void 0),(0,S._)([(0,U.Cb)()],hf.prototype,"fullOpacity",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],hf.prototype,"graphicsTileStore",null),(0,S._)([(0,U.Cb)()],hf.prototype,"graphicsView",void 0),(0,S._)([(0,U.Cb)({type:ml.Z})],hf.prototype,"initialExtent",void 0),(0,S._)([(0,U.Cb)({dependsOn:["map.initialViewProperties?.viewpoint","constraints.effectiveLODs","spatialReference"]})],hf.prototype,"initialExtentRequired",null),(0,S._)([(0,U.Cb)()],hf.prototype,"map",void 0),(0,S._)([(0,U.Cb)()],hf.prototype,"labelManager",void 0),(0,S._)([(0,U.Cb)({value:{top:0,right:0,bottom:0,left:0},cast:function(e){return cf({top:0,right:0,bottom:0,left:0},e)}})],hf.prototype,"padding",null),(0,S._)([(0,U.Cb)({type:Object})],hf.prototype,"renderingOptions",void 0),(0,S._)([(0,U.Cb)()],hf.prototype,"resizeAlign",void 0),(0,S._)([(0,U.Cb)({readOnly:!0,dependsOn:["state.id"]})],hf.prototype,"resolution",null),(0,S._)([(0,U.Cb)({value:0,type:Number,dependsOn:["state.id","ready"]})],hf.prototype,"rotation",null),(0,S._)([(0,U.Cb)({value:0,type:Number,dependsOn:["state.id","ready"]})],hf.prototype,"scale",null),(0,S._)([(0,U.Cb)({type:bl.Z,dependsOn:["map.initialViewProperties?.spatialReference","defaultsFromMap.ready"]})],hf.prototype,"spatialReference",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],hf.prototype,"state",void 0),(0,S._)([(0,U.Cb)({dependsOn:["animation","navigating","resizing","_stationaryTimer"]})],hf.prototype,"stationary",null),(0,S._)([(0,U.Cb)({readOnly:!0})],hf.prototype,"supportsGround",void 0),(0,S._)([(0,U.Cb)({type:uf.T,readOnly:!0})],hf.prototype,"timeline",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],hf.prototype,"type",void 0),(0,S._)([(0,U.Cb)({readOnly:!0,dependsOn:["layerViewManager.updating","labelManager.updating","graphicsView?.updating"]})],hf.prototype,"updating",null),(0,S._)([(0,U.Cb)({value:null,type:wu.Z,dependsOn:["state.id","ready"]})],hf.prototype,"viewpoint",null),(0,S._)([(0,U.Cb)({value:-1,dependsOn:["state.id"]})],hf.prototype,"zoom",null);var vf=hf=(0,S._)([(0,G.j)("esri.views.MapViewBase")],hf);function yf(e,t){switch(t){case"primary":return"touch"===e.pointerType||0===e.button;case"secondary":return"touch"!==e.pointerType&&2===e.button;case"tertiary":return"touch"!==e.pointerType&&1===e.button}}function mf(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var gf=function(e){(0,M.Z)(n,e);var t=mf(n);function n(e,r){var i;return(0,k.Z)(this,n),(i=t.call(this,!0)).view=e,i.registerIncoming("double-click",r,(function(e){return i._handleDoubleClick(e,r)})),i}return(0,C.Z)(n,[{key:"_handleDoubleClick",value:function(e,t){yf(e.data,"primary")&&(e.stopPropagation(),t?this.view.mapViewNavigation.zoomOut([e.data.x,e.data.y]):this.view.mapViewNavigation.zoomIn([e.data.x,e.data.y]))}}]),n}(Dl.a);function bf(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var _f=function(e){(0,M.Z)(n,e);var t=bf(n);function n(e,r,i){var o;return(0,k.Z)(this,n),(o=t.call(this,!0)).view=e,o.pointerType=r,o.registerIncoming("double-tap-drag",i,(function(e){return o._handleDoubleTapDrag(e)})),o}return(0,C.Z)(n,[{key:"_handleDoubleTapDrag",value:function(e){var t=e.data;if(t.pointerType===this.pointerType){e.stopPropagation();var n=t.action,r=t.delta,i=this.view,o=i.mapViewNavigation;switch(n){case"begin":var a=i.scale;this._startScale=a,this._currentScale=a,this._previousDelta=r,o.begin();break;case"update":if(this._previousDelta.y===r.y)return;this._previousDelta=r;var s=Math.pow(1.015,r.y),u=this._startScale*s,l=u/this._currentScale;o.setViewpointImmediate(l),this._currentScale=u;break;case"end":var c=i.constraints,p=c.effectiveLODs;if(!c.snapToZoom||!p)return void o.end();var f=c.snapScale(this._currentScale),d=(r.y>0?Math.max(f,c.snapToPreviousScale(this._startScale)):Math.min(f,c.snapToNextScale(this._startScale)))/this._currentScale;o.zoom(d)}}}}]),n}(Dl.a),wf=function(){function e(t){(0,k.Z)(this,e),this.callbacks=t,this.currentCount=0,this.callbacks.condition||(this.callbacks.condition=function(){return!0})}return(0,C.Z)(e,[{key:"handle",value:function(e){var t=e.data,n=t.pointers.size;switch(t.action){case"start":this.currentCount=n,this.emitStart(e);break;case"added":this.emitEnd(this.previousEvent),this.currentCount=n,this.emitStart(e);break;case"update":this.emitUpdate(e);break;case"removed":this.startEvent&&this.emitEnd(this.previousEvent),this.currentCount=n,this.emitStart(e);break;case"end":this.emitEnd(e),this.currentCount=0}this.previousEvent=e}},{key:"emitStart",value:function(e){this.startEvent=e,this.callbacks.condition(this.currentCount,e)&&this.callbacks.start(this.currentCount,e,this.startEvent)}},{key:"emitUpdate",value:function(e){this.callbacks.condition(this.currentCount,e)&&this.callbacks.update(this.currentCount,e,this.startEvent)}},{key:"emitEnd",value:function(e){this.callbacks.condition(this.currentCount,e)&&this.callbacks.end(this.currentCount,e,this.startEvent),this.startEvent=null}}]),e}();function kf(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Cf=function(e){(0,M.Z)(n,e);var t=kf(n);function n(e,r,i){var o;(0,k.Z)(this,n),(o=t.call(this,!0)).view=e,o.pointerAction=r,o.registerIncoming("drag",i,(function(e){return o._handleDrag(e)})),o.registerIncoming("pointer-down",(function(){return o.stopMomentumNavigation()}));var a=o.view.mapViewNavigation;return o.dragEventSeparator=new wf({start:function(e,t){a.pan.begin(o.view,t.data),t.stopPropagation()},update:function(e,t){a.pan.update(o.view,t.data),t.stopPropagation()},end:function(e,t){a.pan.end(o.view,t.data),t.stopPropagation()},condition:function(e,t){return 1===e&&yf(t.data,o.pointerAction)}}),o}return(0,C.Z)(n,[{key:"_handleDrag",value:function(e){var t=this.view.mapViewNavigation;t.pinch.zoomMomentum||t.pinch.rotateMomentum?this.stopMomentumNavigation():this.dragEventSeparator.handle(e)}},{key:"stopMomentumNavigation",value:function(){this.view.mapViewNavigation.pan.stopMomentumNavigation()}}]),n}(Dl.a);function xf(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Zf=function(e){(0,M.Z)(n,e);var t=xf(n);function n(e,r,i){var o;(0,k.Z)(this,n),(o=t.call(this,!0)).view=e,o.pointerAction=r;var a=o.view.mapViewNavigation;return o.dragEventSeparator=new wf({start:function(e,t){a.rotate.begin(o.view,t.data),t.stopPropagation()},update:function(e,t){a.rotate.update(o.view,t.data),t.stopPropagation()},end:function(e,t){a.rotate.end(),t.stopPropagation()},condition:function(e,t){return 1===e&&yf(t.data,o.pointerAction)}}),o.registerIncoming("drag",i,(function(e){return o.dragEventSeparator.handle(e)})),o}return(0,C.Z)(n)}(Dl.a),Mf=n(77880);function If(e){var t=e*e;return e<0&&(t*=-1),t}function Rf(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Of=function(e){(0,M.Z)(n,e);var t=Rf(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,!0)).view=e,r.frameTask=null,r.watchHandles=new Y.Z,r.currentDevice=null,r.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},r.handle=r.registerIncoming("gamepad",(function(e){return r.handleEvent(e)})),r.handle.pause(),r}return(0,C.Z)(n,[{key:"onInstall",value:function(e){var t=this;(0,Z.Z)((0,R.Z)(n.prototype),"onInstall",this).call(this,e),this.watchHandles.add([(0,N.S1)(this.view.navigation.gamepad,"enabled",(function(e){e?(t.handle.resume(),t.frameTask||(t.frameTask=(0,ne.A)({update:function(e){return t.frameUpdate(e.deltaTime)}}))):(t.handle.pause(),t.frameTask&&(t.frameTask.remove(),t.frameTask=null))}))])}},{key:"onUninstall",value:function(){this.watchHandles.removeAll(),this.frameTask&&(this.frameTask.remove(),this.frameTask=null),(0,Z.Z)((0,R.Z)(n.prototype),"onUninstall",this).call(this)}},{key:"handleEvent",value:function(e){var t=this.view.navigation.gamepad.device;t&&e.data.device!==t||this.currentDevice&&this.currentDevice!==e.data.device||("end"===e.data.action?(this.currentDevice=null,function(e){e.translation[0]=0,e.translation[1]=0,e.translation[2]=0,e.heading=0,e.tilt=0}(this.transformation)):(this.currentDevice=e.data.device,function(e,t,n){var r=n,i=e.state,o=e.device,a="forward-down"===t.tiltDirection?1:-1;"standard"===o.deviceType?(r.translation[0]=If(i.axes[0]),r.translation[1]=If(i.axes[1]),r.translation[2]=If(i.buttons[7])-If(i.buttons[6]),r.heading=If(i.axes[2]),r.tilt=If(i.axes[3])):"spacemouse"===o.deviceType&&(r.translation[0]=1.2*If(i.axes[0]),r.translation[1]=1.2*If(i.axes[1]),r.translation[2]=2*-If(i.axes[2]),r.heading=1.2*If(i.axes[5]),r.tilt=1.2*If(i.axes[3])),r.tilt*=a,(0,Mf.a)(r.translation,r.translation,1)}(e.data,this.view.navigation.gamepad,this.transformation)))}},{key:"frameUpdate",value:function(e){var t=this.transformation;if(!function(e){return 0===e.translation[0]&&0===e.translation[1]&&0===e.translation[2]&&0===e.heading&&0===e.tilt&&0===e.zoom}(t)){var n=this.view.viewpoint.clone(),r=this.view.navigation.gamepad.velocityFactor,i=Tf*r*e;(0,ip.Rx)(n,n,[t.translation[0]*i,-t.translation[1]*i]);var o=1+t.translation[2]*Sf*e,a=this.view.constraints.rotationEnabled?-t.heading*Pf*e:0,s=this.view.size,u=[s[0]/2,s[1]];(0,ip.UZ)(n,n,o,a,u,s);var l=this.view.constraints.constrain(n,this.view.viewpoint);this.view.viewpoint=l}}}]),n}(Dl.a),Pf=.06,Tf=.7,Sf=6e-4;function Ef(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Af=function(e){(0,M.Z)(n,e);var t=Ef(n);function n(e,r,i){var o,a;return(0,k.Z)(this,n),(a=t.call(this,!0)).view=e,a.keys=r,a._pressed=!1,a._keyMap=(o={},(0,H.Z)(o,r.left,"left"),(0,H.Z)(o,r.right,"right"),(0,H.Z)(o,r.up,"up"),(0,H.Z)(o,r.down,"down"),o),a.registerIncoming("key-down",i,(function(e){return a._handleKeyDown(e)})),a.registerIncoming("key-up",i,(function(e){return a._handleKeyUp(e)})),a.registerIncoming("blur",i,(function(){return a._handleBlur()})),a}return(0,C.Z)(n,[{key:"_handleKeyDown",value:function(e){e.data.repeat||this._handleKey(e,!0)}},{key:"_handleKeyUp",value:function(e){this._handleKey(e,!1)}},{key:"_handleBlur",value:function(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())}},{key:"_handleKey",value:function(e,t){var n=this._keyMap[e.data.key];if(this._pressed=null!=n,this._pressed){if(t)switch(this.view.mapViewNavigation.begin(),n){case"left":this.view.mapViewNavigation.continousPanLeft();break;case"right":this.view.mapViewNavigation.continousPanRight();break;case"up":this.view.mapViewNavigation.continousPanUp();break;case"down":this.view.mapViewNavigation.continousPanDown()}else this._pressed=!1,this.view.mapViewNavigation.stop();e.stopPropagation()}}}]),n}(Dl.a);function jf(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Ff=function(e){(0,M.Z)(n,e);var t=jf(n);function n(e,r,i){var o,a;return(0,k.Z)(this,n),(a=t.call(this,!0)).view=e,a.keys=r,a._pressed=!1,a._keyToDirection=(o={},(0,H.Z)(o,r.clockwiseOption1,"clockwise"),(0,H.Z)(o,r.clockwiseOption2,"clockwise"),(0,H.Z)(o,r.counterClockwiseOption1,"counterClockwise"),(0,H.Z)(o,r.counterClockwiseOption2,"counterClockwise"),(0,H.Z)(o,r.resetOption1,"reset"),(0,H.Z)(o,r.resetOption2,"reset"),o),a.registerIncoming("key-down",i,(function(e){return a._handleKeyDown(e)})),a.registerIncoming("key-up",i,(function(e){return a._handleKeyUp(e)})),a.registerIncoming("blur",i,(function(){return a._handleBlur()})),a}return(0,C.Z)(n,[{key:"_handleKeyDown",value:function(e){e.data.repeat||this._handleKey(e,!0)}},{key:"_handleKeyUp",value:function(e){this._handleKey(e,!1)}},{key:"_handleBlur",value:function(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())}},{key:"_handleKey",value:function(e,t){var n=e.modifiers;if(!(n.size>0&&!n.has("Shift")||!this.view.constraints.rotationEnabled)){var r=this._keyToDirection[e.data.key];if(this._pressed=null!=r,this._pressed){if(t)switch(this.view.mapViewNavigation.begin(),r){case"clockwise":this.view.mapViewNavigation.continousRotateClockwise();break;case"counterClockwise":this.view.mapViewNavigation.continousRotateCounterclockwise();break;case"reset":this.view.mapViewNavigation.resetRotation()}else this._pressed=!1,this.view.mapViewNavigation.stop();e.stopPropagation()}}}}]),n}(Dl.a);function Lf(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Df=function(e){(0,M.Z)(n,e);var t=Lf(n);function n(e,r,i){var o;return(0,k.Z)(this,n),(o=t.call(this,!0)).view=e,o.keys=r,o._keysToZoomAction={},o.registerIncoming("key-down",i,(function(e){return o._handleKeyDown(e)})),r.zoomIn.forEach((function(e){return o._keysToZoomAction[e]=0})),r.zoomOut.forEach((function(e){return o._keysToZoomAction[e]=1})),o}return(0,C.Z)(n,[{key:"_handleKeyDown",value:function(e){this._handleKey(e)}},{key:"_handleKey",value:function(e){var t=e.modifiers;if(!(t.size>0)||t.has("Shift")){var n=e.data.key;if(n in this._keysToZoomAction){var r=this._keysToZoomAction[n],i=this.view.mapViewNavigation,o=null;switch(r){case 0:o=i.zoomIn();break;case 1:o=i.zoomOut();break;default:return}i.begin(),o.then((function(){return i.end()})),e.stopPropagation()}}}}]),n}(Dl.a);function Vf(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Bf=function(e){(0,M.Z)(n,e);var t=Vf(n);function n(e,r){var i;return(0,k.Z)(this,n),(i=t.call(this,!0)).view=e,i._canZoom=!0,i.registerIncoming("mouse-wheel",r,(function(e){return i._handleMouseWheel(e)})),i}return(0,C.Z)(n,[{key:"_handleMouseWheel",value:function(e){var t=this;if(this.view.navigation.mouseWheelZoomEnabled&&(e.preventDefault(),e.stopPropagation(),this._canZoom)){var n=this.view.mapViewNavigation,r=e.data,i=r.x,o=r.y,a=r.deltaY,s=1/Math.pow(.6,1/60*a),u=n.zoom(s,[i,o]);u&&(this._canZoom=!1,u.catch((function(){})).then((function(){t._canZoom=!0,n.end()})))}}}]),n}(Dl.a);function Nf(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var zf=function(e){(0,M.Z)(n,e);var t=Nf(n);function n(e){var r;(0,k.Z)(this,n),(r=t.call(this,!0)).view=e,r.registerIncoming("drag",(function(e){return r._handleDrag(e)})),r.registerIncoming("pointer-down",(function(){return r.stopMomentumNavigation()}));var i=r.view.mapViewNavigation;return r.dragEventSeparator=new wf({start:function(e,t){i.pinch.begin(r.view,t.data),t.stopPropagation()},update:function(e,t){i.pinch.update(r.view,t.data),t.stopPropagation()},end:function(e,t){i.pinch.end(r.view),t.stopPropagation()},condition:function(e){return e>=2}}),r}return(0,C.Z)(n,[{key:"_handleDrag",value:function(e){this.dragEventSeparator.handle(e)}},{key:"stopMomentumNavigation",value:function(){this.view.mapViewNavigation.pinch.stopMomentumNavigation()}}]),n}(Dl.a),Uf=n(49871);function Wf(e){var t=e.native;return t?{buttons:t.buttons.map((function(e){return e.pressed?e.value?e.value:1:0})),axes:t.axes.map((function(t){return function(e,t){var n=Math.abs(e);return n<t?0:Math.sign(e)*(n-t)/(1-t)}(t,e.axisThreshold)}))}:{buttons:[],axes:[]}}var qf=function(){function e(t,n){var r=this;(0,k.Z)(this,e),this.element=t,this.input=n,this._hasEventListeners=!1,this.onConnectGamepad=function(e){r.connectGamepad(e.gamepad)},this.onDisconnectGamepad=function(e){var t=e.gamepad,n=t.index,i=r.inputDevices[n];i&&(r.emitGamepadEvent(t,Wf(i),!1),r.inputDevices.splice(n,1),r.latestUpdate.splice(n,1),r.input.gamepad.devices.remove(i),r.ensurePollingState())},this.frameTask=null,this.latestUpdate=new Array,this.inputDevices=new Array,this.callback=null;var i="getGamepads"in window.navigator,o=window.isSecureContext;this.supported=i&&o,this.supported&&(this.forEachGamepad((function(e){return r.connectGamepad(e)})),window.addEventListener("gamepadconnected",this.onConnectGamepad),window.addEventListener("gamepaddisconnected",this.onDisconnectGamepad),this.ensurePollingState())}return(0,C.Z)(e,[{key:"destroy",value:function(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this.onConnectGamepad),window.removeEventListener("gamepaddisconnected",this.onDisconnectGamepad))}},{key:"hasEventListeners",set:function(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}},{key:"eventsEnabled",get:function(){return this.supported&&this.inputDevices.length>0&&this._hasEventListeners}},{key:"onEvent",set:function(e){this.callback=e}},{key:"connectGamepad",value:function(e){var t=new yc(e);"unknown"!==t.deviceType&&(this.inputDevices[e.index]=t,this.input.gamepad.devices.add(t)),this.ensurePollingState()}},{key:"ensurePollingState",value:function(){this.eventsEnabled?this.startPolling():this.stopPolling()}},{key:"startPolling",value:function(){var e=this;null==this.frameTask&&(this.frameTask=(0,ne.A)({update:function(){return e.readGamepadState()}}))}},{key:"stopPolling",value:function(){null!=this.frameTask&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=new Array)}},{key:"readGamepadState",value:function(){var e=this,t=document.hasFocus(),n=this.element.contains(document.activeElement),r="document"===this.input.gamepad.enabledFocusMode&&!t||"view"===this.input.gamepad.enabledFocusMode&&!n;this.forEachGamepad((function(t){var n=e.inputDevices[t.index];if(n){var i=e.latestUpdate[t.index],o=Wf(n),a=r||function(e){for(var t=0;t<e.axes.length;t++)if(0!==e.axes[t])return!1;for(var n=0;n<e.buttons.length;n++)if(0!==e.buttons[n])return!1;return!0}(o);if(i){if(i.timestamp===t.timestamp)return;if(!i.active&&a)return;if(function(e,t){if(e.axes.length!==t.axes.length)return!1;if(e.buttons.length!==t.buttons.length)return!1;for(var n=0;n<e.axes.length;n++)if(e.axes[n]!==t.axes[n])return!1;for(var r=0;r<e.buttons.length;r++)if(e.buttons[r]!==t.buttons[r])return!1;return!0}(i.state,o))return}e.emitGamepadEvent(t,o,!a)}}))}},{key:"forEachGamepad",value:function(e){for(var t=window.navigator.getGamepads(),n=0;n<t.length;n++){var r=t[n];this.validate(r)&&e(r)}}},{key:"emitGamepadEvent",value:function(e,t,n){var r=this.latestUpdate[e.index],i=r&&r.active;if(i||n){var o=!i&&n?"start":i&&n?"update":"end";this.latestUpdate[e.index]={timestamp:e.timestamp,state:t,active:n},this.callback&&this.callback({device:this.inputDevices[e.index],state:t,action:o})}}},{key:"validate",value:function(e){if(!e)return!1;if(!e.connected)return!1;for(var t=0;t<e.axes.length;t++)if(isNaN(e.axes[t]))return!1;return!0}}]),e}(),Gf=(0,L.Z)("trident"),Hf=(0,L.Z)("edge"),Kf=(0,L.Z)("chrome"),Yf=(0,L.Z)("ff"),Jf=(0,L.Z)("safari"),$f="esri-view-surface--touch-none",Qf="esri-view-surface--touch-pan",Xf=function(){function e(t,n){var r=this;(0,k.Z)(this,e),this.input=n,this._active={},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=t,t.getAttribute("tabindex")||t.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new qf(t,this.input),this._gamepadSource.onEvent=function(e){return r._callback("gamepad",e)}}return(0,C.Z)(e,[{key:"destroy",value:function(){var e=this;this._callback=null,this.activeEvents=null,this._activePointerCaptures.forEach((function(t){e._releasePointerCaptureSafe(t)})),this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}},{key:"browserTouchPanningEnabled",get:function(){return this._browserTouchPanningEnabled},set:function(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}},{key:"onEventReceived",set:function(e){this._callback=e}},{key:"activeEvents",set:function(e){var t=this;for(var n in this._active)if(!e||!e.has(n)){var r=this._active[n];this._element.removeEventListener(ed[n],r),delete this._active[n]}e&&e.forEach((function(e){if(!t._active[e]&&ed[e]){var n=(t._eventHandlers[e]||t._handleDefault).bind(t,e);t._element.addEventListener(ed[e],n),t._active[e]=n}})),this._gamepadSource.hasEventListeners=e&&e.has("gamepad")}},{key:"setPointerCapture",value:function(e,t){t?(this._element.setPointerCapture(e.pointerId),this._activePointerCaptures.add(e.pointerId)):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}},{key:"_updateTouchAction",value:function(){this._element.classList.remove(this._browserTouchPanningEnabled?$f:Qf),this._element.classList.add(this._browserTouchPanningEnabled?Qf:$f)}},{key:"_updateTouchEventHandling",value:function(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}},{key:"_removeTouchAction",value:function(){this._element.classList.remove($f),this._element.classList.remove(Qf),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}},{key:"_releasePointerCaptureSafe",value:function(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch(t){}}},{key:"_updateNormalizedPointerLikeEvent",value:function(t,n){var r=Yl(this._element,t);return e.test.disableSubpixelCoordinates&&(r.x=Math.round(r.x),r.y=Math.round(r.y)),n.x=r.x,n.y=r.y,n}},{key:"_handleKey",value:function(e,t){var n=(0,Uf.kK)(t);n&&"key-up"===e&&this._keyDownState.delete(n);var r={native:t,key:n,repeat:n&&this._keyDownState.has(n)};n&&"key-down"===e&&this._keyDownState.add(r.key),this._callback(e,r)}},{key:"_handlePointer",value:function(e,t){var n=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,pointerType:t.pointerType,button:t.button,buttons:t.buttons,eventId:this._eventId++});this._callback(e,n)}},{key:"_handlePointerPreventDefault",value:function(e,t){var n=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,pointerType:t.pointerType,button:t.button,buttons:t.buttons,eventId:this._eventId++});t.preventDefault(),this._callback(e,n)}},{key:"_handleMouseWheel",value:function(e,t){var n=t.deltaY;switch(t.deltaMode){case 0:(Gf||Hf)&&(n=n/document.documentElement.clientHeight*600);break;case 1:n*=30;break;case 2:n*=900}Gf||Hf?n*=.7:Kf||Jf?n*=.6:Yf&&(n*=1.375);var r=Math.abs(n);if(r>100){n=n/r*200/(1+Math.exp(-.02*(r-100)))}var i=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,deltaY:n});this._callback(e,i)}},{key:"_handlePointerCaptureLost",value:function(e,t){this._activePointerCaptures.delete(t.pointerId),this._handleDefault(e,t)}},{key:"_handleDefault",value:function(e,t){var n={native:t};t.preventDefault(),this._callback(e,n)}},{key:"_preventAltKeyDefault",value:function(e){"Alt"===e.key&&e.preventDefault()}},{key:"_preventMultiTouchPanning",value:function(e){e.touches.length>1&&e.preventDefault()}}]),e}();Xf.test={disableSubpixelCoordinates:!1};var ed={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};function td(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var nd=function(e){(0,M.Z)(n,e);var t=td(n);function n(){var e;return(0,k.Z)(this,n),(e=t.call(this,!0)).registerIncoming("context-menu",(function(e){e.data.native.preventDefault()})),e}return(0,C.Z)(n)}(Dl.a),rd=n(40127);function id(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}function od(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var ad=250,sd=10,ud=350,ld=35,cd=function(e){(0,M.Z)(n,e);var t=od(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ad,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:sd,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ud,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ld,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:rd.Z;return(0,k.Z)(this,n),(e=t.call(this,!1)).maximumDoubleClickDelay=r,e.maximumDoubleClickDistance=i,e.maximumDoubleTouchDelay=o,e.maximumDoubleTouchDistance=a,e._clock=s,e._pointerState=new Map,e._click=e.registerOutgoing("click"),e._doubleClick=e.registerOutgoing("double-click"),e.registerIncoming("immediate-click",e._handleImmediateClick.bind((0,x.Z)(e))),e.registerIncoming("pointer-drag",e._handlePointerDrag.bind((0,x.Z)(e))),e.registerIncoming("drag",e._handleDrag.bind((0,x.Z)(e))),e}return(0,C.Z)(n,[{key:"onUninstall",value:function(){this._pointerState.forEach((function(e){null!=e.doubleClickTimeout&&(e.doubleClickTimeout.remove(),e.doubleClickTimeout=null)}))}},{key:"hasPendingInputs",get:function(){return(0,Zl.oE)(this._pointerState,(function(e){return null!=e.doubleClickTimeout}))}},{key:"_pointerId",value:function(e){var t=e.native;return"mouse"===t.pointerType?"".concat(t.pointerId,":").concat(t.button):"".concat(t.pointerType)}},{key:"_handleImmediateClick",value:function(e){var t=e.data,n=this._pointerId(t),r=this._pointerState.get(n);if(r){var i="touch"===t.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;id(r.event.data,t)>i?(this._clearDoubleClickTimeout(n,!0),this._startClick(e)):(this._clearDoubleClickTimeout(n,!1),this._doubleClick.emit(r.event.data,void 0,r.event.modifiers))}else this._startClick(e)}},{key:"_startClick",value:function(e){var t=this,n=this._pointerId(e.data),r="touch"===e.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;this._pointerState.set(n,{event:e,doubleClickTimeout:this._clock.setTimeout((function(){return t._doubleClickTimeoutExceeded(n)}),r)}),this.refreshHasPendingInputs()}},{key:"_handlePointerDrag",value:function(e){var t=this._pointerId(e.data.currentEvent);this._clearDoubleClickTimeout(t,!0)}},{key:"_handleDrag",value:function(e){var t=this._pointerId(e.data.pointer);this._clearDoubleClickTimeout(t,!0)}},{key:"_clearDoubleClickTimeout",value:function(e,t){var n=this._pointerState.get(e);n&&(n.doubleClickTimeout.remove(),n.doubleClickTimeout=null,t&&this._doubleClickTimeoutExceeded(e),this._pointerState.delete(e),this.refreshHasPendingInputs())}},{key:"_doubleClickTimeoutExceeded",value:function(e){var t=this._pointerState.get(e);this._click.emit(t.event.data,void 0,t.event.modifiers),t.doubleClickTimeout=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}}]),n}(Dl.a);function pd(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var fd=function(e){(0,M.Z)(n,e);var t=pd(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ad,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:sd,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ud,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ld,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:rd.Z;return(0,k.Z)(this,n),(e=t.call(this,!1)).maximumDoubleClickDelay=r,e.maximumDoubleClickDistance=i,e.maximumDoubleTouchDelay=o,e.maximumDoubleTouchDistance=a,e._clock=s,e._doubleTapDragReady=!1,e._doubleTapDragActive=!1,e._dragStartCenter=(0,ku.vW)(0,0),e._pointerState=new Map,e._doubleTapDrag=e.registerOutgoing("double-tap-drag"),e._dragEventSeparator=new wf({start:function(t,n){return e._dragStart(t,n)},update:function(t,n){return e._dragUpdate(n)},end:function(t,n){return e._dragEnd(n)}}),e.registerIncoming("drag",(function(t){return e._dragEventSeparator.handle(t)})),e.registerIncoming("pointer-down",(function(t){return e._handlePointerDown(t)})),e.registerIncoming("pointer-up",(function(){return e._handlePointerUp()})),e}return(0,C.Z)(n,[{key:"onUninstall",value:function(){this._pointerState.forEach((function(e){null!=e.doubleTapTimeout&&(e.doubleTapTimeout.remove(),e.doubleTapTimeout=null)}))}},{key:"hasPendingInputs",get:function(){return(0,Zl.oE)(this._pointerState,(function(e){return null!=e.doubleTapTimeout}))}},{key:"_clearPointerDown",value:function(e){var t=this._pointerState.get(e);t&&(t.doubleTapTimeout.remove(),t.doubleTapTimeout=null,this._pointerState.delete(e),this.refreshHasPendingInputs())}},{key:"_createDoubleTapDragData",value:function(e,t,n){return{action:e,delta:t,button:n.button,buttons:n.buttons,pointer:n.pointer,pointers:n.pointers,pointerType:n.pointerType,timestamp:n.timestamp}}},{key:"_dragStart",value:function(e,t){if(this._doubleTapDragReady&&1===e){this._doubleTapDragReady=!1,this._doubleTapDragActive=!0;var n=t.data,r=t.modifiers,i=n.center;this._dragStartCenter=i;var o=this._createDoubleTapDragData("begin",(0,ku.vW)(0,0),n);this._doubleTapDrag.emit(o,void 0,r),t.stopPropagation()}}},{key:"_dragUpdate",value:function(e){if(this._doubleTapDragActive){var t=e.data,n=e.modifiers,r=t.center,i=(0,ku.vW)(r.x-this._dragStartCenter.x,r.y-this._dragStartCenter.y),o=this._createDoubleTapDragData("update",i,t);this._doubleTapDrag.emit(o,void 0,n),e.stopPropagation()}}},{key:"_dragEnd",value:function(e){if(this._doubleTapDragActive){var t=e.data,n=e.modifiers,r=t.center,i=(0,ku.vW)(r.x-this._dragStartCenter.x,r.y-this._dragStartCenter.y),o=this._createDoubleTapDragData("end",i,t);this._doubleTapDrag.emit(o,void 0,n),this._doubleTapDragActive=!1,e.stopPropagation()}}},{key:"_handlePointerDown",value:function(e){var t=e.data,n=this._pointerId(t),r=this._pointerState.get(n),i=t.native.pointerType;if(r){var o="touch"===i?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;this._clearPointerDown(n),id(r.event.data,t)>o?this._storePointerDown(e):this._doubleTapDragReady=!0}else this._storePointerDown(e)}},{key:"_handlePointerUp",value:function(){this._doubleTapDragReady=!1}},{key:"_pointerId",value:function(e){var t=e.native,n=t.pointerId,r=t.button,i=t.pointerType;return"mouse"===i?"".concat(n,":").concat(r):"".concat(i)}},{key:"_storePointerDown",value:function(e){var t=this,n=e.data,r=n.native.pointerType,i=this._pointerId(n),o="touch"===r?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay,a=this._clock.setTimeout((function(){return t._clearPointerDown(i)}),o);this._pointerState.set(i,{event:e,doubleTapTimeout:a}),this.refreshHasPendingInputs()}}]),n}(Dl.a),dd=n(55500);function hd(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var vd,yd=function(e){(0,M.Z)(n,e);var t=hd(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,!1)).navigationTouch=e,r.startStateModifiers=new Set,r.activePointerMap=new Map,r.isDragging=!1,r.isCurrentDragSuppressed=!1,r.drag=r.registerOutgoing("drag"),r.registerIncoming("pointer-drag",r.handlePointerDrag.bind((0,x.Z)(r))),r.registerIncoming("pointer-up",r.handlePointerUpAndPointerLost.bind((0,x.Z)(r))),r.registerIncoming("pointer-capture-lost",r.handlePointerUpAndPointerLost.bind((0,x.Z)(r))),r.registerIncoming("pointer-cancel",r.handlePointerUpAndPointerLost.bind((0,x.Z)(r))),r}return(0,C.Z)(n,[{key:"createPayload",value:function(e,t,n,r){return{action:e,pointerType:this.pointerType,button:this.mouseButton,buttons:t.buttons,timestamp:r,pointers:bd(this.activePointerMap),pointer:t,angle:n.angle,radius:n.radius,center:n.center}}},{key:"addPointer",value:function(e){var t=e.native.pointerId,n=gd(this.activePointerMap).angle,r={event:e,initialAngle:0,lastAngle:0};this.activePointerMap.set(t,r);var i=_d(r,md(this.activePointerMap));r.initialAngle=i,r.lastAngle=i,this.updatePointerAngles(n)}},{key:"updatePointer",value:function(e){if(!e||null!=e.x||null!=e.y){var t=e.native.pointerId,n=this.activePointerMap.get(t);n?n.event=e:this.addPointer(e)}}},{key:"removePointer",value:function(e){var t=gd(this.activePointerMap).angle;this.activePointerMap.delete(e),this.updatePointerAngles(t)}},{key:"updatePointerAngles",value:function(e){var t=gd(this.activePointerMap);this.activePointerMap.forEach((function(n){n.initialAngle=_d(n,t)-e,n.lastAngle=_d(n,t)-e}))}},{key:"emitEvent",value:function(e,t,n){var r=gd(this.activePointerMap);this.drag.emit(this.createPayload(e,t,r,n),void 0,this.startStateModifiers)}},{key:"handlePointerUpAndPointerLost",value:function(e){var t=e.data.native.pointerId,n=(0,dd.HA)(e.timestamp);this.activePointerMap.get(t)&&(1===this.activePointerMap.size?(this.updatePointer(e.data),!this.isCurrentDragSuppressed&&this.emitEvent("end",e.data,n),this.isDragging=!1,this.isCurrentDragSuppressed=!1,this.removePointer(t)):(this.removePointer(t),this.emitEvent("removed",e.data,(0,dd.HA)(e.timestamp))))}},{key:"handlePointerDrag",value:function(e){var t=e.data,n=t.currentEvent,r=(0,dd.HA)(e.timestamp);switch(t.action){case"start":case"update":this.isDragging?this.activePointerMap.has(n.native.pointerId)?(this.updatePointer(n),!this.isCurrentDragSuppressed&&this.emitEvent("update",n,r)):(this.addPointer(n),this.emitEvent("added",n,r),this.isCurrentDragSuppressed=this.isSuppressed):(this.updatePointer(n),this.pointerType=e.data.startEvent.pointerType,this.mouseButton=e.data.startEvent.button,this.startStateModifiers=e.modifiers,this.isDragging=!0,this.isCurrentDragSuppressed=this.isSuppressed,!this.isCurrentDragSuppressed&&this.emitEvent("start",n,r))}}},{key:"isSuppressed",get:function(){return this.navigationTouch&&!this.navigationTouch.browserTouchPanEnabled&&"touch"===this.pointerType&&1===this.activePointerMap.size}}]),n}(Dl.a);function md(e){var t=[];return e.forEach((function(e){t.push((0,ku.vW)(e.event.x,e.event.y))})),function(e,t){if(t?(t.radius=0,t.center.x=0,t.center.y=0):t={radius:0,center:(0,ku.vW)()},0===e.length)return t;if(1===e.length)return t.center.x=e[0].x,t.center.y=e[0].y,t;if(2===e.length){var n=(0,w.Z)(e,2),r=n[0],i=n[1],o=i.x-r.x,a=i.y-r.y;return t.radius=Math.sqrt(o*o+a*a)/2,t.center.x=(r.x+i.x)/2,t.center.y=(r.y+i.y)/2,t}for(var s=0,u=0,l=0;l<e.length;l++)s+=e[l].x,u+=e[l].y;s/=e.length,u/=e.length;for(var c=e.map((function(e){return e.x-s})),p=e.map((function(e){return e.y-u})),f=0,d=0,h=0,v=0,y=0,m=0,g=0,b=0;b<c.length;b++){var _=c[b],k=p[b],C=_*_,x=k*k;f+=C,d+=x,h+=_*k,v+=C*_,y+=x*k,m+=_*x,g+=k*C}var Z=.5*(v+m),M=.5*(y+g),I=f*d-h*h,R=(Z*d-M*h)/I,O=(f*M-h*Z)/I,P=(0,ku.vW)(R+s,O+u);return{radius:Math.sqrt(R*R+O*O+(f+d)/e.length),center:P}}(t)}function gd(e){var t=md(e),n=0;return e.forEach((function(e){for(var r=_d(e,t),i=r-e.lastAngle;i>Math.PI;)i-=2*Math.PI;for(;i<-Math.PI;)i+=2*Math.PI;r=e.lastAngle+i,e.lastAngle=r;var o=r-e.initialAngle;n+=o})),{angle:n/=e.size||1,radius:t.radius,center:t.center}}function bd(e){var t=new Map;return e.forEach((function(e,n){return t.set(n,e.event)})),t}function _d(e,t){var n=e.event,r=n.x-t.center.x,i=n.y-t.center.y;return Math.atan2(i,r)}function wd(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}!function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right",e[e.Back=3]="Back",e[e.Forward=4]="Forward",e[e.Undefined=-1]="Undefined"}(vd||(vd={}));var kd=function(e){(0,M.Z)(n,e);var t=wd(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ad,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:sd,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ud,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ld,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:rd.Z;return(0,k.Z)(this,n),(e=t.call(this,!1)).maximumDoubleClickDelay=r,e.maximumDoubleClickDistance=i,e.maximumDoubleTouchDelay=o,e.maximumDoubleTouchDistance=a,e._clock=s,e._pointerState=new Map,e._immediateDoubleClick=e.registerOutgoing("immediate-double-click"),e.registerIncoming("pointer-down",e._handlePointerDown.bind((0,x.Z)(e))),e.registerIncoming("pointer-up",(function(t){e._handlePointerLoss(t,"pointer-up")})),e.registerIncoming("pointer-capture-lost",(function(t){e._handlePointerLoss(t,"pointer-capture-lost")})),e.registerIncoming("pointer-cancel",(function(t){e._handlePointerLoss(t,"pointer-cancel")})),e}return(0,C.Z)(n,[{key:"onUninstall",value:function(){this._pointerState.forEach((function(e){e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()})),(0,Z.Z)((0,R.Z)(n.prototype),"onUninstall",this).call(this)}},{key:"_handlePointerDown",value:function(e){var t=e.data,n=this._pointerId(t);if(!this._pointerState.has(n)){var r={downButton:t.native.button,immediateDoubleClick:null};this._pointerState.set(n,r),this.startCapturingPointer(t.native)}}},{key:"_handlePointerLoss",value:function(e,t){var n=e.data,r=this._pointerId(n),i=this._pointerState.get(r);if(i&&"pointer-up"===t&&i.downButton===n.native.button){var o=i.immediateDoubleClick;if(o){o.timeoutHandle.remove();var a="touch"===e.data.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;id(o,e.data)>a?this._startImmediateDoubleClick(e,i):(this._immediateDoubleClick.emit(e.data,void 0,o.modifiers),this._removeState(n))}else this._startImmediateDoubleClick(e,i)}}},{key:"_startImmediateDoubleClick",value:function(e,t){var n=this,r="touch"===e.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;t.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout((function(){return n._removeState(e.data)}),r)}}},{key:"_pointerId",value:function(e){var t=e.native;return"mouse"===t.pointerType?"".concat(t.pointerId,":").concat(t.button):"".concat(t.pointerType)}},{key:"_removeState",value:function(e){var t=this._pointerId(e);this._pointerState.delete(t),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}}]),n}(Dl.a);function Cd(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var xd=300,Zd=1.5,Md=6,Id=6,Rd=500,Od=function(e){(0,M.Z)(n,e);var t=Cd(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:xd,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Zd,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Md,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Id,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Rd,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:rd.Z;return(0,k.Z)(this,n),(e=t.call(this,!1)).maximumClickDelay=r,e.movementUntilMouseDrag=i,e.movementUntilPenDrag=o,e.movementUntilTouchDrag=a,e.holdDelay=s,e._clock=u,e._pointerState=new Map,e._pointerDrag=e.registerOutgoing("pointer-drag"),e._immediateClick=e.registerOutgoing("immediate-click"),e._pointerHold=e.registerOutgoing("hold"),e.registerIncoming("pointer-down",e._handlePointerDown.bind((0,x.Z)(e))),e.registerIncoming("pointer-up",(function(t){e._handlePointerLoss(t,"pointer-up")})),e.registerIncoming("pointer-capture-lost",(function(t){e._handlePointerLoss(t,"pointer-capture-lost")})),e.registerIncoming("pointer-cancel",(function(t){e._handlePointerLoss(t,"pointer-cancel")})),e._moveHandle=e.registerIncoming("pointer-move",e._handlePointerMove.bind((0,x.Z)(e))),e._moveHandle.pause(),e}return(0,C.Z)(n,[{key:"onUninstall",value:function(){this._pointerState.forEach((function(e){null!=e.holdTimeout&&(e.holdTimeout.remove(),e.holdTimeout=null)})),(0,Z.Z)((0,R.Z)(n.prototype),"onUninstall",this).call(this)}},{key:"_handlePointerDown",value:function(e){var t=this,n=e.data,r=n.native.pointerId,i=null;0===this._pointerState.size&&(i=this._clock.setTimeout((function(){var n=t._pointerState.get(r);if(n){if(!n.isDragging){var i=n.previousEvent;t._pointerHold.emit(i,void 0,e.modifiers),n.holdEmitted=!0}n.holdTimeout=null}}),this.holdDelay));var o={startEvent:n,previousEvent:n,startTimestamp:e.timestamp,isDragging:!1,downButton:n.native.button,holdTimeout:i,modifiers:new Set};this._pointerState.set(r,o),this.startCapturingPointer(n.native),this._moveHandle.resume(),this._pointerState.size>1&&this.startDragging(e)}},{key:"_createPointerDragData",value:function(e,t,n){return{action:e,startEvent:t.startEvent,previousEvent:t.previousEvent,currentEvent:n}}},{key:"_handlePointerMove",value:function(e){var t=e.data,n=t.native.pointerId,r=this._pointerState.get(n);r&&(r.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",r,t),void 0,r.modifiers):function(e,t){var n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)}(t,r.startEvent)>this._getDragThreshold(t.native.pointerType)&&this.startDragging(e),r.previousEvent=t)}},{key:"_getDragThreshold",value:function(e){switch(e){case"touch":return this.movementUntilTouchDrag;case"pen":return this.movementUntilPenDrag;default:return this.movementUntilMouseDrag}}},{key:"startDragging",value:function(e){var t=this,n=e.data,r=n.native.pointerId;this._pointerState.forEach((function(i){null!=i.holdTimeout&&(i.holdTimeout.remove(),i.holdTimeout=null),i.isDragging||(i.modifiers=e.modifiers,i.isDragging=!0,r===i.startEvent.native.pointerId?t._pointerDrag.emit(t._createPointerDragData("start",i,n)):t._pointerDrag.emit(t._createPointerDragData("start",i,i.previousEvent),e.timestamp))}))}},{key:"_handlePointerLoss",value:function(e,t){var n=e.data,r=n.native.pointerId,i=this._pointerState.get(r);i&&(null!=i.holdTimeout&&(i.holdTimeout.remove(),i.holdTimeout=null),i.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",i,"pointer-up"===t?n:i.previousEvent),void 0,i.modifiers):"pointer-up"===t&&i.downButton===n.native.button&&e.timestamp-i.startTimestamp<=this.maximumClickDelay&&!i.holdEmitted&&this._immediateClick.emit(n),this._pointerState.delete(r),this.stopCapturingPointer(n.native),0===this._pointerState.size&&this._moveHandle.pause())}}]),n}(Dl.a);function Pd(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Td="Ctrl",Sd={left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown"},Ed={zoomIn:["=","+"],zoomOut:["-","_"]},Ad={clockwiseOption1:"a",clockwiseOption2:"A",counterClockwiseOption1:"d",counterClockwiseOption2:"D",resetOption1:"n",resetOption2:"N"},jd=function(e){(0,M.Z)(n,e);var t=Pd(n);function n(){var e;return(0,k.Z)(this,n),(e=t.apply(this,arguments))._handles=new Y.Z,e}return(0,C.Z)(n,[{key:"initialize",value:function(){var e=this;this._handles.add([(0,N.PA)(this.view,"ready",(function(){return e._disconnect()})),(0,N.gx)(this.view,"ready",(function(){return e._connect()}))])}},{key:"destroy",value:function(){this._handles&&(this._handles.removeAll(),this._handles=null),this._disconnect()}},{key:"_disconnect",value:function(){this._inputManager&&(this.view.viewEvents.disconnect(),this._inputManager.destroy(),this._inputManager=null,this._source.destroy(),this._source=null)}},{key:"_connect",value:function(){var e=this,t=this.view.surface,n=new Xf(t,this.view.input),r=[new kd,new Od,new cd,new yd(this.view.navigation),new fd],i=new ta.$({eventSource:n,recognizers:r});i.installHandlers("prevent-context-menu",[new nd],ta.f.INTERNAL),i.installHandlers("navigation",[new zf(this.view),new Of(this.view),new Bf(this.view),new gf(this.view),new gf(this.view,[Td]),new Cf(this.view,"primary"),new Af(this.view,Sd),new Df(this.view,Ed),new Ff(this.view,Ad),new Zf(this.view,"secondary"),new _f(this.view,"touch")],ta.f.INTERNAL),this.view.viewEvents.connect(i),this._source=n,this._inputManager=i,(0,N.S1)(this.view.navigation,"browserTouchPanEnabled",(function(t){e._source.browserTouchPanningEnabled=!t}))}},{key:"test",get:function(){return{inputManager:this._inputManager}}}]),n}(re.Z);(0,S._)([(0,U.Cb)()],jd.prototype,"view",void 0);var Fd=jd=(0,S._)([(0,G.j)("esri.views.2d.input.MapViewInputManager")],jd);function Ld(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Dd=0,Vd=function(e){(0,M.Z)(n,e);var t=Ld(n);function n(){var e;return(0,k.Z)(this,n),(e=t.apply(this,arguments)).color=new Ou.Z([0,255,255]),e.haloOpacity=1,e.fillOpacity=.25,e}return(0,C.Z)(n,[{key:"version",get:function(){return Dd++}}]),n}(re.Z);(0,S._)([(0,U.Cb)({readOnly:!0})],Vd.prototype,"version",null),(0,S._)([(0,U.Cb)({type:Ou.Z})],Vd.prototype,"color",void 0),(0,S._)([(0,U.Cb)({type:Ou.Z})],Vd.prototype,"haloColor",void 0),(0,S._)([(0,U.Cb)()],Vd.prototype,"haloOpacity",void 0),(0,S._)([(0,U.Cb)()],Vd.prototype,"fillOpacity",void 0);var Bd=Vd=(0,S._)([(0,G.j)("esri.views.2d.support.HighlightOptions")],Vd);var Nd=n(11849),zd=n(76665);function Ud(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Wd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ud(Object(n),!0).forEach((function(t){(0,H.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ud(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var qd={checkMajorWebPerformanceCaveat:!0};function Gd(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Hd="esri-component",Kd=function(e){(0,M.Z)(n,e);var t=Gd(n);function n(){var e;return(0,k.Z)(this,n),(e=t.apply(this,arguments)).widget=null,e}return(0,C.Z)(n,[{key:"destroy",value:function(){this.widget&&this.widget.destroy(),this.node=null}},{key:"id",get:function(){return this.get("widget.id")||this.get("node.id")}},{key:"node",set:function(e){var t=this._get("node");e!==t&&(e&&e.classList.add(Hd),t&&t.classList.remove(Hd),this._set("node",e))}},{key:"castNode",value:function(e){return e?"string"==typeof e||function(e){return e&&"nodeType"in e}(e)?(this._set("widget",null),(0,te.L7)(e)):(function(e){return e&&"function"==typeof e.render}(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}}]),n}(re.Z);(0,S._)([(0,U.Cb)({dependsOn:[]})],Kd.prototype,"id",null),(0,S._)([(0,U.Cb)()],Kd.prototype,"node",null),(0,S._)([(0,he.p)("node")],Kd.prototype,"castNode",null),(0,S._)([(0,U.Cb)({readOnly:!0})],Kd.prototype,"widget",void 0);var Yd=Kd=(0,S._)([(0,G.j)("esri.views.ui.Component")],Kd);function Jd(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function $d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Jd(Object(n),!0).forEach((function(t){(0,H.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Jd(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Qd(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Xd(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Xd(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Xd(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function eh(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var th={left:0,top:0,bottom:0,right:0},nh={bottom:30,top:15,right:15,left:15},rh="manual",ih="esri-ui",oh="esri-ui-corner",ah="esri-ui-inner-container",sh="esri-ui-manual-container",uh="esri-ui-corner-container",lh="esri-ui-top-left",ch="esri-ui-top-right",ph="esri-ui-bottom-left",fh="esri-ui-bottom-right";function dh(e){var t=e,n="object"==typeof t&&null!==t&&Object.getPrototypeOf(t);return null!==n&&n!==Object.prototype||!("component"in t||"index"in t||"position"in t)?null:e}function hh(e,t){var n=t.top,r=t.bottom,i=t.left,o=t.right;e.style.top=n,e.style.bottom=r,e.style.left=i,e.style.right=o}var vh=function(e){(0,M.Z)(n,e);var t=eh(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e))._cornerNameToContainerLookup={},r._positionNameToContainerLookup={},r._components=new Array,r._componentToKey=new Map,r._handles=new Y.Z,r.view=null,r._initContainers(),r}return(0,C.Z)(n,[{key:"initialize",value:function(){this._handles.add([(0,N.S1)(this,"view.padding, container",this._applyViewPadding.bind(this)),(0,N.S1)(this,"padding",this._applyUIPadding.bind(this))])}},{key:"destroy",value:function(){this.container=null;var e,t=Qd(this._components);try{for(t.s();!(e=t.n()).done;){e.value.destroy()}}catch(n){t.e(n)}finally{t.f()}this._components.length=0,this._handles.destroy(),this._componentToKey.clear()}},{key:"container",set:function(e){var t=this._get("container");e!==t&&(e&&(e.classList.add(ih),e.classList.add((0,It.rk)()),this._attachContainers(e)),t&&(t.classList.remove(ih),hh(t,{top:"",bottom:"",left:"",right:""}),(0,te.cS)(t)),this._set("container",e))}},{key:"height",get:function(){var e=this.get("view.height")||0;if(0===e)return e;var t=this._getViewPadding(),n=t.top+t.bottom;return Math.max(e-n,0)}},{key:"padding",get:function(){return this._get("padding")},set:function(e){e?this._override("padding",e):this._clearOverride("padding")}},{key:"castPadding",value:function(e){return"number"==typeof e?{bottom:e,top:e,right:e,left:e}:$d($d({},nh),e)}},{key:"width",get:function(){var e=this.get("view.width")||0;if(0===e)return e;var t=this._getViewPadding(),n=t.left+t.right;return Math.max(e-n,0)}},{key:"add",value:function(e,t){var n,r,i,o,a=this;if(Array.isArray(e))e.forEach((function(e){return a.add(e,t)}));else{var s=dh(e);s&&(i=(n=s).index,t=n.position,e=n.component,o=n.key),t&&"object"==typeof t&&(i=(r=t).index,o=r.key,t=r.position),!e||t&&!this._isValidPosition(t)||this._add(e,t,i,o)}}},{key:"remove",value:function(e,t){var n=this;if(e){if(Array.isArray(e))return e.map((function(e){return n.remove(e,t)}));var r=this._find(e);if(r){var i=this._componentToKey;if(i.has(e)&&i.get(e)!==t)return;var o=this._components.indexOf(r);return r.node.parentNode&&r.node.parentNode.removeChild(r.node),this._componentToKey.delete(e),this._components.splice(o,1)[0]}}}},{key:"empty",value:function(e){var t=this;return Array.isArray(e)?e.map((function(e){return t.empty(e)})).reduce((function(e,t){return e.concat(t)})):(e=e||rh)===rh?Array.prototype.slice.call(this._manualContainer.children).filter((function(e){return!e.classList.contains(oh)})).map((function(e){return t.remove(e)})):this._isValidPosition(e)?Array.prototype.slice.call(this._cornerNameToContainerLookup[e].children).map(this.remove,this):null}},{key:"move",value:function(e,t){var n=this;if(Array.isArray(e)&&e.forEach((function(e){return n.move(e,t)})),e){var r,i=dh(e)||dh(t);if(i&&(r=i.index,t=i.position,e=i.component||e),!t||this._isValidPosition(t)){var o=this.remove(e);o&&this.add(o,{position:t,index:r})}}}},{key:"find",value:function(e){if(!e)return null;var t=this._findById(e);return t&&(t.widget||t.node)}},{key:"getPosition",value:function(e){for(var t in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[t].contains(e))return t;return null}},{key:"_add",value:function(e,t,n,r){e instanceof Yd||(e=new Yd({node:e})),this._place({component:e,position:t,index:n}),this._components.push(e),r&&this._componentToKey.set(e,r)}},{key:"_find",value:function(e){return e?e instanceof Yd?this._findByComponent(e):"string"==typeof e?this._findById(e):this._findByNode(e.domNode||e):null}},{key:"_getViewPadding",value:function(){return this.get("view.padding")||th}},{key:"_attachContainers",value:function(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}},{key:"_initContainers",value:function(){var e=document.createElement("div");e.classList.add(ah),e.classList.add(uh);var t=document.createElement("div");t.classList.add(ah),t.classList.add(sh);var n=document.createElement("div");n.classList.add(lh),n.classList.add(oh),e.appendChild(n);var r=document.createElement("div");r.classList.add(ch),r.classList.add(oh),e.appendChild(r);var i=document.createElement("div");i.classList.add(ph),i.classList.add(oh),e.appendChild(i);var o=document.createElement("div");o.classList.add(fh),o.classList.add(oh),e.appendChild(o),this._innerContainer=e,this._manualContainer=t;var a=(0,It.dZ)();this._cornerNameToContainerLookup={"top-left":n,"top-right":r,"bottom-left":i,"bottom-right":o,"top-leading":a?r:n,"top-trailing":a?n:r,"bottom-leading":a?o:i,"bottom-trailing":a?i:o},this._positionNameToContainerLookup=$d({manual:t},this._cornerNameToContainerLookup)}},{key:"_isValidPosition",value:function(e){return!!this._positionNameToContainerLookup[e]}},{key:"_place",value:function(e){var t=e.component,n=e.position||rh,r=e.index,i=this._positionNameToContainerLookup[n],o=r>-1;if(function(e){return e&&!e._started&&"function"==typeof e.postMixInProperties&&"function"==typeof e.buildRendering&&"function"==typeof e.postCreate&&"function"==typeof e.startup}(t.widget)&&t.widget.startup(),o){var a=Array.prototype.slice.call(i.children);0!==r?r>=a.length?i.appendChild(t.node):(0,te.Vt)(t.node,a[r]):i.firstChild?(0,te.Vt)(t.node,i.firstChild):i.appendChild(t.node)}else i.appendChild(t.node)}},{key:"_applyViewPadding",value:function(){var e=this.container;e&&hh(e,this._toPxPosition(this._getViewPadding()))}},{key:"_applyUIPadding",value:function(){var e=this._innerContainer;e&&hh(e,this._toPxPosition(this.padding))}},{key:"_toPxPosition",value:function(e){return{top:this._toPxUnit(e.top),left:this._toPxUnit(e.left),right:this._toPxUnit(e.right),bottom:this._toPxUnit(e.bottom)}}},{key:"_toPxUnit",value:function(e){return 0===e?"0":e+"px"}},{key:"_findByComponent",value:function(e){var t,n=null;return this._components.some((function(r){return(t=r===e)&&(n=r),t})),n}},{key:"_findById",value:function(e){var t,n=null;return this._components.some((function(r){return(t=r.id===e)&&(n=r),t})),n}},{key:"_findByNode",value:function(e){var t,n=null;return this._components.some((function(r){return(t=r.node===e)&&(n=r),t})),n}}]),n}(Oo.Z.EventedAccessor);(0,S._)([(0,U.Cb)()],vh.prototype,"container",null),(0,S._)([(0,U.Cb)()],vh.prototype,"height",null),(0,S._)([(0,U.Cb)({value:nh})],vh.prototype,"padding",null),(0,S._)([(0,he.p)("padding")],vh.prototype,"castPadding",null),(0,S._)([(0,U.Cb)()],vh.prototype,"view",void 0),(0,S._)([(0,U.Cb)()],vh.prototype,"width",null);var yh=vh=(0,S._)([(0,G.j)("esri.views.ui.UI")],vh),mh=n(23454);function gh(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return bh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return bh(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function bh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}function wh(e,t){return e&&"copyright"in e&&(!t||"function"==typeof e.originOf&&"user"===e.originOf("copyright"))}function kh(e,t,n){n&&t&&(e.find((function(e){return e.layerView===t&&e.text===n}))||e.push({text:n,layerView:t}))}function Ch(e){return"bing-maps"===e.type}var xh=[],Zh=function(e){(0,M.Z)(r,e);var t,n=_h(r);function r(e){var t;return(0,k.Z)(this,r),(t=n.call(this,e)).clear=function(){t._fetchedAttributionData.clear(),t._pendingAttributions.clear(),t.handles.remove("suspension"),t.notifyChange("state")},t._pendingAttributions=new Set,t._fetchedAttributionData=new Map,t.items=new A.Z,t.view=null,t._allLayerViewsChange=function(e){t.handles.remove("suspension");var n=t.get("view.allLayerViews");n&&t.handles.add(n.map((function(e){return e.watch(["suspended","attributionVisible"],t._updateAttributionItems)})),"suspension"),e&&e.removed&&e.removed.forEach((function(e){t._pendingAttributions.delete(e),t._fetchedAttributionData.delete(e)})),t._updateAttributionItems()},t._updateAttributionItems=function(){var e=t.get("view.allLayerViews");xh.length=0,e?(e.forEach((function(e){if(!e.suspended&&e.get("layer.attributionVisible")){var n=e.layer;if(wh(n,"user"))kh(xh,e,n.copyright);else if(n.hasAttributionData){if(t._fetchedAttributionData.has(e)){var r=t._fetchedAttributionData.get(e);return void(r?kh(xh,e,t._getDynamicAttribution(r,t.view,n)):wh(n)&&kh(xh,e,n.copyright))}t._fetchAttributionData(e)}else{var i=n.get("portalItem.accessInformation");kh(xh,e,i||n.copyright)}}})),function(e,t){return e.length!==t.length||e.some((function(e,n){return e.text!==t[n].text}))}(t.items,xh)&&(t.items.removeAll(),t.items.addMany(xh)),xh.length=0,t.notifyChange("state")):t.clear()},t.handles.add([(0,N.on)((0,x.Z)(t),"view.allLayerViews","change",t._allLayerViewsChange,t._allLayerViewsChange,t.clear),(0,N.Z4)((0,x.Z)(t),"view.stationary",(function(){return t._updateAttributionItems()}))]),t}return(0,C.Z)(r,[{key:"destroy",value:function(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}},{key:"state",get:function(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}},{key:"_fetchAttributionData",value:(t=(0,O.Z)(T().mark((function e(t){var n,r;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._pendingAttributions.has(t)){e.next=2;break}return e.abrupt("return");case 2:return this._pendingAttributions.add(t),e.next=5,(0,mh.q6)(t.layer.fetchAttributionData());case 5:n=e.sent,this._pendingAttributions.has(t)&&(r=n.ok?this._createContributionIndex(n.value,Ch(t.layer)):null,this._pendingAttributions.delete(t),this._fetchedAttributionData.set(t,r)),this._updateAttributionItems();case 8:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_createContributionIndex",value:function(e,t){var n=e.contributors,r={};if(!n)return r;for(var i=0;i<n.length;i++){var o=n[i],a=o.coverageAreas;if(!a)return;var s,u=gh(a);try{for(u.s();!(s=u.n()).done;)for(var l=s.value,c=l.bbox,p=l.zoomMin-(t&&l.zoomMin?1:0),f=l.zoomMax-(t&&l.zoomMax?1:0),d={xmin:c[1],ymin:c[0],xmax:c[3],ymax:c[2],spatialReference:bl.Z.WGS84},h={extent:(0,zo.$)(d),attribution:o.attribution||"",score:null!=l.score?l.score:100,id:i},v=p;v<=f;v++)r[v]=r[v]||[],r[v].push(h)}catch(y){u.e(y)}finally{u.f()}}return r.maxKey=Math.max.apply(null,Object.keys(r)),r}},{key:"_getDynamicAttribution",value:function(e,t,n){var r=t.extent,i=t.scale,o=n.tileInfo.scaleToZoom(i);if(o=Math.min(e.maxKey,Math.round(o)),!r||null==o||o<=-1)return"";var a=e[o],s=(0,zo.iV)(r.center.clone().normalize(),t.spatialReference),u={};return a?a.filter((function(e){var t=!u[e.id]&&s&&(0,gp.aV)(e.extent,s);return t&&(u[e.id]=!0),t})).sort((function(e,t){return t.score-e.score||e.objectId-t.objectId})).map((function(e){return e.attribution})).join(", "):""}}]),r}(_e.r);(0,S._)([(0,U.Cb)({readOnly:!0,type:A.Z})],Zh.prototype,"items",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],Zh.prototype,"state",null),(0,S._)([(0,U.Cb)()],Zh.prototype,"view",void 0);var Mh=Zh=(0,S._)([(0,G.j)("esri.widgets.Attribution.AttributionViewModel")],Zh);function Ih(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Rh="esri-attribution esri-widget",Oh="esri-attribution__powered-by",Ph="esri-attribution__sources",Th="esri-attribution--open",Sh="esri-attribution__sources--open",Eh="esri-attribution__link",Ah="esri-icon-description",jh="esri-interactive",Fh=function(e){(0,M.Z)(n,e);var t=Ih(n);function n(e,r){var i;return(0,k.Z)(this,n),(i=t.call(this,e,r))._isOpen=!1,i._attributionTextOverflowed=!1,i._prevSourceNodeHeight=0,i.iconClass=Ah,i.itemDelimiter=" | ",i.label=void 0,i.messages=null,i.view=null,i.viewModel=new Mh,i}return(0,C.Z)(n,[{key:"initialize",value:function(){var e=this;this.own((0,N.on)(this,"viewModel.items","change",(function(){return e.scheduleRender()})))}},{key:"_isInteractive",get:function(){return this._isOpen||this._attributionTextOverflowed}},{key:"attributionText",get:function(){return this.viewModel.items.reduce((function(e,t){return-1===e.indexOf(t.text)&&e.push(t.text),e}),[]).join(this.itemDelimiter)}},{key:"render",value:function(){var e=(0,H.Z)({},Th,this._isOpen);return(0,Ot.u)("div",{bind:this,class:this.classes(Rh,e),onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}},{key:"renderPoweredBy",value:function(){return(0,Ot.u)("div",{class:Oh},"Powered by"," ",(0,Ot.u)("a",{class:Eh,href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}},{key:"renderSourcesNode",value:function(){var e,t=this._isOpen,n=this._isInteractive,r=n?0:-1,i=this.attributionText,o=n?"button":void 0,a=(e={},(0,H.Z)(e,Sh,t),(0,H.Z)(e,jh,n),e);return(0,Ot.u)("div",{afterCreate:this._afterSourcesNodeCreate,afterUpdate:this._afterSourcesNodeUpdate,bind:this,class:this.classes(Ph,a),innerHTML:i,role:o,tabIndex:r})}},{key:"_afterSourcesNodeCreate",value:function(e){this._prevSourceNodeHeight=e.clientWidth}},{key:"_afterSourcesNodeUpdate",value:function(e){var t=!1,n=e.clientHeight,r=e.clientWidth,i=e.scrollWidth>=r,o=this._attributionTextOverflowed!==i;if(this._attributionTextOverflowed=i,o&&(t=!0),this._isOpen){var a=n<this._prevSourceNodeHeight;this._prevSourceNodeHeight=n,a&&(this._isOpen=!1,t=!0)}t&&this.scheduleRender()}},{key:"_toggleState",value:function(){this._isInteractive&&(this._isOpen=!this._isOpen)}}]),n}(ve.Z);(0,S._)([(0,U.Cb)()],Fh.prototype,"_isOpen",void 0),(0,S._)([(0,U.Cb)()],Fh.prototype,"_isInteractive",null),(0,S._)([(0,U.Cb)()],Fh.prototype,"_attributionTextOverflowed",void 0),(0,S._)([(0,U.Cb)()],Fh.prototype,"_prevSourceNodeHeight",void 0),(0,S._)([(0,U.Cb)({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],Fh.prototype,"attributionText",null),(0,S._)([(0,U.Cb)()],Fh.prototype,"iconClass",void 0),(0,S._)([(0,U.Cb)()],Fh.prototype,"itemDelimiter",void 0),(0,S._)([(0,U.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Fh.prototype,"label",void 0),(0,S._)([(0,U.Cb)(),(0,Rt.H)("esri/widgets/Attribution/t9n/Attribution")],Fh.prototype,"messages",void 0),(0,S._)([(0,de.B)("viewModel.view")],Fh.prototype,"view",void 0),(0,S._)([(0,U.Cb)({type:Mh})],Fh.prototype,"viewModel",void 0),(0,S._)([(0,Sa.h)()],Fh.prototype,"_toggleState",null);var Lh=Fh=(0,S._)([(0,G.j)("esri.widgets.Attribution")],Fh);function Dh(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Vh=function(e){(0,M.Z)(n,e);var t=Dh(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e))._handles=new Y.Z,r.orientation={x:0,y:0,z:0},r.view=null,r._updateForCamera=r._updateForCamera.bind((0,x.Z)(r)),r._updateForRotation=r._updateForRotation.bind((0,x.Z)(r)),r._updateRotationWatcher=r._updateRotationWatcher.bind((0,x.Z)(r)),r}return(0,C.Z)(n,[{key:"initialize",value:function(){this._handles.add((0,N.S1)(this,"view",this._updateRotationWatcher))}},{key:"destroy",value:function(){this._handles.destroy(),this._handles=null,this.view=null}},{key:"canShowNorth",get:function(){var e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}},{key:"state",get:function(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}},{key:"reset",value:function(){if(this.get("view.ready")){var e={};"2d"===this.view.type?e.rotation=0:e.heading=0,this.callGoTo({target:e})}}},{key:"_updateForRotation",value:function(e){null!=e&&(this.orientation={z:e})}},{key:"_updateForCamera",value:function(e){if(e){var t=-e.heading;this.orientation={x:0,y:0,z:t}}}},{key:"_updateRotationWatcher",value:function(e){this._handles.removeAll(),e&&("2d"===e.type?this._handles.add((0,N.S1)(this,"view.rotation",this._updateForRotation)):this._handles.add((0,N.S1)(this,"view.camera",this._updateForCamera)))}}]),n}(wa(re.Z));(0,S._)([(0,U.Cb)({readOnly:!0})],Vh.prototype,"canShowNorth",null),(0,S._)([(0,U.Cb)()],Vh.prototype,"orientation",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],Vh.prototype,"state",null),(0,S._)([(0,U.Cb)()],Vh.prototype,"view",void 0);var Bh=Vh=(0,S._)([(0,G.j)("esri.widgets.CompassViewModel")],Vh);function Nh(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var zh="esri-compass esri-widget--button esri-widget",Uh="esri-icon-font-fallback-text",Wh="esri-compass__icon",qh="esri-icon-dial",Gh="esri-icon-compass",Hh="esri-icon-locate-circled",Kh="esri-interactive",Yh="esri-disabled",Jh=function(e){(0,M.Z)(n,e);var t=Nh(n);function n(e,r){var i;return(0,k.Z)(this,n),(i=t.call(this,e,r)).goToOverride=null,i.iconClass=Hh,i.label=void 0,i.messages=null,i.view=null,i.viewModel=new Bh,i}return(0,C.Z)(n,[{key:"reset",value:function(){return this.viewModel.reset()}},{key:"render",value:function(){var e,t,n=this.viewModel,r=n.orientation,i=n.state,o="disabled"===i,a="compass"==("rotation"===i?"rotation":"compass"),s=o?-1:0,u=(e={},(0,H.Z)(e,Yh,o),(0,H.Z)(e,Kh,!o),e),l=(t={},(0,H.Z)(t,Gh,a),(0,H.Z)(t,qh,!a),t),c=this.messages;return(0,Ot.u)("div",{bind:this,class:this.classes(zh,u),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:s,"aria-label":c.reset,title:c.reset},(0,Ot.u)("span",{"aria-hidden":"true",class:this.classes(Wh,l),styles:this._toRotationTransform(r)}),(0,Ot.u)("span",{class:Uh},c.reset))}},{key:"_reset",value:function(){this.viewModel.reset()}},{key:"_toRotationTransform",value:function(e){return{transform:"rotateZ(".concat(e.z,"deg)")}}}]),n}(ve.Z);(0,S._)([(0,de.B)("viewModel.goToOverride")],Jh.prototype,"goToOverride",void 0),(0,S._)([(0,U.Cb)()],Jh.prototype,"iconClass",void 0),(0,S._)([(0,U.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Jh.prototype,"label",void 0),(0,S._)([(0,U.Cb)(),(0,Rt.H)("esri/widgets/Compass/t9n/Compass")],Jh.prototype,"messages",void 0),(0,S._)([(0,de.B)("viewModel.view")],Jh.prototype,"view",void 0),(0,S._)([(0,U.Cb)({type:Bh})],Jh.prototype,"viewModel",void 0),(0,S._)([(0,Sa.h)()],Jh.prototype,"_reset",null);var $h=Jh=(0,S._)([(0,G.j)("esri.widgets.Compass")],Jh);function Qh(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Xh=function(e){(0,M.Z)(n,e);var t=Qh(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e))._handles=new Y.Z,r.navigationMode="pan",r.view=null,r}return(0,C.Z)(n,[{key:"initialize",value:function(){this._handles.add((0,N.gx)(this,"view.inputManager",this._setNavigationMode.bind(this)))}},{key:"destroy",value:function(){this._handles.destroy(),this._handles=null,this.view=null}},{key:"state",get:function(){return this.get("view.ready")&&"3d"===this.view.type?"ready":"disabled"}},{key:"toggle",value:function(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())}},{key:"_setNavigationMode",value:function(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"}}]),n}(re.Z);(0,S._)([(0,U.Cb)({readOnly:!0})],Xh.prototype,"state",null),(0,S._)([(0,U.Cb)()],Xh.prototype,"navigationMode",void 0),(0,S._)([(0,U.Cb)()],Xh.prototype,"view",void 0);var ev=Xh=(0,S._)([(0,G.j)("esri.widgets.NavigationToggleViewModel")],Xh);function tv(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var nv="esri-navigation-toggle esri-widget",rv="esri-navigation-toggle__button esri-widget--button",iv="esri-navigation-toggle__button--active",ov="esri-navigation-toggle__button--pan",av="esri-navigation-toggle__button--rotate",sv="esri-navigation-toggle--horizontal",uv="esri-icon-rotate",lv="esri-icon-pan",cv="esri-icon-pan2",pv="esri-disabled",fv=function(e){(0,M.Z)(n,e);var t=tv(n);function n(e,r){var i;return(0,k.Z)(this,n),(i=t.call(this,e,r)).iconClass=cv,i.label=void 0,i.messages=null,i.view=null,i.viewModel=new ev,i}return(0,C.Z)(n,[{key:"layout",set:function(e){"horizontal"!==e&&(e="vertical"),this._set("layout",e)}},{key:"toggle",value:function(){return this.viewModel.toggle()}},{key:"render",value:function(){var e,t="disabled"===this.get("viewModel.state"),n="pan"===this.get("viewModel.navigationMode"),r=(e={},(0,H.Z)(e,pv,t),(0,H.Z)(e,sv,"horizontal"===this.layout),e),i=(0,H.Z)({},iv,n),o=(0,H.Z)({},iv,!n),a=t?-1:0,s=this.messages.toggle;return(0,Ot.u)("div",{bind:this,class:this.classes(nv,r),onclick:this._toggle,onkeydown:this._toggle,tabIndex:a,"aria-label":s,title:s},(0,Ot.u)("div",{class:this.classes(rv,ov,i)},(0,Ot.u)("span",{class:lv})),(0,Ot.u)("div",{class:this.classes(rv,av,o)},(0,Ot.u)("span",{class:uv})))}},{key:"_toggle",value:function(){this.toggle()}}]),n}(ve.Z);(0,S._)([(0,U.Cb)()],fv.prototype,"iconClass",void 0),(0,S._)([(0,U.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],fv.prototype,"label",void 0),(0,S._)([(0,U.Cb)({value:"vertical"})],fv.prototype,"layout",null),(0,S._)([(0,U.Cb)(),(0,Rt.H)("esri/widgets/NavigationToggle/t9n/NavigationToggle")],fv.prototype,"messages",void 0),(0,S._)([(0,de.B)("viewModel.view")],fv.prototype,"view",void 0),(0,S._)([(0,U.Cb)({type:ev})],fv.prototype,"viewModel",void 0),(0,S._)([(0,Sa.h)()],fv.prototype,"_toggle",null);var dv=fv=(0,S._)([(0,G.j)("esri.widgets.NavigationToggle")],fv);function hv(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var vv="esri-widget--button esri-widget",yv="esri-disabled",mv="esri-interactive",gv="esri-icon-font-fallback-text",bv="esri-icon",_v=function(e){(0,M.Z)(n,e);var t=hv(n);function n(){var e;return(0,k.Z)(this,n),(e=t.apply(this,arguments)).enabled=!0,e.iconClass="",e.title="",e}return(0,C.Z)(n,[{key:"render",value:function(){var e,t=this.enabled?0:-1,n=(e={},(0,H.Z)(e,yv,!this.enabled),(0,H.Z)(e,mv,this.enabled),e),r=(0,H.Z)({},this.iconClass,!!this.iconClass);return(0,Ot.u)("div",{bind:this,class:this.classes(vv,n),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:t,title:this.title},(0,Ot.u)("span",{"aria-hidden":"true",role:"presentation",class:this.classes(bv,r)}),(0,Ot.u)("span",{class:gv},this.title))}},{key:"_triggerAction",value:function(){this.action.call(this)}}]),n}(ve.Z);(0,S._)([(0,U.Cb)()],_v.prototype,"action",void 0),(0,S._)([(0,U.Cb)()],_v.prototype,"enabled",void 0),(0,S._)([(0,U.Cb)()],_v.prototype,"iconClass",void 0),(0,S._)([(0,U.Cb)()],_v.prototype,"title",void 0),(0,S._)([(0,Sa.h)()],_v.prototype,"_triggerAction",null);var wv=_v=(0,S._)([(0,G.j)("esri.widgets.IconButton")],_v);function kv(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Cv=function(e){(0,M.Z)(n,e);var t=kv(n);function n(){return(0,k.Z)(this,n),t.apply(this,arguments)}return(0,C.Z)(n,[{key:"canZoomIn",get:function(){if(!this.get("view.ready"))return!1;var e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMaxScale");return 0===t||e>t}},{key:"canZoomOut",get:function(){if(!this.get("view.ready"))return!1;var e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMinScale");return 0===t||e<t}}]),n}(re.Z);(0,S._)([(0,U.Cb)({readOnly:!0})],Cv.prototype,"canZoomIn",null),(0,S._)([(0,U.Cb)({readOnly:!0})],Cv.prototype,"canZoomOut",null),(0,S._)([(0,U.Cb)()],Cv.prototype,"view",void 0);var xv=Cv=(0,S._)([(0,G.j)("esri.widgets.Zoom.ZoomConditions2D")],Cv);function Zv(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Mv=function(e){(0,M.Z)(n,e);var t=Zv(n);function n(){return(0,k.Z)(this,n),t.apply(this,arguments)}return(0,C.Z)(n,[{key:"canZoomIn",get:function(){return!!this.get("view.ready")}},{key:"canZoomOut",get:function(){return!!this.get("view.ready")}}]),n}(re.Z);(0,S._)([(0,U.Cb)({readOnly:!0})],Mv.prototype,"canZoomIn",null),(0,S._)([(0,U.Cb)({readOnly:!0})],Mv.prototype,"canZoomOut",null),(0,S._)([(0,U.Cb)()],Mv.prototype,"view",void 0);var Iv=Mv=(0,S._)([(0,G.j)("esri.widgets.Zoom.ZoomConditions3D")],Mv);function Rv(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Ov=function(e){(0,M.Z)(n,e);var t=Rv(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).canZoomIn=!1,r.canZoomOut=!1,r}return(0,C.Z)(n,[{key:"destroy",value:function(){this.view=null}},{key:"state",get:function(){return this.get("view.ready")?"ready":"disabled"}},{key:"view",set:function(e){e?"2d"===e.type?this._zoomConditions=new xv({view:e}):"3d"===e.type&&(this._zoomConditions=new Iv({view:e})):this._zoomConditions=null,this._set("view",e)}},{key:"zoomIn",value:function(){if(this.canZoomIn){var e=this.view;"2d"===e.type?e.mapViewNavigation.zoomIn():(0,gr.R8)(e.goTo({zoomFactor:2}))}}},{key:"zoomOut",value:function(){if(this.canZoomOut){var e=this.view;"2d"===e.type?e.mapViewNavigation.zoomOut():(0,gr.R8)(e.goTo({zoomFactor:.5}))}}}]),n}(re.Z);(0,S._)([(0,U.Cb)()],Ov.prototype,"_zoomConditions",void 0),(0,S._)([(0,U.Cb)({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],Ov.prototype,"canZoomIn",void 0),(0,S._)([(0,U.Cb)({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],Ov.prototype,"canZoomOut",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],Ov.prototype,"state",null),(0,S._)([(0,U.Cb)()],Ov.prototype,"view",null);var Pv=Ov=(0,S._)([(0,G.j)("esri.widgets.Zoom.ZoomViewModel")],Ov);function Tv(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Sv="esri-zoom esri-widget",Ev="esri-zoom--horizontal",Av="esri-icon-plus",jv="esri-icon-minus",Fv="esri-icon-zoom-in-magnifying-glass",Lv=function(e){(0,M.Z)(n,e);var t=Tv(n);function n(e,r){var i;return(0,k.Z)(this,n),(i=t.call(this,e,r)).iconClass=Fv,i.label=void 0,i.messages=null,i.view=null,i.viewModel=new Pv,i}return(0,C.Z)(n,[{key:"initialize",value:function(){this._zoomInButton=new wv({action:this.zoomIn.bind(this),iconClass:Av}),this._zoomOutButton=new wv({action:this.zoomOut.bind(this),iconClass:jv})}},{key:"destroy",value:function(){this._zoomInButton.destroy(),this._zoomOutButton.destroy(),this._zoomInButton=null,this._zoomOutButton=null}},{key:"layout",set:function(e){"horizontal"!==e&&(e="vertical"),this._set("layout",e)}},{key:"render",value:function(){var e=this.viewModel,t=(0,H.Z)({},Ev,"horizontal"===this.layout);return this._zoomInButton.enabled="ready"===e.state&&e.canZoomIn,this._zoomOutButton.enabled="ready"===e.state&&e.canZoomOut,this._zoomInButton.title=this.messages.zoomIn,this._zoomOutButton.title=this.messages.zoomOut,(0,Ot.u)("div",{class:this.classes(Sv,t)},this._zoomInButton.render(),this._zoomOutButton.render())}},{key:"zoomIn",value:function(){return this.viewModel.zoomIn()}},{key:"zoomOut",value:function(){return this.viewModel.zoomOut()}}]),n}(ve.Z);(0,S._)([(0,U.Cb)()],Lv.prototype,"iconClass",void 0),(0,S._)([(0,U.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Lv.prototype,"label",void 0),(0,S._)([(0,U.Cb)({value:"vertical"})],Lv.prototype,"layout",null),(0,S._)([(0,U.Cb)(),(0,Rt.H)("esri/widgets/Zoom/t9n/Zoom")],Lv.prototype,"messages",void 0),(0,S._)([(0,de.B)("viewModel.view")],Lv.prototype,"view",void 0),(0,S._)([(0,U.Cb)({type:Pv})],Lv.prototype,"viewModel",void 0);var Dv=Lv=(0,S._)([(0,G.j)("esri.widgets.Zoom")],Lv);function Vv(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Bv="esri.views.ui.DefaultUI";V.Z.getLogger(Bv);var Nv=function(e){(0,M.Z)(n,e);var t=Vv(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e))._defaultPositionLookup={attribution:"manual",compass:"top-leading","navigation-toggle":"top-leading",zoom:"top-leading"},r.components=[],r}return(0,C.Z)(n,[{key:"initialize",value:function(){this._handles.add([(0,N.S1)(this,"components",this._componentsWatcher.bind(this)),(0,N.S1)(this,"view",this._updateViewAwareWidgets.bind(this))])}},{key:"_add",value:function(e,t,r,i){if("string"==typeof e&&this._defaultPositionLookup[e]){if(this._find(e))return;e=this._createComponent(e)}(0,Z.Z)((0,R.Z)(n.prototype),"_add",this).call(this,e,t,r,i)}},{key:"_removeComponents",value:function(e){var t=this;e.forEach((function(e){var n=t._find(e);n&&(t.remove(n),n.destroy())}))}},{key:"_updateViewAwareWidgets",value:function(e){var t=this;this.components.forEach((function(n){var r=t._find(n),i=r&&r.widget;(function(e){return e&&void 0!==e.view})(i)&&(i.view=e)}))}},{key:"_componentsWatcher",value:function(e,t){this._removeComponents(t),this._addComponents(e),this._adjustPadding(e)}},{key:"_adjustPadding",value:function(e){if(-1===e.indexOf("attribution")&&!this._isOverridden("padding")){var t=this.padding.top;this.padding=t}}},{key:"_addComponents",value:function(e){var t=this;this.initialized&&e.forEach((function(e){return t.add(t._createComponent(e),t._defaultPositionLookup[e])}))}},{key:"_createComponent",value:function(e){var t=this._createWidget(e);if(t)return new Yd({id:e,node:t})}},{key:"_createWidget",value:function(e){return"attribution"===e?this._createAttribution():"compass"===e?this._createCompass():"navigation-toggle"===e?this._createNavigationToggle():"zoom"===e?this._createZoom():void 0}},{key:"_createAttribution",value:function(){return new Lh({view:this.view})}},{key:"_createCompass",value:function(){return new $h({view:this.view})}},{key:"_createNavigationToggle",value:function(){return new dv({view:this.view})}},{key:"_createZoom",value:function(){return new Dv({view:this.view})}}]),n}(yh);function zv(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}(0,S._)([(0,U.Cb)()],Nv.prototype,"components",void 0);var Uv=function(e){(0,M.Z)(n,e);var t=zv(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).components=["attribution","zoom"],r}return(0,C.Z)(n)}(Nv=(0,S._)([(0,G.j)(Bv)],Nv));(0,S._)([(0,U.Cb)()],Uv.prototype,"components",void 0);var Wv,qv=Uv=(0,S._)([(0,G.j)("esri.views.ui.2d.DefaultUI2D")],Uv);function Gv(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Hv=Wv=function(e){(0,M.Z)(n,e);var t=Gv(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).color=new Ou.Z([0,0,0,1]),r}return(0,C.Z)(n,[{key:"clone",value:function(){return new Wv((0,Eu.d9)({color:this.color}))}}]),n}(Su.wq);(0,S._)([(0,U.Cb)({type:Ou.Z,json:{write:!0}})],Hv.prototype,"color",void 0);var Kv=Hv=Wv=(0,S._)([(0,G.j)("esri.webmap.background.ColorBackground")],Hv);function Yv(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Jv(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Jv(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Jv(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function $v(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Qv,Xv,ey,ty,ny,ry,iy=V.Z.getLogger("esri.views.MapView");function oy(){return(oy=(0,O.Z)(T().mark((function e(){var t,r,i,o,a,s,u,l,c;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([Promise.all([n.e(9351),n.e(317),n.e(7278)]).then(n.bind(n,77278)),Promise.all([n.e(9351),n.e(317),n.e(6979)]).then(n.bind(n,96979))]);case 2:t=e.sent,r=(0,w.Z)(t,2),i=r[1],o=i.GraphicsView2D,a=i.GraphicContainer,s=i.LabelManager,u=i.MapViewNavigation,l=i.MagnifierView2D,c=i.Stage,Xv=o,ey=a,ty=s,ny=u,ry=l,Qv=c;case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ay=function(e){(0,M.Z)(r,e);var t,n=$v(r);function r(e){var t;return(0,k.Z)(this,r),(t=n.call(this,e))._magnifierView=null,t._stage=null,t._resolveWhenReady=[],t.rootLayerViews=new j.Z({getCollections:function(){var e,n;return[null==(e=t.basemapView)?void 0:e.baseLayerViews,t.layerViews,null==(n=t.basemapView)?void 0:n.referenceLayerViews]},getChildrenFunction:function(){return null}}),t.floors=new A.Z,t.graphicsView=null,t.highlightOptions=new Bd,t.inputManager=new Fd({view:(0,x.Z)(t)}),t.mapViewNavigation=null,t.supersampleScreenshotsEnabled=!1,t.ui=new qv,t.rendering=!1,(0,z.j2)(),t}return(0,C.Z)(r,[{key:"destroy",value:function(){this.rootLayerViews.destroy(),this.inputManager.destroy(),this._set("inputManager",null)}},{key:"background",get:function(){return this.get("map.initialViewProperties.background")||null},set:function(e){void 0===e?this._clearOverride("background"):this._override("background",e)}},{key:"resourceManager",get:function(){return this._stage.resourceManager}},{key:"textureManager",get:function(){return this._stage.painter.textureManager}},{key:"navigating",get:function(){return!(!this.mapViewNavigation||!this.mapViewNavigation.interacting)}},{key:"toMap",value:function(e){if($l(e)){var t=Jl(this,e);return(0,Z.Z)((0,R.Z)(r.prototype),"toMap",this).call(this,t)}return(0,Z.Z)((0,R.Z)(r.prototype),"toMap",this).call(this,e)}},{key:"hitTest",value:(t=(0,O.Z)(T().mark((function e(t,n){var r,i,o,a,s,u,l,c;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=$l(t)?Jl(this,t):t,this.ready&&!isNaN(r.x)&&!isNaN(r.y)){e.next=3;break}return e.abrupt("return",{screenPoint:r,results:[]});case 3:return i=new Set,o=!1,a=null,s=null,null!=n&&n.include?cy(n.include,ly(this,(function(e){return i.add(e)}),(function(e){a||(a=new Set),a.add(e)}),(function(e){return i.add(e)}),(function(){return o=!0}))):(o=!0,i=new Set(this.allLayerViews)),null!=n&&n.exclude&&cy(n.exclude,ly(this,(function(e){return i.delete(e)}),(function(e){s||(s=new Set),s.add(e)}))),u=this.allLayerViews.filter((function(e){return!e.suspended&&i.has(e)})).reverse(),l=this.toMap(r),e.next=8,Promise.all([o?this.graphicsView.hitTest(l):null].concat((0,h.Z)(u.map((function(e){return e.hitTest(l,r)})))));case 8:return c=e.sent.filter(B.pC).flat(),e.abrupt("return",(a&&(c=c.filter((function(e){return a.has(uy(e))}))),s&&(c=c.filter((function(e){return!s.has(uy(e))}))),{screenPoint:r,results:c.map((function(e){return{mapPoint:l,graphic:e}}))}));case 10:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"takeScreenshot",value:function(e){var t=this;e=e||{};var n,r=this.supersampleScreenshotsEnabled?Math.min(4,(0,Nd.RZ)(this.size,Math.min(4096,this._stage.context.parameters.maxTextureSize))):1;e.layers?(n=[],e.layers.forEach((function(e){var r=t.allLayerViews.find((function(t){return t.layer.id===e.id}));r&&"container"in r&&r.container&&n.push(r.container)}))):n=this._stage.children;var i=(0,Nd.LI)(e.format,e.quality),o=i.format,a=i.quality,s=function(e,t,n,r,i,o,a,s){var u;e.ignorePadding&&(r={left:0,right:0,top:0,bottom:0}),null!=e.width&&null!=e.height?u=[e.width,e.height]:null==e.width&&null!=e.height?u=[e.height,e.height]:null!=e.width&&null==e.height?u=[e.width,e.width]:null==e.width&&null==e.height&&(u=null);var l,c,p=n[0]-(r.left+r.right),f=n[1]-(r.top+r.bottom),d=e.area||{x:0,y:0,width:p,height:f};if(u){var h=p/f,v=u[0]/u[1];if(v>h){var y=d.width/v;d={x:d.x,y:Math.round(d.y+(d.height-y)/2),width:d.width,height:Math.round(y)}}else{var m=d.height*v;d={x:Math.round(d.x+(d.width-m)/2),y:d.y,width:Math.round(m),height:d.height}}}else u=[d.width,d.height];return u[0]>d.width?(l=Math.min(u[0]/d.width,t),c=u[0]/d.width/l):(l=1,c=u[0]/d.width),{resolutionScale:l,cropArea:{x:Math.round((d.x+r.left)*l),y:Math.round((d.y+r.top)*l),width:Math.round(d.width*l),height:Math.round(d.height*l)},outputScale:c,format:i,quality:o,children:a,rotation:s}}(e,r,this.size,this.padding,o,a,n,e.rotation);return this._stage.takeScreenshot(s)}},{key:"on",value:function(e,t,n,i){return this.inputManager&&this.viewEvents.on(e,t,n,i)||(0,Z.Z)((0,R.Z)(r.prototype),"on",this).call(this,e,t)}},{key:"hasEventListener",value:function(e){return(0,Z.Z)((0,R.Z)(r.prototype),"hasEventListener",this).call(this,e)||this.viewEvents.hasHandler(e)}},{key:"whenLayerView",value:function(e){return(0,Z.Z)((0,R.Z)(r.prototype),"whenLayerView",this).call(this,e)}},{key:"graphicChanged",value:function(e){this.graphicsView&&this.graphicsView.graphicUpdateHandler(e)}},{key:"whenReady",value:function(){var e=this;return new Promise((function(t){e.ready?t(e):e._resolveWhenReady.push(t)}))}},{key:"forceDOMReadyCycle",value:function(){this.forceReadyCycle()}},{key:"validate",value:function(){var e=function(e){e=Wd(Wd({},qd),e);var t=(0,zd.Z)();return t.available?e.checkMajorWebPerformanceCaveat&&t.majorPerformanceCaveat?new F.Z("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist."):t.supportsHighPrecisionFragment?t.supportsVertexShaderSamplers?t.supportsElementIndexUint?t.supportsStandardDerivatives?t.supportsInstancedArrays?null:new F.Z("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported."):new F.Z("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported."):new F.Z("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported."):new F.Z("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new F.Z("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new F.Z("webgl:required","WebGL is required but not supported.")}({checkMajorWebPerformanceCaveat:!1});return(0,L.Z)("safari")&&(0,L.Z)("safari")<9&&(e=new F.Z("mapview:browser-not-supported","This browser is not supported by MapView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:(0,L.Z)("safari")})),(0,B.pC)(e)?(iy.warn("#validate()",e.message),Promise.reject(e)):function(){return oy.apply(this,arguments)}()}},{key:"_startup",value:function(){var e=this;this.timeline.begin("MapView Startup"),(0,Z.Z)((0,R.Z)(r.prototype),"_startup",this).call(this),this.graphics.owner=this;var t={disabledExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions},n=new Qv(this.surface,{canvas:this.renderCanvas,supersampleScreenshots:this.supersampleScreenshotsEnabled,contextOptions:t,renderingOptions:this.renderingOptions,timeline:this.timeline}),i=new Xv({view:this,graphics:this.graphics,requestUpdateCallback:function(){return e.requestUpdate()},container:new ey(this.featuresTilingScheme)}),o=new ny({view:this,animationManager:this.animationManager}),a=new ty({view:this});this._magnifierView=new ry,this._magnifierView.magnifier=this.magnifier,this._stage=n,this.frameTask.graphicsView=i,this._set("graphicsView",i),this._set("mapViewNavigation",o),this._set("labelManager",a),this.handles.add([this.rootLayerViews.on("change",(function(){return e._updateStageChildren()})),n.on("post-render",(function(){return e._set("rendering",n.renderRequested)})),n.on("will-render",(function(){return e._set("rendering",n.renderRequested)})),n.on("webgl-error",(function(t){return e.fatalError=t.error})),(0,N.S1)(this,"stationary",(function(e){return n.stationary=e}),!0),(0,N.S1)(this,"state.id",(function(){return n.state=e.state}),!0),(0,N.S1)(this,"background",(function(t){n.background=t,e._magnifierView.background=t}),!0),(0,N.S1)(this,"magnifier",(function(t){return e._magnifierView.magnifier=t}),!0),(0,N.S1)(this,"renderingOptions",(function(e){return n.renderingOptions=e}),!0),(0,N.S1)(this,"highlightOptions",(function(){return n.highlightOptions=e.highlightOptions}),!0)],"map-view"),n.state=this.state,this._updateStageChildren();var s=this._resolveWhenReady;this._resolveWhenReady=[],s.forEach((function(t){return t(e)})),this.timeline.end("MapView Startup")}},{key:"_teardown",value:function(){this.handles.remove("map-view"),this.layerViewManager.clear(),this.labelManager.destroy(),this._magnifierView.destroy(),this._stage.destroy(),this.graphicsView.destroy(),this.mapViewNavigation.destroy(),this._stage=null,this._set("graphicsView",null),this._magnifierView=null,this._set("labelManager",null),this._set("mapViewNavigation",null),this.graphics.owner=null,(0,Z.Z)((0,R.Z)(r.prototype),"_teardown",this).call(this)}},{key:"_updateStageChildren",value:function(){var e=this;this._stage.removeAllChildren(),this.rootLayerViews.forEach((function(t){e._stage.addChild(t.container)}));var t=this.graphicsView;this._stage.addChild(t.container),this._stage.addChild(this._magnifierView)}}]),r}(function(e){var t=function(e){(0,M.Z)(n,e);var t=$(n);function n(){var e;(0,k.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i)))._breakpointsHandles=new Y.Z,e.orientation=null,e.widthBreakpoint=null,e.heightBreakpoint=null,e.breakpoints=X,e}return(0,C.Z)(n,[{key:"initialize",value:function(){this._breakpointsHandles.add((0,N.S1)(this,["breakpoints","size"],this._updateClassNames))}},{key:"destroy",value:function(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles.destroy(),this._breakpointsHandles=null)}},{key:"breakpoints",set:function(e){if(e!==this._get("breakpoints")){var t=function(e){var t=e;return t&&t.xsmall<t.small&&t.small<t.medium&&t.medium<t.large}(e);if(!t){var n=JSON.stringify(X,null,2);console.warn("provided breakpoints are not valid, using defaults:"+n)}e=t?e:X,this._set("breakpoints",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?J(Object(n),!0).forEach((function(t){(0,H.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e))}}},{key:"_updateClassNames",value:function(){if(this.container){var e,t=K.Z.acquire(),n=K.Z.acquire(),r=!1;for(e in Q){var i=this[e],o=Q[e].getValue({viewSize:this.size,breakpoints:this.breakpoints});i!==o&&(r=!0,this[e]=o,ee(e,i).forEach((function(e){return n.push(e)})),ee(e,o).forEach((function(e){return t.push(e)})))}r&&(this._applyClassNameChanges(t,n),K.Z.release(t),K.Z.release(n))}}},{key:"_applyClassNameChanges",value:function(e,t){var n=this.container;n&&(t.forEach((function(e){return n.classList.remove(e)})),e.forEach((function(e){return n.classList.add(e)})))}},{key:"_removeActiveClassNames",value:function(){var e,t=this.container;if(t)for(e in Q)ee(e,this[e]).forEach((function(e){return t.classList.remove(e)}))}}]),n}(e);return(0,S._)([(0,U.Cb)()],t.prototype,"breakpoints",null),(0,S._)([(0,U.Cb)()],t.prototype,"orientation",void 0),(0,S._)([(0,U.Cb)()],t.prototype,"widthBreakpoint",void 0),(0,S._)([(0,U.Cb)()],t.prototype,"heightBreakpoint",void 0),t=(0,S._)([(0,G.j)("esri.views.BreakpointsOwner")],t)}(function(e){var t=function(e){(0,M.Z)(n,e);var t=yu(n);function n(){var e;(0,k.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i)))._freqInfo={freq:bu,time:_u},e._overlayRenderTaskHandle=null,e.height=0,e.position=null,e.resizing=!1,e.root=null,e.surface=null,e.suspended=!0,e.ui=null,e.userContent=null,e.width=0,e.widthBreakpoint=null,e.handles.add([e.watch("cursor",(function(t){var n=e.surface;n&&n.setAttribute("data-cursor",t)})),e.watch("interacting",(function(t){var n=e.surface;n&&n.setAttribute("data-interacting",t.toString())}))]),e}return(0,C.Z)(n,[{key:"initialize",value:function(){var e=this;this.handles.add(this.watch("ui",(function(t,n){return e._handleUIChange(t,n)}))),this._wireUI(this.ui),this.handles.add([this.on("focus",(function(){return e.notifyChange("focused")})),this.on("blur",(function(){return e.notifyChange("focused")}))])}},{key:"destroy",value:function(){this.destroyed||(this.ui&&(this.ui.destroy(),this.ui=null),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)}},{key:"container",set:function(e){var t=this,n=this._get("container");if(n!==e){var r="dom-size";if(this.handles.remove(r),this._stopMeasuring(),n&&(n.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay.destroy(),this._set("overlay",null),gu(this.root),this._set("root",null),(0,te.YD)(this.userContent,n),gu(this.userContent),this._set("userContent",null)),e){e.classList.add("esri-view");var i=document.createElement("div");i.className="esri-view-user-storage",(0,te.YD)(e,i),e.appendChild(i),this._set("userContent",i);var o=document.createElement("div");o.className="esri-view-root",e.insertBefore(o,e.firstChild),this._set("root",o);var a=document.createElement("div");a.className="esri-view-surface",a.setAttribute("role","application"),a.tabIndex=0,o.appendChild(a),this._set("surface",a);var s=new ce;o.appendChild(s.surface),this._set("overlay",s),s.watch("needsRender",(function(e){e&&!t._overlayRenderTaskHandle?t._overlayRenderTaskHandle=(0,ne.A)({render:function(){t.overlay.render()}}):t._overlayRenderTaskHandle&&(t._overlayRenderTaskHandle.remove(),t._overlayRenderTaskHandle=null)})),this.forceDOMReadyCycle(),this.handles.add((0,N.S1)(this,"size",(function(e){var t=(0,w.Z)(e,2),n=t[0],r=t[1],i="esri-view-surface--inset-outline";n>=document.body.clientWidth||r>=document.body.clientHeight?a.classList.add(i):a.classList.remove(i)})),r),this._set("container",e),this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}}},{key:"focused",get:function(){var e=document.activeElement===this.surface;return document.hasFocus()&&e}},{key:"popup",get:function(){return this._get("popup")||new vu({view:this})},set:function(e){var t=this._get("popup");t&&t!==e&&t.destroy(),this._set("popup",e)}},{key:"size",get:function(){return[this.width,this.height]}},{key:"blur",value:function(){this.surface&&this.surface.blur()}},{key:"focus",value:function(){this.surface&&this.surface.focus()}},{key:"pageToContainer",value:function(e,t,n){var r=this.position;return e-=r[0],t-=r[1],n?(n[0]=e,n[1]=t):n=[e,t],n}},{key:"containerToPage",value:function(e,t,n){var r=this.position;return e+=r[0],t+=r[1],n?(n[0]=e,n[1]=t):n=[e,t],n}},{key:"_handleUIChange",value:function(e,t){t&&(this.handles.remove("ui"),t.destroy()),e&&this._wireUI(e),this._set("ui",e)}},{key:"_wireUI",value:function(e){this.handles.remove("ui"),e&&(e.view=this,this.handles.add([(0,N.S1)(this,"root",(function(t){e.container=t?function(e){var t=document.createElement("div");return e.appendChild(t),t}(t):null})),(0,N.S1)(this,"popup",(function(t,n){var r="popup";n&&e.remove(n,r),t&&(t.view=e.view,e.add(t,{key:r,position:"manual"}))}))],"ui"))}},{key:"_stopMeasuring",value:function(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)}},{key:"_startMeasuring",value:function(){var e=this,t=this._freqInfo;t.freq=bu,t.time=_u,this.handles.add([function(){var e=function(){t.freq=bu,t.time=_u};return window.addEventListener("resize",e),{remove:function(){window.removeEventListener("resize",e)}}}(),(0,ne.A)({prepare:function(t){var n=e._measure(),r=e._freqInfo;if(r.time+=t.deltaTime,n&&(r.freq=bu,e._get("resizing")||e._set("resizing",!0)),!(r.time<r.freq)){r.time=0;var i=e._position();r.freq=i||n?bu:Math.min(_u,2*r.freq),!n&&r.freq>=512&&e._get("resizing")&&e._set("resizing",!1)}}})],"measuring"),this._measure(),this._position()}},{key:"_measure",value:function(){var e=this.container,t=e?e.clientWidth:0,n=e?e.clientHeight:0;if(0===t||0===n)return this.suspended||this._set("suspended",!0),!1;var r=this.width,i=this.height;return t===r&&n===i?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",t),this._set("height",n),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:r,oldHeight:i,width:t,height:n}),!0)}},{key:"_position",value:function(){var e=this.container,t=this.position,n=function(e){var t=(e.ownerDocument||window.document).defaultView,n=e.getBoundingClientRect();return mu[0]=n.left+t.pageXOffset,mu[1]=n.top+t.pageYOffset,mu}(e);return!(t&&n[0]===t[0]&&n[1]===t[1]||(this._set("position",[n[0],n[1]]),0))}},{key:"forceDOMReadyCycle",value:function(){}}]),n}(e);return(0,S._)([(0,U.Cb)({value:null,cast:function(e){return(0,te.L7)(e)}})],t.prototype,"container",null),(0,S._)([(0,U.Cb)({readOnly:!0})],t.prototype,"focused",null),(0,S._)([(0,U.Cb)({readOnly:!0})],t.prototype,"height",void 0),(0,S._)([(0,U.Cb)({type:vu})],t.prototype,"popup",null),(0,S._)([(0,U.Cb)({type:ce})],t.prototype,"overlay",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],t.prototype,"position",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],t.prototype,"resizing",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],t.prototype,"root",void 0),(0,S._)([(0,U.Cb)({value:null,readOnly:!0})],t.prototype,"size",null),(0,S._)([(0,U.Cb)({readOnly:!0})],t.prototype,"surface",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],t.prototype,"suspended",void 0),(0,S._)([(0,U.Cb)()],t.prototype,"ui",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],t.prototype,"userContent",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],t.prototype,"width",void 0),(0,S._)([(0,U.Cb)()],t.prototype,"widthBreakpoint",void 0),t=(0,S._)([(0,G.j)("esri.views.DOMContainer")],t)}(vf)));(0,S._)([(0,U.Cb)({type:Kv})],ay.prototype,"background",null),(0,S._)([(0,U.Cb)()],ay.prototype,"floors",void 0),(0,S._)([(0,U.Cb)()],ay.prototype,"graphicsView",void 0),(0,S._)([(0,U.Cb)({type:Bd})],ay.prototype,"highlightOptions",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],ay.prototype,"inputManager",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],ay.prototype,"resourceManager",null),(0,S._)([(0,U.Cb)({readOnly:!0})],ay.prototype,"textureManager",null),(0,S._)([(0,U.Cb)({readOnly:!0})],ay.prototype,"mapViewNavigation",void 0),(0,S._)([(0,U.Cb)({type:Boolean})],ay.prototype,"navigating",null),(0,S._)([(0,U.Cb)({type:Boolean,constructOnly:!0})],ay.prototype,"supersampleScreenshotsEnabled",void 0),(0,S._)([(0,U.Cb)({type:qv})],ay.prototype,"ui",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],ay.prototype,"rendering",void 0),(0,S._)([(0,U.Cb)({constructOnly:!0})],ay.prototype,"renderCanvas",void 0),(0,S._)([(0,U.Cb)({constructOnly:!0})],ay.prototype,"deactivatedWebGLExtensions",void 0),(0,S._)([(0,U.Cb)({constructOnly:!0})],ay.prototype,"debugWebGLExtensions",void 0);var sy=ay=(0,S._)([(0,G.j)("esri.views.MapView")],ay);function uy(e){var t,n,r,i,o=e.getObjectId();return o?"".concat(null!=(t=null!=(n=null==(r=e.layer)?void 0:r.uid)?n:null==(i=e.sourceLayer)?void 0:i.uid)?t:"MapView","/").concat(o):'"MapView/'.concat(e.uid)}function ly(e,t,n,r,i){return function(o){if(o instanceof E.Z){if(o.layer===e)null==i||i();else{var a=e.allLayerViews.find((function(e){return e.layer===o.layer}));a&&(null==r||r(a))}n(uy(o))}else{var s=e.allLayerViews.find((function(e){return e.layer===o}));s&&t(s)}}}function cy(e,t){if(e)if((0,D.TW)(e)){var n,r=Yv(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;if((0,D.TW)(i)){var o,a=Yv(i);try{for(a.s();!(o=a.n()).done;){t(o.value)}}catch(s){a.e(s)}finally{a.f()}}else t(i)}}catch(s){r.e(s)}finally{r.f()}}else t(e)}var py=n(16851),fy=n(80347),dy=n(9634),hy=n(80845),vy=n(16237);function yy(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function my(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yy(Object(n),!0).forEach((function(t){(0,H.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yy(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function gy(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return by(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return by(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function by(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var wy=V.Z.getLogger("esri.networks.Network"),ky=function(e){(0,M.Z)(o,e);var t,n,r,i=_y(o);function o(e){var t;return(0,k.Z)(this,o),(t=i.call(this,e)).id=null,t.title=null,t.layerUrl=null,t.dataElement=null,t.fullExtent=null,t.spatialReference=null,t.type=null,t.sourceJSON=null,t}return(0,C.Z)(o,[{key:"initialize",value:function(){var e=this;this.when().catch((function(t){var n,r;(0,gr.D_)(t)||wy.error("#load()","Failed to load layer (title: '".concat(null!=(n=e.title)?n:"no title","', id: '").concat(null!=(r=e.id)?r:"no id","')"),{error:t})}))}},{key:"datasetName",get:function(){var e;return null==(e=this.dataElement)?void 0:e.name}},{key:"owner",get:function(){var e;return null==(e=this.dataElement)?void 0:e.userIdentity}},{key:"schemaGeneration",get:function(){var e;return null==(e=this.dataElement)?void 0:e.schemaGeneration}},{key:"parsedUrl",get:function(){var e=this.layerUrl;return e?(0,Xu.mN)(e):null}},{key:"featureServiceUrl",get:function(){var e=this.parsedUrl&&(0,Pc.Qc)(this.parsedUrl.path);return(0,B.pC)(e)?e.url.path:null}},{key:"networkServiceUrl",get:function(){return this.featureServiceUrl?this.featureServiceUrl.replace(/\/FeatureServer/i,"/UtilityNetworkServer"):null}},{key:"layerId",get:function(){var e=this.parsedUrl&&(0,Pc.Qc)(this.parsedUrl.path);return(0,B.pC)(e)?e.sublayer:null}},{key:"load",value:(r=(0,O.Z)(T().mark((function e(t){return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.addResolvingPromise(this._fetchDataElement(this.featureServiceUrl,this.layerId.toString(),t)),this.addResolvingPromise(this._fetchLayerMetaData(this.layerUrl,t)),this));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"getLayerIdBySourceId",value:function(e){if(this.dataElement){var t,n=gy(this.dataElement.domainNetworks);try{for(n.s();!(t=n.n()).done;){var r,i=t.value,o=gy(i.edgeSources?i.edgeSources:[]);try{for(o.s();!(r=o.n()).done;){var a=r.value;if(a.sourceId===e)return a.layerId}}catch(c){o.e(c)}finally{o.f()}var s,u=gy(i.junctionSources?i.junctionSources:[]);try{for(u.s();!(s=u.n()).done;){var l=s.value;if(l.sourceId===e)return l.layerId}}catch(c){u.e(c)}finally{u.f()}}}catch(c){n.e(c)}finally{n.f()}return null}return null}},{key:"_fetchLayerMetaData",value:(n=(0,O.Z)(T().mark((function e(t,n){var r;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,mr.default)(t,my({responseType:"json",query:{f:"json"}},n));case 2:r=e.sent,this.sourceJSON=r.data,this.read(r.data,{origin:"service"});case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"_fetchDataElement",value:(t=(0,O.Z)(T().mark((function e(t,n,r){var i;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.dataElement){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,(0,mr.default)("".concat(t,"/queryDataElements"),my({responseType:"json",query:{layers:JSON.stringify([n]),f:"json"}},r)).then((function(e){var t;return null==(t=e.data.layerDataElements)?void 0:t[0]}));case 4:(i=e.sent)&&this.read(i,{origin:"service"});case 6:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})}]),o}((0,fy.R)(Au.Z));(0,S._)([(0,U.Cb)({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}}},read:!1}})],ky.prototype,"id",void 0),(0,S._)([(0,U.Cb)({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}}},read:!1}})],ky.prototype,"title",void 0),(0,S._)([(0,U.Cb)({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"url"},write:{target:"url",isRequired:!0}}},read:!1}})],ky.prototype,"layerUrl",void 0),(0,S._)([(0,U.Cb)({type:Object,json:{origins:{service:{read:!0}},read:!1}})],ky.prototype,"dataElement",void 0),(0,S._)([(0,U.Cb)({type:ml.Z,json:{origins:{service:{read:{source:"extent"}}},read:!1}})],ky.prototype,"fullExtent",void 0),(0,S._)([(0,U.Cb)({type:bl.Z,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:!1}})],ky.prototype,"spatialReference",void 0),(0,S._)([(0,U.Cb)({type:["utility","trace"],readOnly:!0,json:{read:!1,write:!1}})],ky.prototype,"type",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],ky.prototype,"datasetName",null),(0,S._)([(0,U.Cb)({readOnly:!0})],ky.prototype,"owner",null),(0,S._)([(0,U.Cb)({readOnly:!0})],ky.prototype,"schemaGeneration",null),(0,S._)([(0,U.Cb)({readOnly:!0})],ky.prototype,"parsedUrl",null),(0,S._)([(0,U.Cb)({readOnly:!0})],ky.prototype,"featureServiceUrl",null),(0,S._)([(0,U.Cb)({readOnly:!0})],ky.prototype,"networkServiceUrl",null),(0,S._)([(0,U.Cb)({readOnly:!0})],ky.prototype,"layerId",null),(0,S._)([(0,U.Cb)()],ky.prototype,"sourceJSON",void 0);var Cy=ky=(0,S._)([(0,G.j)("esri.networks.Network")],ky);function xy(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Zy=function(e){(0,M.Z)(n,e);var t=xy(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).conditionBarriers=[],r.outputConditions=[],r.functions=[],r.functionBarriers=[],r.traversabilityScope=null,r.shortestPathNetworkAttributeName=null,r.includeBarriers=null,r.validateConsistency=null,r.ignoreBarriersAtStartingPoints=null,r}return(0,C.Z)(n)}(Su.wq);(0,S._)([(0,U.Cb)({type:[Object],json:{write:!0}})],Zy.prototype,"conditionBarriers",void 0),(0,S._)([(0,U.Cb)({type:[Object],json:{write:!0}})],Zy.prototype,"outputConditions",void 0),(0,S._)([(0,U.Cb)({type:[Object],json:{write:!0}})],Zy.prototype,"functions",void 0),(0,S._)([(0,U.Cb)({type:[Object],json:{write:!0}})],Zy.prototype,"functionBarriers",void 0),(0,S._)([(0,U.Cb)({type:["junctions","edges","junctionsAndEdges"],json:{write:!0}})],Zy.prototype,"traversabilityScope",void 0),(0,S._)([(0,U.Cb)({type:String,json:{write:!0}})],Zy.prototype,"shortestPathNetworkAttributeName",void 0),(0,S._)([(0,U.Cb)({type:Boolean,json:{write:!0}})],Zy.prototype,"includeBarriers",void 0),(0,S._)([(0,U.Cb)({type:Boolean,json:{write:!0}})],Zy.prototype,"validateConsistency",void 0),(0,S._)([(0,U.Cb)({type:Boolean,json:{write:!0}})],Zy.prototype,"ignoreBarriersAtStartingPoints",void 0);var My=Zy=(0,S._)([(0,G.j)("esri.networks.support.TraceConfiguration")],Zy),Iy=n(16924),Ry=new Iy.Xn({connected:"connected",upstream:"upstream",downstream:"downstream",shortestPath:"shortest-path",subnetwork:"subnetwork","subnetwork controllers":"subnetwork-controllers",loops:"loops",isolation:"isolation"});function Oy(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Py=function(e){(0,M.Z)(n,e);var t=Oy(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).filterBarriers=[],r.domainNetworkName=null,r.filterBitsetNetworkAttributeName=null,r.filterFunctionBarriers=[],r.filterScope=null,r.includeContainers=null,r.includeContent=null,r.includeIsolated=null,r.includeStructures=null,r.includeUpToFirstSpatialContainer=null,r.nearestNeighbor=null,r.outputFilterCategories=[],r.outputFilters=[],r.propagators=[],r.subnetworkName=null,r.targetTierName=null,r.tierName=null,r.validateLocatability=null,r}return(0,C.Z)(n)}(My);(0,S._)([(0,U.Cb)({type:[Object],json:{write:!0}})],Py.prototype,"filterBarriers",void 0),(0,S._)([(0,U.Cb)({type:String,json:{write:!0}})],Py.prototype,"domainNetworkName",void 0),(0,S._)([(0,U.Cb)({type:String,json:{write:!0}})],Py.prototype,"filterBitsetNetworkAttributeName",void 0),(0,S._)([(0,U.Cb)({type:[Object],json:{write:!0}})],Py.prototype,"filterFunctionBarriers",void 0),(0,S._)([(0,U.Cb)({type:["junctions","edges","junctionsAndEdges"],json:{write:!0}})],Py.prototype,"filterScope",void 0),(0,S._)([(0,U.Cb)({type:Boolean,json:{write:!0}})],Py.prototype,"includeContainers",void 0),(0,S._)([(0,U.Cb)({type:Boolean,json:{write:!0}})],Py.prototype,"includeContent",void 0),(0,S._)([(0,U.Cb)({type:Boolean,json:{write:!0}})],Py.prototype,"includeIsolated",void 0),(0,S._)([(0,U.Cb)({type:Boolean,json:{write:!0}})],Py.prototype,"includeStructures",void 0),(0,S._)([(0,U.Cb)({type:Boolean,json:{write:!0}})],Py.prototype,"includeUpToFirstSpatialContainer",void 0),(0,S._)([(0,U.Cb)({type:Object,json:{write:!0}})],Py.prototype,"nearestNeighbor",void 0),(0,S._)([(0,U.Cb)({type:[Object],json:{write:!0}})],Py.prototype,"outputFilterCategories",void 0),(0,S._)([(0,U.Cb)({type:[Object],json:{write:!0}})],Py.prototype,"outputFilters",void 0),(0,S._)([(0,U.Cb)({type:[Object],json:{write:!0}})],Py.prototype,"propagators",void 0),(0,S._)([(0,U.Cb)({type:String,json:{write:!0}})],Py.prototype,"subnetworkName",void 0),(0,S._)([(0,U.Cb)({type:String,json:{write:!0}})],Py.prototype,"targetTierName",void 0),(0,S._)([(0,U.Cb)({type:String,json:{write:!0}})],Py.prototype,"tierName",void 0),(0,S._)([(0,U.Cb)({type:Boolean,json:{write:!0}})],Py.prototype,"validateLocatability",void 0);var Ty=Py=(0,S._)([(0,G.j)("esri.networks.support.UNTraceConfiguration")],Py);function Sy(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Ey=function(e){(0,M.Z)(n,e);var t=Sy(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).globalId=null,r.title=null,r.traceConfiguration=null,r.creationDate=null,r.creator=null,r.description=null,r.minStartingPoints=null,r.resultTypes=[],r.tags=[],r.traceType=null,r}return(0,C.Z)(n,[{key:"readTraceConfiguration",value:function(e,t){return void 0!==e.tierName?Ty.fromJSON(e):My.fromJSON(e)}}]),n}(fy.w);(0,S._)([(0,U.Cb)({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"id"},write:{target:"id",isRequired:!0}},service:{read:{source:"globalId"}}},read:!1}})],Ey.prototype,"globalId",void 0),(0,S._)([(0,U.Cb)({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"title"},write:{target:"title",isRequired:!0}},service:{read:{source:"name"}}},read:!1}})],Ey.prototype,"title",void 0),(0,S._)([(0,U.Cb)({type:My,json:{origins:{service:{read:!0}},read:!1}})],Ey.prototype,"traceConfiguration",void 0),(0,S._)([(0,dy.r)("service","traceConfiguration")],Ey.prototype,"readTraceConfiguration",null),(0,S._)([(0,U.Cb)({type:Date,json:{origins:{service:{read:!0}},read:!1}})],Ey.prototype,"creationDate",void 0),(0,S._)([(0,U.Cb)({type:String,json:{origins:{service:{read:!0}},read:!1}})],Ey.prototype,"creator",void 0),(0,S._)([(0,U.Cb)({type:String,json:{origins:{service:{read:!0}},read:!1}})],Ey.prototype,"description",void 0),(0,S._)([(0,U.Cb)({type:["none","one","many"],json:{origins:{service:{read:{source:"minNumStartingPoints"}}},read:!1}})],Ey.prototype,"minStartingPoints",void 0),(0,S._)([(0,U.Cb)({type:[Object],json:{origins:{service:{read:!0}},read:!1}})],Ey.prototype,"resultTypes",void 0),(0,S._)([(0,U.Cb)({type:[String],json:{origins:{service:{read:!0}},read:!1}})],Ey.prototype,"tags",void 0),(0,S._)([(0,U.Cb)({type:Ry.apiValues,json:{type:Ry.jsonValues,origins:{service:{read:Ry.read}},read:!1}})],Ey.prototype,"traceType",void 0);var Ay=Ey=(0,S._)([(0,G.j)("esri.networks.support.NamedTraceConfiguration")],Ey);function jy(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Fy=function(e){(0,M.Z)(n,e);var t=jy(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).id=null,r.name=null,r}return(0,C.Z)(n)}(Su.wq);(0,S._)([(0,U.Cb)({type:Number,json:{read:{source:"terminalId"},write:{target:"terminalId"}}})],Fy.prototype,"id",void 0),(0,S._)([(0,U.Cb)({type:String,json:{read:{source:"terminalName"},write:{target:"terminalName"}}})],Fy.prototype,"name",void 0),(0,S._)([(0,U.Cb)({type:Boolean,json:{write:!0}})],Fy.prototype,"isUpstreamTerminal",void 0);var Ly=Fy=(0,S._)([(0,G.j)("esri.networks.support.Terminal")],Fy);function Dy(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Vy=new Iy.Xn({esriUNTMBidirectional:"bidirectional",esriUNTMDirectional:"directional"}),By=function(e){(0,M.Z)(n,e);var t=Dy(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).defaultConfiguration=null,r.id=null,r.name=null,r.terminals=[],r.traversabilityModel=null,r}return(0,C.Z)(n)}(Su.wq);(0,S._)([(0,U.Cb)({type:String,json:{write:!0}})],By.prototype,"defaultConfiguration",void 0),(0,S._)([(0,U.Cb)({type:Number,json:{read:{source:"terminalConfigurationId"},write:{target:"terminalConfigurationId"}}})],By.prototype,"id",void 0),(0,S._)([(0,U.Cb)({type:String,json:{read:{source:"terminalConfigurationName"},write:{target:"terminalConfigurationName"}}})],By.prototype,"name",void 0),(0,S._)([(0,U.Cb)({type:[Ly],json:{write:!0}})],By.prototype,"terminals",void 0),(0,S._)([(0,U.Cb)({type:Vy.apiValues,json:{type:Vy.jsonValues,read:Vy.read,write:Vy.write}})],By.prototype,"traversabilityModel",void 0);var Ny=By=(0,S._)([(0,G.j)("esri.networks.support.TerminalConfiguration")],By);function zy(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Uy(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Wy(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Wy(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Wy(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function qy(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Gy=function(e){(0,M.Z)(i,e);var t,n,r=qy(i);function i(e){var t;return(0,k.Z)(this,i),(t=r.call(this,e)).sharedNamedTraceConfigurations=[],t.type="utility",t}return(0,C.Z)(i,[{key:"serviceTerritoryFeatureLayerId",get:function(){var e;return null==(e=this.dataElement)?void 0:e.serviceTerritoryFeatureLayerId}},{key:"rulesTableId",get:function(){var e;return null==(e=this.sourceJSON)?void 0:e.systemLayers.rulesTableId}},{key:"rulesTableUrl",get:function(){return this.sourceJSON?"".concat(this.featureServiceUrl,"/").concat(this.rulesTableId):null}},{key:"terminalConfigurations",get:function(){var e;return(null==(e=this.dataElement)?void 0:e.terminalConfigurations.map((function(e){return Ny.fromJSON(e)})))||[]}},{key:"domainNetworkNames",get:function(){var e;return(null==(e=this.dataElement)?void 0:e.domainNetworks.map((function(e){return e.domainNetworkName})))||[]}},{key:"load",value:(n=(0,O.Z)(T().mark((function e(t){return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.addResolvingPromise((0,Z.Z)((0,R.Z)(i.prototype),"load",this).call(this,t)),this.addResolvingPromise(this._loadNamedTraceConfigurationsFromNetwork(t)),this));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getTerminalConfiguration",value:function(e){var t,n=null,r=null,i=e.layer;if("feature"!==(null==i?void 0:i.type))return null;if(null===(t=i.layerId))return null;var o=e.attributes;if(null==o)return null;for(var a=0,s=Object.keys(o);a<s.length;a++){var u=s[a];"ASSETGROUP"===u.toUpperCase()&&(n=e.getAttribute(u)),"ASSETTYPE"===u.toUpperCase()&&(r=e.getAttribute(u))}if(!this.dataElement)return null;var l,c=null,p=Uy(this.dataElement.domainNetworks);try{for(p.s();!(l=p.n()).done;){var f,d=null==(f=l.value.junctionSources)?void 0:f.find((function(e){return e.layerId===t}));if(d){var h,v=null==(h=d.assetGroups)?void 0:h.find((function(e){return e.assetGroupCode===n}));if(v){var y,m=null==(y=v.assetTypes)?void 0:y.find((function(e){return e.assetTypeCode===r}));if(m){c=m.terminalConfigurationId;break}}}}}catch(_){p.e(_)}finally{p.f()}if(null!=c){var g=this.dataElement.terminalConfigurations,b=null==g?void 0:g.find((function(e){return e.terminalConfigurationId===c}));return b?Ny.fromJSON(b):null}return null}},{key:"getTierNames",value:function(e){var t,n=null==(t=this.dataElement)?void 0:t.domainNetworks.find((function(t){return t.domainNetworkName===e}));return(null==n?void 0:n.tiers.map((function(e){return e.name})))||[]}},{key:"_loadNamedTraceConfigurationsFromNetwork",value:(t=(0,O.Z)(T().mark((function e(t){var n,r,i,o,a,s;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(null==(n=this.sharedNamedTraceConfigurations)?void 0:n.length)){e.next=2;break}return e.abrupt("return");case 2:return r=this.sharedNamedTraceConfigurations.map((function(e){return e.globalId})),e.next=5,this._fetchTraceConfigData(this.networkServiceUrl,r,t);case 5:i=e.sent,o=Uy(this.sharedNamedTraceConfigurations);try{for(s=function(){var e=a.value,t=null==i?void 0:i.find((function(t){return t.globalId===e.globalId}));t&&e.read(t,{origin:"service"})},o.s();!(a=o.n()).done;)s()}catch(u){o.e(u)}finally{o.f()}case 8:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_fetchTraceConfigData",value:function(e,t,n){return(0,mr.default)("".concat(e,"/traceConfigurations/query"),function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?zy(Object(n),!0).forEach((function(t){(0,H.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zy(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({responseType:"json",query:{globalIds:JSON.stringify(t),f:"json"}},n)).then((function(e){return e.data.traceConfigurations}))}}]),i}(Cy);(0,S._)([(0,U.Cb)({type:[Ay],json:{origins:{"web-map":{read:{source:"traceConfigurations"},write:{target:"traceConfigurations"}},service:{read:{source:"traceConfigurations"}}},read:!1}})],Gy.prototype,"sharedNamedTraceConfigurations",void 0),(0,S._)([(0,U.Cb)({type:["utility"],readOnly:!0,json:{read:!1,write:!1}})],Gy.prototype,"type",void 0),(0,S._)([(0,U.Cb)({readOnly:!0})],Gy.prototype,"serviceTerritoryFeatureLayerId",null),(0,S._)([(0,U.Cb)({readOnly:!0})],Gy.prototype,"rulesTableId",null),(0,S._)([(0,U.Cb)({readOnly:!0})],Gy.prototype,"rulesTableUrl",null),(0,S._)([(0,U.Cb)({readOnly:!0})],Gy.prototype,"terminalConfigurations",null),(0,S._)([(0,U.Cb)({readOnly:!0})],Gy.prototype,"domainNetworkNames",null);var Hy=Gy=(0,S._)([(0,G.j)("esri.networks.UtilityNetwork")],Gy),Ky=n(51939),Yy=n(87654),Jy=n(93644),$y=n(13741),Qy=n(60986);function Xy(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var em=function(e){(0,M.Z)(n,e);var t=Xy(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).facilityIdField=null,r.layerId=null,r.nameField=null,r.siteIdField=null,r.sublayerId=null,r}return(0,C.Z)(n)}(Su.wq);(0,S._)([(0,U.Cb)({type:String,json:{write:!0}})],em.prototype,"facilityIdField",void 0),(0,S._)([(0,U.Cb)({type:String,json:{write:!0}})],em.prototype,"layerId",void 0),(0,S._)([(0,U.Cb)({type:String,json:{write:!0}})],em.prototype,"nameField",void 0),(0,S._)([(0,U.Cb)({type:String,json:{write:!0}})],em.prototype,"siteIdField",void 0),(0,S._)([(0,U.Cb)({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],em.prototype,"sublayerId",void 0);var tm=em=(0,S._)([(0,G.j)("esri.layers.support.FacilityLayerInfo")],em);function nm(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var rm=function(e){(0,M.Z)(n,e);var t=nm(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).facilityIdField=null,r.layerId=null,r.levelIdField=null,r.levelNumberField=null,r.longNameField=null,r.shortNameField=null,r.sublayerId=null,r.verticalOrderField=null,r}return(0,C.Z)(n)}(Su.wq);(0,S._)([(0,U.Cb)({type:String,json:{write:!0}})],rm.prototype,"facilityIdField",void 0),(0,S._)([(0,U.Cb)({type:String,json:{write:!0}})],rm.prototype,"layerId",void 0),(0,S._)([(0,U.Cb)({type:String,json:{write:!0}})],rm.prototype,"levelIdField",void 0),(0,S._)([(0,U.Cb)({type:String,json:{write:!0}})],rm.prototype,"levelNumberField",void 0),(0,S._)([(0,U.Cb)({type:String,json:{write:!0}})],rm.prototype,"longNameField",void 0),(0,S._)([(0,U.Cb)({type:String,json:{write:!0}})],rm.prototype,"shortNameField",void 0),(0,S._)([(0,U.Cb)({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],rm.prototype,"sublayerId",void 0),(0,S._)([(0,U.Cb)({type:String,json:{write:!0}})],rm.prototype,"verticalOrderField",void 0);var im=rm=(0,S._)([(0,G.j)("esri.layers.support.LevelLayerInfo")],rm);function om(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var am=function(e){(0,M.Z)(n,e);var t=om(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).layerId=null,r.nameField=null,r.siteIdField=null,r.sublayerId=null,r}return(0,C.Z)(n)}(Su.wq);(0,S._)([(0,U.Cb)({type:String,json:{write:!0}})],am.prototype,"layerId",void 0),(0,S._)([(0,U.Cb)({type:String,json:{write:!0}})],am.prototype,"nameField",void 0),(0,S._)([(0,U.Cb)({type:String,json:{write:!0}})],am.prototype,"siteIdField",void 0),(0,S._)([(0,U.Cb)({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],am.prototype,"sublayerId",void 0);var sm=am=(0,S._)([(0,G.j)("esri.layers.support.SiteLayerInfo")],am);function um(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var lm=function(e){(0,M.Z)(n,e);var t=um(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).levelLayer=null,r.facilityLayer=null,r.siteLayer=null,r}return(0,C.Z)(n)}(Su.wq);(0,S._)([(0,U.Cb)({type:im,json:{write:!0}})],lm.prototype,"levelLayer",void 0),(0,S._)([(0,U.Cb)({type:tm,json:{write:!0}})],lm.prototype,"facilityLayer",void 0),(0,S._)([(0,U.Cb)({type:sm,json:{write:!0}})],lm.prototype,"siteLayer",void 0);var cm,pm=lm=(0,S._)([(0,G.j)("esri.support.MapFloorInfo")],lm);function fm(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var dm=cm=function(e){(0,M.Z)(n,e);var t=fm(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).activeRange=null,r.currentRangeExtent=null,r.fullRangeExtent=null,r}return(0,C.Z)(n,[{key:"clone",value:function(){return new cm((0,Eu.d9)({activeRange:this.activeRange,currentRangeExtent:this.currentRangeExtent,fullRangeExtent:this.fullRangeExtent}))}}]),n}(Su.wq);(0,S._)([(0,U.Cb)({type:String,nonNullable:!0,json:{read:{source:"activeRangeName"},write:{target:"activeRangeName",isRequired:!0}}})],dm.prototype,"activeRange",void 0),(0,S._)([(0,U.Cb)({type:[Number],json:{write:!0}})],dm.prototype,"currentRangeExtent",void 0),(0,S._)([(0,U.Cb)({type:[Number],json:{write:!0}})],dm.prototype,"fullRangeExtent",void 0);var hm,vm=dm=cm=(0,S._)([(0,G.j)("esri.webdoc.RangeInfo")],dm);function ym(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var mm=hm=function(e){(0,M.Z)(n,e);var t=ym(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).enabled=!1,r.longNames=!1,r.minimized=!1,r.pinnedLevels=!1,r.site=null,r.facility=null,r.level=null,r}return(0,C.Z)(n,[{key:"clone",value:function(){return new hm((0,Eu.d9)({enabled:this.enabled,longNames:this.longNames,minimized:this.minimized,pinnedLevels:this.pinnedLevels,site:this.site,facility:this.facility,level:this.level}))}}]),n}(Su.wq);(0,S._)([(0,U.Cb)({type:Boolean,json:{read:{source:"enabled"},write:{target:"enabled"}}})],mm.prototype,"enabled",void 0),(0,S._)([(0,U.Cb)({type:Boolean,json:{read:{source:"longNames"},write:{target:"longNames"}}})],mm.prototype,"longNames",void 0),(0,S._)([(0,U.Cb)({type:Boolean,json:{read:{source:"minimized"},write:{target:"minimized"}}})],mm.prototype,"minimized",void 0),(0,S._)([(0,U.Cb)({type:Boolean,json:{read:{source:"pinnedLevels"},write:{target:"pinnedLevels"}}})],mm.prototype,"pinnedLevels",void 0),(0,S._)([(0,U.Cb)({type:String,json:{read:{source:"site"},write:{target:"site"}}})],mm.prototype,"site",void 0),(0,S._)([(0,U.Cb)({type:String,json:{read:{source:"facility"},write:{target:"facility"}}})],mm.prototype,"facility",void 0),(0,S._)([(0,U.Cb)({type:String,json:{read:{source:"level"},write:{target:"level"}}})],mm.prototype,"level",void 0);var gm,bm=mm=hm=(0,S._)([(0,G.j)("esri.webdoc.widgets.FloorFilter")],mm);function _m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var wm=new Iy.Xn({slider:"slider",picker:"picker"}),km=gm=function(e){(0,M.Z)(n,e);var t=_m(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).interactionMode=null,r.numStops=null,r.stopInterval=null,r}return(0,C.Z)(n,[{key:"clone",value:function(){return new gm({interactionMode:this.interactionMode,numStops:this.numStops,stopInterval:this.stopInterval})}}]),n}(Su.wq);(0,S._)([(0,U.Cb)({type:wm.apiValues,nonNullable:!0,json:{type:wm.jsonValues,default:null,read:{reader:wm.read},write:{isRequired:!0,writer:wm.write}}})],km.prototype,"interactionMode",void 0),(0,S._)([(0,U.Cb)({type:Number,json:{read:{source:"numberOfStops"},write:{target:"numberOfStops",overridePolicy:function(){var e=null!=this.stopInterval;return{enabled:!e,isRequired:!e}}}}})],km.prototype,"numStops",void 0),(0,S._)([(0,U.Cb)({type:Number,json:{write:{overridePolicy:function(){return{isRequired:null==this.numStops}}}}})],km.prototype,"stopInterval",void 0);var Cm,xm=km=gm=(0,S._)([(0,G.j)("esri.webdoc.widgets.Range")],km),Zm=n(99745),Mm=n(34582);function Im(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Rm=Cm=function(e){(0,M.Z)(n,e);var t=Im(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).currentTimeExtent=null,r.fullTimeExtent=null,r.loop=!1,r.numStops=null,r.numThumbs=null,r.stopDelay=null,r.stopInterval=null,r.stops=null,r}return(0,C.Z)(n,[{key:"readCurrentTimeExtent",value:function(e){if(e){var t=null!=e[0]?new Date(e[0]):null,n=null!=e[1]?new Date(e[1]):null;return new fl.Z({start:t,end:n})}}},{key:"writeCurrentTimeExtent",value:function(e,t,n){e&&(0,Mm.RB)(n,[(0,B.pC)(e.start)?e.start.getTime():null,(0,B.pC)(e.end)?e.end.getTime():null],t)}},{key:"readFullTimeExtent",value:function(e,t){var n=t.properties;if(n){var r=null!=n.endTime?new Date(n.endTime):null,i=null!=n.startTime?new Date(n.startTime):null;return new fl.Z({start:i,end:r})}}},{key:"writeFullTimeExtent",value:function(e,t){if(e){var n=t.properties=t.properties||{},r=e.end,i=e.start;r&&(n.endTime=(0,B.pC)(r)?r.getTime():null),i&&(n.startTime=(0,B.pC)(i)?i.getTime():null)}}},{key:"readStopInterval",value:function(e,t,n){return e?Zm.Z.fromJSON({value:e.interval,unit:e.units},n):null}},{key:"writeStopInterval",value:function(e,t,n,r){if(e){var i=e.toJSON(r);(0,Mm.RB)(n,{interval:i.value,units:i.unit},t)}}},{key:"readStops",value:function(e){return e&&e.length?e.map((function(e){return new Date(e)})):null}},{key:"writeStops",value:function(e,t,n){e&&e.length&&(0,Mm.RB)(n,e.map((function(e){return e.getTime()})),t)}},{key:"clone",value:function(){return new Cm((0,Eu.d9)({currentTimeExtent:this.currentTimeExtent,fullTimeExtent:this.fullTimeExtent,loop:this.loop,numStops:this.numStops,numThumbs:this.numThumbs,stopDelay:this.stopDelay,stopInterval:this.stopInterval,stops:this.stops}))}}]),n}(Su.wq);(0,S._)([(0,U.Cb)({type:fl.Z,json:{read:{source:"properties.currentTimeExtent"},write:{target:"properties.currentTimeExtent"}}})],Rm.prototype,"currentTimeExtent",void 0),(0,S._)([(0,dy.r)("currentTimeExtent")],Rm.prototype,"readCurrentTimeExtent",null),(0,S._)([(0,Fu.c)("currentTimeExtent")],Rm.prototype,"writeCurrentTimeExtent",null),(0,S._)([(0,U.Cb)({type:fl.Z,json:{read:{source:["properties.endTime","properties.startTime"]},write:{target:{"properties.endTime":{type:Number},"properties.startTime":{type:Number}}}}})],Rm.prototype,"fullTimeExtent",void 0),(0,S._)([(0,dy.r)("fullTimeExtent")],Rm.prototype,"readFullTimeExtent",null),(0,S._)([(0,Fu.c)("fullTimeExtent")],Rm.prototype,"writeFullTimeExtent",null),(0,S._)([(0,U.Cb)({type:Boolean,nonNullable:!0,json:{default:!1,read:{source:"properties.loop"},write:{target:"properties.loop"}}})],Rm.prototype,"loop",void 0),(0,S._)([(0,U.Cb)({type:Number,json:{read:{source:"properties.numberOfStops"},write:{target:"properties.numberOfStops",overridePolicy:function(){var e,t=!!this.stopInterval,n=!(null==(e=this.stops)||!e.length),r=!(t||n);return{enabled:r,isRequired:r}}}}})],Rm.prototype,"numStops",void 0),(0,S._)([(0,U.Cb)({type:[1,2],nonNullable:!0,json:{read:{source:"properties.thumbCount"},write:{target:"properties.thumbCount",isRequired:!0}}})],Rm.prototype,"numThumbs",void 0),(0,S._)([(0,U.Cb)({type:Number,nonNullable:!0,json:{read:{source:"properties.thumbMovingRate"},write:{target:"properties.thumbMovingRate",isRequired:!0}}})],Rm.prototype,"stopDelay",void 0),(0,S._)([(0,U.Cb)({type:Zm.Z,json:{read:{source:"properties.timeStopInterval"},write:{target:"properties.timeStopInterval",overridePolicy:function(){var e,t=null!=this.numStops,n=!(null==(e=this.stops)||!e.length);return{enabled:!n,isRequired:!(t||n)}}}}})],Rm.prototype,"stopInterval",void 0),(0,S._)([(0,dy.r)("stopInterval")],Rm.prototype,"readStopInterval",null),(0,S._)([(0,Fu.c)("stopInterval")],Rm.prototype,"writeStopInterval",null),(0,S._)([(0,U.Cb)({type:[Date],json:{read:{source:"properties.stops"},write:{target:"properties.stops",overridePolicy:function(){return{isRequired:null==this.numStops&&!this.stopInterval}}}}})],Rm.prototype,"stops",void 0),(0,S._)([(0,dy.r)("stops")],Rm.prototype,"readStops",null),(0,S._)([(0,Fu.c)("stops")],Rm.prototype,"writeStops",null);var Om,Pm=Rm=Cm=(0,S._)([(0,G.j)("esri.webdoc.widgets.TimeSlider")],Rm);function Tm(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Sm=Om=function(e){(0,M.Z)(n,e);var t=Tm(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).range=null,r.timeSlider=null,r.floorFilter=null,r}return(0,C.Z)(n,[{key:"clone",value:function(){return new Om((0,Eu.d9)({range:this.range,timeSlider:this.timeSlider,floorFilter:this.floorFilter}))}}]),n}(Su.wq);(0,S._)([(0,U.Cb)({type:xm,json:{write:!0}})],Sm.prototype,"range",void 0),(0,S._)([(0,U.Cb)({type:Pm,json:{write:!0}})],Sm.prototype,"timeSlider",void 0),(0,S._)([(0,U.Cb)({type:bm,json:{write:!0}})],Sm.prototype,"floorFilter",void 0);var Em=Sm=Om=(0,S._)([(0,G.j)("esri.webdoc.Widgets")],Sm),Am={width:600,height:400},jm=1.5;function Fm(e,t){var n=t=t||Am,r=n.width,i=n.height,o=r/i;return o<jm?i=r/jm:o>jm&&(r=i*jm),r>e.width&&(i*=e.width/r,r=e.width),i>e.height&&(r*=e.height/i,i=e.height),{width:Math.round(r),height:Math.round(i)}}var Lm=n(5881);function Dm(e){return{enabled:!(null==e||!e.length)}}var Vm,Bm=n(70308);function Nm(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var zm=Vm=function(e){(0,M.Z)(n,e);var t=Nm(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).exactMatch=!1,r.name=null,r.type=null,r}return(0,C.Z)(n,[{key:"clone",value:function(){return new Vm({exactMatch:this.exactMatch,type:this.type,name:this.name})}}]),n}(Su.wq);(0,S._)([(0,U.Cb)({type:Boolean,json:{write:!0}})],zm.prototype,"exactMatch",void 0),(0,S._)([(0,U.Cb)({type:String,json:{write:!0}})],zm.prototype,"name",void 0),(0,S._)([(0,Lu.J)(Bm.v)],zm.prototype,"type",void 0);var Um,Wm=zm=Vm=(0,S._)([(0,G.j)("esri.webdoc.applicationProperties.SearchLayerField")],zm);function qm(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Gm=Um=function(e){(0,M.Z)(n,e);var t=qm(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).field=null,r.id=null,r.subLayer=null,r}return(0,C.Z)(n,[{key:"clone",value:function(){return new Um((0,Eu.d9)({field:this.field,id:this.id,subLayer:this.subLayer}))}}]),n}(Su.wq);(0,S._)([(0,U.Cb)({type:Wm,json:{write:{isRequired:!0}}})],Gm.prototype,"field",void 0),(0,S._)([(0,U.Cb)({type:String,json:{write:{isRequired:!0}}})],Gm.prototype,"id",void 0),(0,S._)([(0,U.Cb)({type:q.z8,json:{write:!0}})],Gm.prototype,"subLayer",void 0);var Hm,Km=Gm=Um=(0,S._)([(0,G.j)("esri.webdoc.applicationProperties.SearchLayer")],Gm);function Ym(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Jm=Hm=function(e){(0,M.Z)(n,e);var t=Ym(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).exactMatch=!1,r.name=null,r.type=null,r}return(0,C.Z)(n,[{key:"clone",value:function(){return new Hm({exactMatch:this.exactMatch,type:this.type,name:this.name})}}]),n}(Su.wq);(0,S._)([(0,U.Cb)({type:Boolean,json:{write:!0}})],Jm.prototype,"exactMatch",void 0),(0,S._)([(0,U.Cb)({type:String,json:{write:!0}})],Jm.prototype,"name",void 0),(0,S._)([(0,Lu.J)(Bm.v)],Jm.prototype,"type",void 0);var $m,Qm=Jm=Hm=(0,S._)([(0,G.j)("esri.webdoc.applicationProperties.SearchTableField")],Jm);function Xm(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var eg=$m=function(e){(0,M.Z)(n,e);var t=Xm(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).field=null,r.id=null,r}return(0,C.Z)(n,[{key:"clone",value:function(){return new $m((0,Eu.d9)({field:this.field,id:this.id}))}}]),n}(Su.wq);(0,S._)([(0,U.Cb)({type:Qm,json:{write:{isRequired:!0}}})],eg.prototype,"field",void 0),(0,S._)([(0,U.Cb)({type:String,json:{write:{isRequired:!0}}})],eg.prototype,"id",void 0);var tg,ng=eg=$m=(0,S._)([(0,G.j)("esri.webdoc.applicationProperties.SearchTable")],eg);function rg(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var ig=A.Z.ofType(Km),og=A.Z.ofType(ng),ag=tg=function(e){(0,M.Z)(n,e);var t=rg(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).addressSearchEnabled=!0,r.enabled=!0,r.hintText=null,r.layers=new ig,r.tables=new og,r}return(0,C.Z)(n,[{key:"readAddressSearchEnabled",value:function(e){return!e}},{key:"writeAddressSearchEnabled",value:function(e,t,n){t[n]=!e}},{key:"clone",value:function(){return new tg((0,Eu.d9)({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers,tables:this.tables}))}}]),n}(Su.wq);(0,S._)([(0,U.Cb)({type:Boolean,nonNullable:!0,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder",isRequired:!0},origins:{"web-scene":{read:!1,write:!1}}}})],ag.prototype,"addressSearchEnabled",void 0),(0,S._)([(0,dy.r)("addressSearchEnabled")],ag.prototype,"readAddressSearchEnabled",null),(0,S._)([(0,Fu.c)("addressSearchEnabled")],ag.prototype,"writeAddressSearchEnabled",null),(0,S._)([(0,U.Cb)({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-map":{write:{isRequired:!0}},"web-scene":{default:!0,write:!0}}}})],ag.prototype,"enabled",void 0),(0,S._)([(0,U.Cb)({type:String,json:{write:!0}})],ag.prototype,"hintText",void 0),(0,S._)([(0,U.Cb)({type:ig,json:{write:{overridePolicy:Dm},origins:{"web-scene":{write:{isRequired:!0}}}}})],ag.prototype,"layers",void 0),(0,S._)([(0,U.Cb)({type:og,json:{read:!0,write:{overridePolicy:Dm}}})],ag.prototype,"tables",void 0);var sg,ug=ag=tg=(0,S._)([(0,G.j)("esri.webdoc.applicationProperties.Search")],ag);function lg(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var cg=sg=function(e){(0,M.Z)(n,e);var t=lg(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).search=null,r}return(0,C.Z)(n,[{key:"clone",value:function(){return new sg((0,Eu.d9)({search:this.search}))}}]),n}(Su.wq);(0,S._)([(0,U.Cb)({type:ug,json:{write:!0}})],cg.prototype,"search",void 0);var pg,fg=cg=sg=(0,S._)([(0,G.j)("esri.webdoc.applicationProperties.Viewing")],cg);function dg(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var hg=pg=function(e){(0,M.Z)(n,e);var t=dg(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).editing=null,r.offline=null,r.viewing=null,r}return(0,C.Z)(n,[{key:"clone",value:function(){return new pg((0,Eu.d9)({editing:this.editing,offline:this.offline,viewing:this.viewing}))}}]),n}(Su.wq);(0,S._)([(0,U.Cb)({json:{write:!0}})],hg.prototype,"editing",void 0),(0,S._)([(0,U.Cb)({json:{write:!0}})],hg.prototype,"offline",void 0),(0,S._)([(0,U.Cb)({type:fg,json:{write:!0}})],hg.prototype,"viewing",void 0);var vg,yg=hg=pg=(0,S._)([(0,G.j)("esri.webmap.ApplicationProperties")],hg),mg=n(58687),gg=n(70978);function bg(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var _g=vg=function(e){(0,M.Z)(n,e);var t=bg(n);function n(){var e;return(0,k.Z)(this,n),(e=t.apply(this,arguments)).url="",e}return(0,C.Z)(n,[{key:"destroy",value:function(){this.url=""}},{key:"clone",value:function(){return new vg({url:this.url})}}]),n}(Su.wq);(0,S._)([(0,U.Cb)({type:String,json:{write:{isRequired:!0}}})],_g.prototype,"url",void 0);var wg,kg=_g=vg=(0,S._)([(0,G.j)("esri.webdoc.support.Thumbnail")],_g);function Cg(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var xg="esri.webmap.Bookmark",Zg=V.Z.getLogger(xg),Mg=wg=function(e){(0,M.Z)(n,e);var t=Cg(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).name=null,r.thumbnail=new kg,r.timeExtent=null,r}return(0,C.Z)(n,[{key:"extent",set:function(e){(0,mg.Mr)(Zg,"extent",{replacement:"viewpoint",version:"4.17"}),this._set("viewpoint",new wu.Z({targetGeometry:e.clone()})),this._set("extent",e)}},{key:"castThumbnail",value:function(e){return"string"==typeof e?new kg({url:e}):(0,q.se)(kg,e)}},{key:"viewpoint",set:function(e){var t=e.targetGeometry,n=e.scale;(0,B.pC)(t)&&("extent"===t.type?this._set("extent",t.clone()):"point"===t.type&&(0,B.Wi)(n)&&Zg.warn("Bookmark.viewpoint should include 'scale' when its targetGeometry is a point.",e)),this._set("viewpoint",e)}},{key:"readViewpoint",value:function(e,t){var n=t.extent,r=t.viewpoint;return wu.Z.fromJSON(r||{targetGeometry:n})}},{key:"writeViewpoint",value:function(e,t,n,r){if(e){var i=e.targetGeometry;if((0,B.pC)(i)&&"extent"!==i.type){var o="Bookmark.viewpoint cannot be written to JSON when the viewpoint's targetGeometry is not an extent.";null!=r&&r.messages?r.messages.push(new F.Z("property:unsupported",o)):Zg.error(o)}else t[n]=e.toJSON()}}},{key:"clone",value:function(){return new wg((0,Eu.d9)({name:this.name,thumbnail:this.thumbnail,timeExtent:this.timeExtent,viewpoint:this.viewpoint}))}}]),n}((0,gg.I)(Su.wq));(0,S._)([(0,U.Cb)({type:ml.Z,nonNullable:!0,json:{read:!1,write:{isRequired:!0}}})],Mg.prototype,"extent",null),(0,S._)([(0,U.Cb)({type:String,nonNullable:!0,json:{write:{isRequired:!0}}})],Mg.prototype,"name",void 0),(0,S._)([(0,U.Cb)({type:kg,json:{write:{overridePolicy:function(e){return{enabled:!(!e||!e.url)}}}}})],Mg.prototype,"thumbnail",void 0),(0,S._)([(0,he.p)("thumbnail")],Mg.prototype,"castThumbnail",null),(0,S._)([(0,U.Cb)({type:fl.Z,json:{write:!0}})],Mg.prototype,"timeExtent",void 0),(0,S._)([(0,U.Cb)({type:wu.Z,nonNullable:!0,json:{write:!0}})],Mg.prototype,"viewpoint",null),(0,S._)([(0,dy.r)("viewpoint",["extent","viewpoint"])],Mg.prototype,"readViewpoint",null),(0,S._)([(0,Fu.c)("viewpoint")],Mg.prototype,"writeViewpoint",null);var Ig,Rg=Mg=wg=(0,S._)([(0,G.j)(xg)],Mg);function Og(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Pg=Ig=function(e){(0,M.Z)(n,e);var t=Og(n);function n(e){var r;return(0,k.Z)(this,n),(r=t.call(this,e)).background=null,r.rangeInfo=null,r.spatialReference=null,r.viewpoint=null,r}return(0,C.Z)(n,[{key:"clone",value:function(){return new Ig((0,Eu.d9)({background:this.background,rangeInfo:this.rangeInfo,spatialReference:this.spatialReference,viewpoint:this.viewpoint}))}}]),n}(re.Z);(0,S._)([(0,U.Cb)({type:Kv})],Pg.prototype,"background",void 0),(0,S._)([(0,U.Cb)({type:vm})],Pg.prototype,"rangeInfo",void 0),(0,S._)([(0,U.Cb)({type:bl.Z})],Pg.prototype,"spatialReference",void 0),(0,S._)([(0,U.Cb)({type:wu.Z})],Pg.prototype,"viewpoint",void 0);var Tg=Pg=Ig=(0,S._)([(0,G.j)("esri.webmap.InitialViewProperties")],Pg);function Sg(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Eg=function(e){(0,M.Z)(n,e);var t=Sg(n);function n(e,r){return(0,k.Z)(this,n),t.call(this,e,r,"webmap")}return(0,C.Z)(n)}(n(15552).G);function Ag(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return jg(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return jg(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function jg(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Fg(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Lg(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fg(Object(n),!0).forEach((function(t){(0,H.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fg(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Dg(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,R.Z)(e);if(t){var i=(0,R.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,I.Z)(this,n)}}var Vg=new Eg(2,23),Bg="Web Map",Ng=A.Z.ofType(Rg),zg=A.Z.ofType(Hy),Ug=V.Z.getLogger("esri.WebMap"),Wg=new Map;Wg.set("image/jpeg","jpeg"),Wg.set("image/jpg","jpg"),Wg.set("image/png","png"),Wg.set("image/gif","gif");var qg="ArcGIS API for JavaScript",Gg="CollectorDisabled",Hg="Collector",Kg="Data Editing",Yg="OfflineDisabled",Jg="Offline",$g="Workforce Project",Qg="Workforce Worker",Xg="Workforce Dispatcher",eb="DeveloperBasemap",tb=["NatGeo_World_Map","Ocean_Basemap","USA_Topo_Maps","World_Imagery","World_Street_Map","World_Terrain_Base","World_Topo_Map","World_Hillshade","Canvas/World_Light_Gray_Base","Canvas/World_Light_Gray_Reference","Canvas/World_Dark_Gray_Base","Canvas/World_Dark_Gray_Reference","Ocean/World_Ocean_Base","Ocean/World_Ocean_Reference","Reference/World_Boundaries_and_Places","Reference/World_Reference_Overlay","Reference/World_Transportation"].map((function(e){return e.toLowerCase()})),nb=function(e){(0,M.Z)(_,e);var t,r,i,o,a,s,u,l,c,p,f,d,h,v,y,m,g,b=Dg(_);function _(e){var t;return(0,k.Z)(this,_),(t=b.call(this,e)).applicationProperties=null,t.bookmarks=new Ng,t.floorInfo=null,t.initialViewProperties=new Tg,t.portalItem=null,t.presentation=null,t.sourceVersion=null,t.widgets=null,t.utilityNetworks=null,t.authoringApp=t.authoringAppVersion=null,t._isAuthoringAppSetByUser=t._isAuthoringAppVersionSetByUser=!1,t}return(0,C.Z)(_,[{key:"destroy",value:function(){var e=this.portalItem;this.portalItem=null,null==e||e.destroy()}},{key:"initialize",value:function(){if(this.when().catch((function(e){Ug.error("#load()","Failed to load web map",e)})),this.resourceInfo){var e;try{e=this._validateJSON(this.resourceInfo)}catch(t){return void this.addResolvingPromise(Promise.reject(t))}this.read(e)}}},{key:"authoringApp",set:function(e){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",e)}},{key:"writeAuthoringApp",value:function(e,t){e&&this._isAuthoringAppSetByUser?t.authoringApp=e:t.authoringApp=qg}},{key:"authoringAppVersion",set:function(e){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",e)}},{key:"writeAuthoringAppVersion",value:function(e,t){e&&this._isAuthoringAppVersionSetByUser?t.authoringAppVersion=e:t.authoringAppVersion=py.i8}},{key:"readInitialViewProperties",value:function(e,t){var n,r=new Tg;t.background&&(r.background=Kv.fromJSON(t.background));var i=null==(n=t.initialState)?void 0:n.viewpoint;return i&&(i.rotation&&Eg.parse(t.version||"","webmap").lessThan(2,20)&&"ArcGIS Pro"===t.authoringApp&&(i.rotation*=-1),r.viewpoint=wu.Z.fromJSON(i)),t.mapRangeInfo&&(r.rangeInfo=vm.fromJSON(t.mapRangeInfo)),t.spatialReference&&(r.spatialReference=bl.Z.fromJSON(t.spatialReference)),r}},{key:"writeInitialViewProperties",value:function(e,t,n,r){if(e){var i=e.background;i&&i.color&&(t.background=i.write({},r)),e.viewpoint&&(t.initialState={viewpoint:e.viewpoint.write({},r)}),e.rangeInfo&&(t.mapRangeInfo=e.rangeInfo.toJSON(r)),e.spatialReference&&(t.spatialReference=e.spatialReference.write({},r))}}},{key:"writeLayers",value:function(e,t,n,r){t[n]=this._writeLayers(e,r,"operational-layers")}},{key:"readSourceVersion",value:function(e,t){var n=t.version.split("."),r=(0,w.Z)(n,2),i=r[0],o=r[1];return new Eg(parseInt(i,10),parseInt(o,10))}},{key:"writeSourceVersion",value:function(e,t,n){t[n]="".concat(Vg.major,".").concat(Vg.minor)}},{key:"writeTables",value:function(e,t,n,r){var i=this._writeLayers(e,r,"tables");i.length&&(t[n]=i)}},{key:"thumbnailUrl",get:function(){return this.portalItem&&this.portalItem.thumbnailUrl||null},set:function(e){e?(this._override("thumbnailUrl",e),this._thumbnailFilename=this._generateCustomThumbnailFilename(e)):this._clearThumbnailOverride()}},{key:"load",value:function(e){return this.addResolvingPromise(this._loadFromSource()),Promise.resolve(this)}},{key:"loadAll",value:function(){var e=this;return(0,ju.GZ)(this,(function(t){t(e.ground,e.basemap,e.layers,e.tables)}))}},{key:"read",value:function(e,t){var n=this;t=Lg(Lg({},t),{},{origin:"web-map"});var r=this._getAuthoringPropsState();(0,vy.$Z)(this,e,(function(t){return(0,Z.Z)((0,R.Z)(_.prototype),"read",n).call(n,e,t)}),t),this._restoreAuthoringPropsFromState(r)}},{key:"write",value:function(e,t){if("loaded"!==this.loadStatus){var n=new F.Z("webmap:not-loaded","Web map must be loaded before it can be serialized");throw Ug.error("#toJSON()","Web map must be loaded before it can be serialized",this.loadError||this.loadStatus),n}return this._removeDanglingLayerRefs(),t=Lg(Lg({},t),{},{origin:"web-map",restrictedWebMapWriting:!0,webmap:this}),(0,Z.Z)((0,R.Z)(_.prototype),"write",this).call(this,e,t)}},{key:"save",value:(g=(0,O.Z)(T().mark((function e(t){var n,r,i;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},this._validateItem(),e.next=4,this._updateFromPromise;case 4:return e.next=6,this.load();case 6:return e.next=8,this._loadLayerContainers();case 8:return e.next=10,this._beforeSave();case 10:return this._validateMap(),n=this.portalItem,r={origin:"web-map",messages:[],writtenProperties:[],url:n.itemUrl&&(0,Xu.mN)(n.itemUrl),portal:n.portal||Ky.Z.getDefault()},i=this.write({},r),this._validateJSONForWriting(r,t),e.next=15,this._updateItemProperties(n);case 15:return e.next=17,this._updateItem(n,i,r);case 17:return e.next=19,this._updateItemThumbnail();case 19:return e.abrupt("return",n);case 20:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"saveAs",value:(m=(0,O.Z)(T().mark((function e(t,n){var r,i,o,a;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=n||{},r=this._getPortalItem(t),e.next=4,this._updateFromPromise;case 4:return e.next=6,this.load();case 6:return e.next=8,this._loadLayerContainers();case 8:return e.next=10,this._beforeSave();case 10:return this._validateMap(),i={origin:"web-map",messages:[],writtenProperties:[],url:null,portal:r.portal},o=this.write({},i),this._validateJSONForWriting(i,n),e.next=15,this._updateItemPropertiesForSaveAs(r);case 15:return a=this._getThumbnailState(),e.next=18,this._createItem(r,o,i,n);case 18:return this._restoreThumbnailFromState(a),e.next=21,this._updateItemThumbnail();case 21:return e.abrupt("return",r);case 22:case"end":return e.stop()}}),e,this)}))),function(e,t){return m.apply(this,arguments)})},{key:"updateFrom",value:(y=(0,O.Z)(T().mark((function e(t,n){var r;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this._updateFromInternal(t,n),this._updateFromPromise=r,e.next=4,r;case 4:r===this._updateFromPromise&&(this._updateFromPromise=null);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return y.apply(this,arguments)})},{key:"getLayerJSONFromResourceInfo",value:function(e){var t,n,r,i,o=this.resourceInfo;return this._collectAllLayersJSON((0,W.xH)([null==o||null==(t=o.baseMap)?void 0:t.baseMapLayers,null==o?void 0:o.operationalLayers,null==(n=this.basemap)||null==(r=n.resourceInfo)||null==(i=r.data)?void 0:i.baseMapLayers])).find((function(t){return t.id===e.id}))}},{key:"_collectAllLayersJSON",value:function(e){var t=this;return e.reduce((function(e,n){return e.push(n),"GroupLayer"===n.layerType&&(e=e.concat(t._collectAllLayersJSON(n.layers||[]))),e}),[])}},{key:"_writeLayers",value:function(e,t,n){var r=this;return t=Lg(Lg({},t),{},{layerContainerType:n}),e.map((function(e){return(0,B.Wg)((0,Lm.Nw)(e,"tables"===n?null:r.getLayerJSONFromResourceInfo(e),t))})).filter(Boolean).toArray()}},{key:"_loadFromSource",value:function(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-map"}):this.portalItem&&this.portalItem.id?this._loadFromItem(this.portalItem):Promise.resolve(null)}},{key:"_loadFromItem",value:function(e){var t=this;return e.load().catch((function(e){throw new F.Z("webmap:load-portal-item","Failed to load portal item",{error:e})})).then((function(){if("Web Map"!==e.type)throw new F.Z("webmap:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Map'",{type:e.type})})).then((function(){return e.fetchData()})).then((function(n){return t.resourceInfo=n,t._readAndLoadFromJSON(n,{origin:"web-map",portal:e.portal||Ky.Z.getDefault()})})).then((function(){return t._computeInitialViewpoint()}))}},{key:"_readAndLoadFromJSON",value:function(e,t){var n=this._validateJSON(e);return this.read(n,t),this._loadFromJSON(n,t)}},{key:"_validateJSON",value:function(e){var t=Eg.parse(e.version||"","webmap");return Vg.validate(t),e.version="".concat(t.major,".").concat(t.minor),e}},{key:"_loadFromJSON",value:function(e,t){var r=this,i={context:Lg(Lg({},t),{},{layerContainerType:"operational-layers"})};return this.portalItem&&(i.context.portal=this.portalItem.portal||Ky.Z.getDefault()),Promise.all([n.e(9351),n.e(317)]).then(n.bind(n,16886)).then((function(t){var n=t.populateOperationalLayers,o=[],a=e.operationalLayers;a&&a.length&&o.push(n(r.layers,a,i));var s=Lg(Lg({},i),{},{context:Lg(Lg({},i.context),{},{layerContainerType:"tables"}),defaultLayerType:"ArcGISFeatureLayer"}),u=e.tables;return u&&u.length&&o.push(n(r.tables,u,s)),(0,gr.as)(o).then((function(){}))}))}},{key:"_computeInitialViewpoint",value:(v=(0,O.Z)(T().mark((function e(){var t,n,r,i;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.initialViewProperties,!(null==(t=r)||null==(n=t.viewpoint)?void 0:n.targetGeometry)){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this._getExtentFromItem();case 5:(i=e.sent)&&((r=r?r.clone():new Tg).viewpoint=new wu.Z,r.viewpoint.targetGeometry=i,this.initialViewProperties=r);case 7:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"_getExtentFromItem",value:(h=(0,O.Z)(T().mark((function e(){var t,r,i,o;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=null==(t=this.initialViewProperties)?void 0:t.spatialReference,o=null==(r=this.portalItem)?void 0:r.extent,!i||!o){e.next=9;break}if(!i.isWGS84){e.next=4;break}return e.abrupt("return",o.clone());case 4:if(!i.isWebMercator){e.next=6;break}return e.abrupt("return",(0,zo.$)(o));case 6:return e.next=8,n.e(1747).then(n.bind(n,41747));case 8:return e.abrupt("return",e.sent.getGeometryServiceURL(this.portalItem).then((function(e){var t=new Qy.Z;return t.geometries=[o],t.outSpatialReference=i,(0,$y.i)(e,t)})).then((function(e){return e[0]})).catch((function(e){return Ug.error("Error projecting item's extent:",e),null})));case 9:return e.abrupt("return",null);case 10:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"_removeDanglingLayerRefs",value:function(){var e=this,t=this.applicationProperties,n=t&&t.viewing&&t.viewing.search,r=function(t){return!!e.allLayers.find((function(e){return e.id===t}))};n&&n.layers&&(n.layers=n.layers.filter((function(e){return r(e.id)}))),n&&n.tables&&(n.tables=n.tables.filter((function(t){return!!e.tables.find((function(e){return e.id===t.id}))})));var i=t&&t.editing&&t.editing.locationTracking;i&&i.info&&!r(i.info.layerId)&&(t.editing=null);var o=this.presentation&&this.presentation.slides;o&&o.forEach((function(e){e.visibleLayers&&(e.visibleLayers=e.visibleLayers.filter((function(e){return r(e.id)})))}))}},{key:"_validateMap",value:function(){if(!this.basemap||!this.basemap.baseLayers.length)throw new F.Z("webmap:save","Map does not have a valid basemap with a base layer.")}},{key:"_validateItem",value:function(){if(!this.portalItem)throw Ug.error("save: requires the portalItem property to be set"),new F.Z("webmap:portal-item-not-set","Portal item to save to has not been set on the WebMap");this._validateItemType(this.portalItem)}},{key:"_validateItemType",value:function(e){if(e.type!==Bg)throw new F.Z("webmap:portal-item-wrong-type",'Portal item needs to have type "'.concat(Bg,'"'))}},{key:"_loadLayerContainers",value:function(){var e=[];return this.basemap&&e.push(this.basemap.load()),this.ground&&e.push(this.ground.load()),(0,gr.as)(e).then((function(){}))}},{key:"_beforeSave",value:(d=(0,O.Z)(T().mark((function e(){var t,n,r,i,o;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=Ag(this.allLayers);try{for(n.s();!(r=n.n()).done;)"beforeSave"in(i=r.value)&&"function"==typeof i.beforeSave&&(o=i.beforeSave())&&t.push(o)}catch(a){n.e(a)}finally{n.f()}return e.next=5,(0,gr.as)(t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"_loadAllLayers",value:function(){var e=this._getAllLayersAndTables().map((function(e){return e.load()}));return(0,gr.as)(e).then((function(){}))}},{key:"_getAllLayersAndTables",value:function(){return this.allLayers.concat(this.allTables)}},{key:"_validateJSONForWriting",value:function(e,t){var n=e.messages.filter((function(e){return"error"===e.type})).map((function(e){return new F.Z(e.name,e.message,e.details)}));if(t.ignoreUnsupported&&(n=n.filter((function(e){return"layer:unsupported"!==e.name&&"symbol:unsupported"!==e.name&&"symbol-layer:unsupported"!==e.name&&"property:unsupported"!==e.name&&"url:unsupported"!==e.name}))),n.length>0)throw new F.Z("webmap:save","Failed to save webmap due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:n})}},{key:"_updateItemProperties",value:(f=(0,O.Z)(T().mark((function e(t){return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getWGS84Extent(this.initialViewProperties.viewpoint.targetGeometry);case 2:return t.extent=e.sent,e.next=5,this._updateTypeKeywords(t);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"_updateItemPropertiesForSaveAs",value:(p=(0,O.Z)(T().mark((function e(t){return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,Jy.ck)(t,Gg),(0,Jy.ck)(t,Yg),(0,Jy.ck)(t,$g),(0,Jy.ck)(t,Qg),(0,Jy.ck)(t,Xg),(0,Jy.ck)(t,"Offline Map Areas"),(0,Jy.ck)(t,"FieldMapsDisabled"),e.next=9,this._updateItemProperties(t);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"_getWGS84Extent",value:(c=(0,O.Z)(T().mark((function e(t){var n,r,i,o,a;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=t.clone().normalize()).length>1){i=Ag(n);try{for(i.s();!(o=i.n()).done;)a=o.value,r?a.width>r.width&&(r=a):r=a}catch(s){i.e(s)}finally{i.f()}}else r=n[0];return e.abrupt("return",this._projectToWGS84(r));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"_projectToWGS84",value:(l=(0,O.Z)(T().mark((function e(t){var r,i,o,a;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=t.spatialReference).isWGS84){e.next=3;break}return e.abrupt("return",t.clone());case 3:if(!r.isWebMercator){e.next=5;break}return e.abrupt("return",(0,zo.Sx)(t));case 5:return e.next=7,n.e(1747).then(n.bind(n,41747));case 7:return i=e.sent,e.next=10,i.getGeometryServiceURL(this.portalItem);case 10:return o=e.sent,(a=new Qy.Z).geometries=[t],a.outSpatialReference=bl.Z.WGS84,e.next=15,(0,$y.i)(o,a);case 15:return e.abrupt("return",e.sent[0]);case 16:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"_updateTypeKeywords",value:(u=(0,O.Z)(T().mark((function e(t){return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,Jy.qj)(t,qg),e.next=3,this._loadAllLayers();case 3:this._evalCollectorKeyword(t),this._evalDataEditingKeyword(t),this._evalOfflineKeyword(t),this._evalDeveloperBasemapKeyword(t),t.typeKeywords&&(t.typeKeywords=t.typeKeywords.filter((function(e,t,n){return n.indexOf(e)===t})));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"_evalCollectorKeyword",value:function(e){(0,Jy._$)(e,Gg)||(0,Jy._$)(e,$g)||(0,Jy._$)(e,Qg)||(0,Jy._$)(e,Xg)||!this._hasEditableFeatureLayer()?(0,Jy.ck)(e,Hg):(0,Jy.qj)(e,Hg)}},{key:"_evalDataEditingKeyword",value:function(e){this._hasEditableFeatureLayer()?(0,Jy.qj)(e,Kg):(0,Jy.ck)(e,Kg)}},{key:"_evalOfflineKeyword",value:function(e){!(0,Jy._$)(e,Yg)&&this._isOfflineCapableMap()?(0,Jy.qj)(e,Jg):(0,Jy.ck)(e,Jg)}},{key:"_evalDeveloperBasemapKeyword",value:function(e){!function(e){return!(null==e||!e.baseLayers.concat(e.referenceLayers).some(rl))}(this.basemap)?(0,Jy.ck)(e,eb):(0,Jy.qj)(e,eb)}},{key:"_hasEditableFeatureLayer",value:function(){var e=this;return this._getAllLayersAndTables().some((function(t){return t.loaded&&e._isFeatureServiceLayer(t)&&t.capabilities.operations.supportsEditing&&t.editingEnabled}))}},{key:"_isFeatureServiceLayer",value:function(e){return!("feature"!==e.type||!e.source||"feature-layer"!==e.source.type)}},{key:"_isOfflineCapableMap",value:function(){var e=this;return this._getAllLayersAndTables().filter((function(e){return"group"!==e.type})).every((function(t){return t.loaded&&e._isOfflineCapableLayer(t)}))}},{key:"_isOfflineCapableLayer",value:function(e){return this._isFeatureServiceLayer(e)&&e.capabilities.operations.supportsSync||("tile"===e.type||"vector-tile"===e.type)&&(e.capabilities.operations.supportsExportTiles||this._isExportableAGOLTileLayer(e)||rl(e))&&e.spatialReference.equals(this.initialViewProperties.spatialReference)}},{key:"_isExportableAGOLTileLayer",value:function(e){return"tile"===e.type&&(0,Pc.h3)(e.url)&&tb.some((function(t){return e.url.toLowerCase().indexOf("/"+t+"/")>-1}))}},{key:"_updateItem",value:(s=(0,O.Z)(T().mark((function e(t,n,r){return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.update({data:n});case 2:this._syncUpInstanceWithItem(t,n,r);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return s.apply(this,arguments)})},{key:"_createItem",value:(a=(0,O.Z)(T().mark((function e(t,n,r,i){var o,a,s;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=this.portalItem,a=!!(o&&o.id&&o.portal.user),s=t.portal,e.next=3,s._signIn();case 3:return e.next=5,this._canCopyItem(o,a,s);case 5:if(e.sent){e.next=7;break}throw new F.Z("webmap:save-as-copy-not-allowed","Owner of this map does not allow others to save a copy");case 7:return e.next=9,s.user.addItem({item:t,folder:i.folder,data:n});case 9:this.portalItem=t,this._syncUpInstanceWithItem(t,n,r);case 11:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return a.apply(this,arguments)})},{key:"_canCopyItem",value:(o=(0,O.Z)(T().mark((function e(t,n,r){return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=!((0,B.pC)(t)&&t.id&&t.typeKeywords&&t.typeKeywords.indexOf("useOnly")>-1),e.t0){e.next=10;break}if(e.t1=t.portal.portalHostname===r.portalHostname,!e.t1){e.next=9;break}if(e.t2=n,e.t2){e.next=8;break}return e.next=8,t.reload();case 8:e.t1="admin"===t.itemControl||"update"===t.itemControl;case 9:e.t0=e.t1;case 10:return e.abrupt("return",e.t0);case 11:case"end":return e.stop()}}),e)}))),function(e,t,n){return o.apply(this,arguments)})},{key:"_syncUpInstanceWithItem",value:function(e,t,n){fy.w.prototype.read.call(this,{version:t.version,authoringApp:t.authoringApp,authoringAppVersion:t.authoringAppVersion},{origin:"web-map",ignoreDefaults:!0,url:e.itemUrl&&(0,Xu.mN)(e.itemUrl)}),(0,hy.D)(n),this.resourceInfo=t}},{key:"_updateItemThumbnail",value:(i=(0,O.Z)(T().mark((function e(){return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.thumbnailUrl&&this._isOverridden("thumbnailUrl"),!e.t0){e.next=5;break}return e.next=4,this.portalItem.updateThumbnail({thumbnail:this.thumbnailUrl,filename:this._thumbnailFilename});case 4:this._clearThumbnailOverride();case 5:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"_getPortalItem",value:function(e){var t=Yy.default.from(e);return t.id&&((t=t.clone()).id=null),t.type||(t.type=Bg),t.portal||(t.portal=Ky.Z.getDefault()),this._validateItemType(t),t}},{key:"_updateFromInternal",value:(r=(0,O.Z)(T().mark((function e(t,n){var r,i,o,a,s,u;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=n||{},e.next=3,(0,N.LR)(t,"ready");case 3:if(this._updateInitialViewProperties(t,n),t.map!==this){e.next=7;break}r=Ag(t.allLayerViews);try{for(r.s();!(i=r.n()).done;)for(o=i.value,a=0,s=["visible","featureEffect"];a<s.length;a++)(u=s[a])in o&&u in o.layer&&o._isOverridden(u)&&(o.layer[u]=o[u])}catch(l){r.e(l)}finally{r.f()}case 7:return e.next=9,this._updateThumbnailUrl(t,n);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"_updateInitialViewProperties",value:function(e,t){var n;if(t.backgroundExcluded||(this.initialViewProperties.background=null==(n=e.background)?void 0:n.clone()),this.initialViewProperties.spatialReference=e.spatialReference.clone(),t.viewpointExcluded||(this.initialViewProperties.viewpoint=new wu.Z({rotation:e.rotation,scale:t.scalePreserved?e.scale:null,targetGeometry:this._getViewExtent(e)})),!t.widgetsExcluded){var r,i=Ag(e.persistableViewModels);try{for(i.s();!(r=i.n()).done;){r.value.updateWebDocument(this)}}catch(o){i.e(o)}finally{i.f()}}}},{key:"_getViewExtent",value:function(e){var t=e.center.clone().normalize(),n=e.extent.clone(),r=n.width/2;return n.xmin=t.x-r,n.xmax=t.x+r,n}},{key:"_updateThumbnailUrl",value:(t=(0,O.Z)(T().mark((function e(t,n){var r,i;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.thumbnailExcluded){e.next=2;break}return e.abrupt("return");case 2:return r=Fm(t,n.thumbnailSize),e.next=5,t.takeScreenshot({format:"png",width:r.width,height:r.height});case 5:i=e.sent,this._setAutoGeneratedThumbnail(i.dataUrl);case 7:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"_setAutoGeneratedThumbnail",value:function(e){this.thumbnailUrl=e,this._thumbnailFilename=null}},{key:"_clearThumbnailOverride",value:function(){this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"),this._thumbnailFilename=null}},{key:"_generateCustomThumbnailFilename",value:function(e){if((0,Xu.HK)(e)){var t=(0,Xu.sJ)(e),n=t&&t.mediaType,r=n&&Wg.get(n.toLowerCase())||null,i="thumbnail".concat(Date.now());return r?"".concat(i,".").concat(r):i}return null}},{key:"_getThumbnailState",value:function(){var e=this.thumbnailUrl;return e&&(e=this._isOverridden("thumbnailUrl")?e:(0,Xu.ZN)(e,"w","8192")),{thumbnailUrl:e,filename:this._thumbnailFilename}}},{key:"_restoreThumbnailFromState",value:function(e){this.thumbnailUrl=e.thumbnailUrl,this._thumbnailFilename=e.filename}},{key:"_getAuthoringPropsState",value:function(){return{authoringApp:this.authoringApp,authoringAppVersion:this.authoringAppVersion,isAuthoringAppSetByUser:this._isAuthoringAppSetByUser,isAuthoringAppVersionSetByUser:this._isAuthoringAppVersionSetByUser}}},{key:"_restoreAuthoringPropsFromState",value:function(e){e.isAuthoringAppSetByUser?this.authoringApp=e.authoringApp:this._isAuthoringAppSetByUser=!1,e.isAuthoringAppVersionSetByUser?this.authoringAppVersion=e.authoringAppVersion:this._isAuthoringAppVersionSetByUser=!1}}],[{key:"fromJSON",value:function(e){var t=e;if(!t)throw new F.Z("webmap:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:t})}}]),_}((0,fy.R)(Au.Z.LoadableMixin((0,hl.v)(pl))));nb.VERSION=Vg,(0,S._)([(0,U.Cb)({type:yg,json:{write:!0}})],nb.prototype,"applicationProperties",void 0),(0,S._)([(0,U.Cb)({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],nb.prototype,"authoringApp",null),(0,S._)([(0,Fu.c)("authoringApp")],nb.prototype,"writeAuthoringApp",null),(0,S._)([(0,U.Cb)({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],nb.prototype,"authoringAppVersion",null),(0,S._)([(0,Fu.c)("authoringAppVersion")],nb.prototype,"writeAuthoringAppVersion",null),(0,S._)([(0,U.Cb)({json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],nb.prototype,"basemap",void 0),(0,S._)([(0,U.Cb)({type:Ng,json:{write:{overridePolicy:function(e){return{enabled:!!(e&&e.length>0),ignoreOrigin:!0}}}}})],nb.prototype,"bookmarks",void 0),(0,S._)([(0,U.Cb)({type:pm,json:{read:{source:"mapFloorInfo"},write:{target:"mapFloorInfo"}}})],nb.prototype,"floorInfo",void 0),(0,S._)([(0,U.Cb)({type:Tg,nonNullable:!0,json:{read:{source:["background","initialState.viewpoint","mapRangeInfo","spatialReference"]},write:{ignoreOrigin:!0,target:{background:{type:Kv},"initialState.viewpoint":{type:wu.Z},mapRangeInfo:{type:vm},spatialReference:{type:bl.Z}}}}})],nb.prototype,"initialViewProperties",void 0),(0,S._)([(0,dy.r)("initialViewProperties")],nb.prototype,"readInitialViewProperties",null),(0,S._)([(0,Fu.c)("initialViewProperties")],nb.prototype,"writeInitialViewProperties",null),(0,S._)([(0,U.Cb)({json:{read:!1,write:{target:"operationalLayers",ignoreOrigin:!0}}})],nb.prototype,"layers",void 0),(0,S._)([(0,Fu.c)("layers")],nb.prototype,"writeLayers",null),(0,S._)([(0,U.Cb)({type:Yy.default})],nb.prototype,"portalItem",void 0),(0,S._)([(0,U.Cb)({json:{write:!0}})],nb.prototype,"presentation",void 0),(0,S._)([(0,U.Cb)()],nb.prototype,"resourceInfo",void 0),(0,S._)([(0,U.Cb)({readOnly:!0,type:Eg,json:{read:{source:"version"},write:{allowNull:!0,ignoreOrigin:!0,target:"version",isRequired:!0}}})],nb.prototype,"sourceVersion",void 0),(0,S._)([(0,dy.r)("sourceVersion")],nb.prototype,"readSourceVersion",null),(0,S._)([(0,Fu.c)("sourceVersion")],nb.prototype,"writeSourceVersion",null),(0,S._)([(0,U.Cb)({json:{read:!1,write:{ignoreOrigin:!0}}})],nb.prototype,"tables",void 0),(0,S._)([(0,Fu.c)("tables")],nb.prototype,"writeTables",null),(0,S._)([(0,U.Cb)()],nb.prototype,"thumbnailUrl",null),(0,S._)([(0,U.Cb)({type:Em,json:{write:!0}})],nb.prototype,"widgets",void 0),(0,S._)([(0,U.Cb)({type:zg,json:{read:!0,write:!0}})],nb.prototype,"utilityNetworks",void 0);var rb=nb=(0,S._)([(0,G.j)("esri.WebMap")],nb),ib=n(81023),ob=function(e,t){e.visible=t};var ab=function(){var e=(0,r.useRef)(null);Qu.Z.apiKey="AAPK789039d962bd4c77aa4b181dbd0b4407Tx1dIccUkYkjp9hp3BugwmxFdzAhroKRZYu1UxKVHUyW5IYSRwGQpxTWKCS-INN3";var t=(0,r.useRef)(null),n=(0,r.useContext)(cb),i=n.state.filters,o=n.dispatch;return(0,r.useEffect)((function(){t.current&&t.current.when((function(){var e=t.current.layers.filter((function(e){return Object.values(v).includes(e.id)}));Array.isArray(i)&&0!=i.length?e.forEach((function(e){return ob(e,i.includes(e.id))})):e.forEach((function(e){return ob(e,!0)}))}))}),[i]),(0,r.useEffect)((function(){e.current&&function(){var n=new rb({portalItem:{id:ib.Z.map,url:ib.c}});t.current=n;var r=new sy({container:e.current,map:n});r.popup.watch("visible",(function(e){e&&r.popup.close()})),r.on("click",(function(e){r.popup.fetchFeatures(e).then((function(e){var t={};e.promisesPerLayerView.forEach((function(e){e.promise.then((function(e){e.forEach((function(e){t=Object.assign({},t,e.attributes)}))})).then((function(){o({type:sb,payload:{buildingData:t}})}))}))}))}))}()}),[o]),r.createElement(r.Fragment,null,r.createElement("div",{className:"EsriMap-module--mapDiv--WeeNS",ref:e}))},sb="UPDATE_FOCUSSED_BUILDING",ub="UNFOCUS",lb={buildingData:null,filters:[]},cb=r.createContext(null),pb=function(e,t){var n,r;switch(t.type){case sb:return Object.assign({},e,{buildingData:null===(n=t.payload)||void 0===n?void 0:n.buildingData});case"UPDATE_FILTERS":return Object.assign({},e,{filters:null===(r=t.payload)||void 0===r?void 0:r.filters});case ub:return Object.assign({},e,{buildingData:null});default:return lb}};function fb(){var e=(0,r.useReducer)(pb,lb),t=e[0],n=e[1];return r.createElement("div",{className:"Home-module--mapContainer--6oQsI"},r.createElement(cb.Provider,{value:{state:t,dispatch:n}},r.createElement(_,null),r.createElement(ab,null)))}}}]);
//# sourceMappingURL=component---src-pages-index-tsx-bfd5d514d8ab8cb77a46.js.map